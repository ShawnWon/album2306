(function(e){function t(t){for(var a,o,r=t[0],l=t[1],d=t[2],c=0,h=[];c<r.length;c++)o=r[c],s[o]&&h.push(s[o][0]),s[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);g&&g(t);while(h.length)h.shift()();return n.push.apply(n,d||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],a=!0,o=1;o<i.length;o++){var r=i[o];0!==s[r]&&(a=!1)}a&&(n.splice(t--,1),e=l(l.s=i[0]))}return e}var a={},o={app:0},s={app:0},n=[];function r(e){return l.p+"static/js/"+({about:"about"}[e]||e)+"."+{about:"e303bedc","chunk-181affcf":"ee0b0921","chunk-1a01030c":"667d8f60","chunk-1c144800":"e8d31e32","chunk-1e3b6668":"de33331b","chunk-29caf8e0":"6520dd43","chunk-2d0aecdd":"91d50ba2","chunk-2d0d0999":"fdcda194","chunk-3411d1c8":"cbca3438","chunk-3c9adc10":"355cfc57","chunk-5a660951":"5ae27684","chunk-5afea25f":"e816e374","chunk-6b6dab90":"bffb49a5","chunk-0d12f359":"9c5c1cae","chunk-3e1b3264":"6b3d1670","chunk-72f9b014":"c1d76ef6","chunk-747cf2f1":"0738f3a2","chunk-7b6b29f2":"9722941a","chunk-7c8852a5":"ee2c0c26","chunk-8ddf6b2c":"edd12018","chunk-2f16aff6":"807782b1","chunk-cafbe074":"4e5fdb1a","chunk-a54652ec":"89ab413b","chunk-b1786d32":"c624ca36","chunk-c392e1ec":"45a6ca71","chunk-d6e6fb8c":"114ad74b","chunk-ebc79894":"98c72da2","chunk-2d0aa644":"796b2f8b","chunk-2d217117":"2fe63789","chunk-2d22906f":"41242404","chunk-2d22d042":"ff3dd7e3","chunk-2d212c17":"fa6db272"}[e]+".js"}function l(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],i={"chunk-181affcf":1,"chunk-1a01030c":1,"chunk-1c144800":1,"chunk-1e3b6668":1,"chunk-29caf8e0":1,"chunk-3411d1c8":1,"chunk-3c9adc10":1,"chunk-5a660951":1,"chunk-5afea25f":1,"chunk-0d12f359":1,"chunk-3e1b3264":1,"chunk-72f9b014":1,"chunk-7b6b29f2":1,"chunk-7c8852a5":1,"chunk-2f16aff6":1,"chunk-cafbe074":1,"chunk-a54652ec":1,"chunk-b1786d32":1,"chunk-c392e1ec":1,"chunk-d6e6fb8c":1,"chunk-ebc79894":1};o[e]?t.push(o[e]):0!==o[e]&&i[e]&&t.push(o[e]=new Promise(function(t,i){for(var a="static/css/"+({about:"about"}[e]||e)+"."+{about:"31d6cfe0","chunk-181affcf":"6cf79f90","chunk-1a01030c":"2f0ec972","chunk-1c144800":"4175fd33","chunk-1e3b6668":"dffbfcf6","chunk-29caf8e0":"25a6e80f","chunk-2d0aecdd":"31d6cfe0","chunk-2d0d0999":"31d6cfe0","chunk-3411d1c8":"35c06937","chunk-3c9adc10":"134aa342","chunk-5a660951":"ceb96694","chunk-5afea25f":"5cdce444","chunk-6b6dab90":"31d6cfe0","chunk-0d12f359":"afdb8011","chunk-3e1b3264":"a5925d91","chunk-72f9b014":"249d65da","chunk-747cf2f1":"31d6cfe0","chunk-7b6b29f2":"c7dd0ab8","chunk-7c8852a5":"88e63e31","chunk-8ddf6b2c":"31d6cfe0","chunk-2f16aff6":"b2377269","chunk-cafbe074":"430736d3","chunk-a54652ec":"a8767343","chunk-b1786d32":"42645b20","chunk-c392e1ec":"baa86d1a","chunk-d6e6fb8c":"4a9c8ab3","chunk-ebc79894":"8d8771a0","chunk-2d0aa644":"31d6cfe0","chunk-2d217117":"31d6cfe0","chunk-2d22906f":"31d6cfe0","chunk-2d22d042":"31d6cfe0","chunk-2d212c17":"31d6cfe0"}[e]+".css",s=l.p+a,n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var d=n[r],c=d.getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(c===a||c===s))return t()}var h=document.getElementsByTagName("style");for(r=0;r<h.length;r++){d=h[r],c=d.getAttribute("data-href");if(c===a||c===s)return t()}var g=document.createElement("link");g.rel="stylesheet",g.type="text/css",g.onload=t,g.onerror=function(t){var a=t&&t.target&&t.target.src||s,n=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");n.code="CSS_CHUNK_LOAD_FAILED",n.request=a,delete o[e],g.parentNode.removeChild(g),i(n)},g.href=s;var m=document.getElementsByTagName("head")[0];m.appendChild(g)}).then(function(){o[e]=0}));var a=s[e];if(0!==a)if(a)t.push(a[2]);else{var n=new Promise(function(t,i){a=s[e]=[t,i]});t.push(a[2]=n);var d,c=document.createElement("script");c.charset="utf-8",c.timeout=120,l.nc&&c.setAttribute("nonce",l.nc),c.src=r(e),d=function(t){c.onerror=c.onload=null,clearTimeout(h);var i=s[e];if(0!==i){if(i){var a=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,n=new Error("Loading chunk "+e+" failed.\n("+a+": "+o+")");n.type=a,n.request=o,i[1](n)}s[e]=void 0}};var h=setTimeout(function(){d({type:"timeout",target:c})},12e4);c.onerror=c.onload=d,document.head.appendChild(c)}return Promise.all(t)},l.m=e,l.c=a,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(i,a,function(t){return e[t]}.bind(null,a));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/jianying/",l.oe=function(e){throw console.error(e),e};var d=window["webpackJsonp"]=window["webpackJsonp"]||[],c=d.push.bind(d);d.push=t,d=d.slice();for(var h=0;h<d.length;h++)t(d[h]);var g=c;n.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"054f":function(e,t,i){"use strict";i.d(t,"a",function(){return a});i("6b54"),i("a481");function a(e){var t=e,i=new Date;return t=t.replace(/yyyy|YYYY/,i.getFullYear()),t=t.replace(/MM/,i.getMonth()+1>9?(i.getMonth()+1).toString():"0"+(i.getMonth()+1)),t=t.replace(/dd|DD/,i.getDate()>9?i.getDate().toString():"0"+i.getDate()),t}},"07f5":function(e,t,i){e.exports=i.p+"static/img/tipsTu.3f473185.png"},"08b0":function(t,i,a){"use strict";a.d(i,"a",function(){return f});a("a481"),a("28a5");var o=a("f5b3"),s=a("89d6"),n=(a("5ad2"),a("e091")),r=a("a09a"),l=a("738b"),d=a("5841"),c=a("1dd3"),h=a("b2a9"),g=a("103a"),m=a("d80f"),p=a("ff08"),u=(a("ec06"),a("eb9b"));function f(t,i,a){var f,y,_,v,w,b,I;f=i.detailJson,y=i.pageId,w=i.isPhotoChange,b=i.isChangeModel;var S=SVG(y);f.pageList[t].content.itemList;v=i.vm;var x=localStorage.getItem(v.pageKey.diytype),k=localStorage.getItem(v.pageKey.thumbnailToken),O={loadComplete:!1,imgArr:[]};if(i.isEdit,b){null==S&&(S=SVG().addTo("#div_"+t),S.attr({id:"svg_"+t,sp:t}),S.click(function(e){console.log(this.attr("sp")),v.goEditor(this.attr("sp"),e.target,e)}));var L=S.defs(),T=(L.clip(),L.mask()),C=(L.filter(),f.pageList[t].content.itemList);if("calendar"!=f.diyType&&"year_calendar"!=f.diyType&&"week_calendar"!=f.diyType&&"week_calendar"!=f.diyType&&"wall_calendar"!=f.diyType&&"mug_cup"!=f.diyType&&"fashion_photo"!=f.diyType){var P={x:0,y:0};if(P.w=f.pageList[t].diyDisplayWidth,P.h=f.pageList[t].diyDisplayHeight,S.viewbox(P.x,P.y,P.w,P.h),0==t&&v.screenShotCanvas&&v.isCloudTeam){localStorage.getItem(v.pageKey.isPart);v.isPart}}for(var j=0;j<C.length;j++){var A=C[j];if(void 0==A.moveable&&(A.moveable="no"),"image"==A.media.mediaType){if(""!=A.media.imgPath){if(A.isVideo?-1==A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))&&(A.media.imgPath=Object(g["d"])(A.media.imgPath)+""+Object(g["a"])(A.media.imgPath,A,v.pageKey)):(-1==A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))&&-1==A.media.imgPath.indexOf("img.alicdn.com")&&(A.media.imgPath=Object(g["d"])(A.media.imgPath)+""+Object(g["a"])(A.media.imgPath,A,v.pageKey)),-1!=A.media.imgPath.indexOf("img.alicdn.com")&&(A.media.imgPath=Object(g["d"])(A.media.imgPath)+Object(g["a"])(A.media.imgPath,A,v.pageKey))),-1!=A.media.imgPath.indexOf("img/nophoto.jpg")&&A.cutArea&&A.cutArea.fromAiCut&&(A.media.imgPath="img/nophoto.jpg"),A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))>-1&&A.media.imgPath.indexOf("?token=")>-1&&-1==A.media.imgPath.indexOf(k)&&-1==A.media.imgPath.indexOf("img.alicdn.com")&&-1==A.media.imgPath.indexOf("img/nophoto.jpg")&&(A.media.imgPath=Object(g["g"])(A.media.imgPath,k)),A.media.imgPath.indexOf("?token=")>-1){var N=A.media.imgPath.split("?token=");A.media.imgPath=N[0]}A.media.isDisplay&&j==C.length-1||O.imgArr.push(A.media.imgPath)}}else if("advancedImageMask"==A.media.mediaType&&1==A.visible){if(A.media.defaultState=!1,-1==A.media.maskSource.indexOf(Object(g["d"])(A.media.maskSource))&&-1==A.media.maskSource.indexOf("img.alicdn.com")&&(A.media.maskSource=Object(g["d"])(A.media.maskSource)+Object(g["a"])(A.media.maskSource,A,v.pageKey)),-1!=A.media.maskSource.indexOf("img.alicdn.com")&&(A.media.maskSource=Object(g["d"])(A.media.maskSource)+Object(g["a"])(A.media.maskSource,A,v.pageKey)),-1==A.media.factMaskSource.indexOf(Object(g["d"])(A.media.factMaskSource))&&(A.media.factMaskSource=Object(g["d"])(A.media.factMaskSource)+""+Object(g["a"])(A.media.factMaskSource,A,v.pageKey)),-1==A.media.bgSource.indexOf(Object(g["d"])(A.media.bgSource))&&(A.media.bgSource=Object(g["d"])(A.media.bgSource)+""+Object(g["a"])(A.media.bgSource,A,v.pageKey)),-1!=A.media.maskSource.indexOf("img/nophoto.jpg")&&(A.media.maskSource="img/nophoto.jpg",A.media.defaultState=!0),A.media.maskSource.indexOf(Object(g["d"])(A.media.maskSource))>-1&&A.media.maskSource.indexOf("?token=")>-1&&-1==A.media.maskSource.indexOf(k)&&-1==A.media.maskSource.indexOf("img.alicdn.com")&&-1==A.media.maskSource.indexOf("img/nophoto.jpg")&&(A.media.maskSource=Object(g["g"])(A.media.maskSource,k)),A.media.maskSource.indexOf("?token=")>-1){N=A.media.maskSource.split("?token=");A.media.maskSource=N[0]}A.media.factMaskSource.indexOf(Object(g["d"])(A.media.factMaskSource))>-1&&A.media.factMaskSource.indexOf("?token=")>-1&&-1==A.media.factMaskSource.indexOf(k)&&(A.media.factMaskSource=Object(g["g"])(A.media.factMaskSource,k)),A.media.bgSource.indexOf(Object(g["d"])(A.media.bgSource))>-1&&A.media.bgSource.indexOf("?token=")>-1&&-1==A.media.bgSource.indexOf(k)&&(A.media.bgSource=Object(g["g"])(A.media.bgSource,k)),""!=A.media.maskSource&&O.imgArr.push(A.media.maskSource),A.media.isSimple?""!=A.media.factMaskSource&&O.imgArr.push(A.media.factMaskSource):""!=A.media.bgSource&&O.imgArr.push(A.media.bgSource)}else"text"==A.media.mediaType&&1==A.visible?A.media.font.textPath?(-1==A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))&&(A.media.font.textPath=d["a"].baseUrl2+""+A.media.font.textPath),A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))>-1&&A.media.imgPath.indexOf("?token=")>-1&&-1==A.media.imgPath.indexOf(k)&&(A.media.imgPath=Object(g["g"])(A.media.imgPath,k)),A.media.font.textPath&&O.imgArr.push(A.media.imgPath)):(A.media.text=A.media.text.replace(/\r\n/g,"\n"),A.media.text=A.media.text.replace(/\r/g,"\n")):"svg"==A.media.mediaType&&(""!=A.media.imgPath&&-1==A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))&&(A.media.imgPath=Object(g["d"])(A.media.imgPath)+Object(g["a"])(A.media.imgPath,A,v.pageKey)),A.media.imgPath.indexOf(Object(g["d"])(A.media.imgPath))>-1&&A.media.imgPath.indexOf("?token=")>-1&&-1==A.media.imgPath.indexOf(k)&&(A.media.imgPath=Object(g["g"])(A.media.imgPath,k)));if(A.media.isBG)A.location.x,A.location.y,A.location.width,A.location.height;if("image"==A.media.mediaType&&"no"==A.moveable&&1==A.media.isBG&&("calendar"==f.diyType||"year_calendar"==f.diyType||"week_calendar"==f.diyType||"wall_calendar"==f.diyType||"mug_cup"==f.diyType||"fashion_photo"==f.diyType)){P={};I||"fashion_photo"==f.diyType?(P.x=A.location.x,P.y=A.location.y,P.w=A.location.width,P.h=A.location.height):(P.x=0,P.y=0,P.w=f.pageList[t].diyDisplayWidth,P.h=f.pageList[t].diyDisplayHeight),S.viewbox(P.x,P.y,P.w,P.h)}}for(var E=0;E<C.length;E++){var J;A=C[E];if(J=SVG("#group"+t+"_"+E)?SVG("#group"+t+"_"+E):S.group(),J.attr({id:"group"+t+"_"+E,style:"overflow:hidden"}),A.media.mediaType==m["a"].SELF_GROUP){1!=A.visible&&J.attr({display:"none"});var D={};D.pageImgJson=O,D.parentIndex=t,D.itemIndex=E;var B=new p["a"](J,A,D,v);B.allchange()}if("image"==A.media.mediaType&&"no"==A.moveable&&1==A.media.isBG&&""!=A.media.imgPath){if(v.isUpdate&&!i.isRepeat&&!a)continue;1!=A.visible&&J.attr({display:"none"});var K=new n["a"](J,A,O,t,E,v);K.initBgImg()}if("shape"==A.media.mediaType&&1==A.visible&&"no"==A.moveable&&1==A.media.isBG&&0==A.isDesignShape){var M=new c["a"](J,A,t,E,v);M.initBgShape()}else if("image"!=A.media.mediaType||1!=A.visible&&!A.tuCengVisible&&0!=A.tuCengVisible||"no"!=A.moveable||0!=A.media.isBG){if("image"==A.media.mediaType&&0==A.visible&&1==A.isDisplay&&"no"==A.moveable&&0==A.media.isBG&&E==C.length-1){2==f.templateInfo.coverper&&f.coverInfo.hascover&&(F=!0);W=new l["a"](J,A,t,E,f,F,v);W.initBleedLine()}}else{if(E!=C.length-1||"calendar"==f.diyType||"year_calendar"==f.diyType||"week_calendar"==f.diyType||"wall_calendar"==f.diyType||"mug_cup"==f.diyType||f.pageList.length<=1&&E==C.length-1&&""!=A.media.imgPath){if(E!=C.length-1||"photo"!=f.diyType&&"zaojiao"!=f.diyType||"true"!=v.isTeamBook&&1!=v.isTeamBook){if(1!=A.visible&&J.attr({display:"none"}),0==t||t==f.pageList.length-1){var U=new s["a"](J,A,O,t,E,!1,v,null,w);U.initDecorateImg()}else if(!A.barTypeSign){U=new s["a"](J,A,O,t,E,!1,v,null,w);U.initDecorateImg()}}else if(2==f.templateInfo.coverper&&f.coverInfo.hascover&&(F=!0),"fashion_photo"!=f.diyType){var W=new l["a"](J,A,t,E,f,F,v);W.initBleedLine()}}else if(A.isDisplay){var F;if(2==f.templateInfo.coverper&&f.coverInfo.hascover&&(F=!0),"fashion_photo"!=f.diyType)if("photo"==f.diyType&&0==t&&f.coverInfo.hascover&&!f.coverInfo.hasbackcover&&1==f.templateInfo.coverper&&!f.pageList[t].pageBleed&&A.media.imgPath){1!=A.visible&&J.attr({display:"none"});U=new s["a"](J,A,O,t,E,!1,v,null,w);U.initDecorateImg()}else{var W=new l["a"](J,A,t,E,f,F,v);W.initBleedLine()}}else{1!=A.visible&&J.attr({display:"none"});U=new s["a"](J,A,O,t,E,!1,v,null,w);U.initDecorateImg()}}if("svg"==A.media.mediaType){D={i:t,m:E};1!=A.visible&&J.attr({display:"none"});var R=new h["a"](J,A,D,v);R.initSvgImg()}if("advancedImageMask"==A.media.mediaType){1!=A.visible&&J.attr({display:"none"});D={pageImgJson:O,parentIndex:t,childIndex:E,id:"bgimg_photo_"+t+"_"+E,isEdit:!1,isPhotoChange:w},T=new o["a"](J,A,D,v);T.initMask()}if("image"==A.media.mediaType&&"yes"==A.moveable){1!=A.visible&&J.attr({display:"none"}),G=!I;U=new s["a"](J,A,O,t,E,G,v);U.initDecorateImg()}var q=!1;if("text"==A.media.mediaType&&"no"==A.moveable)if(A.media.font.textPath){var G=!1,z=!0;1!=A.visible&&J.attr({display:"none"});U=new s["a"](J,A,O,t,E,G,v,z);U.initDecorateImg()}else if(v.isSignleTempleBook){D={pageImgJson:O,pageIndex:t,itemIndex:E,isEdit:!1,vm:v};var H=new r["a"](J,A,D);H.initCustomText()}else A.moveable="yes",A.changeMove=!0,q=!0;if("text"==A.media.mediaType&&"yes"==A.moveable){var V;V=!I,1!=A.visible&&J.attr({display:"none"});D={pageImgJson:O,pageIndex:t,itemIndex:E,isEdit:V,vm:v},H=new r["a"](J,A,D);H.initCustomText(),q&&(A.moveable="no")}}if(0==t)try{var Y=!1;Object(u["a"])(v,Y)}catch(ee){console.log(ee)}}else{if(!SVG(y)){try{if(window._jylog){var X=localStorage.getItem(v.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计页面","警告","id为"+y+"的SVG节点不存在",JSON.parse(X).orderNo])}}catch(e){console.log(e)}return void v.$layer.alert("id为"+y+"的SVG节点不存在")}if(!SVG(_)){try{if(window._jylog){X=localStorage.getItem(v.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计页面","警告","id为"+_+"的group节点不存在",JSON.parse(X).orderNo])}}catch(e){console.log(e)}return void v.$layer.alert("id为"+_+"的group节点不存在")}}f.pageList[t].hasWarn=!1;for(j=0;j<f.pageList[t].content.itemList.length;j++){A=f.pageList[t].content.itemList[j];A.isBeyond&&"wall_calendar"!=x&&"other_object"!=x&&"mug_cup"!=x&&-1==f.pageList[t].title.indexOf("封面")&&-1==f.pageList[t].title.indexOf("封底")&&(f.pageList[t].hasWarn||(f.pageList[t].hasWarn=!0,!0))}var Q=JSON.stringify(f);v.$store.dispatch("updatePages",f),localStorage.setItem(v.pageKey.detailJson,Q);var Z="svg_"+t;f.pageList[t].hasWarn?SVG("#"+Z).addClass("warnBorderShadow"):(SVG("#"+Z).removeClass("warnBorderShadow"),$(".thBtn").hide(),$(".thp").hide())}},"0a73":function(e,t,i){"use strict";var a=i("b99b"),o=i.n(a);o.a},"0a92":function(e,t,i){"use strict";function a(e,t,i){var a={},o=e.transform("rotate");if(0==o)a.xspace=t,a.yspace=i;else if(o>0&&o<90){Math.sqrt(t*t+i*i),0!=t?Math.abs(Math.atan(i/t)):Math.PI/2,a.xspace=t,a.yspace=i}else o>=90&&o<180?(a.xspace=i,a.yspace=-t):o>=180&&o<270||o<=-0&&o>-90?(a.xspace=-t,a.yspace=-i):(o>=270&&o<360||o<=-90&&o>-180)&&(a.xspace=-i,a.yspace=t);return a}i.d(t,"a",function(){return a})},"0ddc":function(e,t,i){},"0efa":function(e,t,i){"use strict";var a=i("f5cd"),o=i.n(a);o.a},1:function(e,t){},"103a":function(e,t,i){"use strict";i.d(t,"d",function(){return o}),i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n}),i.d(t,"f",function(){return r}),i.d(t,"e",function(){return l}),i.d(t,"g",function(){return d}),i.d(t,"c",function(){return c}),i.d(t,"h",function(){return h});i("4917"),i("20d6"),i("a481"),i("28a5");var a=i("5841");function o(e){return-1!=e.indexOf(a["a"].thumbnailUrl)?a["a"].thumbnailUrl:-1!=e.indexOf(a["a"].baseUrl)?a["a"].baseUrl:-1!=e.indexOf(a["a"].baseUrl2)?a["a"].baseUrl2:-1!=e.indexOf(a["a"].baseUrl3)?a["a"].baseUrl3:!e||-1==e.indexOf("material/")&&-1==e.indexOf("yingxiangdiy/")&&-1==e.indexOf("commonUpload/")?!e||-1==e.indexOf(".svg")&&-1==e.indexOf(".xml")?e&&-1!=e.indexOf("oss-")?a["a"].ossPhotoUrl:e&&-1!=e.indexOf("img.alicdn.com")?"":e&&e.charAt(0)<="f"?a["a"].thumbnailUrl:-1!=e.indexOf(a["a"].orgBaseUrl)?a["a"].orgBaseUrl:a["a"].baseUrl:a["a"].thumbnailUrl:-1!=e.indexOf("yingxiangdiy/")?-1!=e.indexOf(a["a"].orgBaseUrl3)?a["a"].orgBaseUrl3:a["a"].baseUrl3:a["a"].thumbnailUrl}function s(e,t,i){localStorage.getItem(i.thumbnailToken);if(e&&(-1!=e.indexOf("material/")||-1!=e.indexOf("/yingxiangdiy/")||-1!=e.indexOf("commonUpload/"))&&t&&t.media&&"svg"!=t.media.mediaType){var a=0,s=0,n="advancedImageMask"==t.media.mediaType?t.location.maskFactWidth:t.location.factWidth,r="advancedImageMask"==t.media.mediaType?t.location.maskFactHeight:t.location.factHeight;if("image"==t.media.mediaType&&t.cutArea&&t.cutArea.fromAiCut&&(n=t.location.factWidth,r=t.location.factHeight),n=Math.floor(n),r=Math.floor(r),n>=r?a=n>=600?600:n:s=r>=600?600:r,-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+a+"x"+s;if(-1!=e.indexOf("commonUpload/")){e.split("commonUpload/");return e+"!"+a+"x"+s}if(-1!=e.indexOf("http")){var l=o(e);if(l&&-1!=e.indexOf(l))e=e.replace(l,"");else{var d=e.split("/"),c=d.findIndex(function(e){return"yingxiangdiy"==e});c>0&&d.splice(0,c),e="fs3015/"+d.join("/")}}var h=e.split("/");return h.splice(1,0,a+"x"+s),h.join("/")}if(e&&-1!=e.indexOf("img.alicdn.com"))return-1==e.indexOf("_600x600")?e+"_600x600":e;if("svg"==t.media.mediaType)return-1==e.indexOf("commonUpload/")?"mongo_yx/"+e:e;if(e&&e.charAt(0)<="f"){a=0,s=0;return n=t.location.factWidth,r=t.location.factHeight,n=Math.floor(n),r=Math.floor(r),n>=r?a=n>=600?600:n:s=r>=600?600:r,"mongo_yx/"+e+"!"+a+"x"+s}return e}function n(e,t,i,a,o){localStorage.getItem(o.thumbnailToken);var s=0,n=0;if(!e||-1==e.indexOf("material/")&&-1==e.indexOf("/yingxiangdiy/")&&-1==e.indexOf("commonUpload/")){if(e&&-1!=e.indexOf("img.alicdn.com"))return-1==e.indexOf("_600x600")?e+"_600x600":e;if(e&&-1!=e.indexOf(".xml"))return"mongo_yx/"+e;if(e&&e.charAt(0)<="f"){s=t,n=i,s=Math.floor(s),n=Math.floor(n);t=0,i=0;return s>=n?t=s>=600?600:s:i=n>=600?600:n,"mongo_yx/"+e+"!"+t+"x"+i}return e}if(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+s+"x"+n;if(-1!=e.indexOf("commonUpload/")){e.split("commonUpload/");return e+"!"+s+"x"+n}var r=e.split("/");return r.splice(1,0,s+"x"+n),r.join("/")}function r(e,t){if(e&&-1!=e.indexOf("material/")&&"svg"!=t.media.mediaType){if(-1!=e.indexOf(a["a"].thumbnailUrl)){(u=e.match(/!\d{1,3}x\d{1,3}/))&&(e=e.substring(0,u.index));var i=e.split("/"),o=i.findIndex(function(e){return"fs1020"==e});return o>0&&i.splice(o,1),i.join("/")}if(-1!=e.indexOf(a["a"].baseUrl3)){var s=0,n=0,r="advancedImageMask"==t.media.mediaType?t.location.maskFactWidth:t.location.factWidth,l="advancedImageMask"==t.media.mediaType?t.location.maskFactHeight:t.location.factHeight;return"image"==t.media.mediaType&&t.cutArea&&t.cutArea.fromAiCut&&(r=t.location.factWidth,l=t.location.factHeight),r=Math.floor(r),l=Math.floor(l),r>=l?s=r>=600?600:r:n=l>=600?600:l,e.replace(s+"x"+n+"/","")}}else{if(e&&-1!=e.indexOf("yingxiangdiy/")&&"svg"!=t.media.mediaType){var d=e.split("/"),c=d.findIndex(function(e){return"yingxiangdiy"==e});return c>0&&d.splice(c-1,1),d.join("/")}if(!e||-1==e.indexOf("commonUpload/")||"svg"==t.media.mediaType){if(e&&-1!=e.indexOf("oss-")&&"svg"!=t.media.mediaType){var h=e.split("oss-");return"oss-"+h[1]}if(e&&-1!=e.indexOf("img.alicdn.com")&&"svg"!=t.media.mediaType){var g=e.split("_600x600");return g[0]}if(e&&-1!=e.indexOf(".xml")){i=e.split("?token=");var m=i[0],p=m.split("/");o=p.findIndex(function(e){return"mongo_yx"==e});return o>0&&p.splice(o,1),p.join("/")}if(e&&-1!=e.indexOf("mongo_yx")){(u=e.match(/!\d{1,3}x\d{1,3}/))&&(e=e.substring(0,u.index));i=e.split("/"),o=i.findIndex(function(e){return"mongo_yx"==e});return o>0&&i.splice(o,1),i.join("/")}if(e&&-1!=e.indexOf(a["a"].thumbnailUrl)){if((u=e.match(/!\d{1,3}x\d{1,3}/))&&(e=e.substring(0,u.index)),-1==e.indexOf("commonUpload")){i=e.split(a["a"].thumbnailUrl);e=a["a"].thumbnailUrl+"commonUpload/"+i[1]}return e}return e}var u;if(-1!=e.indexOf(a["a"].thumbnailUrl))return(u=e.match(/!\d{1,3}x\d{1,3}/))&&(e=e.substring(0,u.index)),e;if(-1!=e.indexOf(a["a"].baseUrl3)){var f=e.split("/"),y=f.findIndex(function(e){return"commonUpload"==e});return y>0&&-1!=f[y+1].indexOf("x")&&f.splice(y+1,1),f.join("/")}}}function l(e,t,i){if(!e||-1==e.indexOf("material/")&&-1==e.indexOf("/yingxiangdiy/")&&-1==e.indexOf("commonUpload/")){if(e&&-1!=e.indexOf("img.alicdn.com"))return-1==e.indexOf("_600x600")?e+"_600x600":e;if(e&&-1!=e.indexOf(".xml"))return"mongo_yx/"+e;if(e&&e.charAt(0)<="f"){var a,o;n=0,r=0;return a=t.width,o=t.height,a=Math.floor(a),o=Math.floor(o),a>=o?n=a>=600?600:a:r=o>=600?600:o,"mongo_yx/"+e+"!"+n+"x"+r}return e}var s="";s="string"==typeof t?JSON.parse(t):t;var n=s.width,r=s.height;n=Math.floor(n),r=Math.floor(r);if(s.primaryImageInfo?s.primaryImageInfo:s,n>=r?n>=600&&(n=600,r=0):r>=600&&(r=600,n=0),-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+n+"x"+r;if(-1!=e.indexOf("commonUpload/")){e.split("commonUpload/");return e+"!"+n+"x"+r}var l=e.split("/");return l.splice(1,0,n+"x"+r),l.join("/")}function d(e,t){if(e.indexOf("?token=")>-1&&-1==e.indexOf(t)){var i=e.split("?token=");e=i[0]+"?token="+t}return e}function c(e){var t=!1,i=JSON.parse(decodeURIComponent(escape(window.atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))))).exp;console.log(i);var a=(new Date).getTime()/1e3;return console.log(a),console.log(Math.floor(a)+60>=i),Math.floor(a)+60>=i&&(t=!0),t}function h(e,t,i){var a=localStorage.getItem(i.thumbnailToken);if(!t||!t.media){if(-1!=e.indexOf("commonUpload/")){var o=e.split("commonUpload/");if(-1!=o[1].indexOf("?")){var s=o[1].split("?");return s[0]+"!200x0?token="+a}return o[1]+"!200x0?token="+a}return"mongo_yx/"+e+"!200x0?token="+a}if(t&&"svg"==t.media.mediaType)return"mongo_yx/"+e+"?token="+a;if(e&&e.charAt(0)<="f"){var n,r,l=0,d=0;return n=t.location.factWidth,r=t.location.factHeight,n=Math.floor(n),r=Math.floor(r),n>=r?l=n>=600?600:n:d=r>=600?600:r,"mongo_yx/"+e+"!"+l+"x"+d}return e}},"10dc":function(e,t,i){e.exports=i.p+"static/img/sheji1.9871476a.png"},1180:function(e,t,i){},"132a":function(e,t,i){},"14fc":function(e,t,i){"use strict";var a=i("87fc"),o=i.n(a);o.a},1503:function(e,t,i){"use strict";i.d(t,"a",function(){return a});i("6b54"),i("a481");function a(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});return t}},"15e1":function(e,t,i){e.exports=i.p+"static/img/jy.c47dce9a.png"},1631:function(e,t,i){},1640:function(e,t,i){e.exports=i.p+"static/img/noDrafts.2cfd3720.svg"},"1c43":function(e,t,i){"use strict";var a=i("f309"),o=i.n(a);o.a},"1c432":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"about"},[a("div",{staticClass:"orderId"},[a("a",{directives:[{name:"show",rawName:"v-show",value:e.is_byte,expression:"is_byte"}],staticStyle:{"font-size":"16px"},on:{click:function(t){return e.gosomthing()}}},[a("img",{attrs:{src:i("7108"),alt:""}})]),e._v("\n\t\t订单编号:"+e._s(e.orderNo))]),a("div",{staticClass:"list_box",staticStyle:{"padding-bottom":"60px"}},[e.designList&&0!=e.designList.length?e._e():a("div",{staticClass:"noDrafts"},[a("img",{attrs:{src:i("4002")}}),a("span",[e._v("暂无设计")])]),e._l(e.designList,function(t,i){return e.designList.length>0?a("div",{staticClass:"list new-list"},[a("i",{directives:[{name:"show",rawName:"v-show",value:14==t.signtype,expression:"item.signtype == 14"}]},[e._v("极速")]),a("img",{attrs:{src:""==t.previewimage?e.photourl:t.previewimage}}),a("div",[a("p",[e._v(e._s(t.name))]),a("span",[e._v(e._s(t.modifydate))]),a("ul",[a("button",{on:{click:function(i){return e.deleteItem(t.id)}}},[e._v("删除")]),a("button",{on:{click:function(i){return e.toDesign(t)}}},[e._v("编辑设计")])])])]):e._e()})],2),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.showshejitype,expression:"!showshejitype"}],staticClass:"she",on:{click:e.getSkuDesignType}},[e._v("添加新设计")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showshejitype,expression:"showshejitype"}],staticClass:"shejitype"},[a("div",{staticClass:"shejitype1"},[a("div",{staticClass:"shejititle"},[e._v("请选择设计方式")]),a("div",{staticClass:"shejipotho"},[a("div",{on:{click:e.createDesign}},[a("p",[e._v("常规设计")]),a("img",{attrs:{src:i("aeea"),alt:""}})]),a("div",{on:{click:e.creatEasyeDesign}},[a("p",[e._v("极速设计")]),a("img",{attrs:{src:i("10dc"),alt:""}})])]),e._m(0)]),a("div",{on:{click:e.cancleShowshejitype}},[e._v("取消")])])])},o=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"yangshi"},[i("span",[e._v("多样功能,更多选择")]),i("span",[e._v("快速填充,方便快捷")])])}],s=i("22ce"),n=s["a"],r=(i("c5fa"),i("b088"),i("2877")),l=Object(r["a"])(n,a,o,!1,null,"3ff53e88",null);t["default"]=l.exports},"1d89":function(e,t,i){e.exports=i.p+"static/img/add.d9e4a363.png"},"1dab":function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s});i("c5f6"),i("6b54"),i("a481"),i("28a5");var a=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;function o(e){if(/^(rgb|RGB)/.test(e)){for(var t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",o=0;o<t.length;o++){var s=Number(t[o]).toString(16);"0"===s&&(s+=s),s.length<2&&(s="0"+s),i+=s}return 7!==i.length&&(i=e),i}if(!a.test(e))return e;var n=e.replace(/#/,"").split("");if(6===n.length)return e;if(3===n.length){var r="#";for(o=0;o<n.length;o+=1)r+=n[o]+n[o];return r}}function s(e){var t=e.toString(16);switch(t.length){case 0:t="#000000";break;case 1:t="#00000"+t;break;case 2:t="#0000"+t;break;case 3:t="#000"+t;break;case 4:t="#00"+t;break;case 5:t="#0"+t;break;case 6:t="#"+t;break}return t}},"1db1":function(e,t,i){"use strict";i.d(t,"a",function(){return o});var a=i("d225"),o=function e(t){Object(a["a"])(this,e)}},"1dd3":function(e,t,i){"use strict";i.d(t,"a",function(){return d});var a=i("d225"),o=i("b0b4"),s=i("1dab"),n=i("66a2"),r="dMaskShape_",l="bgshape_",d=function(){function e(t,i,o,s,n){Object(a["a"])(this,e),this.parent=t,this.objJson=i,this.i=o,this.m=s,this.vm=n}return Object(o["a"])(e,[{key:"initBgShape",value:function(){var e=this,t=e.objJson;if(!SVG("#"+l+"_"+e.i+"_"+e.m)){var i=e.parent.rect(),a=t.media.color;a=Object(s["b"])(a),i.attr({id:l+e.i+"_"+e.m,fill:a,ty:t.media.mediaType,x:t.location.x,y:t.location.y,width:t.location.width,height:t.location.height,preserveAspectRatio:"none",style:"pointer-events: none"})}}},{key:"initMaskShape",value:function(){var e,t=this;if(SVG("#"+r+t.i+"_"+t.m))return SVG("#"+r+t.i+"_"+t.m);e=t.parent.rect();var i=t.vm.$store.getters.detailJson,a=i.pageList[t.i].content.itemList[0].location.x,o=i.pageList[t.i].content.itemList[0].location.y,s=i.pageList[t.i].content.itemList[0].location.width,l=i.pageList[t.i].content.itemList[0].location.height;if("photo"==i.diyType){var d=i.pageList[t.i].diyWorkAreaWidth/i.pageList[t.i].workAreaWidth,c=i.pageList[t.i].content.itemList[0].location.x,h=i.pageList[t.i].content.itemList[0].location.y,g=n["a"].productBleedSpace*d,m=c+n["a"].productBleedSpace*d,p=h+n["a"].productBleedSpace*d;if(2==i.templateInfo.coverper&&i.coverInfo.hascover&&0==t.i&&i.pageList[0].iscover){g=n["a"].yignkeProductBleedSpace*d,m=c+n["a"].yignkeProductBleedSpace*d,p=h+n["a"].yignkeProductBleedSpace*d;var u=localStorage.getItem(t.vm.pageKey.rk);4==u&&(g=n["a"].rkBleedSpace*d,m=c+n["a"].rkBleedSpace*d,p=h+n["a"].rkBleedSpace*d)}a=m,o=p,s=i.pageList[t.i].content.itemList[0].location.width-2*g,l=i.pageList[t.i].content.itemList[0].location.height-2*g}return e.attr({id:r+t.i+"_"+t.m,x:a,y:o,width:s,height:l}),e}}]),e}()},"201f":function(e,t,i){"use strict";i.d(t,"b",function(){return o}),i.d(t,"c",function(){return s}),i.d(t,"a",function(){return n});i("ac4d"),i("8a81"),i("ac6a"),i("7514"),i("28a5");var a=i("d80f");function o(e,t,i,o,s){if(t.stroke){var n="";if(s)n=a["a"].TEXT_STROKE+"_"+i+"_"+o+"_"+s;else{n=a["a"].TEXT_STROKE+"_"+i+"_"+o;s=0}var r=SVG("#"+n);r&&r.remove();var l=[];l.push("stroke:"+t.stroke.strokeColor),l.push("stroke-width:"+t.stroke.strokeWidth);var d=e.clone();d.attr({style:e.attr("style")+l.join(";")+";",id:n}),e.parent().add(d,s)}}function s(e,t){var i=e.$store.getters.idNameJson,a=e.$store.getters.currentDesignFonts;for(var o in a)for(var s=a[o],n=0;n<s.length;n++){var r=s[n],l=r.split("_"),d=t.pageList[l[0]].content.itemList[l[1]],c=SVG("#text_"+r),h="textStroke_"+r;if("text"==d.media.mediaType&&d.media.font.id){var g=i[o];FontDetect.isFontLoaded(g)?(c.font({family:g}),console.log(g+"字体设置-重置")):FontDetect.onFontLoaded(g,function(e){console.log(g+"字体下载成功-重置"),c.font({family:g});var t=SVG("#"+h);t&&t.font({family:g})},function(e){console.log(g+"字体下载失败-重置")},{msTimeout:3e4})}}}function n(e,t){var i=e.find("tspan");if(i.length>1)if(t.media.lineSpace){var a=t.media.font.pointSize*t.media.lineSpace*1.13,o=!1,s=!0,n=!1,r=void 0;try{for(var l,d=i[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var c=l.value;console.log(c.text()),""!=c.text()&&" "!=c.text()&&"\n"!=c.text()||c.text("　"),o&&c.dy(a),o=!0}}catch(y){n=!0,r=y}finally{try{s||null==d.return||d.return()}finally{if(n)throw r}}}else{var h=!0,g=!1,m=void 0;try{for(var p,u=i[Symbol.iterator]();!(h=(p=u.next()).done);h=!0){var f=p.value;""!=f.text()&&" "!=f.text()||f.text("　")}}catch(y){g=!0,m=y}finally{try{h||null==u.return||u.return()}finally{if(g)throw m}}}}},"20ca":function(e,t,i){"use strict";function a(e,t){var i;return function(){clearTimeout(i);var a=this,o=arguments;i=setTimeout(function(){e.apply(a,o)},t)}}t["a"]=a},"214a":function(e,t,i){"use strict";var a=i("4694"),o=i.n(a);o.a},"22ce":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2__),D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("bd86"),_api_getJson__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("4cbb"),_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("103a"),_storagekey__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("b60d"),_baseUrl__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("5841"),timeOutEvent;__webpack_exports__["a"]={name:"newdrafts",data:function(){return{orderNo:"",designList:[],token:"",is_byte:!1,query:{},photourl:__webpack_require__("c97a"),fromDesign:!1,isBlankDraft:!1,hasDraft:!1,is_alipay:!1,designsorce:"",showshejitype:!1,fromAlipyShopPaid:null,fromAlipyShop:null,fromJianYingDesign:null,sku:"",pageKey:_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"],canGoNewPage:!1}},created:function(){var e;console.log("drafts sku======",this.$route.query),this.sku=this.$route.query.sku;var t=this;for(var i in $.ajax((e={url:_baseUrl__WEBPACK_IMPORTED_MODULE_7__["a"].basicUrl+"/member/checkSkuType.do?sku="+this.sku,type:"POST",data:{sku:this.sku},contentType:"application/json; charset=utf-8"},Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_3__["a"])(e,"type","POST"),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_3__["a"])(e,"async",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_3__["a"])(e,"success",function(e){console.log(e),1!=e.data.type&&3!=e.data.type&&4!=e.data.type&&5!=e.data.type&&9!=e.data.type||(t.canGoNewPage=!0)}),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_3__["a"])(e,"error",function(e){console.log(e)}),e)),$("#divclick").click(),_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"])localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"][i]);for(var a in _storagekey__WEBPACK_IMPORTED_MODULE_6__["c"])localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["c"][a]);this.query=this.$route.query,this.fromDesign=this.$route.query.fromDesign,this.fromAlipyShopPaid=this.$route.query.fromAlipyShopPaid,this.fromAlipyShopPaid||(this.fromAlipyShopPaid=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShopPaid));var o=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromJianYingDesign);1!=o&&"1"!=o||(this.fromJianYingDesign=!0),this.fromAlipyShop=this.$route.query.fromAlipyShop,1!=this.$route.query.fromJianYingDesign&&"1"!=this.$route.query.fromJianYingDesign||(this.fromJianYingDesign=!0,localStorage.setItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromJianYingDesign,1),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShopPaid),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShop),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShopCartEdit));var s=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"].token),n=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"].orderInfo);s?this.token=s:(this.token=this.$route.query.token,console.log("this.$route.query.token:"+this.$route.query.token)),this.orderNo=n?JSON.parse(n).orderNo:this.$route.query.orderNo,this.queryList(this.token);var r=navigator.userAgent.toLowerCase(),l=localStorage.getItem("isAlipay");("alipayclient"==r.match(/AlipayClient/i)||l||"undefined"!=typeof my)&&(this.is_alipay=!0,this.designsorce="is_alipay",loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}})),"toutiaomicroapp"==r.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0);r=navigator.userAgent;var d=r.indexOf("Android")>-1||r.indexOf("Linux")>-1;console.log("isAndroid:"+d),this.is_byte||(history.pushState({state:1},null,window.location.href),window.addEventListener("popstate",this.returnback,!1))},mounted:function(){},methods:{toDesign:function(e){navigator.userAgent.toLowerCase();var t=navigator.userAgent,i=this,a=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),o="design";this.canGoNewPage&&(o="design_new"),a||i.is_byte?!a&&i.is_byte?this.$router.push({name:o,query:{token:i.token,sku:e.sku,minnum:e.pnum,maxnum:99,gid:e.goodsid,pid:e.productid,id:e.templateid,p:e.pnum,uid:e.id,history:!0}}):i.is_byte?location.href=o+"?uid="+e.id+"&history=true&sku="+e.sku+"&id="+e.templateid+"&token="+i.token+"&p="+e.pnum+"&gid="+e.goodsid+"&pid="+e.productid:location.href=o+"?uid="+e.id+"&history=true&designsorce="+this.designsorce:this.$router.push({name:o,query:{uid:e.id,history:!0,designsorce:this.designsorce}})},deleteItem:function(t){console.log(t);var i=this;i.$layer.confirm("是否需要删除？",{btn:["确定","取消"]},function(){try{window._jylog&&window._jylog.push(["按钮点击","草稿箱","删除草稿",t,i.orderNo])}catch(e){console.log(e)}i.$layer.closeAll(),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_4__["f"])({id:t,token:i.token}).then(function(e){e.result&&i.queryList(i.token)})},function(){i.$layer.closeAll()})},returnback:function(){if("1"==this.fromAlipyShopPaid||1==this.fromAlipyShopPaid||"1"==this.fromAlipyShop||1==this.fromAlipyShop||this.fromJianYingDesign)my.navigateBack({});else{var e=this.$route.query.returnURL,t="";if(e&&(t=decodeURIComponent(e)+"/photo/list.do?orderNo="+this.orderNo+"&terminal=1&info=#",-1!=window.location.href.indexOf("https")&&-1==t.indexOf("https")&&-1==t.indexOf("sjky."))){var i=t.split("http");t="https"+i[1]}this.is_byte?(console.log("111111111"),alert("1111111"),tt.miniProgram.navigateBack({delta:1e3})):location.href=t}},gosomthing:function(){tt.miniProgram.navigateBack({delta:1e3})},queryList:function(t){var i=this,a=this.$route.query.orderNo,o=this.$route.query.source;o&&"fxxt"==o&&(a=this.$route.query.fxOrderNo),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_4__["g"])({token:t,orderno:a}).then(function(o){if(console.log(o),o.data&&o.data.length>0){localStorage.setItem(i.pageKey.thumbnailToken,o.data[0].base64Token);var s=o.data[0].userdesigns;if(s&&s.length>0){for(var n=0;n<s.length;n++)""!=s[n].previewimage?s[n].previewimage=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_5__["d"])(s[n].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_5__["h"])(s[n].previewimage,{},i.pageKey):s[n].previewimage="";i.designList=s,i.hasDraft=!0}else i.hasDraft=!1,i.isBlankDraft=!0,i.designList=[]}else{o.data||i.$toast(o.msg,"text");try{window._jylog&&window._jylog.push(["草稿查询异常","草稿箱","草稿查询",t,a])}catch(e){console.log(e)}}})},gotouchstart:function(e){var t=this;clearTimeout(timeOutEvent),timeOutEvent=0,timeOutEvent=setTimeout(function(){t.deleteItem(e)},600)},gotouchend:function(){clearTimeout(timeOutEvent)},gotouchmove:function(){clearTimeout(timeOutEvent),timeOutEvent=0},createDesign:function createDesign(){var source=this.$route.query.source,str=window.location.href.split("?");function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var retuenUrl=url,temp="/(&"+arg+"=)([^&]*)/gi";eval(temp).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temp),"&"+replaceText));var temps="/([?])("+arg+"=)([^&]*)/gi";return eval(temps).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temps),"?"+replaceText)),retuenUrl}return url.indexOf("?")>0?url+"&"+replaceText:url+"?"+replaceText}var templatePageName="mtemplate";if(this.canGoNewPage&&(templatePageName="newmtemplate"),this.is_byte)return console.info("返回模板列表页面 sku=========",this.$route.query.sku),void this.$router.push({name:templatePageName,query:{token:this.$route.query.token,uid:this.$route.query.uid,sku:this.$route.query.sku,orderNo:this.orderNo,isContinueDesign:!1,history:!1,isPart:!1,isfirst:!0,hassort:0,hasDraft:this.hasDraft,source:source}});window.location.href=changeURLArg(templatePageName+"?"+str[1],"id",this.templateid)+"&hasDraft="+this.hasDraft},creatEasyeDesign:function(){var e=window.location.href.split("?"),t="loading?iswechat=true&"+e[1];this.is_byte,window.location.href=t},getSkuDesignType:function(){var e=this,t=this.$route.query.sku;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_4__["b"])({sku:t}).then(function(t){if(t.result){var i=t.data.type;i.split(",").length>1?e.showshejitype=!0:"0"==i?e.createDesign():creatEasyeDesign()}else e.createDesign()})},cancleShowshejitype:function(){this.showshejitype=!1}},beforeDestroy:function(){window.removeEventListener("popstate",this.returnback,!1)}}},2380:function(e,t,i){"use strict";var a=i("d509"),o=i.n(a);o.a},"238a":function(e,t,i){e.exports=i.p+"static/img/gualiIndex.02fad3ab.png"},"23d5":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("3b2b"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_3__),_api_getJson__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("4cbb"),_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("103a"),_storagekey__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("b60d"),timeOutEvent;__webpack_exports__["a"]={name:"drafts",data:function(){return{orderNo:"",designList:[],token:"",is_byte:!1,query:{},photourl:__webpack_require__("c97a"),fromDesign:!1,isBlankDraft:!1,hasDraft:!1,is_alipay:!1,designsorce:"",pageKey:_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"],fromAlipyShopPaid:null,fromAlipyShop:null,fromJianYingDesign:null,isPinduoduo:!1}},created:function(){for(var e in console.log("drafts sku======",this.$route.query),$("#divclick").click(),_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"])localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"][e]);for(var t in _storagekey__WEBPACK_IMPORTED_MODULE_6__["c"])localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["c"][t]);console.log(localStorage.getItem("e_detailJson")),this.query=this.$route.query,this.fromDesign=this.$route.query.fromDesign,this.fromAlipyShopPaid=this.$route.query.fromAlipyShopPaid,this.fromAlipyShopPaid||(this.fromAlipyShopPaid=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShopPaid));var i=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromJianYingDesign);1!=i&&"1"!=i||(this.fromJianYingDesign=!0),this.fromAlipyShop=this.$route.query.fromAlipyShop,1!=this.$route.query.fromJianYingDesign&&"1"!=this.$route.query.fromJianYingDesign||(this.fromJianYingDesign=!0,localStorage.setItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromJianYingDesign,1),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShopPaid),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShop),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["f"].fromAlipyShopCartEdit));var a=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"].token),o=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_6__["a"].orderInfo);a?this.token=a:(this.token=this.$route.query.token,console.log("this.$route.query.token:"+this.$route.query.token)),this.orderNo=o?JSON.parse(o).orderNo:this.$route.query.orderNo,this.queryList(this.token);var s=navigator.userAgent.toLowerCase(),n=localStorage.getItem("isAlipay");("alipayclient"==s.match(/AlipayClient/i)||n||"undefined"!=typeof my)&&(this.is_alipay=!0,this.designsorce="is_alipay",loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}})),"toutiaomicroapp"==s.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0,this.designsorce="is_byte");s=navigator.userAgent;var r=s.indexOf("Android")>-1||s.indexOf("Linux")>-1;console.log("isAndroid:"+r),history.pushState({state:1},null,window.location.href),window.addEventListener("popstate",this.returnback,!1),6!=this.orderNo.indexOf("_")||this.is_alipay||this.is_byte||(this.isPinduoduo=!0)},mounted:function(){},methods:{goWenjuan:function(){window.open("https://shoujitaobao.wjx.cn/vm/Q0Bn9Cn.aspx#")},toDesign:function(e){navigator.userAgent.toLowerCase();var t=navigator.userAgent,i=this,a=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);a||i.is_byte?!a&&i.is_byte?this.$router.push({name:"design",query:{token:i.token,sku:e.sku,minnum:e.pnum,maxnum:99,gid:e.goodsid,pid:e.productid,id:e.templateid,p:e.pnum,uid:e.id,history:!0,designsorce:this.designsorce}}):i.is_byte?location.href="design?uid="+e.id+"&history=true&sku="+e.sku+"&id="+e.templateid+"&token="+i.token+"&p="+e.pnum+"&gid="+e.goodsid+"&pid="+e.productid+"&designsorce="+this.designsorce:this.$router.push({name:"design",query:{uid:e.id,history:!0,designsorce:this.designsorce}}):this.$router.push({name:"design",query:{uid:e.id,history:!0,designsorce:this.designsorce}})},deleteItem:function(t){console.log(t);var i=this;i.$layer.confirm("是否需要删除？",{btn:["确定","取消"]},function(){try{window._jylog&&window._jylog.push(["按钮点击","草稿箱","删除草稿",t,i.orderNo])}catch(e){console.log(e)}i.$layer.closeAll(),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_4__["f"])({id:t,token:i.token}).then(function(e){e.result&&i.queryList(i.token)})},function(){i.$layer.closeAll()})},returnback:function(){if("1"==this.fromAlipyShopPaid||1==this.fromAlipyShopPaid||"1"==this.fromAlipyShop||1==this.fromAlipyShop||this.fromJianYingDesign)my.navigateBack({});else{var e=this.$route.query.returnURL,t="";if(e&&(t=decodeURIComponent(e)+"/photo/list.do?orderNo="+this.orderNo+"&terminal=1&info=#",-1!=window.location.href.indexOf("https")&&-1==t.indexOf("https")&&-1==t.indexOf("sjky."))){var i=t.split("http");t="https"+i[1]}this.is_byte?(console.log("111111111"),tt.miniProgram.navigateBack({delta:1e3})):location.href=t}},gosomthing:function(){tt.miniProgram.navigateBack({delta:1e3})},queryList:function(t){var i=this,a=this.$route.query.orderNo,o=this.$route.query.source;o&&"fxxt"==o&&(a=this.$route.query.fxOrderNo),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_4__["g"])({token:t,orderno:a}).then(function(o){if(console.log(o),o.data&&o.data.length>0){localStorage.setItem(i.pageKey.thumbnailToken,o.data[0].base64Token);var s=o.data[0].userdesigns;if(s&&s.length>0){for(var n=0;n<s.length;n++)s[n].previewimage?s[n].previewimage=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_5__["d"])(s[n].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_5__["h"])(s[n].previewimage,{},i.pageKey):s[n].previewimage="";i.designList=s,i.hasDraft=!0}else i.hasDraft=!1,i.isBlankDraft=!0,i.designList=[]}else{o.data||i.$toast(o.msg,"text");try{window._jylog&&window._jylog.push(["草稿查询异常","草稿箱","草稿查询",t,a])}catch(e){console.log(e)}}}).catch(function(i){console.log(i);try{window._jylog&&window._jylog.push(["草稿查询异常2","草稿箱","草稿查询",t,a])}catch(e){console.log(e)}})},gotouchstart:function(e){var t=this;clearTimeout(timeOutEvent),timeOutEvent=0,timeOutEvent=setTimeout(function(){t.deleteItem(e)},600)},gotouchend:function(){clearTimeout(timeOutEvent)},gotouchmove:function(){clearTimeout(timeOutEvent),timeOutEvent=0},createDesign:function createDesign(){var source=this.$route.query.source,str=window.location.href.split("?");function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var retuenUrl=url,temp="/(&"+arg+"=)([^&]*)/gi";eval(temp).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temp),"&"+replaceText));var temps="/([?])("+arg+"=)([^&]*)/gi";return eval(temps).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temps),"?"+replaceText)),retuenUrl}return url.indexOf("?")>0?url+"&"+replaceText:url+"?"+replaceText}if(this.is_byte)return console.info("返回模板列表页面 sku=========",this.$route.query.sku),void this.$router.push({name:"mtemplate",query:{token:this.$route.query.token,uid:this.$route.query.uid,sku:this.$route.query.sku,orderNo:this.orderNo,isContinueDesign:!1,history:!1,isPart:!1,isfirst:!0,hassort:0,returnURL:this.$route.query.returnURL,hasDraft:this.hasDraft,source:source}});var sUserAgent=navigator.userAgent.toLowerCase(),u=navigator.userAgent,_this=this,isIOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(isIOS){var that=this,url=window.location.href,sku=that.getUrlKey(url,"sku"),flagURL=that.getUrlKey(url,"flagURL"),orderNo=that.getUrlKey(url,"orderNo"),memberid=that.getUrlKey(url,"memberid"),returnURL=that.getUrlKey(url,"returnURL"),id=that.getUrlKey(url,"id"),num=that.getUrlKey(url,"num"),spmc=that.getUrlKey(url,"spmc"),token=that.getUrlKey(url,"token");this.$router.push({name:"mtemplate",query:{sku:sku,flagURL:flagURL,orderNo:orderNo,memberid:memberid,returnURL:returnURL,id:id,num:num,spmc:spmc,token:token,hasDraft:this.hasDraft,source:source}})}else window.location.href=changeURLArg("mtemplate?"+str[1],"id",this.templateid)+"&hasDraft="+this.hasDraft},getUrlKey:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null}},beforeDestroy:function(){window.removeEventListener("popstate",this.returnback,!1)},destroyed:function(){}}},"23ed":function(e,t,i){"use strict";i.d(t,"a",function(){return a});i("4917");function a(){var e=o(navigator.userAgent.toLowerCase());return e}function o(e){var t="iphone"==e.match(/iphone/i),i="huawei"==e.match(/huawei/i),a="honor"==e.match(/honor/i),o="oppo"==e.match(/oppo/i),s="pacm00"==e.match(/pacm00/i),n="vivo"==e.match(/vivo/i),r="mi "==e.match(/mi\s/i),l="mix "==e.match(/mix\s/i),d="redmi"==e.match(/redmi/i),c="sm-"==e.match(/sm-/i);return t?"iphone":i||a?"huawei":o||s?"oppo":n?"vivo":r||d||l?"xiaomi":c?"samsung":"default"}},2510:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"ss"}},[i("div",{staticClass:"weui-popup__container popup-bottom sjky-point-none temp-out",attrs:{id:"popTemplate1"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),i("div",{staticClass:"weui-popup__modal"},[i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner"},[i("a",{staticClass:"picker-button",attrs:{href:"javascript:;"},on:{click:function(t){return t.stopPropagation(),e.checkEnter(t)}}},[e._v("确定")]),i("a",{staticClass:"picker-button cancel",attrs:{href:"javascript:;"},on:{click:function(t){return t.stopPropagation(),e.close(t)}}},[e._v("取消")]),i("h1",{staticClass:"title sjky-title-site"},[e._v("单页替换")])])]),i("div",{staticClass:"modal-content sjky-modal-padding"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isPageListLoading,expression:"isPageListLoading"}],staticClass:"loading3"}),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.showInfo,expression:"showInfo"}],staticClass:"sjky-template sjky-template2"},e._l(e.tempList,function(t,a){return i("li",{key:t.id,class:{on:e.currentIndex==a},on:{click:function(t){return e.checkTemp(a)}}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:t.previewImagePath}})])])}),0),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.showInfoTitle,expression:"showInfoTitle"}],staticClass:"sjky-template sjky-template2"},e._l(e.tempListTitle,function(t,a){return i("li",{key:t.id,class:{on:e.currentIndex==a},on:{click:function(t){return e.checkTemp(a)}}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:t.previewImagePath}})])])}),0),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.showInfoFoot,expression:"showInfoFoot"}],staticClass:"sjky-template sjky-template2"},e._l(e.tempListFoot,function(t,a){return i("li",{key:t.id,class:{on:e.currentIndex==a},on:{click:function(t){return e.checkTemp(a)}}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:t.previewImagePath}})])])}),0),i("div",{directives:[{name:"show",rawName:"v-show",value:e.hasTempMoreBtn,expression:"hasTempMoreBtn"}],staticClass:"more-btn more",on:{click:function(t){return e.toDeatail()}}},[i("i",{staticClass:"sjky"},[e._v("")]),i("span",[e._v("整套模板")])])]),i("div",{staticClass:"cTit mA"},[i("div",{staticClass:"proTit"},[i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showInfo,expression:"!showInfo"}],staticClass:"on"},[e._v(e._s(e.title))]),e._l(e.tempPhoto,function(t,a){return i("span",{directives:[{name:"show",rawName:"v-show",value:e.showInfo,expression:"showInfo"}],key:t,staticClass:"v-binding ng-scope",on:{click:function(i){return e.loadDataPic(t,a)}}},[e._v(e._s(t)+"图")])})],2)])])])])},o=[],s=(i("7514"),{name:"TemplateModal",data:function(){return{currentIndex:1}},props:["showInfo","showInfoTitle","showInfoFoot","title","tempList","tempListTitle","tempListFoot","tempPhoto","pageKey","showModelInfo","hasTempMoreBtn","isPageListLoading","vm"],created:function(){var e=localStorage.getItem(this.pageKey.detailJson);if(e){var t=JSON.parse(e);t.pageList[0].iscover||(this.showInfo=!0,this.showInfoTitle=!1,this.showInfoFoot=!1)}!this.showInfo&&!this.showInfoTitle&&this.showInfoFoot},mounted:function(){this.hasTempMoreBtn?$("#popTemplate1").removeClass("temp-out-no"):$("#popTemplate1").addClass("temp-out-no")},methods:{checkTemp:function(e){this.currentIndex=e},close:function(){this.vm.drawingPadingBottom=.5,$.closePopup(),localStorage.setItem(this.pageKey.ableSelect,!1),$(".sjky-right-btn").css("bottom","1.2rem")},checkEnter:function(){this.vm.drawingPadingBottom=.5,this.$emit("checkEnter",this.currentIndex),this.close()},toDeatail:function(){this.vm.resetOldPosition(),this.$emit("toDeatail")},loadDataPic:function(e,t){var i=$(".proTit").find("span").eq(t+1);i.hasClass("on")||(i.addClass("on").siblings().removeClass("on"),this.$emit("loadData",e))}},watch:{tempList:function(e,t){this.currentIndex=0,null!=t&&t.length>0&&(this.currentIndex=t[0].id)}}}),n=s,r=(i("43ce"),i("2877")),l=Object(r["a"])(n,a,o,!1,null,"6c3c670e",null);t["a"]=l.exports},2531:function(e,t,i){},"288a":function(e,t,i){"use strict";var a=i("a062"),o=i.n(a);o.a},2916:function(e,t,i){},2927:function(e,t,i){"use strict";var a=i("978b"),o=i.n(a);o.a},"295d":function(e,t,i){"use strict";function a(e){return new Promise(function(t,i){FontDetect||i("字体下载依赖FontDetect库"),FontDetect.isFontLoaded(e)?t("success"):FontDetect.onFontLoaded(e,function(e){t("success")},function(e){i("fail")},{msTimeout:1e5})})}t["a"]=a},"2ad3":function(e,t,i){"use strict";var a=i("a6e9"),o=i.n(a);o.a},"2c48":function(e,t,i){"use strict";i("c5f6"),i("28a5"),i("a244")},"2cbf":function(e,t,i){"use strict";var a=i("a637"),o=i.n(a);o.a},"2d89":function(e,t,i){},"2e79":function(e,t,i){},"2f02":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAANNJREFUSEvN1KEOwjAQBuD/eLRuAjq5zmAwCAwKhdsMCoVBYDAYmAW5VztSsWRZ0t11YwmzTb7+d9cbYaaPZnLxP7Cxrmw+dSlVGpU4se4I4MRAJeFqOFm5AwhnDeqrUcFp5vbMuGhRFWxsviPQNQYVYWPdloAbA35glTSw7nmwFcky32BB9zFoMHFqizWDH7HlDyY2mSuI8ZyCBhP/Ag/2eCo++I6n4OKCdPCoJyfCfhBjcBXcw8UfkLh5/U2L6bk6cXuJx5t3/ZLWOxqWwPZ8NvgLzO5uF0jHTPoAAAAASUVORK5CYII="},"2ff8":function(e,t,i){e.exports=i.p+"static/img/tanchuangnew.56227197.png"},"324d":function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return o});i("d80f");function a(e){var t="",i=1,a=1;return e.flipX&&(i=-1),e.flipY&&(a=-1),t="matrix("+i+",0,0,"+a+",0,0)",t}function o(e,t){t.filters&&t.filters.length>0&&e.filterWith(function(e){for(var i in t.filters){var a,o,s,n;if("Contrast"==t.filters[i].type)a=t.filters[i].contrast>=0?1+t.filters[i].contrast/100:1-t.filters[i].contrast/-100*.6,o=[-.5*a+.5]/2,e.colorMatrix("matrix",[a,0,0,0,o,0,a,0,0,o,0,0,a,0,o,0,0,0,1,0]);if("ColorMatrix"==t.filters[i].type){var r=t.filters[i].matrix;e.colorMatrix("matrix",r)}if("Brightness"==t.filters[i].type)t.filters[i].brightness>=0?(s=1+t.filters[i].brightness/100*2,n=0):(s=1-t.filters[i].brightness/-100*.6,n=-.1),e.colorMatrix("matrix",[s,0,0,0,n,0,s,0,0,n,0,0,s,0,n,0,0,0,1,0])}for(var l=0;l<e.children().length;l++)e.children()[l]&&e.children()[l].attr({in:""})})}},"32d1":function(e,t,i){"use strict";i.d(t,"a",function(){return o});var a=i("5841");function o(e,t){var i={type:"image"};return"text"==t&&(i.type="text"),i.content=e,new Promise(function(e,t){try{$.ajax({url:a["a"].checkPhotoUrl+"security/content",contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",data:JSON.stringify(i),success:function(t){console.info("checkNewPhoto=============="),console.info(t),t.data&&"REJECTED"==t.data.resultAction?(e(t),i.type,i.type):e(t)},fail:function(e){reject(e)}})}catch(o){reject(o)}})}},3320:function(e,t,i){},3441:function(e,t,i){e.exports=i.p+"static/img/1.e62c56a7.png"},3523:function(e,t,i){e.exports=i.p+"static/img/pixelIns2.d71a65b2.svg"},3571:function(e,t,i){e.exports=i.p+"static/img/qrcode.f8ed957c.png"},"35f8":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAeCAIAAAA0IQ7mAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDcwN0ZCRTFBN0UxMTFFQjkyMzRGRUY2RjU5NTJFN0IiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDcwN0ZCRTJBN0UxMTFFQjkyMzRGRUY2RjU5NTJFN0IiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpENzA3RkJERkE3RTExMUVCOTIzNEZFRjZGNTk1MkU3QiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpENzA3RkJFMEE3RTExMUVCOTIzNEZFRjZGNTk1MkU3QiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pq5Ujb0AAAVlSURBVHja7FhtTFtVGD6n4c/4MNFMx5JNygbTLWTZTNQRJKAz/FphKMwMRDMzxcwF9YcBFQ1RYtlI1JAFQY1Gx0aWLFGKmcGBSIzCtkRmAp0GzMq2hGgbp4yWX9zj895ze2/v7b21FYwm65ub9vR8vO953u/bjGWew24mcrGbjNKA04DTgBNSYT4rK15Nbnj+z4D58Q9do0O8uckkQ1lwTZ2zVQp/5gk+7LPnVVbsmpzgr7c4COoFWxy3nU9wwwzrgc9P8IKClECK2Vmxt57ONjfx++4V5y+II10Yi18us9ODVv5vvcYPHmCZWcrOXWzmMist4Q+Vs+O9oqERiuAPlpp2R8K8fj+bmmbX/9Bk/X7dwpNU9nan6DomXnnTRi/DPr55k1LhIVmSUIdjHzHtF6nStJ/O1taJcEQEg8tbti+XV9B8YE7jqY6VvpNYpXE4gjFtw+qW7XQqHMFAaXwuWVk8h7gJgSMGh9o6fV7b4z1KR+SVogCtgJN8pF6MGYk2KpWEDfjoQgM+DbCkYFDp7iFs6qfp6n0nJWAsYaCMjNKDgfpAHG5P8GrriDOkS90F5mipu0fTLzjrgHElVbn6lVYTsHLuvOROj5k0uwGq96hxHPMjo9rP8goc14BJo0n+UWNq+9V5TZVmwJoWsKflVR2w3KCf0p8M+5TgEMlKW3t8WBJ9NsCys2U8sxuLNHP1GvFpeYk99ST9hCKiMaZlmvl57ezYuNi125jfV8NLS9gdt8sMZIiQ81evIV8IdQnhLeC0739Kcn+cYmeGMNaPKCW7+SMeuZooaWl3Alq3mwUCxhRusHYtv+1WYZu3jnQhRWHVOv9er3i3m09OsLw7+cQIm5kl5tV7pUZi1aoU3a+J3ryJ5a5DVqPxzh3GldR5kZNtU2lQArZtpT09x/S6oJ3ytjP/JZ25I2CiQCB2n9RoovrW1iqlmgCf6Ed6RAqFqZHAGR5J/kvi4z7e2U5jaDZzjXFENZosY/oFAEA3ptU2zU3wu3hda6tRFSQB+B+QWZdGPdy4QXR0xpcN6Zy6fZg7Tys8UZ8yubSlIVm/XscjXLcIp77g3wXscEVyDZhUj2G1FCuHnremg40b6FOfzMyKdel4ByaauyLOfJnSHVcVsMMVdbPwFw7x2keRC1hkid+zQ1haCJwNhWQvKXxf0KeuI4se566wcBiwpZ+TBiv3rBjwtq2Je7S/DXvTcbcbfSLFamQJgS3e6DBan2gjSQC+/oYfeBwBL15u5Q314oeL/NmnWXYW++gTck53HlQgRVBOiUsZKwMcComhs9ao+3kmETOgiu2ZTcZfQ+7Xfwq5ClDR8YmeD2Jdmr94mL7ODrPqKhKN5tTbzqv2sMUb6D2VhoM8FOL7H7PtHzFpO29VegLAVE7RIaO/TYkiYTF50cAQawFzPgMGnrtOAWA4sFpyWW4u4Zy44PK2C9+g1DgyE/TCKz0wO7RPuaDGY98IrNDC8mXAkSAVtSSefgsaOkLExpaxrCyT90IEVFOY7/pqkEJaCm1t43cVEux31Nz7/Tjz/wR48HP4NhsaZoUFTo1ACu9zyf6JV1ZMXqd2UdQ5qC6q5BeZkqdaOZFCkG/5AyVoNihcGxpdi79iP96ijMYDPzs6KdOocSttTuE9NSX3ONLCAvtzgfirTJR99XD7xA1C0o2HhcbG+eiQyQv6Tzlku7vhhKqHL4kBNdmi8Wg6HNt40Cskghl1aHFRPFxJU3iFrq7iRUVGc2LretDO/LyGELka9g+G2LffsaTrME/hb9oaj97QUPYaG7f6eWwVTfIPDZAlXSfja/B83MGu8Vo9l07/p5UGnAacBpwG/B/QXwIMABc531CdK+rkAAAAAElFTkSuQmCC"},"39b5":function(e,t,i){},"3a10":function(e,t,i){},"3d7d":function(e,t,i){e.exports=i.p+"static/img/14.23f07f62.png"},4002:function(e,t,i){e.exports=i.p+"static/img/noDrafts.4b4b85de.png"},"41be":function(e,t,i){"use strict";var a=i("c52e"),o=i.n(a);o.a},"430e":function(e,t,i){},"43ce":function(e,t,i){"use strict";var a=i("2d89"),o=i.n(a);o.a},"446c":function(e,t,i){e.exports=i.p+"static/img/4.70e62c89.png"},4694:function(e,t,i){},"473b":function(e,t,i){"use strict";var a={media:{isBG:!1,isImage:!1,font:{pointSize:22,fontColor:"#000000",isHorizontal:"true",isFontInit:!1,gravity:"left",id:1030155561,isItalic:!1,textDecoration:"",isBold:!1},text:"点击添加文字",charSpace:0,lineSpace:1.16,mediaType:"text"},layer:{alpha:1},printLocation:{x:100,y:100,width:100,height:100,rotation:0},location:{x:100,y:100,width:100,height:100,factWidth:1e4,factHeight:1e4,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:3e3,topEnable:!1,moveable:"yes"};t["a"]=a},"4ba4":function(e,t,i){"use strict";i.d(t,"a",function(){return m}),i.d(t,"b",function(){return p});i("28a5"),i("c5f6");var a=i("a244"),o=i("66a2"),s=o["a"].bookSpace,n=o["a"].rkBookSpace,r=o["a"].productBleedSpace,l=o["a"].productBleedSpace,d=o["a"].yignkeProductBleedSpace,c=o["a"].yignkeProductBleedSpace,h=o["a"].rkBleedSpace,g=o["a"].rkBleedSpace;function m(e,t,i,m,p,u,f,y,_,v,w,b,I,S){if(r=o["a"].productBleedSpace,l=o["a"].productBleedSpace,y.templateInfo.spinewidth&&""!=y.templateInfo.spinewidth&&(s=y.templateInfo.spinewidth,n=y.templateInfo.spinewidth),y.templateInfo.spinewidth||y.pageList[0].pageBleed&&y.pageList[0].pageBleed.m>2&&(s=y.pageList[0].pageBleed.m,n=y.pageList[0].pageBleed.m),!y.pageList[_].pageBleed||""==y.pageList[_].pageBleed||"photo"!=y.diyType&&"zaojiao"!=y.diyType)r=o["a"].productBleedSpace,l=o["a"].productBleedSpace,d=o["a"].yignkeProductBleedSpace,c=o["a"].yignkeProductBleedSpace,h=o["a"].rkBleedSpace,g=o["a"].rkBleedSpace;else{var x=y.pageList[_].pageBleed;r=Number(x.r),l=Number(x.t),d=Number(x.r),c=Number(x.t),h=Number(x.r),g=Number(x.t)}if(-1!=f.id().indexOf("decrorate")&&!f.attr("videoId")&&1934875331!=f.attr("tagid"))return!1;var k=f.id().split("_"),O=k[2];if("yes"!=y.pageList[_].content.itemList[O].moveable)return!1;var L,T,C=!1,P=Object(a["b"])(t,i,m,p,u);L=f.width(),T=f.height(),v&&(L=w,T=b);var j=Object(a["a"])(P.x,P.y,L,T,m),A=(f.id().split("_"),y.pageList[_].diyWorkAreaWidth/y.pageList[_].workAreaWidth),N=y.pageList[_].content.itemList[0].location.x,E=y.pageList[_].content.itemList[0].location.y;if(2==y.templateInfo.coverper&&y.coverInfo.hascover&&0==_&&y.pageList[0].iscover){N+d*A,E+c*A;var J=localStorage.getItem(e.pageKey.rk);4==J&&(N+h*A,E+g*A)}"calendar"==y.diyType||y.diyType;var D,B,K,M,$=y.pageList[_].content.itemList[0].location.width,U=y.pageList[_].content.itemList[0].location.height;if(D=N+r*A+5,B=E+l*A+5,K=N+$-r*A-5,M=E+U-l*A-5,2==y.templateInfo.coverper&&y.coverInfo.hascover&&0==_&&y.pageList[0].iscover){D=N+d*A+5,B=E+c*A+5,K=N+$-d*A-5,M=E+U-c*A-5;J=localStorage.getItem(e.pageKey.rk);4==J&&(D=N+h*A+5,B=E+g*A+5,K=N+$-h*A-5,M=E+U-g*A-5)}if("calendar"==y.diyType||"year_calendar"==y.diyType||"wall_calendar"==y.diyType){$=y.pageList[_].content.itemList[0].location.width;K=N+$-r*A;E=y.pageList[_].content.itemList[0].location.y,U=y.pageList[_].content.itemList[0].location.height;B=E+o["a"].calendarUpbleed*A,M=E+U-l*A}if("week_calendar"==y.diyType){D=N+o["a"].banhuaBleedSpace*A;$=y.pageList[_].content.itemList[0].location.width;K=N+$-o["a"].banhuaBleedSpace*A;E=y.pageList[_].content.itemList[0].location.y,U=y.pageList[_].content.itemList[0].location.height;B=E+o["a"].banhuaBleedSpace*A,M=E+U-o["a"].banhuaBleedSpace*A}if(I){if(2==y.templateInfo.coverper&&y.coverInfo.hascover&&0==_&&y.pageList[0].iscover){var W=D,F=(y.pageList[_].diyDisplayWidth-2*D-s*A)/2;J=localStorage.getItem(e.pageKey.rk);4==J&&(F=(y.pageList[_].diyDisplayWidth-2*D-n*A)/2);var R=D+F,q=y.pageList[_].diyDisplayWidth-D-F,G=y.pageList[_].diyDisplayWidth-D;j.x>=W&&j.x<=R&&(j.x<=W&&(C=!0),j.x+j.width>=R&&(C=!0)),j.x>=q&&j.x<=G&&(j.x<=q&&(C=!0),j.x+j.width>=G&&(C=!0))}}else{if(j.x<=D&&(C=!0,j.x<D&&S)){m=f.transform("rotate");var z="rotate(0,"+f.cx()+","+f.cy()+")";f.attr({transform:z});var H=D-j.x;f.x(t+H+5),z="rotate("+m+","+f.cx()+","+f.cy()+")",f.attr({transform:z}),f.borderControl.updateBorderAndControl(f.borderControl,f)}if(j.x+j.width>=K&&(C=!0,j.x+j.width>K&&S))if(j.width>K-D)alert("宽度将大于页面尺寸，为防止素材被裁切请调整！");else{m=f.transform("rotate"),z="rotate(0,"+f.cx()+","+f.cy()+")";f.attr({transform:z});H=j.x+j.width-K;f.x(t-H-5),z="rotate("+m+","+f.cx()+","+f.cy()+")",f.attr({transform:z}),f.borderControl.updateBorderAndControl(f.borderControl,f)}if(j.y<=B&&(C=!0,j.y<B&&S)){m=f.transform("rotate"),z="rotate(0,"+f.cx()+","+f.cy()+")";f.attr({transform:z});var V=B-j.y;f.y(i+V+5),z="rotate("+m+","+f.cx()+","+f.cy()+")",f.attr({transform:z}),f.borderControl.updateBorderAndControl(f.borderControl,f)}if(j.y+j.height>=M&&(C=!0,j.y+j.height>M&&S)){m=f.transform("rotate"),z="rotate(0,"+f.cx()+","+f.cy()+")";f.attr({transform:z});V=j.y+j.height-M;f.y(i-V-5),z="rotate("+m+","+f.cx()+","+f.cy()+")",f.attr({transform:z}),f.borderControl.updateBorderAndControl(f.borderControl,f)}}return C}function p(e,t,i,a,m){if(t.templateInfo.spinewidth&&""!=t.templateInfo.spinewidth&&(s=t.templateInfo.spinewidth,n=t.templateInfo.spinewidth),t.templateInfo.spinewidth||t.pageList[0].pageBleed&&t.pageList[0].pageBleed.m>2&&(s=t.pageList[0].pageBleed.m,n=t.pageList[0].pageBleed.m),t.pageList[i].pageBleed&&""!=t.pageList[i].pageBleed){var p=t.pageList[i].pageBleed;r=Number(p.r),l=Number(p.t),d=Number(p.r),c=Number(p.t),h=Number(p.r),g=Number(p.t)}var u=!1,f=t.pageList[i].diyWorkAreaWidth/t.pageList[i].workAreaWidth,y=t.pageList[i].content.itemList[0].location.x,_=t.pageList[i].content.itemList[0].location.y;if(2==t.templateInfo.coverper&&t.coverInfo.hascover&&0==i&&t.pageList[0].iscover){y+d*f,_+c*f;var v=localStorage.getItem(m.pageKey.rk);4==v&&(y+h*f,_+g*f)}"calendar"==t.diyType||t.diyType;var w,b,I,S,x=t.pageList[i].content.itemList[0].location.width,k=t.pageList[i].content.itemList[0].location.height;if(w=y+r*f+5,b=_+l*f+5,I=y+x-r*f-5,S=_+k-l*f-5,2==t.templateInfo.coverper&&t.coverInfo.hascover&&0==i&&t.pageList[0].iscover){w=y+d*f+5,b=_+c*f+5,I=y+x-d*f-5,S=_+k-c*f-5;v=localStorage.getItem(m.pageKey.rk);4==v&&(w=y+h*f+5,b=_+g*f+5,I=y+x-h*f-5,S=_+k-g*f-5)}if("calendar"==t.diyType||"year_calendar"==t.diyType||"wall_calendar"==t.diyType){x=t.pageList[i].content.itemList[0].location.width;I=y+x-r*f;_=t.pageList[i].content.itemList[0].location.y,k=t.pageList[i].content.itemList[0].location.height;b=_+o["a"].calendarUpbleed*f,S=_+k-l*f}if("week_calendar"==t.diyType){w=y+o["a"].banhuaBleedSpace*f+5;x=t.pageList[i].content.itemList[0].location.width;I=y+x-o["a"].banhuaBleedSpace*f;_=t.pageList[i].content.itemList[0].location.y,k=t.pageList[i].content.itemList[0].location.height;b=_+o["a"].banhuaBleedSpace*f,S=_+k-o["a"].banhuaBleedSpace*f}if(a){if(2==t.templateInfo.coverper&&t.coverInfo.hascover&&0==i&&t.pageList[0].iscover){var O=w,L=(t.pageList[i].diyDisplayWidth-2*w-s*f)/2;v=localStorage.getItem(m.page.rk);4==v&&(L=(t.pageList[i].diyDisplayWidth-2*w-n*f)/2);var T=w+L,C=t.pageList[i].diyDisplayWidth-w-L,P=t.pageList[i].diyDisplayWidth-w;e.x>=O&&e.x<=T&&(e.x<=O&&(u=!0),e.x+e.width>=T&&(u=!0)),e.x>=C&&e.x<=P&&(e.x<=C&&(u=!0),e.x+e.width>=P&&(u=!0))}}else e.x<=w&&(u=!0),e.x+e.width>=I&&(u=!0),e.y<=b&&(u=!0),e.y+e.height>=S&&(u=!0);return u}},"4cbb":function(e,t,i){"use strict";i("3b2b"),i("a481");var a=i("b775"),o=i("bc3a"),s=i.n(o),n=i("5841");console.log(n["a"].basicUrl);var r=s.a.create({baseURL:n["a"].taobanUrl,timeout:1e4});r.interceptors.request.use(function(e){return e},function(e){return console.log(e),Promise.reject(e)}),r.interceptors.response.use(function(e){var t=e.data;return t},function(e){return console.log("err"+e),Promise.reject(e)});var l=r;console.log(n["a"].evaluateUrl);var d=s.a.create({baseURL:n["a"].evaluateUrl,timeout:0});d.defaults.headers.retry=4,d.defaults.headers.retryDelay=1e3,d.interceptors.request.use(function(e){return e},function(e){return console.log(e),Promise.reject(e)}),d.interceptors.response.use(function(e){var t=e.data;return t},function(e){console.log("err"+e);var t=e.config;if(!t||!t.headers.retry)return Promise.reject(e);if(t.headers.__retryCount=t.headers.__retryCount||0,t.headers.__retryCount>=t.headers.retry)return Promise.reject(e);t.headers.__retryCount+=1;var i=new Promise(function(e){setTimeout(function(){e()},t.headers.retryDelay||1)});return i.then(function(){return d(t)})});var c=d;i.d(t,"e",function(){return h}),i.d(t,"o",function(){return g}),i.d(t,"bb",function(){return m}),i.d(t,"P",function(){return p}),i.d(t,"r",function(){return u}),i.d(t,"H",function(){return f}),i.d(t,"n",function(){return y}),i.d(t,"a",function(){return _}),i.d(t,"y",function(){return v}),i.d(t,"I",function(){return w}),i.d(t,"p",function(){return b}),i.d(t,"m",function(){return I}),i.d(t,"M",function(){return S}),i.d(t,"G",function(){return x}),i.d(t,"gb",function(){return k}),i.d(t,"L",function(){return O}),i.d(t,"E",function(){return L}),i.d(t,"cb",function(){return T}),i.d(t,"v",function(){return C}),i.d(t,"t",function(){return P}),i.d(t,"u",function(){return j}),i.d(t,"Q",function(){return A}),i.d(t,"eb",function(){return N}),i.d(t,"D",function(){return E}),i.d(t,"h",function(){return J}),i.d(t,"z",function(){return D}),i.d(t,"J",function(){return B}),i.d(t,"A",function(){return K}),i.d(t,"F",function(){return M}),i.d(t,"s",function(){return $}),i.d(t,"B",function(){return U}),i.d(t,"w",function(){return W}),i.d(t,"R",function(){return F}),i.d(t,"T",function(){return R}),i.d(t,"i",function(){return q}),i.d(t,"j",function(){return G}),i.d(t,"O",function(){return z}),i.d(t,"ab",function(){return H}),i.d(t,"Z",function(){return V}),i.d(t,"X",function(){return Y}),i.d(t,"Y",function(){return X}),i.d(t,"V",function(){return Q}),i.d(t,"W",function(){return Z}),i.d(t,"jb",function(){return ee}),i.d(t,"K",function(){return te}),i.d(t,"d",function(){return ie}),i.d(t,"l",function(){return ae}),i.d(t,"g",function(){return oe}),i.d(t,"N",function(){return se}),i.d(t,"lb",function(){return ne}),i.d(t,"f",function(){return re}),i.d(t,"S",function(){return le}),i.d(t,"hb",function(){return de}),i.d(t,"kb",function(){return ce}),i.d(t,"fb",function(){return he}),i.d(t,"U",function(){return ge}),i.d(t,"C",function(){return me}),i.d(t,"b",function(){return pe}),i.d(t,"x",function(){return ue}),i.d(t,"c",function(){return fe}),i.d(t,"db",function(){return ye}),i.d(t,"k",function(){return _e}),i.d(t,"q",function(){return ve}),i.d(t,"ib",function(){return we});function h(e){var t=e.id;return Object(a["a"])({url:"/diy/deleteimg?materialType=al&ids="+t,method:"post"})}function g(e){return Object(a["a"])({url:"member/ziTie?sku="+e,method:"post"})}function m(e,t,i){var o=encodeURIComponent(e);return Object(a["a"])({url:"member/nameCard?name="+o+"&sku="+t+"&token="+i,method:"post"})}function p(e){return Object(a["a"])({url:"member/qrcode/"+e,method:"post"})}function u(e){return Object(a["a"])({url:"/upload/previewimage",method:"post",data:e})}function f(){return Object(a["a"])({url:"/member/getS3UploadConfig",method:"post"})}function y(e){return Object(a["a"])({url:"/member/getCommonUploadConfig?token="+e,method:"post"})}function _(e){return Object(a["a"])({url:"/diy/appendMbUsedWords.do?wordid="+e,method:"post"})}function v(e){return l({url:"weixin_test3/calendar/2.0/check_order/"+e,method:"get"})}function w(e){return l({url:"weixin_test3/calendar/2.0/book3_order/"+e+"?type=1",method:"get"})}function b(e,t){return Object(a["a"])({url:"member/getDatebarLayoutStylesPic?motherid="+e+"&datestr="+t,method:"post"})}function I(e,t,i){return Object(a["a"])({url:"member/getChangeDatebarData?styleid="+e+"&datestr="+t+"&type="+i,method:"post"})}function S(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.href)||[,""])[1].replace(/\+/g,"%20"))||null}function x(e){return Object(a["a"])({url:"/list/getGoodsBysku?sku="+e,method:"post"})}function k(e){return Object(a["a"])({url:"list/scgjback?",method:"post",data:e})}function O(e){return Object(a["a"])({url:"list/getTokenDetail?token="+e,method:"get"})}function L(e,t){return Object(a["a"])({url:"/list/getPicListMobile?token="+e+(null==t||void 0==t||""==t?"":"&uuid="+t),method:"post"})}function T(e){return Object(a["a"])({url:"/member/msave",method:"post",data:e})}function C(){return Object(a["a"])({url:"weixin_test3/calendar/2.0/material",method:"get"})}function P(e,t,i,o,s,n,r){return Object(a["a"])({url:"/mlist/"+e+"/"+t+"?"+(null==i||void 0==i||""==i?"":"page="+i)+(null==o||void 0==o||""==o?"":"&mobilestyleid="+o)+(null==s||void 0==s||""==s?"":"&isJijian="+s)+(null==n||void 0==n||""==n?"":"&sort="+n)+(r?"&content="+r:""),method:"get"})}function j(e,t,i,o,s,n,r,l){return Object(a["a"])({url:"/mlist/more?"+(null==e||void 0==e||""==e?"":"token="+e)+(null==t||void 0==t||""==t?"":"&sku="+t)+(null==i||void 0==i||""==i?"":"&pnum="+i)+(null==o||void 0==o||""==o?"":"&page="+o)+(null==s||void 0==s||""==s?"":"&mobilestyleid="+s)+(null==n||void 0==n||""==n?"":"&content="+n)+(null==r||void 0==r||""==r?"":"&isJijian="+r)+(null==l||void 0==l||""==l?"":"&sort="+l),method:"post"})}function A(e,t){return Object(a["a"])({url:"/wechat/getWeixinToken?wsid="+e+"&shopname="+t,method:"get"})}function N(e){return Object(a["a"])({url:"/member/mtotal",method:"POST",data:e})}function E(e,t,i,o){return Object(a["a"])({url:"/list/getPicListCaiyun?msisdn="+e+"&startNum="+t+"&endNum="+i+"&hcyToken="+o,method:"POST"})}function J(e){return Object(a["a"])({url:"/upload/downloadCaiyun",method:"POST",data:e})}function D(e){var t=JSON.parse(JSON.stringify(e));return delete t.pageKey,Object(a["a"])({url:"/member/mload",method:"POST",data:t})}function B(e){return Object(a["a"])({url:"/member/teamload",method:"POST",data:e})}function K(e){return Object(a["a"])({url:"/member/mobileload",method:"POST",data:e})}function M(e){return Object(a["a"])({url:"/mlist/previewimage?tid="+e.tid+"&sku="+e.sku+"&mid="+e.mid+"&pnum="+e.pnum,method:"get"})}function $(e){return Object(a["a"])({url:"/info/getDetailText?styleid="+e,method:"get"})}function U(e){return Object(a["a"])({url:"/pagelist?id="+e.id+(null==e.mid?"":"&mid="+e.mid)+(null==e.pnum?"":"&pnum="+e.pnum)+(null==e.sku?"":"&sku="+e.sku),method:"post"})}function W(e,t,i,o){return o="de",Object(a["a"])({url:"/diy/newMaterial?fold="+e+"&pagenum="+i+"&tagid="+t+"&materialType="+o,method:"POST"})}function F(e){return Object(a["a"])({url:"/list/getdiyspecasmobile?goodsid="+e,method:"post"})}function R(e){return Object(a["a"])({url:"member/orderquery?designno="+e,method:"get"})}function q(e,t){return Object(a["a"])({url:"upload/apiSign?source="+e+"&url="+t,method:"get"})}function G(e){return Object(a["a"])({url:"upload/apiSignPost",method:"post",data:e})}function z(e){return Object(a["a"])({url:"member/video/checkpsw?uuid="+e.id+(null!=e.password?"&password="+e.password:""),method:"post"})}function H(e){return Object(a["a"])({url:"member/redesign?id="+e.id,method:"POST"})}function V(e){return Object(a["a"])({url:"member/querytoken?uid="+e.uid+(e.token?"&token="+e.token:"")+(e.openid?"&openid="+e.openid+"&avatarurl="+e.avatarurl+"&nickname="+e.nickname+"&membertype="+e.membertype:""),method:"POST"})}function Y(e){return Object(a["a"])({url:"/member/querydesignnum?uid="+e.uid,method:"POST"})}function X(e){return Object(a["a"])({url:"/member/querypreviewimage?uid="+e.uid,method:"POST"})}function Q(e){return Object(a["a"])({url:"/member/queryalbum?uid="+e.uid,method:"POST"})}function Z(e){return Object(a["a"])({url:"/member/querycurrdesignnum/"+e.uid,method:"POST"})}function ee(e){return Object(a["a"])({url:"/member/updatenickname?token="+e.token+"&nickname="+e.nickname+"&uid="+e.uid,method:"POST"})}function te(e){return Object(a["a"])({url:"/wechat/checkToken",method:"post",data:e})}function ie(e){return Object(a["a"])({url:"/member/checkuid?uid="+e.uid,method:"POST"})}function ae(e){return Object(a["a"])({url:"/member/getButtonSetBySku?sku="+e.sku,method:"POST"})}function oe(e){return Object(a["a"])({url:"/member/designdrafts?token="+e.token,method:"POST"})}function se(e){return Object(a["a"])({url:"/diy/mmaterial.do?token="+e.token+"&materialType=album&pagenum="+e.pagenum+"&pageSize="+e.pageSize,method:"POST"})}function ne(e){return Object(a["a"])({url:"/diy/mmaterial.do?token="+e.token+"&materialType=ma_u&pagenum="+e.pagenum,method:"POST"})}function re(e){return Object(a["a"])({url:"/member/deletedesigndrafts?id="+e.id+"&token="+e.token,method:"POST"})}function le(e){return Object(a["a"])({url:"/member/getextract",method:"POST",data:e})}function de(e){return Object(a["a"])({url:"/member/singleload",method:"POST",data:e})}function ce(e,t){return Object(a["a"])({url:"/upload/videobook",method:"POST",data:e,onUploadProgress:t})}function he(e){return Object(a["a"])({url:"/bookvideo/save",method:"POST",data:e})}function ge(e){return Object(a["a"])({url:"/ecd/picupmatting",method:"POST",data:e})}function me(e){return Object(a["a"])({url:"/list/getPhotoByids",method:"POST",data:e})}function pe(e){return Object(a["a"])({url:"/member/checkSkuDesignType?sku="+e.sku,method:"POST"})}function ue(e){return Object(a["a"])({url:"/mlist/previewimage?tid="+e.tid+"&sku="+e.sku+"&mid="+e.mid+"&pnum="+e.pnum+"&new=true",method:"get"})}function fe(e){return c({url:"/member/wenquan/check?uid="+e.uid,method:"POST"})}function ye(e){return c({url:"/member/wenquan/addinfo",method:"POST",data:e})}function _e(e){return Object(a["a"])({url:"/taobao/member/imageuid/"+e.uid,method:"POST"})}function ve(e){return Object(a["a"])({url:"/taobao/member/getDesignNo/"+e.uid,method:"POST"})}function we(e){return Object(a["a"])({url:"/member/tsinghuaEmba",method:"POST",data:e})}},"4edf":function(e,t,i){"use strict";var a=i("75be"),o=i.n(a);o.a},"4ffd":function(e,t,i){e.exports=i.p+"static/img/logo.13df3a17.png"},5031:function(e,t,i){"use strict";i("4917");!function(e){function t(){var t=i.clientWidth,o="}";!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)&&t>1024&&(t=750,o=";max-width:"+t+"px;margin-right:auto!important;margin-left:auto!important;}"),e.rem=t/7.5,/ZTE U930_TD/.test(navigator.userAgent)&&(e.rem=1.13*e.rem),/Android\s+4\.4\.4;\s+M351\s/.test(navigator.userAgent)&&(e.rem=e.rem/1.05),a.innerHTML="html{font-size:"+e.rem+"px!important;}body{font-size:"+t/320*12+"px"+o}var i=document.documentElement,a=document.createElement("style");i.firstElementChild.appendChild(a),e.addEventListener("resize",function(){t()},!1),e.addEventListener("pageshow",function(e){e.persisted&&t()},!1),t()}(window),function(){if(window.devicePixelRatio&&devicePixelRatio>=2){var e=document.documentElement,t=document.createElement("div"),i=document.createElement("body"),a=e.firstElementChild||e.firstChild;t.style.border=".5px solid transparent",i.appendChild(t),e.insertBefore(i,a),1==t.offsetHeight&&document.querySelector("html").classList.add("hairlines"),e.removeChild(i)}}()},"533d":function(e,t,i){e.exports=i.p+"static/img/u102.c56e5d7e.svg"},"56d7":function(t,i,a){"use strict";a.r(i);a("3b2b"),a("ac4d"),a("8a81"),a("ac6a"),a("a481"),a("6b54"),a("4917"),a("4b0a");var o=a("2bb1"),s=(a("7844"),a("5596")),n=(a("66b9"),a("b650")),r=(a("3647"),a("ea47")),l=(a("869a"),a("6869")),d=(a("c3a6"),a("ad06")),c=(a("e930"),a("8f80")),g=(a("18e9"),a("471a")),m=(a("5852"),a("d961")),p=(a("5f1a"),a("a3e2")),u=(a("cadf"),a("551c"),a("f751"),a("097d"),a("2b0e")),f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},y=[],_=(a("7f7f"),{name:"App",mounted:function(){var e=document.createElement("script");e.src="https://s19.cnzz.com/z_stat.php?id=1253519982&web_id=1253519982",e.language="JavaScript",document.body.appendChild(e),window._czc&&_czc.push(["_setAutoPageview",!1])},watch:{$route:{handler:function(e,t){setTimeout(function(){if(window._czc){var i=window.location,a=i.pathname+i.hash;window._czc.push(["_trackPageview",a,null])}if(void 0!=e.name){var o=e.name,s=t?t.name:"null";window._jylog&&window._jylog.push(["页面跳转",null,o,"从"+s+"跳转到"+o],"")}},300)},immediate:!0}}}),v=_,b=(a("5c0b"),a("2877")),I=Object(b["a"])(v,f,y,!1,null,null,null),S=I.exports,x=a("8c4f"),k=(a("e507"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"home",attrs:{id:"drawing"}},[i("div",[i("router-link",{attrs:{to:"/design"}},[e._v("路由跳转按钮")])],1),i("hello-world",{attrs:{msg:e.myString},on:{ListenChild:e.ShowChild}}),i("button",{on:{click:e.changPhotos}},[e._v("改变数据")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isopen,expression:"isopen"}],staticClass:"page",attrs:{id:"editSection"}},[e._m(0)])],1)}),O=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"maxW720 pb30 tc",staticStyle:{height:"100%"}},[i("div",{staticClass:"editParent",attrs:{id:"editParent"}})])}],L=(a("8e6e"),a("456d"),a("bd86")),T=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"hello"},[i("h1",[e._v(e._s(e.msg))]),i("button",{on:{click:e.ChildClick}},[e._v("点击向父组件传值")])])},C=[],P={name:"HelloWorld",props:{msg:String},methods:{ChildClick:function(){this.$emit("ListenChild","I am child.vue")}}},j=P,A=(a("0a73"),Object(b["a"])(j,T,C,!1,null,"a942e58a",null)),N=A.exports,E=a("2f62"),J=a("5841"),D=(a("3e8f"),a("f5b3"),a("89d6"),a("e091"),a("a09a"));function B(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function K(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?B(i,!0).forEach(function(t){Object(L["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):B(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var M={name:"home",data:function(){return{vPages:[],vPhotos:[],viewBoxArr:[],isopen:!0,myString:"我是helloword组件"}},components:{HelloWorld:N},created:function(){this.$store.dispatch("getJsonFun"),this.$store.dispatch("getOrderNo");JSON.parse(localStorage.getItem("calenderTemp"))},mounted:function(){},methods:{goEditor:function(e){alert("页面索引："+e)},editopen:function(e){alert("图片索引："+e)},changPhotos:function(){this.photos[0].size[0]=0,this.$store.dispatch("updatePhotos",this.photos),SVG("#ph_0").attr({x:this.photos[0].size[0]}),SVG("#ph_0").load(this.photos[1].img,function(){alert("图片替换成功")},function(){alert("图片下载失败")})},ShowChild:function(e){alert(e)}},computed:K({},Object(E["b"])(["detailJson"])),watch:{detailJson:function(){console.log("发生变化"),console.log(J["a"].baseUrl)}}},U=M,W=Object(b["a"])(U,k,O,!1,null,"dbe4f4ec",null),F=(W.exports,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"body-bg2"},[i("header",{attrs:{id:"audioPlay"}},[i("div",{staticClass:"weui-navbar coupon-navbar"},[i("a",{staticClass:"left sjky",on:{click:function(t){return e.goback()}}},[e._v("")]),i("span",{staticClass:"right"},[e.isSubmit?e._e():i("i",{staticClass:"sjky",attrs:{id:"share"},on:{click:function(t){return e.share()}}},[e._v("")])])])]),e.isNamePaste?i("div",{staticClass:"name_paste",on:{touchstart:e.calendartouchtouchstart,touchmove:e.calendartouchmove,touchend:e.calendartouchend}},[e._l(e.namePasteImgArr,function(t,a){return i("div",{key:a,staticClass:"name_paste_item",style:{display:a==e.pageIndex?"inline-block":"none"}},[i("img",{staticStyle:{width:"90%"},attrs:{src:t.image}})])}),i("canvas",{staticClass:"hideCanvas",staticStyle:{border:"1px solid #000000",display:"none"},attrs:{id:"paperCanvas",width:e.canvasW,height:e.canvasH}})],2):i("div",[e.isCalendar?i("calendar",{attrs:{detail:e.detailJson,pageLists:e.items,time:e.time,pageKey:e.pageKey,isSubmit:e.isSubmit,vm:e.vm,isNamePaste:e.isNamePaste}}):i("div",{staticClass:"magazine-viewport",staticStyle:{height:"100%",width:"100%"}},[i("div",{staticClass:"container"},[i("div",{staticClass:"magazine",attrs:{id:"flipbook"}})])])],1),i("footer",{directives:[{name:"show",rawName:"v-show",value:!e.isNamePaste,expression:"!isNamePaste"}],staticClass:"weui-btn-area sjky-btn-bottom bottomSubmit"},[e.isSubmit?i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh",attrs:{href:"javascript:void(0);"},on:{click:e.showSave}},[e._v("提交")]):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isNamePaste,expression:"!isNamePaste"}],staticClass:"btn-tips"},[e._v("\n\t    模糊和遮挡提示仅为页面提示，实际不会印刷哦\n\t  ")]),!e.isSubmit&&e.showSubmit?i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh",on:{click:function(t){return e.makeSimple()}}},[e._v("我也去做")]):e._e()]),i("footer",{directives:[{name:"show",rawName:"v-show",value:e.isNamePaste,expression:"isNamePaste"}],staticClass:"weui-btn-area sjky-btn-bottom bottomSubmit",attrs:{id:"isNamePaste"}},[e.isSubmit?i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh",attrs:{href:"javascript:void(0);"},on:{click:e.showSave}},[e._v("提交")]):e._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showHelp,expression:"showHelp"}],staticClass:"previewTips",on:{click:e.changeState}},[i("img",{attrs:{src:a("07f5")}})]),e._m(0),e._m(1),i("div",{staticClass:"weui-popup__container",attrs:{id:"addPop"}},[i("div",{staticClass:"weui-popup__overlay sjky-mask"}),i("div",{staticClass:"weui-popup__modal addressOut"},[i("address-form",{attrs:{pageKey:e.pageKey},on:{addinfo1:e.addinfo1,closep:e.closep}})],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design"},[i("div",{staticClass:"con",staticStyle:{"background-color":"#26c6da"}},[i("img",{attrs:{src:a("f46a")}}),i("p",{staticStyle:{color:"#ffffff"}},[e._v(e._s(e.wenanText))])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isSaving,expression:"isSaving"}],staticClass:"loading-design"},[e._m(2)]),i("form",{attrs:{id:"submitForm",method:"post"}})])}),R=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-popup__container",attrs:{id:"sharePop"}},[i("div",{staticClass:"weui-popup__overlay sjky-mask"}),i("div",{staticClass:"weui-popup__modal"},[i("img",{attrs:{src:a("cff1"),width:"100%"}}),i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh close-popup",attrs:{href:"javascript:void(0);"}},[e._v("关闭")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"submit-modal"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"})]),i("footer",{staticClass:"modal-buttons"},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"con",staticStyle:{"background-color":"#26c6da"}},[i("img",{attrs:{src:a("f46a")}}),i("p",{staticStyle:{color:"#ffffff"}},[e._v("正在提交中")])])}],q=a("7618"),G=(a("1180"),a("5031"),a("b354")),z=a.n(G),H=a("4cbb"),V=a("57b3"),Y=a("c192"),X=a("86cb"),Q=a("103a"),Z=a("cabc"),ee=a("b60d"),te=a("d5e8"),ie=a("ec06"),ae=a("6614"),oe=a("5b39"),se=a("295d"),ne=a("201f");function re(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function le(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?re(i,!0).forEach(function(t){Object(L["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):re(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var de={name:"preview",components:{Calendar:Y["a"],AddressForm:X["a"]},data:function(){return{name:"",flag:"",uid:null,isSubmit:!0,items:[],bookWidth:300,bookHeight:380,ss:"",savedays:"",p:null,orderNo:"",memberid:"",editType:1,pageKey:"",time:500,isBook:!1,isCalendar:!1,isSaving:!1,isTeamBook:!1,photoSize:"",isMiniProgram:!1,tbPass:"",isGongge:!1,isNamePaste:!1,ecdbookKey:!1,normalKey:null,showSubmit:!0,fromDesign:null,mshopSign:"",reqData:"",wsid:"",showHelp:!0,iswsid:!1,isShowLoading:!0,nativeShare:new z.a,addinfo:{},wenanText:"设计正在加载中",isOverdueTip:"",vm:this,isInit:!1,coverPreviewImage:"",isEcdbook:"",paperCanvas:null,canvasW:100,canvasH:100,namePasteImgArr:[],startx:0,starty:0,pageIndex:0,fontId:null,startSavetime:"",autoTurnPage:null}},created:function(){var e=this,t=localStorage.getItem("isAlipay"),i=navigator.userAgent.toLowerCase();("undefined"!=typeof my||"alipayclient"==i.match(/AlipayClient/i)||t)&&(this.is_alipay=!0),localStorage.getItem(ee["f"].isShowHelp)?this.changeState():localStorage.setItem(ee["f"].isShowHelp,!0);var a=this;this.$route.path;this.$store.dispatch("getFontCss");var o=this.$route.query.editType;if(null!=o&&void 0!=o&&(this.editType=o),this.isSubmit=void 0!=this.$route.query.submit&&this.$route.query.submit,this.id=this.$route.query.id,this.p=this.$route.query.p,this.uid=this.$route.query.uid,this.fromDesign=this.$route.query.fromDesign,this.isTeamBook=this.$route.query.isTeamBook,this.isGongge=this.$route.query.isGongge,this.isNamePaste=this.$route.query.isNamePaste,this.isEcdbook=this.$route.query.isEcdbook,this.fontId=this.$route.query.fontId,"true"==this.isTeamBook&&(this.isTeamBook=!0),this.$route.query.coverPreviewImage&&(this.coverPreviewImage=this.$route.query.coverPreviewImage),this.isGongge)this.pageKey=ee["d"];else if(this.isNamePaste)this.pageKey=ee["e"];else if(this.isEcdbook)this.pageKey=ee["b"];else if(2!=this.editType&&this.isSubmit)this.pageKey=ee["a"];else{this.pageKey=ee["c"];localStorage.getItem(this.pageKey.detailJson);if(1!=this.fromDesign&&"true"!=this.fromDesign)for(var s in this.pageKey)localStorage.removeItem(this.pageKey[s]);this.$route.query.history&&!this.$route.query.admin&&this.isTeamBook}this.isGongge?this.logFrom("宫格预览"):this.isSubmit?this.logFrom("设计预览"):this.logFrom("分享预览"),this.normalKey=ee["f"];var n=localStorage.getItem(ee["f"].isMiniProgram);n&&(a.isMiniProgram=!0);i=navigator.userAgent.toLowerCase();"micromessenger"==i.match(/MicroMessenger/i)&&wx.miniProgram.getEnv(function(e){console.log(e),(e.miniprogram||n)&&(a.isMiniProgram=!0)});t=localStorage.getItem("isAlipay");("alipayclient"==i.match(/AlipayClient/i)||t)&&loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}}),this.isSubmit||(setTimeout(function(){window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","分享打开"])},3e3),Object(H["ab"])({id:this.uid}).then(function(t){e.tbPass=t.data,null==e.tbPass&&(e.showSubmit=!1)}));var r={uid:this.$route.query.uid,pageKey:this.pageKey,isTeamBook:this.isTeamBook,edittype:2};this.$store.dispatch("getJsonFunNoToken",r).then(function(t){JSON.stringify(t.detail);if(t.data&&t.data.base64Token);else{var i=JSON.parse(t.data);localStorage.setItem(e.pageKey.thumbnailToken,i.base64Token)}}).catch(function(t){console.log(t),e.alertMessage(t.msg),e.isShowLoading=!1}),$(".zzz").click(function(){hideModal()})},mounted:function(){this.isNamePaste&&($("#audioPlay").css("height","7%"),ae["a"].create("screenShot").listen("toDataURLComplete",this.drawComplete),this.paperCanvas=new fabric.StaticCanvas("paperCanvas"),ie["a"].getInstance().currentCanvasNum=0),console.log()},beforeDestroy:function(){this.paperCanvas&&ae["a"].create("screenShot").remove("toDataURLComplete",this.drawComplete),clearInterval(this.autoTurnPage)},computed:le({},Object(E["b"])(["detailJson"])),watch:{detailJson:function(){var e=this;this.isInit||(this.isInit=!0,this.$store.dispatch("getAllFontInfo").then(function(t){if(e.isNamePaste||e.initPreview(),e.isNamePaste){var i=JSON.parse(localStorage.getItem(e.pageKey.detailJson)),a=e.$store.getters.idNameJson,o=a[e.fontId];Object(se["a"])(o).then(function(t){Object(oe["a"])(i,0,e)}).catch(function(e){console.log(o+"字体下载失败8")})}e.isTeamBook&&localStorage.setItem(e.pageKey.token,localStorage.getItem(ee["f"].userToken))}))}},deactivated:function(){this.$destroy()},beforeRouteLeave:function(e,t,i){this.$layer.closeAll(),layer.closeAll(),i()},methods:{goNext:function(){$("#flipbook").turn("page")&&($("#flipbook").turn("page")<$("#flipbook").turn("pages")?$("#flipbook").turn("next"):$("#flipbook").turn("page",1))},calendartouchtouchstart:function(e){this.startx=e.touches[0].pageX,this.starty=e.touches[0].pageY},calendartouchmove:function(e){e.changedTouches[0].pageX,e.changedTouches[0].pageY},calendartouchend:function(e){var t,i,a=this;t=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY;var o=a.getDirection(a.startx,a.starty,t,i);console.log(o),3==o&&a.onNext(),4==o&&a.onPre()},onNext:function(){this.pageIndex<this.namePasteImgArr.length-1&&this.pageIndex++},onPre:function(){this.pageIndex>0&&this.pageIndex--},getDirection:function(e,t,i,a){var o=e-i,s=0;return o>50?s=3:o<-50&&(s=4),s},drawComplete:function(e,t){var i;this.isNamePaste&&(i=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),console.log("名字贴json======",i),console.log("页面渲染完成"),console.log(t),this.$set(this.namePasteImgArr,t,{css:{},image:e}),t<i.pageList.length-1?(ie["a"].getInstance().clearCanvasAndLayer(),ie["a"].getInstance().currentCanvasNum=t+1,Object(oe["a"])(i,t+1,this),console.log(this.namePasteImgArr)):this.isShowLoading=!1)},initPreview:function(){if(null!=this.detailJson&&void 0!=this.detailJson){$("#flipbook").hide(),$("#flipbook").empty();var e=this.detailJson.diyType;if("poker"==e||"week_calendar"==e||"template_cloth"==e||"year_calendar"==e||1==this.detailJson.pageList.length||"fashion_photo"==e||"wall_calendar"==e||"mug_cup"==e||"other_object"==e||"calendar"==e||1!=this.detailJson.templateInfo.coverper||1!=this.detailJson.templateInfo.innerper||this.detailJson.isguali){this.time="year_calendar"==e||"calendar"==e?500:0;for(var t=0;t<this.detailJson.pageList.length;t++)this.items.push({css:{},class:{}});this.isCalendar=!0}else{var i=localStorage.getItem(this.pageKey.forceRefresh);localStorage.setItem(this.pageKey.forceRefresh,!1);var a=window.location.href;if("true"==i&&a.indexOf("preview")>=0)return void this.$router.go(0);console.log(this.detailJson);var o=$(window).width(),s=$(window).height(),n=2*this.detailJson.pageList[0].displayWidth,r=this.detailJson.pageList[0].displayHeight;if("photo"==this.detailJson.diyType)for(var l=0;l<this.detailJson.pageList[1].content.itemList.length;l++)"shape"==this.detailJson.pageList[1].content.itemList[l].media.mediaType&&this.detailJson.pageList[1].content.itemList[l].isDesignShape&&(n=2*this.detailJson.pageList[1].content.itemList[l].location.width,r=this.detailJson.pageList[1].content.itemList[l].location.height);var d=this.calculateBound({width:n,height:r,boundWidth:Math.min(n,o),boundHeight:Math.min(r,s)});w=d.width,h=d.height;for(t=0;t<this.detailJson.pageList.length;t++)1==t&&this.detailJson.coverInfo&&this.detailJson.coverInfo.hascover&&$("#flipbook").append("<div></div>"),t==this.detailJson.pageList.length-1&&this.detailJson.coverInfo&&this.detailJson.coverInfo.hasbackcover&&$("#flipbook").append("<div></div>"),Object(V["b"])("#flipbook",this.detailJson,t,null,this,!0,!1,!this.isSubmit);this.initMagazine()}}else this.alertMessage("模板加载失败")},goback:function(){void 0!=this.uid&&null!=this.uid||this.isGongge||this.isNamePaste||this.isEcdbook?history.go(-1):this.$router.push({name:"design",query:{id:this.id,p:this.p}})},save:function(){var t=this;try{if(this.startSavetime=(new Date).getTime(),window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);if(this.detailJson){var a=Object(q["a"])(this.detailJson);window._jylog.push(["检测this.detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测this.detailJson","预览页面","save方法",String(this.detailJson),JSON.parse(i).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){var o=localStorage.getItem(this.pageKey.detailJson);if(o){a=Object(q["a"])(o);window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",String(o),JSON.parse(i).orderNo])}}catch(e){console.log(e)}setSave();var s=J["a"].baseUrl2,n=J["a"].fxBackUrl,r=(J["a"].wechatBackUrl,J["a"].xlsBackUrl);if(this.photoSize=localStorage.getItem(this.pageKey.photoSize),this.mshopSign=localStorage.getItem(this.pageKey.mshopSign),"1"!=this.mshopSign&&"2"!=this.mshopSign||(this.editType=1,"1"==this.mshopSign?this.flag=4:this.flag=10),this.isSaving)this.showMessage("正在保存中，请不要重复点击");else{this.isSaving=!0;var l=this;if(Object(te["a"])(this.pageKey,this.$store.getters.svgxmlArr,function(e){localStorage.setItem(l.pageKey.detailJson,JSON.stringify(e)),l.$store.dispatch("updatePages",e),l.svgSaveFail=!0},function(){l.svgSaveFail=!1}),0!=this.svgSaveFail){var d,c;this.isOverdueTip="";try{if(window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);if(this.detailJson){a=Object(q["a"])(this.detailJson);window._jylog.push(["检测this.detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测this.detailJson","预览页面","save方法",String(this.detailJson),JSON.parse(i).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){o=localStorage.getItem(this.pageKey.detailJson);if(o){a=Object(q["a"])(o);window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",String(o),JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.detailJson?(d=this.detailJson.pageList,c=this.detailJson):(c=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),d=c.pageList);JSON.parse(localStorage.getItem(this.pageKey.calenderTemp));var h=JSON.parse(localStorage.getItem(this.pageKey.goodsid)),g=JSON.parse(localStorage.getItem(this.pageKey.productId)),m="",p=JSON.parse(localStorage.getItem(this.pageKey.motherid)),u=this.detailJson;this.savedays=u.savedays,u.datetime=(new Date).getTime(),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(u)),this.$store.dispatch("updatePages",u);var f=localStorage.getItem(this.pageKey.token),y=localStorage.getItem(this.pageKey.returnURL);"calendar"==c.diyType||"year_calendar"==c.diyType?JSON.parse(localStorage.getItem(this.pageKey.cal_baseBoard)):localStorage.removeItem(this.pageKey.cal_baseBoard),console.log(m);for(var _=!1,v=!0,w=0;w<d.length;w++){if(!v)return void(this.isSaving=!1);for(var b=d[w].content.itemList,I=0;I<b.length;I++)if("text"==b[I].media.mediaType&&""!=b[I].media.text&&""!=b[I].media.font.textPath?"yes"==b[I].moveable&&(b[I].moveable="yes"):"image"==b[I].media.mediaType&&0==b[I].media.isBG&&0==b[I].isDisplay||"yes"!=b[I].moveable&&delete b[I].moveable,"advancedImageMask"==b[I].media.mediaType&&1==b[I].visible){if(-1!=b[I].media.maskSource.indexOf("img/nophoto.jpg")&&1==b[I].visible)return this.isSaving=!1,void this.showMessage("您有照片未填充");b[I].media.defaultState=!1,-1!=b[I].media.maskSource.indexOf(Object(Q["d"])(b[I].media.maskSource))&&(b[I].media.maskSource=Object(Q["f"])(b[I].media.maskSource,b[I]).replace(Object(Q["d"])(b[I].media.maskSource),"")),-1!=b[I].media.factMaskSource.indexOf(Object(Q["d"])(b[I].media.factMaskSource))&&(b[I].media.factMaskSource=Object(Q["f"])(b[I].media.factMaskSource,b[I]).replace(Object(Q["d"])(b[I].media.factMaskSource),"")),-1!=b[I].media.bgSource.indexOf(Object(Q["d"])(b[I].media.bgSource))&&(b[I].media.bgSource=Object(Q["f"])(b[I].media.bgSource,b[I]).replace(Object(Q["d"])(b[I].media.bgSource),"")),this.checkDate(d[w],b[I].media.maskSource)}else if("image"==b[I].media.mediaType)-1!=b[I].media.imgPath.indexOf(Object(Q["d"])(b[I].media.imgPath))&&(b[I].media.imgPath=Object(Q["f"])(b[I].media.imgPath,b[I]).replace(Object(Q["d"])(b[I].media.imgPath),"")),-1!=b[I].media.imgPath.indexOf(s)&&(b[I].media.imgPath=b[I].media.imgPath.replace(s,""));else if("text"==b[I].media.mediaType)console.log(b[I]),null!=b[I].media.imgPath&&void 0!=b[I].media.imgPath&&-1!=b[I].media.imgPath.indexOf(s)&&(b[I].media.font.textPath=b[I].media.font.textPath.replace(s,"")),b[I].media.isImage&&-1!=b[I].media.font.textPath.indexOf(s)&&(b[I].media.font.textPath=b[I].media.font.textPath.replace(s,""));else if(b[I].media.mediaType.indexOf("svg")>-1){if(-1!=b[I].media.imgPath.indexOf(Object(Q["d"])(b[I].media.imgPath))&&(b[I].media.imgPath=Object(Q["f"])(b[I].media.imgPath,b[I]).replace(Object(Q["d"])(b[I].media.imgPath),"")),1==b[I].media.svgmodified&&-1!=b[I].media.imgPath.indexOf("MXYZ-")){_=!0;break}}else if(b[I].media.mediaType.indexOf("selfGroup")>-1){var S=!0,x=!1,k=void 0;try{for(var O,L=b[I].childrenElement[Symbol.iterator]();!(S=(O=L.next()).done);S=!0){var T=O.value;if(Object(Z["a"])(T),1==T.media.svgmodified&&-1!=T.media.imgPath.indexOf("MXYZ-")){_=!0;break}}}catch(ae){x=!0,k=ae}finally{try{S||null==L.return||L.return()}finally{if(x)throw k}}if(_)break}if(_)break}if(_)return this.alertMessage("svgxml保存异常，请返回设计页面重新提交"),void(this.isSaving=!1);if(""!=this.isOverdueTip)return this.isSaving=!1,void this.alertMessage("您设计的第"+this.isOverdueTip+"    存在过期图片，请修改！");if(this.detailJson.pageList=d,null==this.detailJson)return this.alertMessage("您保存的数据异常，请返回检查！"),void(this.isSaving=!1);for(var C=[],P="",j=0;j<d.length;j++){b=d[j].content.itemList;for(var A=!1,N=[],E=0;E<b.length;E++)"text"!=b[E].media.mediaType||void 0!=b[E].media.text&&null!=b[E].media.text||(A=!0,N=[j,E]);A&&(0==j?P=d[j].title+"、":P+=d[j].title+"、",C.push(N))}if(""!=P)return P+="页面文字节点数据异常！",this.isSaving=!1,void this.alertMessage(P);var D=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));null!=D&&void 0!=D||(D=u.oderInfo?u.oderInfo:{});var B="";B=D&&""!=D&&D!={}?D.source:localStorage.getItem(this.pageKey.source);var K=JSON.parse(localStorage.getItem(this.pageKey.cal_baseBoard)),M="";B&&"wsid"==B&&(this.iswsid=!0),!this.iswsid||1!=this.iswsid&&"true"!=this.iswsid||(this.wsid=localStorage.getItem(this.pageKey.wsid),this.addinfo.wsid=this.wsid,u.addinfo=this.addinfo),null!=K&&""!=K?(g=K.proid,M=K.productno):D&&""!=D&&D!={}&&(M=D.productNo),1==u.templateInfo.coverper&&1==u.templateInfo.backcover&&1==u.templateInfo.innerper&&"photo"==u.diyType&&(u.coverInfo.hascover||1!=u.pageList[0].content.itemList.length||u.pageList.splice(0,1),u.coverInfo.hasbackcover||1!=u.pageList[u.pageList.length-1].content.itemList.length||u.pageList.splice(u.pageList.length-1,1)),"woodcut"==u.diyType&&(u.diyType="photo",u.isBanhua=!0),"woodcut"==u.templateInfo.diyType&&(u.templateInfo.diyType="photo"),"wall_calendar"==u.templateInfo.diyType&&(u.templateInfo.diyType="photo",u.diyType="photo",u.isguali=!0),"mug_cup"==u.templateInfo.diyType&&(u.templateInfo.diyType="photo",u.diyType="photo",u.iscup=!0),"other_object"==u.diyType&&(u.diyType="photo",u.isBanhua=!0),"other_object"==u.templateInfo.diyType&&(u.templateInfo.diyType="photo");var U=localStorage.getItem(this.pageKey.fold);if(""!=U&&void 0!=U&&null!=U&&(u.fold=U),""!=D&&void 0!=D&&null!=D&&(u.oderInfo=D),u.oderInfo.productNo!=u.sku&&u.sku&&u.oderInfo.productNo){try{if(window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","问题提示",u.oderInfo.productNo+":"+u.sku,JSON.parse(i).orderNo])}}catch(e){console.log(e)}return this.alertMessage("同一设计无法对应不同产品，请重新设计"),void(this.isSaving=!1)}var W=localStorage.getItem(this.pageKey.autoSave),F=this.editType;W&&(F=2,this.uid||(this.uid=localStorage.getItem(this.pageKey.uid)));var R=localStorage.getItem(this.pageKey.orgTime),G=0;if(void 0!=R&&null!=R&&"undefined"!=R&&"null"!=R){var z=(new Date).getTime(),V=z-R;G=Math.floor(V/6e4);try{if(window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","设计时长",G,JSON.parse(i).orderNo])}}catch(e){console.log(e)}}var Y={};if(1==F){if(Y={userid:-1,name:"",submit:!0,token:f,edittype:1,gid:h,mid:p,pid:g,productno:M,designerDetail:u,orderNo:D.orderNo,tid:this.detailJson.templateInfo.id,pnum:localStorage.getItem(this.pageKey.pnum),membertype:D.shopName,photoSize:this.photoSize,materials:localStorage.getItem(this.pageKey.materials),previewImage:localStorage.getItem(this.pageKey.previewImage),isTeamBook:this.isTeamBook,addinfo:this.addinfo,flag:this.flag},"fashion_photo"==this.detailJson.diyType&&(Y.addinfo={num:$("#addinfo").val()},!this.checkNum($("#addinfo").val())))return this.showMessage("请填写数量"),void(this.isSaving=!1)}else{if(2!=F)return this.alertMessage("参数错误"),void(this.isSaving=!1);if(null==g&&(g=u.productId),Y={uid:this.uid,name:"",designerDetail:u,edittype:2,productno:M,gid:h,mid:p,pid:g,photoSize:this.photoSize,materials:localStorage.getItem(this.pageKey.materials),previewImage:localStorage.getItem(this.pageKey.previewImage),pnum:localStorage.getItem(this.pageKey.pnum),submit:!0,tid:this.detailJson.templateInfo.id,isTeamBook:this.isTeamBook,addinfo:this.addinfo},1==this.$route.query.fromAdmin&&(Y.token="supervisor"),2!=this.editType||this.$route.query.history||(Y.isEdit=!0),"fashion_photo"==this.detailJson.diyType&&1!=this.$route.query.admin&&!this.isTeamBook&&"third"!=B)if("wsid"==B){var X=Y.addinfo.num;if(!this.checkNum(X))return this.showMessage("请填写数量"),void(this.isSaving=!1)}else if(Y.addinfo={num:$("#addinfo").val()},!this.checkNum($("#addinfo").val()))return this.showMessage("请填写数量"),void(this.isSaving=!1)}this.coverPreviewImage&&(Y.previewImage=this.coverPreviewImage),console.log("req.previewImage:"+Y.previewImage);var ie=this;this.reqData=Y,1==this.editType&&(Y.addinfo.designlongtime=G),window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","提交设计"]),Object(H["cb"])(Y).then(function(i){try{if(window._jylog){var a=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交成功",i.data.uid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){var o="",s=(new Date).getTime();ie.startSavetime&&(o=(s-ie.startSavetime)/1e3);a=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","保存相应时长",o,JSON.parse(a).orderNo])}}catch(e){console.log(e)}if(ie.isSaving=!1,1==i.result){var l=JSON.parse(localStorage.getItem(t.pageKey.thirdDatil)),d=localStorage.getItem(t.pageKey.redirecType);w=localStorage.getItem(t.pageKey.source);var c=M,h="null";""!=c&&null!=c&&void 0!=c&&(D.productNo==M||(h=M)),ie.reqData.uid=i.data.uid,ie.total(ie.reqData),"fxxt"!=w&&-1==window.location.href.indexOf("zheliyin.com")||(c=M,""!=c&&null!=c&&void 0!=c&&(D.productNo==M||(h=M)));localStorage.getItem(t.pageKey.goodsid);for(var g in t.pageKey)localStorage.removeItem(t.pageKey[g]);var m=localStorage.getItem(ee["f"].fromAlipyShopCartEdit);if("1"==m||1==m)return void my.navigateBack();var p=localStorage.getItem(ee["f"].fromAlipyShop),u=localStorage.getItem(ee["f"].alipyShopGoodsid),f=localStorage.getItem(ee["f"].alipyShopProductid);if("1"==p||1==p)return void my.redirectTo({url:"/pages/preDesign-complete/preDesign-complete?goodsid="+u+"&alipyShopProductid="+f});if("third"==w)return"1"==ie.mshopSign||"2"==ie.mshopSign?void ie.scgjthirdMethod(i,l):void ie.thirdMethod(i,l);if("fxxt"==w||-1!=window.location.href.indexOf("zheliyin.com")){try{window._czc&&window._czc.push(["_trackEvent","剪影","分销提交页面","提交"+D.orderNo+"-"+n])}catch(e){console.log(e)}return void(window.location.href=n+"/diyRedirect/callbackOrderDetail/"+D.orderNo+"/"+i.data.designno+"/"+d+"/"+h)}if("xls"==w)return void(window.location.href=r+"/mobile/odr/order/sheet/designDIYGoods.do?thirdOrderNo="+i.data.designno+"&odrGoodsCode="+D.orderNo+"&redirecType="+d+"&sku="+h);if("wechat"==w){var _=0;return y||(y=D.returnURL),void(window.location.href=y+"?designId="+i.data.uid+"&member_id="+encodeURI(encodeURI(D.memberid))+"&plseNum="+_)}if("wsid"==w)return void ie.goSuccess(i);if(-1!=window.location.href.indexOf("zheliyin.com"))try{window._czc&&window._czc.push(["_trackEvent","剪影","分销提交页面","提交"+D.orderNo+":"+w])}catch(e){console.log(e)}if(1==t.editType||t.$route.query.history&&1!=t.$route.query.admin)if(i.data.tburl){try{if(window._jylog){a=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交成功回传地址",i.data.tburl,JSON.parse(a).orderNo])}}catch(e){console.log(e)}t.goWait(i,D.orderNo,w)}else t.goSuccess(i);else 2==t.editType&&t.goSuccess(i)}else if(i.data){var v=t,w=localStorage.getItem(t.pageKey.source);t.$layer.alert(i.msg,function(e){"guochao"!=w&&v.copyText(i.data,"成功复制设计单单号,请将设计单单号发送给客服"),v.$layer.close(e)})}else if("用户信息失效！"==i.msg){v=t;var b={};b.token=localStorage.getItem(v.pageKey.token),b.detail=JSON.parse(localStorage.getItem(v.pageKey.tokenDetail)),Object(H["K"])(b).then(function(e){e.result&&(localStorage.setItem(v.pageKey.token,e.token),v.save())})}else t.alertMessage(i.msg)}).catch(function(t){try{if(window._jylog){var i=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交失败",JSON.stringify(t),JSON.parse(i).orderNo])}}catch(e){console.log(e)}Y=JSON.stringify(Y),$.ajax({url:J["a"].basicUrl+"/member/tempsave",async:!0,type:"POST",data:Y,timeout:12e3,headers:{"Content-Type":"application/json"},success:function(e){ie.alertMessage("保存失败:"+t)},error:function(e){console.log(e),console.log(e.status),ie.uploadError("jianyingstring.txt",Y),ie.alertMessage("保存串失败："+JSON.stringify(e))}}),ie.isSaving=!1})}else this.isSaving=!1}},showSave:function(){var t=this,i=localStorage.getItem(this.pageKey.source);if(!this.isMiniProgram||"third"==i||2==this.editType&&1==this.$route.query.admin)if("wsid"==i)this.change();else if("guochao"==i)layer.open({content:'请输入制作数量:<input id="addinfo" /><p style="margin-top:10px; color:red;font-size:14px">【注：制作数量代表一个作品印刷数量，请结合订单实际购买数量填写】</p>',btn:["确认","取消"],yes:function(e,i){t.save(),layer.close(e)},cancel:function(){t.isSaving=!1,layer.close(index)}});else{var a=localStorage.getItem(this.pageKey.tokenDetail),o="";null!=a&&(o=JSON.parse(localStorage.getItem(this.pageKey.tokenDetail))),"third"==i&&""!=o&&o.tradenum.content&&o.tradenum.content.name&&""!=o.tradenum.content.name&&o.tradenum.content.phone&&""!=o.tradenum.content.phone?this.change():this.$layer.confirm("请确认您的设计，提交后不可修改",{icon:3,title:"提示"},function(i){try{t.save(),t.$layer.close(i)}catch(e){t.alertMessage(e),t.isSaving=!1}})}else{for(var s=!1,n=0;n<this.detailJson.pageList.length;n++){var r=this.detailJson.pageList[n];if(null!=r.videoUuid&&void 0!=r.videoUuid){s=!0;break}}s||!this.detailJson.isVideo?this.$layer.confirm("请确认您的设计，提交后不可修改",{icon:3,title:"提示"},function(a){try{"guochao"==i?(t.$layer.close(a),layer.open({content:'请输入制作数量:<input id="addinfo" /><p style="margin-top:10px; color:red;font-size:14px">【注：制作数量代表一个作品印刷数量，请结合订单实际购买数量填写】</p>',btn:["确认","取消"],yes:function(e,i){t.save(),layer.close(e)},cancel:function(){t.isSaving=!1,layer.close(a)}})):(t.save(),t.$layer.close(a))}catch(e){t.alertMessage(e),t.isSaving=!1;try{if(window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交格式失败","未知错误",JSON.parse(o).orderNo])}}catch(e){console.log(e)}var s={};localStorage.getItem(t.pageKey.detailJson)&&(s={designerDetail:localStorage.getItem(t.pageKey.detailJson)},s=JSON.stringify(s),$.ajax({url:J["a"].basicUrl+"/member/tempsave",async:!0,type:"POST",data:s,timeout:12e3,headers:{"Content-Type":"application/json"},success:function(e){t.alertMessage("保存失败:"+error)},error:function(e){console.log(e),console.log(e.status),t.uploadError("jianyingstring.txt",s),t.alertMessage("保存串失败："+e.responseText)}}))}}):"guochao"==i?layer.open({content:'请输入制作数量:<input id="addinfo" /><p style="margin-top:10px; color:red;font-size:14px">【注：制作数量代表一个作品印刷数量，请结合订单实际购买数量填写】</p>',btn:["确认","取消"],yes:function(e,i){t.save(),layer.close(e)},cancel:function(){t.isSaving=!1,layer.close(index)}}):layer.open({content:"<div>您制作的影音照片书未上传过视频</div>",btn:["继续","返回设计"],yes:function(i,a){layer.confirm("请确认您的设计，提交后不可修改",{icon:3,title:"提示"},function(i){try{t.save(),t.$layer.close(i)}catch(e){t.alertMessage(e),t.isSaving=!1}})},cancel:function(){t.isSaving=!1}})}},calculateBound:function(e){var t={width:e.width,height:e.height};if(t.width>e.boundWidth||t.height>e.boundHeight){var i=t.width/t.height;e.boundWidth/i>e.boundHeight&&e.boundHeight*i<=e.boundWidth?(t.width=Math.round(e.boundHeight*i),t.height=e.boundHeight):(t.width=e.boundWidth,t.height=Math.round(e.boundWidth/i))}return t},share:function(){window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","分享"]);navigator.userAgent.toLowerCase();if("qq"==this.is_weixn_qq())$("#sharePop").popup();else{var t=window.location.href;if(t=t.replace("preview","album"),this.nativeShare.setShareData({title:"剪影",desc:"我定制了一本照片书，快来看看吧",link:t,icon:"../assets/img/share.png"}),this.isMiniProgram)return void this.copyText("我定制了一本照片书，快来看看吧:"+t,"链接已经复制到剪切板，快去分享给好友吧！");try{this.nativeShare.call()}catch(e){this.copyText("我定制了一本照片书，快来看看吧:"+t,"链接已经复制到剪切板，快去分享给好友吧！")}}},copyText:function(e,t){var i=this;this.$copyText(e).then(function(e){console.log(e),i.alertMessage(t)},function(e){i.$toast("复制失败")})},checkNum:function(e){return RegExp("^[0-9]*[1-9][0-9]*$").test(e)},changeState:function(){this.showHelp=!1},initMagazine:function(e,t){if(yepnope({test:Modernizr.csstransforms,yep:["libs/turn.min.js"],nope:["libs/turn.html4.min.js","css/jquery.ui.html4.css"],both:["libs/zoom.min.js","css/jquery.ui.css","libs/magazine.js"],complete:loadApp}),"vidoephoto"==this.detailJson.diyType){var i=this;this.autoTurnPage=setInterval(function(){i.goNext()},100)}},is_weixn_qq:function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)?"weixin":"qq"==e.match(/QQ/i)&&e.match(/QQ/i).length>1&&"qq"},thirdMethod:function(e,t){var i=this,a=e.data.designno,o=J["a"].xlsBackUrl+"/diyOdrOrder/saveDesignNo/"+t.orderNo+"/"+t.thirdGoodsCode+"/"+t.sku+"/"+a+".do",s={};s.appNo=t.appNo,s.count=1,s.uid=e.data.uid,$.ajax({url:o,type:"get",async:!1,cache:!1,data:s,success:function(a){"SUCCESS"==a.result?window.location.href=t.redirectUrl:i.goSuccess(e)},error:function(){return i.alertMessage("服务器异常!"),!1}})},scgjthirdMethod:function(e,t){var i=this,a={designNo:e.data.designno,uid:e.data.uid};i.addinfo&&(t.info=i.addinfo),a.thirdDatil=t,console.info("三方跳转参数===="),console.info(JSON.stringify(a)),Object(H["gb"])(a).then(function(a){var o=a.result;"fail"==o?i.goSuccess(e):window.location.href=t.content.redirectUrl})},makeSimple:function(){var e=this.tbPass;window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","淘口令复制"]),this.copyText(e,"口令已经复制，快去打开吧!")},total:function(e){Object(H["eb"])(e).then(function(e){e.result?console.log("保存素材成功！"):console.log("保存素材失败！")})},goWait:function(e,t,i){this.$router.push({name:"wait",query:{redirectUrl:encodeURI(e.data.tburl),code:e.data.designno,uid:e.data.uid,orderNo:t,isSimple:0,source:i}})},goSuccess:function(e){this.$router.push({name:"success",query:{code:e.data.designno,uid:e.data.uid,photoBecomBook:this.$route.query.photoBecomBook}})},addinfo1:function(e){this.addinfo=e,this.save()},change:function(){$(".sjky-mask").show(),$(".weui-popup__modal").show(),$("#addPop").popup()},checkDate:function(e,t){var i="20"+t.substring(3,9),a=new Date;i=i.replace(/^(\d{4})(\d{2})(\d{2})$/,"$1/$2/$3");var o=new Date(i),s=(a.getTime()-o.getTime())/1e3/60/60/24,n=75;if(this.savedays&&(n=this.savedays),s>n){this.isOverdueTip?this.isOverdueTip+=","+e.title:this.isOverdueTip=e.title;var r=JSON.stringify(this.detailJson);r=r.replace(t,"img/nophoto.jpg"),localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",JSON.parse(r))}},closep:function(){$("#addPop").removeClass("weui-popup__container weui-popup__container--visible"),$("#addPop").hide(),$(".sjky-mask").hide(),$(".weui-popup__modal").hide()},uploadError:function(e,t){new Blob([t],{type:"text/plain;charset=utf-8"});var i=new File([t],"error.txt",{type:"text/plain;charset=utf-8"}),a=new FormData;a.append("file",i),a.append("id","2"),$.ajax({url:J["a"].basicUrl+"/member/tempfilesave",dataType:"json",type:"post",data:a,processData:!1,contentType:!1,error:function(e){alert("保存文件失败")},success:function(e){}})},saveDesign:function(){var t=this,i=J["a"].baseUrl2,a=localStorage.getItem(this.pageKey.token),o=JSON.parse(localStorage.getItem(this.pageKey.goodsid)),s=JSON.parse(localStorage.getItem(this.pageKey.productId)),n=JSON.parse(localStorage.getItem(this.pageKey.motherid)),r=JSON.parse(localStorage.getItem(this.pageKey.detailJson));r.datetime=(new Date).getTime(),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(r)),this.$store.dispatch("updatePages",this.detailJson);for(var l=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)),d=(JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),r.pageList),c=0;c<d.length;c++)for(var h=d[c].content.itemList,g=0;g<h.length;g++)if("text"==h[g].media.mediaType&&""!=h[g].media.text&&""!=h[g].media.font.textPath?"yes"==h[g].moveable&&(h[g].moveable="yes"):"image"==h[g].media.mediaType&&0==h[g].media.isBG&&0==h[g].isDisplay||"yes"!=h[g].moveable&&delete h[g].moveable,"advancedImageMask"==h[g].media.mediaType&&1==h[g].visible){if(-1!=h[g].media.maskSource.indexOf("img/nophoto.jpg")&&1==h[g].visible)return void this.alertMessage("您有照片未填充");h[g].media.defaultState=!1,-1!=h[g].media.maskSource.indexOf(Object(Q["d"])(h[g].media.maskSource))&&(h[g].media.maskSource=Object(Q["f"])(h[g].media.maskSource,h[g]).replace(Object(Q["d"])(h[g].media.maskSource),"")),-1!=h[g].media.factMaskSource.indexOf(Object(Q["d"])(h[g].media.factMaskSource))&&(h[g].media.factMaskSource=Object(Q["f"])(h[g].media.factMaskSource,h[g]).replace(Object(Q["d"])(h[g].media.factMaskSource),"")),-1!=h[g].media.bgSource.indexOf(Object(Q["d"])(h[g].media.bgSource))&&(h[g].media.bgSource=Object(Q["f"])(h[g].media.bgSource,h[g]).replace(Object(Q["d"])(h[g].media.bgSource),""))}else if("image"==h[g].media.mediaType)-1!=h[g].media.imgPath.indexOf(Object(Q["d"])(h[g].media.imgPath))&&(h[g].media.imgPath=Object(Q["f"])(h[g].media.imgPath,h[g]).replace(Object(Q["d"])(h[g].media.imgPath),"")),-1!=h[g].media.imgPath.indexOf(i)&&(h[g].media.imgPath=h[g].media.imgPath.replace(i,""));else if("text"==h[g].media.mediaType)null!=h[g].media.imgPath&&void 0!=h[g].media.imgPath&&-1!=h[g].media.imgPath.indexOf(i)&&(h[g].media.font.textPath=h[g].media.font.textPath.replace(i,"")),h[g].media.isImage&&-1!=h[g].media.font.textPath.indexOf(i)&&(h[g].media.font.textPath=h[g].media.font.textPath.replace(i,""));else if(h[g].media.mediaType.indexOf("svg")>-1)-1!=h[g].media.imgPath.indexOf(Object(Q["d"])(h[g].media.imgPath))&&(h[g].media.imgPath=Object(Q["f"])(h[g].media.imgPath,h[g]).replace(Object(Q["d"])(h[g].media.imgPath),""));else if(h[g].media.mediaType.indexOf("selfGroup")>-1){var m=!0,p=!1,u=void 0;try{for(var f,y=h[g].childrenElement[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var _=f.value;Object(Z["a"])(_)}}catch(x){p=!0,u=x}finally{try{m||null==y.return||y.return()}finally{if(p)throw u}}}var v,w=localStorage.getItem(this.pageKey.uid),b=localStorage.getItem(this.pageKey.autoSave),I=localStorage.getItem(this.pageKey.fold);""!=I&&void 0!=I&&null!=I&&(r.fold=I),""!=l&&void 0!=l&&null!=l&&l!={}&&(r.oderInfo=l),v=b||2==this.editType?2:1;var S={};1==v?S={userid:-1,name:"",submit:!1,token:a,edittype:1,gid:o,pid:s,mid:n,designerDetail:r,orderNo:l.orderNo,tid:r.templateInfo.id,pnum:localStorage.getItem(this.pageKey.pnum),membertype:l.shopName,materials:localStorage.getItem(this.pageKey.materials),isTeamBook:this.isTeamBook,addinfo:this.addinfo,previewImage:localStorage.getItem(this.pageKey.previewImage)}:2==v&&(S={uid:w,designerDetail:r,edittype:2,pid:s,previewImage:localStorage.getItem(this.pageKey.previewImage),submit:!1,isTeamBook:this.isTeamBook}),Object(H["cb"])(S).then(function(i){if(i.result){console.log("自动保存成功！"),localStorage.setItem(t.pageKey.autoSave,1),localStorage.setItem(t.pageKey.uid,i.data.uid);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","自动保存",i.data.uid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}}else console.log("自动保存失败")}).catch(function(i){console.log(i);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","自动保存","失败"+i.message,JSON.parse(a).orderNo])}}catch(e){console.log(e)}})},alertMessage:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","预览","警告",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.$layer.alert(t)},showMessage:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","预览","提示",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.$layer.alert(t)},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录","预览",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}}}};window.onload=function(){$("#audioPlay").autoAudio()};var ce,he,ge,me,pe,ue,fe=de,ye=(a("4edf"),a("c2de"),Object(b["a"])(fe,F,R,!1,null,"63394c93",null)),_e=ye.exports,ve=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about"},[i("section",{staticClass:"index-cont"},[e._m(0),i("section",{staticClass:"diyCard pr"},[e._m(1),i("div",{attrs:{id:"message"}},[i("p",{staticClass:"tips"},[e._v(e._s(e.errorInfo))])]),i("a",{staticClass:"btnSearch",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.query()}}},[e._v("查询")])])]),e._m(2),i("section",{staticClass:"search-hint"}),i("section",{staticClass:"overlay"}),i("section",{staticClass:"search-hint1"},[i("image",{attrs:{src:"img/bg2.jpg"}}),i("image",{attrs:{src:"img/bg3.jpg"}}),i("image",{attrs:{src:"img/bg-taoban.jpg"}})])])},we=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"diyLogo"},[i("img",{attrs:{src:a("4ffd")}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("input",{staticClass:"diyOrder",attrs:{type:"text",placeholder:"请输入订单号",id:"orderNo"}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"index-footer"},[i("a",{attrs:{href:"javascript:void(0)"}},[e._v("订单号查询?")]),e._v("　\n\t\t\t"),i("a",{attrs:{href:"javascript:void(0)"}},[e._v("制作教程?")]),i("p",{staticClass:"f26"},[e._v("传照片　 > 　生成　 > 　编辑　 > 　提交")])])}],be=!1,Ie="",Se={name:"serach",data:function(){return{errorInfo:""}},methods:{query:function(){var e=this;Ie=document.getElementById("orderNo").value,""==Ie&&(this.errorInfo="请输入订单号进行查询");var t=new RegExp("^[0-9]*$");t.test(Ie)||(this.errorInfo="订单号只包含数字，请重新输入");var i=0x8000000000000000;Ie>i&&(this.errorInfo="订单号超出上限，请重新输入",be=!0),""!=Ie&&null!=Ie&&0==be&&Object(H["y"])(Ie).then(function(t){if(console.log(t),"false"!=t.data.Success)if("21"==t.data.state)e.hreftwo(Ie);else if("22"==t.data.state)e.errorInfo="已受理正在生产",e.hreftwo(Ie);else if("24"==t.data.state)e.errorInfo="订单已发货",e.hreftwo(Ie);else{if("26"==t.data.state)return void(errorInfo="此订单已废置");if("30"==t.data.state)return void(e.errorInfo="订单已申请退款")}else e.errorInfo=t.data.Message}).catch(function(e){console.log(e)})},hreftwo:function(e){this.$router.push({name:"productlist",query:{orderid:e}})}}},xe=Se,ke=Object(b["a"])(xe,ve,we,!1,null,null,null),Oe=ke.exports,Le=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about"},[i("section",{staticClass:"index-cont"},[e._m(0),i("section",{staticClass:"diyCard pr"},[i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.designNo,expression:"designNo"}],staticClass:"diyOrder",attrs:{type:"text",placeholder:"请输入设计单号"},domProps:{value:e.designNo},on:{input:function(t){t.target.composing||(e.designNo=t.target.value)}}})]),i("div",{attrs:{id:"message"}},[i("p",{staticClass:"edit-tips"},[e._v(e._s(e.errorInfo))])]),i("a",{staticClass:"btnSearch",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.query()}}},[e._v("查询")])])]),i("section",{staticClass:"search-hint"}),i("section",{staticClass:"overlay"})])},Te=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"diyLogo"},[i("img",{attrs:{src:a("4ffd")}})])}],Ce={name:"editsearch",data:function(){return{designNo:"",errorInfo:"",productno:"",isGongge:!1,isNamePaste:!1}},methods:{query:function(){var e=this,t=this;""!=this.designNo&&null!=this.designNo&&Object(H["T"])(this.designNo).then(function(i){var a;if(console.log("response======",i),1==i.result)if(0!=i.data.length){var o=i.data[0].orderno;if(e.productno=i.data[0].sku,null!=o&&""!=o){var s=JSON.parse(o);if(s.hasOwnProperty("flag")){var n=s.flag;if("9"==n)return void layer.alert("此设计为pc设计，无法在移动端编辑，请到pc进行操作")}}$.ajax((a={url:J["a"].basicUrl+"/member/checkSkuType.do?sku="+e.productno,type:"POST",data:{sku:e.productno},contentType:"application/json; charset=utf-8"},Object(L["a"])(a,"type","POST"),Object(L["a"])(a,"async",!1),Object(L["a"])(a,"success",function(e){console.log(e),20==e.data.type?t.isGongge=!0:21==e.data.type&&(t.isNamePaste=!0)}),Object(L["a"])(a,"error",function(e){}),a)),e.hreftwo(i.data[0].id)}else e.errorInfo="设计查询不到";else e.errorInfo="设计查询失败"}).catch(function(t){console.log(t),e.errorInfo=t})},hreftwo:function(e){navigator.userAgent.toLowerCase();var t=navigator.userAgent,i=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);this.isNamePaste?this.$router.push({name:"namepaste",query:{uid:e}}):this.isGongge?this.$router.push({name:"gongge",query:{uid:e}}):i?location.href="design?uid="+e:this.$router.push({name:"design",query:{uid:e}})}}},Pe=Ce,je=(a("214a"),Object(b["a"])(Pe,Le,Te,!1,null,"8f30a2c8",null)),Ae=je.exports,Ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"weui-navbar coupon-navbar sjky-bg-wh"},[i("span",{staticClass:"left"},[i("a",{staticClass:"sjky",attrs:{href:"javascript:history.go(-1)"}},[e._v("")]),e._v("\n\t\t\t\t订单号："+e._s(e.orderNo)+"\n\t\t\t")]),i("span",{staticClass:"right"},[i("a",{attrs:{href:"javascript:void(0);"}},[e._v(e._s(e.state))])])]),i("section",{staticClass:"list-body sjky-top-space"},[e.showlocal?i("div",{staticClass:"sjky-list-tip sjky-list-tip1 sjky-list-top"},[e._v("\n\t\t    \t\t检测到您之前未提交的设计，【硬壳照片书24P】"),i("br"),i("a",{staticClass:"sjky-btn-tip",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.conti()}}},[e._v("继续")]),i("a",{staticClass:"sjky-btn-tip-light",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.abandon()}}},[e._v("放弃")])]):e._e(),i("div",{attrs:{id:"listInf"}}),e._l(e.lists,function(t){return i("div",{key:t.orderId,staticClass:"weui-panel weui-panel_access"},[i("div",{staticClass:"weui-panel__bd"},[i("div",{staticClass:"weui-media-box weui-media-box_appmsg",attrs:{href:"javascript:void(0);"}},[i("div",{staticClass:"weui-media-box__hd sjky-img-bg"},[t.isDesignOk?e._e():i("a",{attrs:{href:"javascript:void(0);"}},[""!=t.previewImg?i("img",{staticClass:"w pr",attrs:{src:"http://www.36588.com.cn/"+t.previewImg}}):e._e(),""==t.previewImg?i("img",{staticClass:"w pr",attrs:{src:a("8793")}}):e._e()])]),i("div",{staticClass:"weui-media-box__bd"},[i("p",{staticClass:"weui-media-box__desc"}),i("div",{staticClass:"txtbox-title"},[e._v(e._s(t.spmc)+"-"+e._s(t.attrs))]),i("p"),i("p",{staticClass:"sjky-pannel-tips"},[e._v("\n\t\t\t\t        \t待设计"),i("span",{staticClass:"sjky-pannel-num"},[e._v(e._s(t.remainNum))]),e._v("本"),i("br"),e._v("\n\t\t\t\t        \t已完成"),i("span",{staticClass:"sjky-pannel-num"},[e._v(e._s(t.spsl-t.remainNum))]),e._v("本\n\t\t\t\t        \t"),i("a",{staticClass:"sjky-btn-grey sjky-btn-grey1",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.goTodata()}}},[e._v("查看")]),i("br"),e._v("\n\t\t\t\t        \t总数量"),i("span",{staticClass:"sjky-pannel-num"},[e._v(e._s(t.spsl))]),e._v("本\n\t\t\t\t        ")])])])]),i("div",{staticClass:"weui-panel__ft"},[i("div",{staticClass:"weui-cell weui-cell_access weui-cell_link sjky-panel-btngroup"},[i("div",{staticClass:"sjky-flex-width"},[t.isDesignOk?e._e():i("a",{staticClass:"weui-btn weui-btn_mini weui-btn_primary",attrs:{href:"javascript:void(0)",id:"design"},on:{click:function(i){return e.design(t)}}},[e._v("我去设计")]),i("br")]),i("div",{staticClass:"sjky-flex-width"},[t.isCopy?i("a",{staticClass:"button sjky-btn-txt",attrs:{href:"javascript:void(0)",id:"taoban"},on:{click:function(i){return e.taoban(t)}}},[e._v("随机套版")]):e._e()])])]),t.isDesignOk?i("img",{staticClass:"sjky-panel-inf",attrs:{src:"img/ok.png"}}):e._e()])}),e._l(e.nonsupport,function(t){return i("div",{key:t.orderId,staticClass:"weui-panel weui-panel_access"},[i("div",{staticClass:"weui-panel__bd"},[i("div",{staticClass:"weui-media-box weui-media-box_appmsg",attrs:{href:"javascript:void(0);"}},[i("div",{staticClass:"weui-media-box__hd sjky-img-bg"},[t.isDesignOk?e._e():i("a",{attrs:{href:"javascript:void(0);"}},[i("img",{staticClass:"w pr",attrs:{src:a("cc09")}})])]),i("div",{staticClass:"weui-media-box__bd"},[i("p",{staticClass:"weui-media-box__desc"}),i("div",{staticClass:"txtbox-title"},[e._v(e._s(t.spmc)+"-"+e._s(t.attrs))]),i("p"),i("p",{staticClass:"sjky-pannel-tips"},[e._v("\n\t\t\t\t        \t 待设计"),i("span",{staticClass:"sjky-pannel-num"},[e._v("0")]),e._v("本"),i("br"),e._v("\n\t\t\t\t        \t已完成"),i("span",{staticClass:"sjky-pannel-num"},[e._v("0")]),e._v("本\n\t\t\t\t\t\t\t"),i("span",{staticClass:"sjky-btn-grey sjky-btn-grey1",attrs:{href:"list1-1.html"}},[e._v("查看")]),i("br"),e._v("\n\t\t\t\t        \t总数量"),i("span",{staticClass:"sjky-pannel-num"},[e._v(e._s(t.spsl))]),e._v("本\n\t\t\t\t        ")])])])]),e._m(0,!0),t.isDesignOk?i("img",{staticClass:"sjky-panel-inf",attrs:{src:"img/ok.png"}}):e._e()])})],2),i("footer",{staticClass:"bar bar-footer"},[e.finished?i("a",{staticClass:"button",attrs:{href:"serach"}},[e._v("返回首页")]):e._e()]),i("div",{staticClass:"showch"},[i("p",[e._v("选择台历起始月份")]),i("p",[e._v("您可以选择任一连续的12个月定制跨年台历")]),i("button",{staticStyle:{float:"right","margin-right":".2rem","margin-top":"0.3rem"},on:{click:function(t){return e.confirmBtn()}}},[e._v("去设计")]),i("button",{staticStyle:{float:"right","margin-right":".2rem","margin-top":"0.3rem"},on:{click:function(t){return e.confirmBtn()}}},[e._v("预览")]),i("button",{staticStyle:{float:"right","margin-top":"0.3rem"},on:{click:function(t){return e.cancelBtn()}}},[e._v("取消")])])])},Ee=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-panel__ft"},[i("div",{staticClass:"weui-cell weui-cell_access weui-cell_link sjky-panel-btngroup"},[i("div",{staticClass:"sjky-flex-width"},[i("a",{staticClass:"proTip w wh tc",staticStyle:{background:"#FF4C88"},attrs:{href:"javascript:void(0)"}},[e._v("不可定制，请联系客服")])])])])}],Je=(a("3320"),a("0ddc"),{name:"productlist",data:function(){return{orderNo:"",state:"",SendPH:"",memberid:"",finished:!0,lists:[],finish:[],nonsupport:[],showgoodsname:"",showlocal:!1,token:""}},created:function(){this.orderNo=this.$route.query.orderid,this.requiss(this.orderNo),localStorage.setItem("token",this.token)},methods:{requiss:function(e){var t=this;Object(H["I"])(e).then(function(e){if("ok"==e.data.errorMsg){if(t.memberid=e.data.data.memberid,t.lists=e.data.dataList,t.finish=e.data.finishList,t.orderNo=e.data.data.orderId,t.nonsupport=e.data.nonsupportList,0==t.finish.length&&0==t.lists.length)return void alert("对不起,您订单中的产品系统暂时不支持定制");t.state=e.data.data.state,"21"==t.state?"1"==e.data.data.Status?t.state="未定制":t.state="定制完成-等待受理":"22"==t.state?t.state="已受理-正在生产":"24"==t.state&&(t.state="已发货",t.SendPH="发货单号："+e.data.data.SendPH);for(var i=0;i<t.lists.length;i++)if(0==t.lists[i].isDesignOk)return void(t.finished=!1)}else alert("系统异常")})},choose:function(e,t){0==t&&this.design(e)},design:function(e){var t=localStorage.getItem("orderInfo");if(""!=t&&null!=t){t=JSON.parse(localStorage.getItem("orderInfo"));var i=t.productNo;i==e.outer_sku_id||(localStorage.removeItem("bk3_layouts"),localStorage.removeItem("bk3_photos"),localStorage.removeItem("imageTemp"),localStorage.removeItem("selectid"),localStorage.removeItem("styleid"),localStorage.removeItem("viewBox"),localStorage.removeItem("texts"),localStorage.removeItem("layouts"),localStorage.removeItem("pageNum"),localStorage.removeItem("p"),localStorage.removeItem("flagURL"),localStorage.removeItem("returnURL"),localStorage.removeItem("orderSource"),localStorage.removeItem("redirecType"),localStorage.removeItem("calenderTemp"),localStorage.removeItem("cal_size"),localStorage.removeItem("cal_decrateModel"),localStorage.removeItem("cal_detail"),localStorage.removeItem("cal_dgid"),localStorage.removeItem("cal_pageList"),localStorage.removeItem("cal_textindex"),localStorage.removeItem("odrGoodsCode"),localStorage.removeItem("orderSource"),localStorage.removeItem("productId"))}localStorage.setItem("orderSource","taobao"),this.designtwo(e)},designtwo:function(e){var t={orderNo:this.orderNo,id:e.id,productNo:e.outer_sku_id,goodsname:e.spmc,num:e.remainNum,shopName:e.shopName,memberid:this.memberid};localStorage.setItem("orderInfo",JSON.stringify(t)),this.totemplate()},taoban:function(e){localStorage.removeItem("taobanTemp"),localStorage.removeItem("imageArray"),localStorage.removeItem("imageList"),localStorage.removeItem("md5List"),console.log(e);var t={orderNo:this.orderNo,orderId:e.id,sku:e.outer_sku_id,goodsname:e.spmc,remainNum:e.remainNum,picnum:e.picnum,shopName:e.shopName,memberid:this.memberid,spmc:e.spmc,attrs:e.attrs};localStorage.setItem("orderInfo",JSON.stringify(t)),this.toTaoban()},toUpload:function(e){this.$router.push({name:"upload"})},totemplate:function(){this.$router.push({name:"mtemplate"})},goTodata:function(){this.$router.push({name:"list1"})},toTaoban:function(){this.$router.push({name:"taobanupload"})}}}),De=Je,Be=(a("ff8b"),Object(b["a"])(De,Ne,Ee,!1,null,null,null)),Ke=Be.exports,Me=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("base-upload",{attrs:{storageName:e.storageName,pageKey:e.pageKey,submitButtonName:e.submitButtonName,server:e.server,checksubmitstate:e.checksubmitstate,isTaoBan:!1,uploadcomplete:e.uploadcomplete,minPageNum:e.minPageNum,maxPageNum:e.maxPageNum},on:{baseUploadNextStep:e.nextStep}})],1)},$e=[],Ue=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._m(0),i("div",{staticClass:"uploaderBox pr",attrs:{id:"uploadIndex"}},[i("a",{staticClass:"uploader_input sjky",attrs:{href:"javascript:void(0);",id:"loadUpload",title:"选择照片"}},[e._v("")]),e.minPageNum!=e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")]):e._e(),e.minPageNum==e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"张照片")]):e._e()]),i("section",{staticClass:"mobile_web pb100",attrs:{id:"uploadShow"}},[i("div",{staticClass:"weui-cells sjky-list-tip sjky-list-tip2 sjky-list-tip3",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell__hd"},[i("div",{staticClass:"checkbox weui-cells_checkbox"},[i("input",{staticClass:"weui-check weui-check_box2",attrs:{type:"checkbox",name:"photos"},on:{click:e.finishEdit}}),i("i",{staticClass:"weui-icon-checked"})])]),e._m(1),i("div",{staticClass:"weui-cell__ft"},[[i("a",{staticClass:"sjky-btn-grey sjky-btn-grey2 delete-btn",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.deletePic()}}},[e._v("删除("+e._s(e.upladNum)+")")])]],2)])]),i("section",{staticClass:"phoList clearfix page",on:{scroll:e.handleScroll}},[i("div",{staticStyle:{display:"none"},attrs:{id:"filePicker"}}),i("div",{attrs:{id:"imageList"}})]),i("footer",{staticClass:"sjky-btn-bottom sjky-btn-bottom2"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipsFont,expression:"tipsFont"}],staticClass:"num-tips"},[e._v("\n\t\t\t          最少上传"+e._s(e.minPageNum)+"张，再上传几张吧。\n\t\t\t")]),i("div",{staticClass:"l tc addImagediv"},[i("a",{staticClass:"addImage",staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);",id:"addImage"}},[e._v("继续上传"),i("span",[e._v("("+e._s(e.upladNum)+")")])]),i("p",{attrs:{id:"info"}},[e._v("还需上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")])]),i("a",{staticClass:"weui-btn weui-btn_primary",attrs:{href:"javascript:void(0);",id:"designGO"},on:{click:function(t){return e.next()}}},[e._v(e._s(e.isTaoBan?"提交":"进入设计"))]),i("div",[i("a",{staticClass:"weui-btn weui-btn_primary",staticStyle:{display:"none"},attrs:{href:"javascript:void(0);",id:"insertupload"},on:{click:e.changePhotoUploadList}},[e._v("确定使用")])])])]),e._m(2),e._m(3),i("section",{staticClass:"modal modal-out",attrs:{id:"px-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),e._m(4)]),e._m(5),i("section",{staticClass:"modal modal-out",attrs:{id:"fail-photo"}},[e._m(6),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.chooseFail()}}},[e._v("一键选中")])])]),i("section",{staticClass:"modal modal-out",attrs:{id:"morethan-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("我们根据您选取顺序上传"+e._s(e.arrnum)+"张")])]),e._m(7)]),e._m(8),i("section",{staticClass:"overlay"}),e._m(9),i("section",{staticClass:"modal modal-out",attrs:{id:"low-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("返回")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.nextStep()}}},[e._v("确定")])])]),e._m(10),i("section",{staticClass:"modal modal-out",attrs:{id:"duplicate-photo"}},[e._m(11),i("footer",{staticClass:"modal-buttons"},[i("span",{staticClass:"modal-button btn-cancel ddel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.resetupload()}}},[e._v("确定")])])]),e._m(12),e._m(13),""!=e.options.target?i("uploader",{ref:"uploader",staticClass:"uploader-example",attrs:{options:e.options,"file-status-text":e.statusText,"auto-start":!0},on:{status:e.status,"file-added":e.onFileAdded,"file-progress":e.fileProgress,"progress-style":e.progressStyle,"progressing-class":e.progressingClass,"file-success":e.onFileSuccess,"file-error":e.onFileError,"file-removed":e.fileRemoved,"files-submitted":e.onFilesubmitted,"is-complete":e.isComplete,"is-uploading":e.isUploading}},[i("uploader-btn",{staticClass:"chooseSimple",staticStyle:{display:"none"},attrs:{attrs:e.attrs}},[e._v("select images")])],1):e._e()],1)},We=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"anniu"},[i("button",{staticClass:"active",attrs:{id:"uploadbutton"}},[e._v("照片上传")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-cell__bd"},[i("div",[i("p",{staticClass:"sub-title",attrs:{id:"chooseNumShow"}},[e._v("全选")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maskLayer",staticStyle:{display:"none"}},[i("p",[e._v("上传中")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"loadBox tc wh f32",staticStyle:{display:"none"},attrs:{id:"loadingDatacaiyun"}},[i("img",{attrs:{src:"img/loading.gif"}}),i("span",[e._v("正在上传...")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"uping-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("正在上传中，请稍等！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("有未成功加载的照片，请先删除！")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"taoban-show"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("【随机套版】将对您上传的图片随机排版，暂时无法查看效果及修改的哦，建议您选择【我去设计】自由设计。")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("我知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"del-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("确认删除此照片？")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold ddel"},[e._v("确定")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"choose-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片上传失败")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel ddel"},[e._v("删除")]),i("span",{staticClass:"modal-button modal-button-bold aagain"},[e._v("重新上传")])]),i("input",{attrs:{type:"hidden",id:"file_id",value:""}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片重复，是否上传")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-denied"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片类型错误")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-size"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片过大")])])])}],Fe=(a("28a5"),a("55dd"),a("7514"),new Array,800),Re=800,qe={name:"BaseUpload",props:["storageName","submitButtonName","uploadcomplete","minPageNum","pageKey","maxPageNum","server","checksubmitstate","orderInfo","isTaoBan"],data:function(){return{id:"",readyphoto:"",tipsFont:!1,isSimple:!1,isSimpleUpload:!1,caiyun:"",pageNum:"",productId:"",calendar_type:"",paused:!1,error:!1,isComplete:!1,isUploading:!1,p:-1,editing:!1,showDeleteModal:!1,arrnum:"",chooseNum:0,checkAll:!1,isTeamBook:!1,upladNum:0,isfirst:0,piclist:[],storageNamebase:"",isWeixin:!1,isuploadbutton:!0,ishistoryuploadbutton:!1,options:{target:"",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:41943040,query:{}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"},picList:[],progress:0,progressingClass:"uploader-file-progressing",file_total:1,pageIndex:1,pageSize:40,isSelectHistory:!1,errorfilelist:[],isNoHistoryPhoto:!1,readyupload:"",isfinish:!1,readyuploadFromDesign:"",thumbnailToken:"",historytips:!0,chooseUploadImage:[],isSignleTempleBook:null}},beforeCreate:function(){console.info("执行beforeCreate")},created:function(){1!=this.$route.query.isSignleTempleBook&&"true"!=this.$route.query.isSignleTempleBook||(this.isSignleTempleBook=!0),console.info("执行create"),this.readyupload=localStorage.getItem(this.pageKey.readyupload),this.readyuploadFromDesign=localStorage.getItem("readyupload"),this.isSimple=this.$route.query.isSimple,this.storageNamebase=this.storageName;var e=localStorage.getItem(ee["f"].isMiniProgram),t=navigator.userAgent.toLowerCase();console.log("mess:"+t.match("micromessenger")),console.log("navigator:"+navigator.userAgent.toLowerCase()),console.log("isweixin:"+e),(e||null!=t.match(/wechat/i)||null!=t.match("micromessenger"))&&(this.isWeixin=!0),localStorage.removeItem(this.pageKey.historyCalenderTemp),window.onload=function(){var e=!1;window.addEventListener("pageshow",function(){e&&window.location.reload()}),window.addEventListener("pagehide",function(){e=!0})};var i=localStorage.getItem(this.pageKey.id),a=localStorage.getItem(this.pageKey.isfirst),o=localStorage.getItem(this.pageKey.calenderTemp);a&&"1"==a?null==o||"[]"==o?this.isfirst=0:(this.isfirst=1,this.piclist=JSON.parse(o),this.upladNum=JSON.parse(o).length):(localStorage.setItem(this.pageKey.isfirst,this.isfirst),null==o||"[]"==o||(this.piclist=JSON.parse(o),this.upladNum=JSON.parse(o).length)),this.isTeamBook=this.$route.query.isTeamBook,this.caiyun=this.$route.query.caiyun,null==i||""==i||"undefined"==i?(this.id=this.$route.query.id,localStorage.setItem(this.pageKey.id,this.id)):this.id=i,this.getCommonUploadConfig(),this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},mounted:function(){$(".zzz").click(function(){hideModal()}),$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show();JSON.parse(localStorage.getItem(this.pageKey.goodsid));this.calendar_type=localStorage.getItem(this.pageKey.calendar_type),this.productId=JSON.parse(localStorage.getItem(this.pageKey.productId)),this.p=JSON.parse(localStorage.getItem(this.pageKey.pnum)),null==this.p&&(this.p=-1);var t=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(t=!0)}),t)showConfirm("#fail-photo");else{if(1==this.isfirst)try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","提示","改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！",JSON.parse(i).orderNo])}}catch(e){console.log(e)}var a=this;$("#loadUpload").bind("click",function(e){if(a.changeHistoryTips(),$(".sjky-btn-greytxt").hide(),!$(".webuploader-element-invisible")[0])try{if(window._jylog){var t=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","上传插件实例化失败，请刷新返回重新进入",JSON.parse(t).orderNo])}}catch(e){console.log(e)}if("function"==typeof loadUpload)$(".webuploader-element-invisible")[0].click();else{try{if(window._jylog){t=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","上传页面","上传插件实例化失败，调用备用插件",JSON.parse(t).orderNo])}}catch(e){console.log(e)}a.isSimpleUpload=!0,$(".chooseSimple")[0].click()}})}},methods:{changeHistoryTips:function(){this.historytips=!1},editPhotos:function(){this.editing=!0},finishEdit:function(){var e=localStorage.getItem(vm.pageKey.historyCalenderTemp),t=localStorage.getItem(this.pageKey.calenderTemp),i=[],a=[];if(a=JSON.parse(e),i=JSON.parse(t),this.checkAll){this.chooseUploadImage=[],i=[];o=this.maxPageNum,s=a;s.length<=this.maxPageNum&&(o=s.length);for(n=0;n<o;n++){delete s[n].chooseIndex;r=$("#uploadList_"+s[n].index),l=$(r).children().find("span[class=chooseIndexSpan_pub]");handleStyle(!1,l),l.text("")}this.checkAll=!1,a=s,this.chooseUploadImage=this.chooseUploadImage}else{this.chooseUploadImage=[],i=[];var o=this.maxPageNum,s=a;s.length<=this.maxPageNum&&(o=s.length);for(var n=0;n<s.length;n++){delete s[n].chooseIndex;var r=$("#uploadList_"+s[n].index),l=$(r).children().find("span[class=chooseIndexSpan_pub]");handleStyle(!1,l),l.text("")}for(var n=0;n<o;n++){s[n].chooseIndex=n+1,i.push(s[n]),this.chooseUploadImage.push(s[n]);var r=$("#uploadList_"+s[n].index),l=$(r).children().find("span[class=chooseIndexSpan_pub]");handleStyle(!0,l),l.text(n+1)}this.checkAll=!0,a=s,this.chooseUploadImage=this.chooseUploadImage}console.info("全选方法！"),localStorage.setItem(vm.pageKey.calenderTemp,JSON.stringify(i)),localStorage.setItem(vm.pageKey.historyCalenderTemp,JSON.stringify(a)),vm.upladNum=vm.chooseUploadImage.length},finishEditAbandonment:function(){var e=this;if(console.info("全选方法！"),this.upladNum=0,this.ishistoryuploadbutton)this.checkAll?(resetEdit(),this.checkAll=!1):(checkAllBox(),this.checkAll=!0);else{var t=localStorage.getItem(this.pageKey.calenderTemp),i=[];if(t){var a=JSON.parse(t);this.chooseUploadImage.length==a.length?(this.checkAll&&(this.checkAll=!1),i=a.map(function(e){var t=$("#uploadList_"+e.index);return t.children().find("span[class=chooseIndexSpan_pub]").text(""),delete e.chooseIndex,e}),this.chooseUploadImage=[]):(this.checkAll&&(this.checkAll=!1),i=a.map(function(t,i){t.chooseIndex=i+1;var a=$("#uploadList_"+t.index);return a.children().find("span[class=chooseIndexSpan_pub]").text(i+1),e.chooseUploadImage.push(t),t})),localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(i))}else this.chooseUploadImage=[];this.upladNum=this.chooseUploadImage.length}},changeSimple:function(){this.isSimpleUpload=!0,$(".chooseSimple")[0].click()},getCommonUploadConfig:function(){var t=this;console.info("获取上传参数=======");var i=this,a=localStorage.getItem(this.pageKey.token);try{if(window._czc){var o="调用newgetCommonUploadConfig的token===="+a;window._czc.push(["_trackEvent","剪影","上传页面",o])}if(window._jylog){var s=localStorage.getItem(this.pageKey.orderInfo);o="调用newgetCommonUploadConfig的token===="+a;window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"普通上传":"上传页面","newgetCommonUploadConfig进入设计",o,JSON.parse(s).orderNo])}}catch(e){console.log(e)}Object(H["n"])(a).then(function(a){if(console.info("res======="),console.info(a),a.result){if(i.server.commonUpload=a.data.commonUpload,i.isTaoBan&&(i.server.commonUpload=!1),i.server.commonUpload){if(i.server.upload=J["a"].commonuploadapi+a.data.uploadUrl,i.options.target=J["a"].commonuploadapi+a.data.uploadUrl,i.server.uploadData.appKey=a.data.appKey,i.server.uploadData.appSecret=a.data.appSecret,i.server.uploadData.serverKey=a.data.serverKey,i.server.uploadData.thumbnailToken=a.data.base64Token,i.server.uploadData.ipAddress=a.data.ipAddress,i.server.uploadData.multiple=!0,i.server.uploadData.unionId=a.data.unionId,i.options.query=a.data,window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"普通上传":"上传页面","ip地址",a.data.ipAddress,JSON.parse(o).orderNo])}try{if(window._jylog){o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"支付宝上传":"上传页面","ip地址",a.data.ipAddress,JSON.parse(o).orderNo])}}catch(e){console.log(e)}}else i.options.target=i.server.upload,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==========="),console.info(i.server.upload),console.info(a.data.uploadUrl);i.arrnum=i.maxPageNum,i.thumbnailToken=a.data.base64Token,localStorage.setItem(i.pageKey.thumbnailToken,a.data.base64Token);var s=localStorage.getItem(i.pageKey.token);if(i.options.query.token=s,console.log("undefined"===typeof loadUpload?"undefined":Object(q["a"])(loadUpload)),"function"==typeof loadUpload)try{loadUpload(i.minPageNum,i.maxPageNum,i.storageNamebase,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i);var n=localStorage.getItem(i.pageKey.caiyunContent);if("1"==i.caiyun&&n){var r=JSON.parse(n),l=i.readyphoto+r.contentIDList.length;if(i.readyphoto<i.maxPageNum&&l<=i.maxPageNum){for(var d=0;d<r.contentIDList.length;d++)localIds.push(r.contentIDList[d]);uploadPicCaiyun(localIds,i.server.uploadUrl,r,i.minPageNum,i.maxPageNum)}if(i.readyphoto<i.maxPageNum&&i.maxPageNum&&l>i.maxPageNum){for(d=0;d<i.maxPageNum-i.readyphoto;d++)localIds.push(r.contentIDList[d]);uploadPicCaiyun(localIds,i.server.uploadUrl,r,i.minPageNum,i.maxPageNum)}}}catch(c){try{if(window._jylog){o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告",c,JSON.parse(o).orderNo])}}catch(e){console.log(e)}i.$layer.alert(c),loadUpload(i.minPageNum,i.maxPageNum,i.storageNamebase,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i)}}})},getS3UpConfig:function(){var t=this,i=this;Object(H["H"])().then(function(a){if(a.result){i.server.s3flag=a.data.s3flag,i.isTaoBan&&(i.server.s3flag=!1),i.server.s3flag?(i.server.upload=J["a"].uploadapi+a.data.s3url,i.options.target=J["a"].uploadapi+a.data.s3url,i.server.uploadData.appkey=a.data.appkey,i.server.uploadData.methodId=a.data.methodId,i.server.uploadData.sign=a.data.sign,i.server.uploadData.checkId=a.data.checkId,i.options.query=a.data):(i.options.target=i.server.upload,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==========="),console.info(i.server.upload),console.info(J["a"].uploadapi+a.data.s3url)),i.arrnum=i.maxPageNum;var o=localStorage.getItem(i.pageKey.token);if(i.options.query.token=o,console.log("undefined"===typeof loadUpload?"undefined":Object(q["a"])(loadUpload)),"function"==typeof loadUpload)try{loadUpload(i.minPageNum,i.maxPageNum,i.storageNamebase,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i);var s=localStorage.getItem(i.pageKey.caiyunContent);if("1"==i.caiyun&&s){var n=JSON.parse(s),r=i.readyphoto+n.contentIDList.length;if(i.readyphoto<i.maxPageNum&&r<=i.maxPageNum){for(var l=0;l<n.contentIDList.length;l++)localIds.push(n.contentIDList[l]);uploadPicCaiyun(localIds,i.server.uploadUrl,n,i.minPageNum,i.maxPageNum)}if(i.readyphoto<i.maxPageNum&&i.maxPageNum&&r>i.maxPageNum){for(l=0;l<i.maxPageNum-i.readyphoto;l++)localIds.push(n.contentIDList[l]);uploadPicCaiyun(localIds,i.server.uploadUrl,n,i.minPageNum,i.maxPageNum)}}}catch(c){try{if(window._jylog){var d=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告，实例化插件失败",c,JSON.parse(d).orderNo])}}catch(e){console.log(e)}i.$layer.alert(c),loadUpload(i.minPageNum,i.maxPageNum,i.storageNamebase,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i)}}console.log(a)})},downLoadUrlList:function(t){var i=this;$("#uploadIndex").hide(),$("#loadingDatacaiyun").show(),Object(H["h"])(t).then(function(t){if(t.result);else{try{if(window._jylog){var a=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","加载历史图片失败",JSON.parse(a).orderNo])}}catch(e){console.log(e)}layer.alert("图片下载失败！"),$("#uploadIndex").show()}i.getCalenderTemp(localStorage.getItem(i.pageKey.token)),$("#loadingDatacaiyun").hide()}).catch(function(e){i.getCalenderTemp(localStorage.getItem(i.pageKey.token)),$("#loadingDatacaiyun").hide()})},getCalenderTemp:function(e){var t=[],i=this,a=(i=this,{});a.token=e,a.pagenum=this.pageIndex,a.pageSize=this.pageSize,Object(H["N"])(a).then(function(e){var a=[],o=localStorage.getItem(i.pageKey.historyCalenderTemp);o&&"null"!=o&&null!=o&&(a=JSON.parse(o)),$("#imageList").empty();var s=null;if(s="string"==typeof e?JSON.parse(e):e,s.result){var n=null;if(n="string"==typeof s.data?JSON.parse(s.data.list):s.data.list,n.length>0?i.isSelectHistory=!0:1==i.pageIndex&&n.length>0&&(i.isSelectHistory=!0),""!=n&&n.length>0){i.readyphoto=n.length;for(var r=0;r<n.length;r++){1!=i.pageIndex&&a.length+r;var l={isUse:!0};l.index=r,l.history=!0,l.id=n[r].id,l.name=n[r].name,l.url=n[r].picname,l.src=Object(Q["d"])(n[r].picname)+Object(Q["e"])(n[r].picname,n[r].imageinfo,i.thumbnailToken);Object(q["a"])(n[r].imageinfo);if(""!=n[r].imageinfo){var d=JSON.parse(n[r].imageinfo),c="";c=d.primaryImageInfo?d.primaryImageInfo:d,l.dateTime=d.dateTime,l.width=c.width,l.height=c.height,l.sortId=c.sortId,(c.width<Fe||c.height<Re)&&(l.pixellow=1)}t.push(l)}}else i.isNoHistoryPhoto=!0;var h=localStorage.getItem(i.pageKey.calenderTemp);if(null!=h&&void 0!=h||(h=[]),t.length>0){if(t.length==h.length)for(r=0;r<t.length;r++)if(t[r].id!=h[r].id){localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson),console.log(11111111111111111e39);break}t=a.concat(t);var g={};t=t.reduce(function(e,t){return!g[t.id]&&(g[t.id]=e.push(t)),e},[]),localStorage.setItem(i.pageKey.historyCalenderTemp,JSON.stringify(t))}else localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson)}else localStorage.removeItem(i.pageKey.calenderTemp),localStorage.removeItem(i.pageKey.historyCalenderTemp),localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson);i.storageNamebase=i.pageKey.historyCalenderTemp,handleImagehistoryupload(!0,i.minPageNum,i.maxPageNum,i.storageNamebase,i)})},handleScroll:function(e){var t=e.target.scrollHeight,i=e.target.clientHeight,a=e.target.scrollTop;console.log(t,i,a);var o=this.$route.query.isfirst;o?"string"==typeof o&&(o="false"!=o):o=!1,!o||this.isNoHistoryPhoto?(console.log("加载更多1"),this.isfinish||(console.log("继续加载"),a+i+100>=t&&(this.pageIndex++,this.getCalenderTemp(localStorage.getItem(this.pageKey.token)),console.log("加载更多")))):this.isfinish||a+i+100>=t&&(this.pageIndex++,this.getCalenderTemp(localStorage.getItem(this.pageKey.token)),console.log("加载更多"))},deletePic:function(){var e=$("#imageList").find("span[class=chooseIndexSpan_pub]");console.info("开始删除照片了！！！"),e.length>0&&(console.info("进入删除照片了！！！"),deleteDelimage(e,this.minPageNum,this.maxPageNum)),this.editing=!1,$(".weui-cell").show()},resetupload:function(){hideModal()},next:function(){var t=this;if(isupping)showConfirm("#uping-photo");else{var i=!1,a=localStorage.getItem(this.storageNamebase);try{if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面跳转","上传跳设计页","页面跳转","[]"==a?"上传照片数量0张":"上传照片数量"+JSON.parse(a).length+"张",JSON.parse(o).orderNo])}}catch(e){console.log(e)}if(null!=a&&"null"!=a){a=JSON.parse(a),a.sort(sortBy("index",!0));var s=this.$route.query.isSimple;if(a.length<this.minPageNum&&(s||-1==this.id||this.isSignleTempleBook))return this.tipsFont=!0,void setTimeout(function(){t.tipsFont=!1},3e3);for(var n=0;n<a.length;n++)if(1==a[n].pixellow){i=!0;break}localStorage.setItem(this.storageNamebase,JSON.stringify(a));var r=[];if(this.uploadcomplete);else{var l=localStorage.getItem(this.pageKey.uploadCalenderTemp);if(l){var d=JSON.parse(l);r=d.concat(a)}else r=a}localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(r));var c=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(c=!0)}),c)showConfirm("#fail-photo");else{t=this;if(1!=this.isTeamBook&&"true"!=this.isTeamBook)if(this.isTaoBan)if(i)this.showModal("#low-photo");else{t=this;layer.confirm("确认提交套版吗?",function(i){try{t.nextStep(1)}catch(e){}layer.close(i)})}else this.isSimple,t.nextStep(0);else i?this.showModal("#low-photo"):this.nextStep(1)}}}},chooseFail:function(){this.checkAll&&resetEdit(),chooseFailBox(),this.hideModal()},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},goFxupload:function(){location.href="fxUpload?id="+this.id+"&p="+this.p+"&isTeamBook="+this.isTeamBook+"&isfirst="+!0},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},nextStep:function(t){if(isupping)showConfirm("#uping-photo");else{this.hideModal();var i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));try{if(window._czc){var a="";a=0==t?"时间排序":"智能排序",window._czc.push(["_trackEvent","剪影","上传页面",a])}if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","进入设计",a,JSON.parse(o).orderNo])}}catch(e){console.log(e)}this.$emit("baseUploadNextStep",this.id,this.p,i,t)}},showUpload:function(){$(".uploadZoone").show(),$(".no-infor").hide()},onFileAdded:function(e){if(e.requestid||(e.requestid=(new Date).getTime(),this.options.query.requestid=e.requestid),$("#uploadIndex").hide(),$("#uploadShow").show(),e&&e._info&&e._info.width>1e4&&e._info.height>1e4){if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","上传照片","图片:"+e.name+" 文件宽高过大！系统不支持！",JSON.parse(t).orderNo])}alert("图片:"+e.name+" 文件宽高过大！系统不支持！")}if(e.size>this.options.size)return this.showModal("#type-size"),window.setTimeout(function(){hideModal()},2e3),void(e.ignored=!0);addFileSimple(e)},onFileSuccess:function(e,t,i,a){var o=JSON.parse(i);if(uploadSuccess(t,o,this.minPageNum,this.maxPageNum),window._jylog){var s=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","simple上传照片","上传成功",JSON.parse(s).orderNo])}},fileProgress:function(e,t,i){if(this.progress=t.progress(),!t.starttime){var a=(new Date).getTime();console.info("上传开始时间"),console.info(a),t.starttime=a}uploadProgressSimple(t,this.progress),this.averageSpeed=Math.round(t.averageSpeed),this.currentSpeed=Math.round(t.currentSpeed),this.timeRemaining=t.timeRemaining(),this.uploadedSize=t.sizeUploaded();this.isUploading,this.isComplete;if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面",t.name+"simple上传照片进度100%","requestid："+t.requestid+"图片大小="+t.size+",用时==秒当前速度="+this.currentSpeed+",平均上传速度="+this.averageSpeed+"kb/s",JSON.parse(o).orderNo])}},onFileError:function(e,t,i,a){faileureSimple(t)},fileRemoved:function(e){var t=this;this.$nextTick(function(){t.file_total=t.$refs["uploader"].files.length})},getHistoryPhoto:function(){this.isuploadbutton=!1,this.ishistoryuploadbutton=!0,this.historytips=!1,$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNum=0,this.checkAll=!1,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.historyCalenderTemp,$("#historyuploadbutton").addClass("active"),$("#uploadbutton").removeClass("active"),$("#designGO").hide(),$(".addImagediv").hide(),$("#insertupload").show();var e=localStorage.getItem(this.pageKey.historyCalenderTemp);e?(e=JSON.parse(e),e!=[]&&e.length>0?handleImagehistoryupload(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this):this.getCalenderTemp(localStorage.getItem(this.pageKey.token))):this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},changebutton:function(){this.isuploadbutton=!0,this.ishistoryuploadbutton=!1,$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNum=0,this.checkAll=!1,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.calenderTemp,this.chooseNum=0,$("#designGO").show(),$("#uploadIndex").show(),$(".addImagediv").show(),$("#insertupload").hide(),$("#uploadbutton").addClass("active"),$("#historyuploadbutton").removeClass("active"),handleImagebeforeupload(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this)},submitUpload:function(){var e=this;this.$nextTick(function(){for(var t=0;t<e.$refs["uploader"].files.length;t++)e.$refs["uploader"].files[t].resume()})},closeErrorDialog:function(){this.errorDialog=!1},handelClose:function(){this.clearcache(),this.thirdDialog=!1},clearcache:function(){this.file_total=0,this.errorfilelist=[],this.controllerErrorFileDialog=!1,this.$refs.uploader.uploader.cancel(),this.getresourceDetail()},cancelUpload:function(){console.info("取消上传"),this.thirdDialog=!1,this.clearcache()},progressStyle:function(){var e=Math.floor(100*this.progress),t="translateX(".concat(Math.floor(e-100),"%)");return{progress:"".concat(e,"%"),webkitTransform:t,mozTransform:t,msTransform:t,transform:t}},status:function(){statuschange();var e=this.isUploading,t=this.isComplete,i=this.error,a=this.paused;return t?"success":i?"error":e?"uploading":a?"paused":"waiting"},onFilesubmitted:function(e,t){console.info("asjjjj")},changePhotoUploadList:function(){var e=JSON.parse(localStorage.getItem(this.pageKey.historyCalenderTemp)),t=[],i=localStorage.getItem(this.pageKey.calenderTemp);if("[]"==i?(console.info("7418473==="),t=[]):t=JSON.parse(i),t.length>this.maxPageNum){var a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";layer.alert(a)}else{for(var o=$("#imageList").find(".weui-check"),s=0;s<o.length;s++)if(o[s].checked)for(var n=$(o[s]).parents(".phoBox").attr("imageid"),r=0;r<e.length;r++)if(n==e[r].id){if(t.length>=this.maxPageNum){localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t));a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";return layer.alert(a),console.info("22222"),void this.changebutton()}t.push(e[r]);break}localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t)),this.changebutton()}},handleRoute:function(){try{var t="",i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));if(i){t=-1!=i.url.indexOf("mtemplate")?i.url.replace("mtemplate","drafts"):i.url.replace("loading","drafts");var a=localStorage.getItem(this.pageKey.token),o=this.getUrlKey(t,"token"),s="token="+o,n="token="+a+"&fromDesign="+!0;if(console.info("aaaaaaaaaaaaaaaaaaaaaaaa==============="+o),t=t.replace(s,n),-1!=window.location.href.indexOf("https")&&-1!=t.indexOf("http://")&&-1==t.indexOf("http://sjky")){var r=t.split("http");2==r.length?t="https"+r[1]:3==r.length&&(t="https"+r[1]+"https"+r[2])}if(-1!=window.location.href.indexOf("https")&&-1!=t.indexOf("http://sjky")){r=t.split("http://sjky");t="https://tt"+r[1]}location.href=t}}catch(e){console.log(e)}},getUrlKey:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null}}},Ge=qe,ze=(a("c30c"),a("b165"),Object(b["a"])(Ge,Ue,We,!1,null,"56d13ae7",null)),He=ze.exports,Ve={name:"upload",components:{BaseUpload:He},data:function(){return{storageName:null,submitButtonName:"进入设计",history:!1,uid:"",id:"",pageKey:null,isPart:!1,isChangxian:!1,isSimple:!1,iscomplete:!1,server:{upload:J["a"].basicUrl+"/upload/photo",uploadData:{},delete:"/tbdiy/uploade/deleteImg.do",urlConfig:J["a"],uploadUrl:J["a"].basicUrl+"/upload/downloadCaiyun"},checksubmitstate:!0,minPageNum:0,maxPageNum:0,isTeamBook:!1,uploadcomplete:!1,options:{target:"",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:15728640,query:{}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"},isSignleTempleBook:null}},created:function(){1!=this.$route.query.isSignleTempleBook&&"true"!=this.$route.query.isSignleTempleBook||(this.isSignleTempleBook=!0),document.body.style.position="absolute";var e=localStorage.getItem("isAlipay"),t=navigator.userAgent.toLowerCase();("undefined"!=typeof my||"alipayclient"==t.match(/AlipayClient/i)||e)&&(this.is_alipay=!0),this.id=this.$route.query.id,this.isSimple=this.$route.query.isSimple,"boolean"===typeof this.isSimple||("false"==this.isSimple?this.isSimple=!1:"true"==this.isSimple&&(this.isSimple=!0));this.$route.query.uploadcomplete;this.isPart=this.$route.query.isPart,this.history=this.$route.query.history,this.uid=this.$route.query.uid;var i=this.$route.query.p;this.isTeamBook=this.$route.query.isTeamBook,this.isfirst=this.$route.query.isfirst,this.isChangxian=this.$route.query.isChangxian,"true"!=this.isTeamBook&&1!=this.isTeamBook||"true"==this.isfirst||1==this.isfirst?this.pageKey=ee["a"]:this.pageKey=ee["c"],(this.isPart||this.history)&&(this.pageKey=ee["c"]),this.logFrom("普通上传"),localStorage.removeItem(this.pageKey.calenderTemp);var a=localStorage.getItem(this.pageKey.token);if(null!=a&&void 0!=a&&"null"!=a&&"undefined"!=a){this.storageName=this.pageKey.calenderTemp,!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isTeamBook=!1,this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)):(this.isTeamBook=!0,this.isPart&&1!=this.isChangxian?(this.minPageNum=i,this.maxPageNum=5*i,localStorage.setItem(this.pageKey.minnum,i),localStorage.setItem(this.pageKey.maxnum,5*i)):(this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)));a=localStorage.getItem(this.pageKey.token);this.server.uploadData.token=a}else this.$router.push({name:"404"})},mounted:function(){},beforeRouteEnter:function(e,t,i){var a=localStorage.getItem("readyupload");i(function(e){if(("/mtemplate"!=t.path||"/loading"!=t.path)&&a&&"true"==a&&!e.isSignleTempleBook){var i=localStorage.getItem(e.pageKey.orderInfo);if(i){var o=JSON.parse(i),s=e.getUrlKey(o.url,"sku"),n=e.getUrlKey(o.url,"flagURL"),r=e.getUrlKey(o.url,"orderNo"),l=e.getUrlKey(o.url,"memberid"),d=e.getUrlKey(o.url,"returnURL"),c=e.getUrlKey(o.url,"id"),h=e.getUrlKey(o.url,"num"),g=e.getUrlKey(o.url,"spmc"),m=e.getUrlKey(o.url,"token"),p="fromDesign",u=e.getUrlKey(o.url,"hasDraft");e.$router.push({name:"drafts",query:{sku:s,flagURL:n,orderNo:r,memberid:l,returnURL:d,id:c,num:h,spmc:g,token:m,fromDesign:p,hasDraft:u}})}}})},methods:{getUrlKey:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null},nextStep:function(t,i,a,o){var s=localStorage.getItem(this.pageKey.calenderTemp);localStorage.getItem(this.pageKey.diytype);try{if(window._jylog){var n=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面跳转","上传跳设计页","页面跳转","[]"==s?"上传照片数量0张":"上传照片数量"+JSON.parse(s).length+"张",JSON.parse(n).orderNo])}}catch(e){console.log(e)}if(this.isfirst&&"[]"!=s){var r=JSON.parse(s);if(-1==this.id&&r.length<this.minPageNum)return void layer.alert("空白模板，上传照片数量不能小于最小照片数量")}if("[]"!=s&&""!=s&&void 0!=s&&"undefined"!=s){var l=JSON.parse(s);if(l.length<"1")return void layer.alert("请先选择照片")}else{l=JSON.parse(s);if(l.length<"1")return void layer.alert("请先选择照片")}localStorage.getItem(this.pageKey.hassort);localStorage.setItem(this.pageKey.hassort,o),localStorage.removeItem(this.pageKey.cal_pageList);var d=!1;1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(d=!0),localStorage.setItem(this.pageKey.areadyInsert,"1");navigator.userAgent.toLowerCase();var c=navigator.userAgent,h=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),g=0;if(this.isSignleTempleBook&&(g=1),h)this.isSimple?(console.log("----this.isSimple----:"+this.isSimple),location.href="simpledesign?id="+this.id+(null==i||void 0==i||""==i?"":"&p="+i)+(null==d||void 0==d||""==d?"":"&isEditCover="+d)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+g+"&submit=true&editType=1&iscomplete="+this.iscomplete):location.href="design?id="+this.id+(null==i||void 0==i||""==i?"":"&p="+i)+(null==d||void 0==d||""==d?"":"&isEditCover="+d)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+g+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid)+"&isSignleTempleBook="+this.isSignleTempleBook;else if(this.isSimple)console.log("----this.isSimple----:"+this.isSimple),this.$router.push({name:"simpledesign",query:{id:this.id,p:i,isEditCover:d,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:g,submit:!0,editType:1,iscomplete:this.iscomplete}});else{var m={id:this.id,p:i,isEditCover:d,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:g,iscomplete:this.iscomplete,isSignleTempleBook:this.isSignleTempleBook};this.history&&(m.history=this.history,m.uid=this.uid),this.$router.push({name:"design",query:m})}},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录",this.isSimple?"极简上传":"上传页面",t,i,JSON.parse(a).orderNo])}startUploadLog()}catch(e){console.log(e)}}}},Ye=Ve,Xe=Object(b["a"])(Ye,Me,$e,!1,null,null,null),Qe=Xe.exports,Ze=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("new-base-upload",{attrs:{storageName:e.storageName,pageKey:e.pageKey,submitButtonName:e.submitButtonName,server:e.server,checksubmitstate:e.checksubmitstate,isTaoBan:!1,uploadcomplete:e.uploadcomplete,minPageNum:e.minPageNum,maxPageNum:e.maxPageNum},on:{baseUploadNextStep:e.nextStep}})],1)},et=[],it=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"anniu"}),i("div",{staticClass:"uploaderBox pr uploaderBoxnew",attrs:{id:"uploadIndex"}},[i("p",{staticClass:"upload-tips"},[e._v("每次上传50-100张最佳，选择较多可能会卡住哦~")]),i("a",{staticClass:"uploader_input sjky uploader_inputnew",attrs:{href:"javascript:void(0);",id:"loadUploader_new",title:"选择照片"}}),e.minPageNum!=e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc upload-hintnew"},[e._v("请上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")]):e._e(),e.minPageNum==e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc upload-hintnew"},[e._v("请上传"+e._s(e.minPageNum)+"张照片")]):e._e()]),i("section",{staticClass:"mobile_web pb100 mobile_webnew",attrs:{id:"uploadShow"}},[i("div",{ref:"top",staticClass:"weui-cells sjky-list-tip sjky-list-tip2 sjky-list-tip3 sjky-list-tip3new top",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell"},[i("div",{staticClass:"weui-cellnew"},[i("div",{staticClass:"weui-cellnews"},[i("div",{staticClass:"weui-cell__hd"},[i("div",{staticClass:"checkbox weui-cells_checkbox"},[i("input",{staticClass:"weui-check weui-check_box2",attrs:{type:"checkbox",name:"photos"},on:{click:e.checkAllphoto}}),i("i",{staticClass:"weui-icon-checked"})])]),e._m(0)])]),i("div",{staticClass:"weui-cell__ft weui-cell__ftnew"},[[i("a",{staticClass:"sjky-btn-grey sjky-btn-grey2 sjky-btn-greyshanchu",attrs:{id:"deletephoto",href:"javascript:void(0);"},on:{click:function(t){return e.deletePic()}}},[e._v("删除("+e._s(e.chooseNum)+")")])]],2)])]),i("section",{staticClass:"phoList clearfix page",on:{scroll:e.handleScroll}},[i("div",{staticStyle:{display:"none"},attrs:{id:"filePicker"}}),i("div",{attrs:{id:"imageList"}})]),i("footer",{staticClass:"sjky-btn-bottom sjky-btn-bottom2 sjky-btn-bottom2new"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipsFont,expression:"tipsFont"}],staticClass:"num-tips"},[e._v("\n\t\t\t          最少上传"+e._s(e.minPageNum)+"张，再上传几张吧。\n\t\t\t")]),e._m(1),i("div",{staticClass:"l tc addImagediv addImagedivnew"},[i("a",{staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.clickNext()}}},[e._v("下一步"),i("span",{attrs:{id:"chooseNumNext"}},[e._v("("+e._s(e.chooseNum)+")")])]),i("p",{attrs:{id:"info"}},[e._v("还需上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")])])])]),e._m(2),e._m(3),i("section",{staticClass:"modal modal-out",attrs:{id:"px-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),e._m(4)]),e._m(5),i("section",{staticClass:"modal modal-out",attrs:{id:"fail-photo"}},[e._m(6),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.chooseFail()}}},[e._v("一键选中")])])]),i("section",{staticClass:"modal modal-out",attrs:{id:"morethan-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("我们根据您选取顺序上传"+e._s(e.arrnum)+"张")])]),e._m(7)]),e._m(8),i("section",{staticClass:"overlay"}),e._m(9),i("section",{staticClass:"modal modal-out",attrs:{id:"low-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("返回")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.nextStep()}}},[e._v("确定")])])]),e._m(10),i("section",{staticClass:"modal modal-out",attrs:{id:"duplicate-photo"}},[e._m(11),i("footer",{staticClass:"modal-buttons"},[i("span",{staticClass:"modal-button btn-cancel ddel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.resetupload()}}},[e._v("确定")])])]),e._m(12),e._m(13),""!=e.options.target?i("uploader",{ref:"uploader",staticClass:"uploader-example",attrs:{options:e.options,"file-status-text":e.statusText,"auto-start":!0},on:{status:e.status,"file-added":e.onFileAdded,"file-progress":e.fileProgress,"progress-style":e.progressStyle,"progressing-class":e.progressingClass,"file-success":e.onFileSuccess,"file-error":e.onFileError,"file-removed":e.fileRemoved,"files-submitted":e.onFilesubmitted,"is-complete":e.isComplete,"is-uploading":e.isUploading}},[i("uploader-btn",{staticClass:"chooseSimple",staticStyle:{display:"none"},attrs:{attrs:e.attrs}},[e._v("select images")])],1):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showtanchaungnew,expression:"showtanchaungnew"}],staticClass:"tanchaungnew"},[i("div",[i("img",{attrs:{src:a("2ff8")}}),i("p",[e._v("照片还不够哦")]),i("p",[e._v("是否预留空白先预览效果")]),i("div",[i("a",{on:{click:function(t){return e.next()}}},[e._v("预留空白")]),i("a",{on:{click:e.closeShowtanchaungnew}},[e._v("继续选择")])])])])],1)},at=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-cell__bd"},[i("div",[i("p",{staticClass:"sub-title"},[e._v("顺序全选")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"addUpload",attrs:{id:"addImage"}},[i("img",{attrs:{src:a("7904")}}),i("div",[e._v("上传照片")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maskLayer",staticStyle:{display:"none"}},[i("p",[e._v("上传中")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"loadBox tc wh f32",staticStyle:{display:"none"},attrs:{id:"loadingDatacaiyun"}},[i("img",{attrs:{src:"img/loading.gif"}}),i("span",[e._v("正在上传...")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"uping-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("正在上传中，请稍等！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("有未成功加载的照片，请先删除！")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"taoban-show"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("【随机套版】将对您上传的图片随机排版，暂时无法查看效果及修改的哦，建议您选择【我去设计】自由设计。")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("我知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"del-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("确认删除此照片？")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold ddel"},[e._v("确定")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"choose-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片上传失败")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel ddel"},[e._v("删除")]),i("span",{staticClass:"modal-button modal-button-bold aagain"},[e._v("重新上传")])]),i("input",{attrs:{type:"hidden",id:"file_id",value:""}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片重复，是否上传")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-denied"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片类型错误")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-size"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片过大")])])])}],ot=(a("aef6"),a("c5f6"),""),st="",nt="",rt="",lt="",dt="",ct="";function ht(t,i,a,o,s,n,r,l,d){he=new Array,ce=!1,ge=800,me=800,pe=!1,[],a=a,o=o,s=s,n=n,r=r,l=l,ue=d,wt(n,t,i,a,ue),$("#addImage").bind("click",function(e){try{if(window._jylog){var t=localStorage.getItem(l.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","继续上传","上传数量="+ue.upladNum+",最大数量="+i,JSON.parse(t).orderNo])}}catch(e){console.log(e)}"function"==typeof ht&&0==ue.isSimpleUpload?(console.info("sssssss1111"),$(".webuploader-element-invisible")[0].click()):$(".chooseSimple")[0].click()});var c,h=$("#imageList"),g=0,m=(window.devicePixelRatio,150),p=150,u="pedding",f={},y=function(){var e=new Image,t=!0;return e.onload=e.onerror=function(){1==this.width&&1==this.height||(t=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t}(),_=(function(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){e="0.0"}}e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}(),function(){var e=document.createElement("p").style,t="transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e;e=null}(),41943040),v=localStorage.getItem(l.source);function w(o,n){var r=localStorage.getItem(a);if(null!=r&&"null"!=r&&void 0!=r&&(r=JSON.parse(r),r.length>0&&(he=r)),"1"==o.r){$("#uploadList_"+n.id).attr("uploading","1"),$("#uploadFailure_"+n.id).remove();var d="",c="",h="";o.imageInfo.primaryImageInfo?(d=o.imageInfo.primaryImageInfo.width,c=o.imageInfo.primaryImageInfo.height,h=o.imageInfo.primaryImageInfo.dateTime):(d=o.imageInfo.width,c=o.imageInfo.height,h=o.imageInfo.dateTime);var g=_t(o.url)+vt(o.url,d,c,s),m={url:o.url,index:n.id,sort:n.sort,id:o.id,width:d,height:c,name:n.name,dateTime:h,isUse:!0};he.push(m);var p=!1;if(d>=c?(d<ge||c<me)&&(p=!0):(d<me||c<ge)&&(p=!0),p?($("#uploadDel_"+n.id).show(),$("#uploadMask_"+n.id).show(),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()):($("#uploadDel_"+n.id).hide(),$("#uploadMask_"+n.id).hide(),$("#showIOSDialog2").hide(),$("#showIOSDialog3").show()),window.localStorage){var u=[];$.each(he,function(e,t){var i=0;$("#uploadMask_"+t.index).is(":visible")&&(i=1,$("#showIOSDialog2").show(),$("#showIOSDialog3").hide());var a={url:t.url,id:t.id,index:t.index,sort:t.sort,src:_t(t.url)+vt(t.url,t.width,t.height,s),pixellow:i,history:t.history,width:t.width,height:t.height,dateTime:t.dateTime,name:t.name,isUse:!0};u.push(a)});var f=$("#uploadFailure_"+n.id),y=$("#uploadMask_"+n.id);y.remove(),f.remove(),localStorage.setItem(ue.pageKey.historyCalenderTemp,JSON.stringify(u)),ue.upladNum=u.length,u.length,$("#info").text("可上传"+t+"-"+i+"张")}-1!=g.indexOf(ue.server.urlConfig.thumbnailUrl)&&(g=g.replace("fsferry/","")),$("#uploadList_"+n.id).css("background-image","url("+g+")");try{St(n,"上传成功")}catch(e){console.log(e)}}else{try{if(window._jylog){var _=localStorage.getItem(l.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","上传失败",JSON.stringify(o),JSON.parse(_).orderNo])}}catch(e){console.log(e)}try{St(n,"上传失败")}catch(e){console.log(e)}$("#uploadFailure_"+n.id).show(),$("#uploadList_"+n.id).attr("uploading","1")}}function b(o){$(".checkbox").hide(),$("#loadingData").show();var d=[],g=localStorage.getItem(ue.pageKey.historyCalenderTemp);g&&"null"!=g&&null!=g&&(d=JSON.parse(g)),ue.isSelectHistory&&(o.id=d.length+o.id);var u=$('<div id="uploadList_'+o.id+'" imageid="'+o.id+'" data-index="'+o.id+'" uploading="0" class="phoBox" style="" onClick="photochoose_new('+o.id+","+ue.minPageNum+","+ue.maxPageNum+')"></div>');if(o.chooseIndex&&""!=o.chooseIndex){var _=$('<div class="checkbox weui-cells_checkbox" style="display:none"><label class="weui-check__label" for="photoCheck_'+o.id+'">\t<span class="chooseIndexSpan">'+o.chooseIndex+"</span>\t</label></div>\t");_.appendTo(u)}var v=$('<div class="tips-pixel-out" id="uploadMask_'+o.id+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');v.appendTo(u);var w=$('<div id="uploadFailure_'+o.id+'" class="waitUpload tc" style="display:none"><span class="wh fs12 mt10 dib" id="uploadFailure_span_'+o.id+'">网络连接异常</span></div>');function b(o){n||alert("已经提交，不允许重复制作。");var r=new Array,d=$("#uploadList_"+o.id).attr("imageid")+"",h=[];h.push(d),$.ajax({url:s.delete,type:"post",data:{imgIds:h},async:!1,cache:!1,success:function(e){var s=JSON.parse(e),n=s.retCode;if($.each(he,function(e,t){t.index==o.id||r.push(t)}),n<=0){var l=localStorage.getItem(a);if(null!=l&&"null"!=l){l=JSON.parse(l);var d=new Array;$.each(l,function(e,t){t.index==o.id||d.push(t)}),l=d}else l=new Array;ue.upladNum=l.length,localStorage.setItem(a,JSON.stringify(l)),c.removeFile(o),ut()}else{if(he=r,window.localStorage){l=localStorage.getItem(a);if(null!=l&&"null"!=l){l=JSON.parse(l);d=new Array;$.each(l,function(e,t){t.index==o.id||d.push(t)}),l=d}else l=new Array;ue.upladNum=l.length,localStorage.setItem(a,JSON.stringify(l)),l.length<t&&$("#info").text("可上传"+t+"-"+i+"张"),l.length>t&&$("#info").text("可上传"+t+"-"+i+"张"),0==l.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var h=!1,g=0;g<l.length;g++)if(1==l[g].pixellow){h=!0;break}h||$("#showIOSDialog2").hide()}c.removeFile(o),ut()}},error:function(){try{if(window._jylog){var t=localStorage.getItem(l.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","服务器异常,删除失败。",JSON.parse(t).orderNo])}}catch(e){console.log(e)}return layer.alert("服务器异常,删除失败。"),!1}})}function I(e){var o=new Array;if($.each(he,function(t,i){i.index==e.id||o.push(i)}),he=o,window.localStorage){var s=localStorage.getItem(a);if(null!=s&&"null"!=s){s=JSON.parse(s);var n=new Array;$.each(s,function(t,i){i.index==e.id||n.push(i)}),s=n}else s=new Array;localStorage.setItem(a,JSON.stringify(s)),he=s,ue.upladNum=s.length,s.length<t?$("#info").text("可上传"+t+"-"+i+"张"):s.length<i&&s.length>=t?$("#info").text("可上传"+t+"-"+i+"张"):(s.length>i&&$("#info").css("color","#a5a6a6"),$("#info").text("已上传"+s.length+"张,可上传"+t+"-"+i+"张")),0==s.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var r=!1,l=0;l<s.length;l++)if(1==s[l].pixellow){r=!0;break}r||$("#showIOSDialog2").hide()}c.removeFile(e),ut()}w.appendTo(u),ct=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">等待上传</p></div>'),ct.appendTo(u),u.on("click",function(){var e=$(this).attr("uploading");"0"!=e&&$(".ddel").click(function(){r?b(o):I(o)})}),"invalid"===o.getStatus()?w.show():(c.makeThumb(o,function(e,t){e||(y?c.makeThumb(o,function(e,t){e?w.show():u.attr("style","background-image:url("+t+");")},m,p):w.show())},m,p),f[o.id]=[o.size,0],o.rotation=0),o.on("statuschange",function(e,t){"error"===e||"invalid"===e?(console.log(o.statusText),v.hide(),w.show(),f[o.id][1]=1):"interrupt"===e?(v.hide(),w.show()):"queued"===e?(v.hide(),w.hide(),f[o.id][1]=0):"progress"===e?(v.hide(),w.hide()):"complete"===e&&(v.hide(),w.hide())});$("div[id^='uploadList_']:visible").length;h.prepend(u)}function I(e){var t=$("#uploadList_"+e.id);t.remove(),delete f[e.id],S()}function S(){x()}function x(){"ready"===u||c.getStats()}function k(e){var t;if(e!==u){switch(u=e,u){case"pedding":break;case"ready":h.show(),c.refresh();break;case"uploading":break;case"paused":break;case"confirm":if(t=c.getStats(),t.successNum&&!t.uploadFailNum)return void k("finish");break;case"finish":t=c.getStats(),t.successNum||(u="done",location.reload());break}x()}}"fxxt"==v&&(_=41943040),WebUploader.Uploader.register({"before-send-file":"beforeSendFile"},{beforeSendFile:function(e){var t=WebUploader.Deferred();return c.md5File(e).fail(function(){delete c.options.formData.fileMd5,console.log("md5File fail,deferred.reject."),t.reject()}).then(function(i){c.options.formData.fileMd5=i,e.requestid||(e.requestid=(new Date).getTime(),c.options.formData.requestid=e.requestid),t.resolve()}),t.promise()}}),c=WebUploader.create({pick:{id:"#filePicker",label:"选择图片",multiple:!0},formData:s.uploadData,swf:"/swf/Uploader.swf",chunked:!1,chunkSize:524288,threads:5,server:s.upload,accept:{title:"Images",extensions:"jpg,jpeg,png,webp,bmp,heic,heif,avif",mimeTypes:"image/*"},duplicate:!0,compress:!1,method:"POST",disableGlobalDnd:!0,fileSingleSizeLimit:_,resize:!1}),c.on("uploadError",function(t,i){try{xt(t,"响应时间，uploadFile fail方法")}catch(e){console.info(e)}$("#uploadList_"+t.id).attr("uploading","1"),$("#waitUploadmask_"+t.id).hide(),$("#uploadFailure_"+t.id).show(),$(".sjky-btn-bottom2").show();try{if(window._jylog){var a=localStorage.getItem(l.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","普通上传失败",String(i),JSON.parse(a).orderNo])}}catch(e){console.log(e)}}),c.on("uploadSuccess",function(o,n){try{xt(o,"响应时间")}catch(e){console.info(e)}if($(".weui-cell").show(),$(".sjky-list-tip3").show(),$(".sjky-btn-bottom2").show(),$(".checkbox").hide(),r){if("4"==n.state)return I(o),!1;if("0"==n.state||"1"==n.state){$("#uploadList_"+o.id).attr("uploading","1"),$("#uploadList_"+o.id).attr("imageid",JSON.parse(n._raw).imageId);var d={id:JSON.parse(n._raw).imageId,url:n.path,index:o.id,sort:o.sort,name:o.name,isUse:!0,md5val:n.imagemd5,state:n.state};he.push(d);if("1"==n.state&&($("#uploadDel_"+o.id).show(),$("#uploadMask_"+o.id).show(),$("#uploadCover_"+o.id).show(),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()),!window.localStorage){try{if(window._jylog){var c=localStorage.getItem(l.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","提示","浏览器版本过低,请更换qq浏览器或刷新页面!",JSON.parse(c).orderNo])}}catch(e){console.log(e)}return void layer.alert("浏览器版本过低,请更换qq浏览器或刷新页面!")}var h=[];$.each(he,function(e,t){var i=0;$("#uploadMask_"+t.index).is(":visible")&&(i=1);var a={id:t.id,url:t.url,index:t.index,src:s.baseUrl+"/tbdiy/uploade/queryTbImages.do?filePath="+t.url,pixellow:i,sortv:t.sort,history:t.history,name:t.name,isUse:!0,md5val:t.md5val,state:n.state};h.push(a)}),imageArray=h,ue.upladNum=imageArray.length,localStorage.setItem(a,JSON.stringify(h)),h.length,$("#info").text("可上传"+t+"-"+i+"张")}else $("#uploadFailure_"+o.id).show(),$("#uploadList_"+o.id).attr("uploading","1")}else if(s.s3flag||s.commonUpload)if("success"==n.result&&n.data[0].uploadResult||n.success&&n.data){var g={};if(g.token=s.uploadData.token,s.commonUpload){var m=n.data[0];g.filename=m.filePath,g.originalName=m.fileName,m.prefix&&(g.prefix=m.prefix),g.ImageInfo={},g.ImageInfo.width=Number(m.width),g.ImageInfo.height=Number(m.height),g.ImageInfo.fileMd5=m.md5,m.dateTime&&(g.ImageInfo.dateTime=m.dateTime),g.lastModifiedDate=o.lastModifiedDate}else{m=n.data[0];g.filename=m.lookPath,g.store=m.store,g.originalName=m.oldFileName,g.ImageInfo={},g.ImageInfo.width=Number(m.widthpx),g.ImageInfo.height=Number(m.hightpx),g.ImageInfo.fileMd5=m.fileMd5,g.ImageInfo.sortId=o.id,g.sort=o.sort,m.dateTime&&(g.ImageInfo.dateTime=m.dateTime),g.lastModifiedDate=o.lastModifiedDate}g=JSON.stringify(g),$.ajax({type:"POST",url:s.urlConfig.basicUrl+"/upload/savephotoinfo",data:g,dataType:"json",contentType:"application/json",success:function(e){w(e,o)},error:function(t,i,a){$("#uploadFailure_"+o.id).show();var s="保存出错";i&&(s=i);try{if(window._jylog){var n=localStorage.getItem(l.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","新版保存失败",s,JSON.parse(n).orderNo])}}catch(e){console.log(e)}try{St(o,"新版保存失败")}catch(e){console.log(e)}$("#uploadFailure_span_"+o.id).text(s),$("#uploadList_"+o.id).attr("uploading","1")}})}else{$("#uploadFailure_"+o.id).show();var p="";p=n.data?-1!=n.data[0].uploadMessage.indexOf("不允许上传此文件类型")?"格式不支持":n.data[0].uploadMessage:n.message;try{if(window._jylog){c=localStorage.getItem(l.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","新版上传失败",p,JSON.parse(c).orderNo])}}catch(e){console.log(e)}try{St(o,"新版上传失败")}catch(e){console.log(e)}$("#uploadFailure_span_"+o.id).text(p),$("#uploadList_"+o.id).attr("uploading","1")}else if("1"==n.r)w(n,o);else{try{if(window._jylog){c=localStorage.getItem(l.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","新版上传失败",JSON.stringify(n),JSON.parse(c).orderNo])}}catch(e){console.log(e)}try{St(o,"新版上传失败")}catch(e){console.log(e)}$("#uploadFailure_"+o.id).show(),$("#uploadList_"+o.id).attr("uploading","1")}}),c.on("uploadFinished",function(e){console.info("上传完成1"),ce&&($(".sjky-btn-greytxt").show(),$(".sjky-btn-grey").show()),ce=!1,g=0,console.log(he),ue.isfinish=!1,console.info("上传完成2"),$("#loadingData").hide(),$(".checkbox").show()}),c.on("ready",function(){window.uploader=c}),c.onUploadProgress=function(t,i){var a="";t.starttime||(a=(new Date).getTime(),console.info("上传开始时间"),console.info(a),t.starttime=a);$("#uploadFailure_"+t.id),$("#uploadMask_"+t.id);t&&t._info&&t._info.width>1e4&&t._info.height>1e4&&(alert("图片:"+t.name+" 文件宽高过大！系统不支持！"),c.removeFile(t));var o=$("#uploadList_"+t.id),s=o.find(".upload-state");if(s.length||(s=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">等待上传</p></div>').appendTo(o)),s.find(".upload-state-bar").html("上传中"),s.find(".loading").show(),1==i){if(!t.endtime)try{xt(t,"进度100%")}catch(e){console.info(e)}$("#uploadDel_"+t.id).show()}f[t.id][1]=i,S()},c.onFilesQueued=function(e){e.sort(),e.length>0&&($(".shangchuantu").show(),$("#newupload").hide(),ue.isfinish=!0),pe=!1,$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show();for(var t=[],i=[],o=[],s=localStorage.getItem(a),n=(JSON.parse(s),0);n<e.length;n++)t.push(e[n].name);for(n=0;n<t.length;n++){for(var r=!1,l=n;l<t.length-1;l++)if(t[n]==t[l+1]){r=!0,pe=!0;break}null!=s&&"null"!=s&&"[]"!=s&&-1!=s.indexOf(t[n])&&(r=!0,pe=!0),r?o.push(e[n]):i.push(e[n])}function d(e){localStorage.removeItem(ue.pageKey.calenderTemp);var t=localStorage.getItem(ue.pageKey.historyCalenderTemp);null!=t&&"null"!=t&&"undefined"!=t&&(t=JSON.parse(t),t.forEach(function(e){e.chooseIndex=""})),$(".weui-check_box2").attr("checked",!1),ue.checkAll=!1,localStorage.setItem(ue.pageKey.historyCalenderTemp,JSON.stringify(t)),$(".chooseIndexSpan").remove();var i=localStorage.getItem(a);console.log(e),console.log(e.length),g=0,console.log("fileCount==="+g);var o=!0,s=!1,n=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var d=r.value;i=localStorage.getItem(a);d.sort=(new Date).getTime(),d.size,g++,i=null!=i&&"null"!=i&&"[]"!=i?JSON.parse(i):[],d.lastModifiedDate=(new Date).toString(),ce=!0,b(d),k("ready"),S(),c.upload(d)}}catch(h){s=!0,n=h}finally{try{o||null==l.return||l.return()}finally{if(s)throw n}}}pe?(pe=!1,layer.open({skin:"unpload-layer",title:!1,content:'<p style="padding:10px 30px;font-size: 16px;">检测到重复图片<br/>是否上传这些重复的图片？</p>',btn:["上传","不上传"],closeBtn:0,yes:function(t){d(e),layer.close(t)},btn2:function(e){console.log(i),d(i);for(var t=0;t<o.length;t++)c.removeFile(o[t]);layer.close(e)}})):d(e)},c.onFileDequeued=function(e){g--,e.size,g||k("pedding"),I(e),S()},c.on("all",function(e){switch(e){case"uploadFinished":k("confirm");break;case"startUpload":k("uploading");break;case"stopUpload":k("paused");break}}),c.onError=function(t){console.log(t),$(".sjky-btn-greytxt").show(),$(".sjky-btn-grey").show(),t>"Q_EXCEED_NUM_LIMIT"&&$("#info").css("color","#a5a6a6"),"F_DUPLICATE"==t&&ft("#duplicate-photo"),"Q_TYPE_DENIED"==t&&(ft("#type-denied"),window.setTimeout(function(){ut()},2e3)),"F_EXCEED_SIZE"==t&&(ft("#type-size"),window.setTimeout(function(){ut()},2e3));try{if(window._jylog){var i=localStorage.getItem(l.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","新版上传","上传插件判断图片错误=="+t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}var o=localStorage.getItem(a);o=null!=o&&"null"!=o&&"[]"!=o?JSON.parse(o):[],$(".sjky-btn-bottom2").show()},S()}function gt(t,i,a){$(".ddel").unbind("click"),$(".ddel").click(function(){for(var o=0,s=0;s<t.length;s++)o++,lt?mt(t[s],i,a):(console.info("开始进入删除照片方法了！！！"),console.info(t[s]),pt(t[s],i,a));ut();var n=localStorage.getItem(dt.calenderTemp);n=null!=n&&"null"!=n?JSON.parse(n):[];try{if(window._jylog){var r=localStorage.getItem(dt.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","删除照片","删除:"+o+",剩余:"+n.length,JSON.parse(r).orderNo])}}catch(e){console.log(e)}ot="已选"+ue.chooseNum+"张",$("#vm.chooseNumShow").html(ot)}),ft("#del-photo")}function mt(e,t,i){var a=$(e).parents(".phoBox").attr("data-index"),o=new Array;$.each(he,function(e,t){t.index==a||o.push(t)});var s=$(e).parents(".phoBox").attr("imageid"),n=[];n.push(s),$.ajax({url:nt.delete,type:"post",data:{imgIds:n},async:!1,cache:!1,success:function(s){var n=JSON.parse(s),r=n.retCode;if(he=o,r<=0){var l=localStorage.getItem(st);if(null!=l&&"null"!=l){l=JSON.parse(l);var d=new Array;$.each(l,function(e,t){t.index==a||d.push(t),ue.chooseNum=$("#imageList").find("input[type=checkbox]:checked").length}),l=d,localStorage.setItem(st,JSON.stringify(l))}}else if(window.localStorage){l=localStorage.getItem(st);if(null!=l&&"null"!=l){l=JSON.parse(l);d=new Array;$.each(l,function(e,t){t.index==a||d.push(t)}),l=d}l.length<t&&$("#info").text("可上传"+t+"-"+i+"张"),l.length>=t&&l.length<i&&$("#info").text("可上传"+t+"-"+i+"张"),0==l.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var c=!1,h=0;h<l.length;h++)if(1==l[h].pixellow){c=!0;break}c||$("#showIOSDialog2").hide(),localStorage.setItem(st,JSON.stringify(l))}$(e).parents(".phoBox").remove(),ue.upladNum=l.length,ue.chooseNum=$("#imageList").find("input[type=checkbox]:checked").length,0==ue.chooseNum&&($(".weui-cell").hide(),$(".sjky-list-tip3").show())}})}function pt(e,t,i){var a=e.attributes.imageid.value,o=new Array,s={},n="",r=he;if($.each(r,function(e,t){t.index==a||t.id==a?(1,ue.ishistoryuploadbutton&&(""==n?n=t.id:n+=t.id,t.url)):o.push(t)}),console.info("ids======"),console.info(n),""!=n&&(s.ids=n,s.materialType="al",$.ajax({type:"POST",url:ue.server.urlConfig.basicUrl+"/diy/deleteimg",data:s,dataType:"json",success:function(e){console.log(e)}})),0==he.length){e=$(".weui-check_box2");for(var l=0;l<e.length;l++)e[l].checked=!1;ue.checkAll=!1}if(window.localStorage){var d=localStorage.getItem(ue.pageKey.historyCalenderTemp);if(null!=d&&"null"!=d){d=JSON.parse(d),d.forEach(function(e){e.chooseIndex=""});var c=new Array;$.each(d,function(e,t){t.index==a||t.id==a||c.push(t)}),d=c}if(null==d&&(d=[]),ue.upladNum=d.length,d.length<t&&(ue.chooseNum=0,$("#deletephoto").text("删除("+ue.chooseNum+")"),$("#chooseNumNext").text("("+ue.chooseNum+")"),$("#info").text("可上传"+t+"-"+i+"张")),d.length>=t&&d.length<i&&(ue.chooseNum=0,$("#deletephoto").text("删除("+ue.chooseNum+")"),$("#chooseNumNext").text("("+ue.chooseNum+")"),$("#info").text("可上传"+t+"-"+i+"张")),0==d.length){$(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#imageList").empty();for(e=$(".weui-check_box2"),l=0;l<e.length;l++)e[l].checked=!1;ue.checkAll=!1,$("#info").text("需上传"+t+"-"+i+"张照片")}for(var h=!1,g=0;g<d.length;g++)if(1==d[g].pixellow){h=!0;break}h||$("#showIOSDialog2").hide(),localStorage.setItem(ue.pageKey.historyCalenderTemp,JSON.stringify(d)),localStorage.removeItem(ue.pageKey.calenderTemp),he=d}$(e).parents(".phoBox").remove(),ue.chooseNum=$("#imageList").find("input[type=checkbox]:checked").length,wt(rt,t,i,ue.pageKey.historyCalenderTemp,ue),ue.chooseNum=0,$("#deletephoto").text("删除("+ue.chooseNum+")"),$("#chooseNumNext").text("("+ue.chooseNum+")")}function ut(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)}function ft(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)}function yt(){$(".sjky-btn-greytxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-resettxt").show();for(var e=$(".weui-check_box1"),t=0;t<e.length;t++)e[t].checked=!0;ue.chooseNum=e.length,ot="已选"+ue.chooseNum+"张",$("#vm.chooseNumShow").html(ot)}function _t(e){return-1!=e.indexOf(ue.server.urlConfig.thumbnailUrl)?ue.server.urlConfig.thumbnailUrl:-1!=e.indexOf(ue.server.urlConfig.baseUrl)?ue.server.urlConfig.baseUrl:!e||-1==e.indexOf("material/")&&-1==e.indexOf("yingxiangdiy/")&&-1==e.indexOf("commonUpload/")?e&&(e.endsWith("svg")||e.endsWith("xml"))?this.server.urlConfig.thumbnailUrl:e&&-1!=e.indexOf("oss-")?ue.server.urlConfig.ossPhotoUrl:e&&-1!=e.indexOf("img.alicdn.com")?"":-1!=e.indexOf(ue.server.urlConfig.orgBaseUrl)?ue.server.urlConfig.orgBaseUrl:ue.server.urlConfig.baseUrl:-1!=e.indexOf("yingxiangdiy/")?-1!=e.indexOf(ue.server.urlConfig.orgBaseUrl3)?ue.server.urlConfig.orgBaseUrl3:ue.server.urlConfig.baseUrl3:ue.server.urlConfig.thumbnailUrl}function vt(e,t,i,a){var o="";a.uploadData.thumbnailToken&&(o=a.uploadData.thumbnailToken);var s=0,n=0;if(!e||-1==e.indexOf("material/")&&-1==e.indexOf("/yingxiangdiy/")&&-1==e.indexOf("commonUpload/"))return e&&-1!=e.indexOf(".xml")?"mongo_yx/"+e+"?token="+o:e&&e.charAt(0)<="f"?(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,"mongo_yx/"+e+"!"+s+"x"+n+"?token="+o):e;if(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+s+"x"+n+"?token="+o;if(-1!=e.indexOf("commonUpload/")){var r=e.split("commonUpload/");return r[1]+"!"+s+"x"+n+"?token="+o}var l=e.split("/");return l.splice(1,0,s+"x"+n),l.join("/")}function wt(e,t,i,a,o){if($("#imageList").empty(),he=[],null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);if(null!=s&&"null"!=s&&"undefined"!=s){s=JSON.parse(s);var n=new Array,r=s.length;if(r>"0"&&$(".shangchuantu").show(),r>i){for(var l=0;l<r;l++)if(l<i)n.push(s[l]);else if(lt){var d=[];d.push(s[l].id),delImageTaobanSimple(d)}s=n}$.each(s,function(e,t){-1!=t.src.indexOf(o.server.urlConfig.thumbnailUrl)&&(t.src=t.src.replace("commonUpload/",""),-1!=t.src.indexOf("fsferry")&&(t.src=t.src.replace("fsferry/","")),-1==t.src.indexOf("token")&&(t.src=t.src+"?token="+localStorage.getItem(o.pageKey.thumbnailToken)));var i=new Image;i.src=t.src,t.index=t.index;var a=$('<div id="uploadList_'+t.index+'" imageid="'+t.id+'" data-index="'+t.index+'" uploading="1" class="phoBox"onClick="photochoose_new('+t.id+","+o.minPageNum+","+o.maxPageNum+')" style="background-image:url('+i.src+');"></div>');if(1==t.pixellow){var s=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');s.appendTo(a),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}if(t.chooseIndex&&""!=t.chooseIndex){var n=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<span class="chooseIndexSpan">'+t.chooseIndex+"</span>\t</label></div>\t");n.appendTo(a)}$("#imageList").prepend(a);var r={dateTime:t.dateTime,url:t.url,id:t.id,index:t.index,width:t.width,height:t.height,history:t.history,isUse:!0,name:t.name,md5val:t.md5val};he.push(r)}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),o.upladNum=s.length,s.length>0?(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),s.length<t?lt?$("#info").text("已上传"+s.length+"张","可上传"+t+"-"+i+"张"):$("#info").text("可上传"+t+"-"+i+"张"):s.length<i&&s.length>=t?$("#info").text("可上传"+t+"-"+i+"张"):(s.length>i&&$("#info").css("color","#a5a6a6"),$("#info").text("可上传"+t+"-"+i+"张"))):t==i?$("#info").text("需上传"+t+"张照片"):$("#info").text("需上传"+t+"-"+i+"张照片")}else s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(dt.isfirst,0);$(".chooseIndexSpan").css("background","#3399ff"),$(".chooseIndexSpan").css("border-radius","50%"),$(".chooseIndexSpan").css("width","30px"),$(".chooseIndexSpan").css("height","30px"),$(".chooseIndexSpan").css("display","block"),$(".chooseIndexSpan").css("text-align","center"),$(".chooseIndexSpan").css("line-height","30px"),$(".chooseIndexSpan").css("color","#fff"),$(".chooseIndexSpan").css("margin-right","10px"),$(".chooseIndexSpan").css("margin-bottom","6px")}else alert("商品问题，请联系客服！")}function bt(e,t,i,a,o){if($("#imageList").empty(),null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);null!=s&&"null"!=s&&"undefined"!=s?(s=JSON.parse(s),$.each(s,function(e,t){-1!=t.src.indexOf(o.server.urlConfig.thumbnailUrl)&&(t.src=t.src.replace("commonUpload/",""),-1!=t.src.indexOf("fsferry")&&(t.src=t.src.replace("fsferry/","")),-1==t.src.indexOf("token")&&(t.src=t.src+"?token="+localStorage.getItem(o.pageKey.thumbnailToken)));var i=new Image;i.src=t.src,t.index=t.index;var a=$('<div id="uploadList_'+t.index+'" imageid="'+t.id+'" data-index="'+t.index+'" uploading="1" class="phoBox"onClick="photochoose_new('+t.id+","+o.minPageNum+","+o.maxPageNum+')" style="background-image:url('+i.src+');"></div>');if(1==t.pixellow){var s=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');s.appendTo(a),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}if(t.chooseIndex&&""!=t.chooseIndex){var n=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<span class="chooseIndexSpan">'+t.chooseIndex+"</span>\t</label></div>\t");n.appendTo(a)}$("#imageList").prepend(a)}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),s.length>0&&(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),$(".shangchuantu").show())):(s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(o.pageKey.isfirst,0)),s.length==o.chooseNum||(o.isClickcheckAll=!1,$(".weui-check_box2").attr("checked",!1)),$(".chooseIndexSpan").css("background","#3399ff"),$(".chooseIndexSpan").css("border-radius","50%"),$(".chooseIndexSpan").css("width","30px"),$(".chooseIndexSpan").css("height","30px"),$(".chooseIndexSpan").css("display","block"),$(".chooseIndexSpan").css("text-align","center"),$(".chooseIndexSpan").css("line-height","30px"),$(".chooseIndexSpan").css("color","#fff"),$(".chooseIndexSpan").css("margin-right","10px"),$(".chooseIndexSpan").css("margin-bottom","6px")}else alert("商品问题，请联系客服！")}function It(){console.info("处理选中问题");var e=localStorage.getItem(ue.pageKey.historyCalenderTemp);if(ue.isClickcheckAll)return ue.chooseNum=0,localStorage.removeItem(ue.pageKey.calenderTemp),ue.isClickcheckAll=!1,$(".weui-check_box2").attr("checked",!1),null!=e&&"null"!=e&&"undefined"!=e&&(e=JSON.parse(e),e.sort(sortBy("index",!0)),e.forEach(function(e){e.chooseIndex=""})),localStorage.setItem(ue.pageKey.historyCalenderTemp,JSON.stringify(e)),wt(!0,ue.minPageNum,ue.maxPageNum,ue.pageKey.historyCalenderTemp,ue),$("#deletephoto").text("删除("+ue.chooseNum+")"),void $("#chooseNumNext").text("("+ue.chooseNum+")");ue.isClickcheckAll=!0;var t=[];if(null!=e&&"null"!=e&&"undefined"!=e){e=JSON.parse(e),e.sort(sortBy("index",!0));var i=$("#imageList")[0].children;if(e.length>0&&i.length>0)for(var a=0;a<i.length;a++){var o=i[a].attributes.imageid.value,s=e.filter(function(e){if(e.id==o||e.index==o)return e});s.length>0&&t.length<ue.maxPageNum&&t.push(s[0])}}ue.chooseNum=t.length,localStorage.setItem(ue.pageKey.calenderTemp,JSON.stringify(t)),t.forEach(function(t,i){for(var a=0;a<e.length;a++)t.id==e[a].id&&(e[a].chooseIndex=i+1)}),localStorage.setItem(ue.pageKey.historyCalenderTemp,JSON.stringify(e)),wt(!0,ue.minPageNum,ue.maxPageNum,ue.pageKey.historyCalenderTemp,ue),$("#deletephoto").text("删除("+ue.chooseNum+")"),$("#chooseNumNext").text("("+ue.chooseNum+")")}function St(e,t){var i=$("#uploadList_"+e.id),a=i.find(".upload-state");a.hide()}function xt(t,i){var a=(new Date).getTime(),o="",s="";console.info("上传开始时间"),console.info(t.starttime),console.info("上传结束时间"),console.info(a),console.info("耗时===");var n="";t.endtime?(console.info("响应时间"),n=(new Date).getTime(),s=t.uploadtime):(console.info("100%时计算时间"),s=t.starttime,t.endtime=a,n=a,o=(new Date).getTime(),t.uploadtime=o);var r=(n-s)/1e3;console.info((n-s)/1e3);var l=t.size/1024,d=Math.round(l/r);try{if(window._jylog){var c=localStorage.getItem(ue.pageKey.orderInfo);window._jylog.push(["提示",getQueryVariable("isSimple")?"极简上传":"上传页面","上传方法用时","ip="+ue.server.uploadData.ipAddress+i+"requestid:"+t.requestid+";图片大小="+t.size+",用时=="+r+"秒,平均上传速度="+d+"kb/s",JSON.parse(c).orderNo])}}catch(e){console.log(e)}}uploadProgressSimple=function(e,t){var i=$("#uploadList_"+e.id);ct=i.find(".upload-state"),ct.length||(ct=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">等待上传</p></div>').appendTo(i)),ct.find(".upload-state-bar").html("上传中"),ct.find(".loading").show(),1==t&&(ct.find(".loading").remove(),ct.remove(),$(".checkbox").show(),$("#uploadDel_"+e.id).show())},sortBy=function(e,t){return t=void 0==t?1:t?1:-1,function(i,a){return i=i[e],a=a[e],i<a?-1*t:i>a?1*t:0}};new Array;var kt,Ot,Lt,Tt,Ct,Pt,jt,At=800,Nt=800,Et={name:"BaseUpload",props:["storageName","submitButtonName","uploadcomplete","minPageNum","pageKey","maxPageNum","server","checksubmitstate","orderInfo","isTaoBan"],data:function(){return{id:"",readyphoto:"",tipsFont:!1,isSimple:!1,isSimpleUpload:!1,caiyun:"",pageNum:"",productId:"",calendar_type:"",paused:!1,error:!1,isComplete:!1,isUploading:!1,p:-1,editing:!1,showDeleteModal:!1,arrnum:"",chooseNum:0,checkAll:!1,isTeamBook:!1,upladNum:0,isfirst:0,isNoHistoryPhoto:!1,piclist:[],storageNamebase:"",isWeixin:!1,isuploadbutton:!0,ishistoryuploadbutton:!1,isfinish:!1,options:{target:"",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:41943040,query:{}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"},picList:[],progress:0,progressingClass:"uploader-file-progressing",file_total:1,errorfilelist:[],isClickcheckAll:!1,showtanchaungnew:!1,isshowuploadiocn:!1,first:!1,pageIndex:1,pageSize:40,isSelectHistory:!1,readyupload:"",readyuploadFromDesign:"",thumbnailToken:""}},created:function(){if(this.readyupload=localStorage.getItem(this.pageKey.readyupload),"true"!=this.readyupload&&(this.readyuploadFromDesign=localStorage.getItem("readyupload"),"true"!=this.readyuploadFromDesign)){this.isSimple=this.$route.query.isSimple,this.storageNamebase=this.storageName;var e=localStorage.getItem(ee["f"].isMiniProgram),t=navigator.userAgent.toLowerCase();console.log("mess:"+t.match("micromessenger")),console.log("navigator:"+navigator.userAgent.toLowerCase()),console.log("isweixin:"+e),(e||null!=t.match(/wechat/i)||null!=t.match("micromessenger"))&&(this.isWeixin=!0),window.onload=function(){var e=!1;window.addEventListener("pageshow",function(){e&&window.location.reload()}),window.addEventListener("pagehide",function(){e=!0})};var i=localStorage.getItem(this.pageKey.id),a=localStorage.getItem(this.pageKey.isfirst),o=localStorage.getItem(this.pageKey.calenderTemp);a&&"1"==a?null==o||"[]"==o?this.isfirst=0:(this.isfirst=1,this.piclist=JSON.parse(o),this.upladNum=JSON.parse(o).length):(localStorage.setItem(this.pageKey.isfirst,this.isfirst),null==o||"[]"==o||(this.piclist=JSON.parse(o),this.upladNum=JSON.parse(o).length)),this.isTeamBook=this.$route.query.isTeamBook,this.caiyun=this.$route.query.caiyun,null==i||""==i||"undefined"==i?(this.id=this.$route.query.id,localStorage.setItem(this.pageKey.id,this.id)):this.id=i,this.first=this.$route.query.isfirst,this.first?"true"==this.first||this.first:this.isshowuploadiocn=!1}},mounted:function(){if("true"!=this.readyupload&&"true"!=this.readyuploadFromDesign){var t=localStorage.getItem(this.pageKey.calenderTemp);null!=t&&"null"!=t&&void 0!=t&&(t=JSON.parse(t),this.chooseNum=t.length);var i=localStorage.getItem(this.pageKey.historyCalenderTemp);null!=i&&"null"!=i&&void 0!=i&&(i=JSON.parse(i),i.length>0&&(this.isshowuploadiocn=!0)),$(".zzz").click(function(){hideModal()}),""==this.checkTop&&(this.checkTop=document.getElementById("imageList").scrollTop);JSON.parse(localStorage.getItem(this.pageKey.goodsid));this.calendar_type=localStorage.getItem(this.pageKey.calendar_type),this.productId=JSON.parse(localStorage.getItem(this.pageKey.productId)),this.p=JSON.parse(localStorage.getItem(this.pageKey.pnum)),null==this.p&&(this.p=-1);var a=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(a=!0)}),a)showConfirm("#fail-photo");else{if(1==this.isfirst)try{if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","提示","改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}this.getCommonUploadConfig(),$("#loadUploader_new").bind("click",function(e){if($(".sjky-btn-greytxt").hide(),!$(".webuploader-element-invisible")[0])try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","上传插件实例化失败，请刷新返回重新进入",JSON.parse(t).orderNo])}}catch(e){console.log(e)}"function"==typeof ht?$(".webuploader-element-invisible")[0].click():(this.isSimpleUpload=!0,$(".chooseSimple")[0].click())})}}},updated:function(){var e=localStorage.getItem(this.pageKey.calenderTemp);null!=e&&"null"!=e&&void 0!=e&&(e=JSON.parse(e))},methods:{editPhotos:function(){this.editing=!0},finishEdit:function(){console.info("全选方法！"),this.checkAll?(resetEdit(),this.checkAll=!1):(yt(),this.checkAll=!0)},changeSimple:function(){this.isSimpleUpload=!0,$(".chooseSimple")[0].click()},getCommonUploadConfig:function(){var t=this,i=this,a=localStorage.getItem(this.pageKey.token);try{if(window._czc){var o="调用newgetCommonUploadConfig的token===="+a;window._czc.push(["_trackEvent","剪影","新版上传页面",o])}if(window._jylog){var s=localStorage.getItem(this.pageKey.orderInfo);o="调用newgetCommonUploadConfig的token===="+a;window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"普通上传":"新版上传页面","newgetCommonUploadConfig进入设计",o,JSON.parse(s).orderNo])}}catch(e){console.log(e)}Object(H["n"])(a).then(function(a){if(a.result){if(i.server.commonUpload=a.data.commonUpload,i.isTaoBan&&(i.server.commonUpload=!1),i.server.commonUpload){i.server.upload=J["a"].commonuploadapi+a.data.uploadUrl,i.options.target=J["a"].commonuploadapi+a.data.uploadUrl,i.server.uploadData.appKey=a.data.appKey,i.server.uploadData.appSecret=a.data.appSecret,i.server.uploadData.serverKey=a.data.serverKey,i.server.uploadData.unionId=a.data.unionId,i.server.uploadData.multiple=!0,i.server.uploadData.ipAddress=a.data.ipAddress,i.server.uploadData.thumbnailToken=a.data.base64Token,i.options.query=a.data;try{if(window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"支付宝上传":"上传页面","ip地址",a.data.ipAddress,JSON.parse(o).orderNo])}}catch(e){console.log(e)}}else i.options.target=i.server.upload,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==========="),console.info(i.server.upload);i.arrnum=i.maxPageNum,i.thumbnailToken=a.data.base64Token,localStorage.setItem(i.pageKey.thumbnailToken,a.data.base64Token);var s=localStorage.getItem(i.pageKey.token);if(i.options.query.token=s,console.log(Object(q["a"])(ht)),"function"==typeof ht)try{ht(i.minPageNum,i.maxPageNum,i.pageKey.historyCalenderTemp,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i);var n=localStorage.getItem(i.pageKey.caiyunContent);if("1"==i.caiyun&&n){var r=JSON.parse(n),l=i.readyphoto+r.contentIDList.length;if(i.readyphoto<i.maxPageNum&&l<=i.maxPageNum){for(var d=0;d<r.contentIDList.length;d++)localIds.push(r.contentIDList[d]);uploadPicCaiyun(localIds,i.server.uploadUrl,r,i.minPageNum,i.maxPageNum)}if(i.readyphoto<i.maxPageNum&&i.maxPageNum&&l>i.maxPageNum){for(d=0;d<i.maxPageNum-i.readyphoto;d++)localIds.push(r.contentIDList[d]);uploadPicCaiyun(localIds,i.server.uploadUrl,r,i.minPageNum,i.maxPageNum)}}}catch(c){try{if(window._jylog){o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告",c,JSON.parse(o).orderNo])}}catch(e){console.log(e)}i.$layer.alert(c),ht(i.minPageNum,i.maxPageNum,i.pageKey.historyCalenderTemp,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i)}}console.log(a),t.getHistoryPhoto()})},getS3UpConfig:function(){var t=this,i=this;Object(H["H"])().then(function(a){if(a.result){i.server.s3flag=a.data.s3flag,i.isTaoBan&&(i.server.s3flag=!1),i.server.s3flag?(i.server.upload=J["a"].uploadapi+a.data.s3url,i.options.target=J["a"].uploadapi+a.data.s3url,i.server.uploadData.appkey=a.data.appkey,i.server.uploadData.methodId=a.data.methodId,i.server.uploadData.sign=a.data.sign,i.server.uploadData.checkId=a.data.checkId,i.options.query=a.data):(i.options.target=i.server.upload,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==========="),console.info(i.server.upload),console.info(J["a"].uploadapi+a.data.s3url)),i.arrnum=i.maxPageNum;var o=localStorage.getItem(i.pageKey.token);if(i.options.query.token=o,console.log(Object(q["a"])(ht)),"function"==typeof ht)try{ht(i.minPageNum,i.maxPageNum,i.pageKey.historyCalenderTemp,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i);var s=localStorage.getItem(i.pageKey.caiyunContent);if("1"==i.caiyun&&s){var n=JSON.parse(s),r=i.readyphoto+n.contentIDList.length;if(i.readyphoto<i.maxPageNum&&r<=i.maxPageNum){for(var l=0;l<n.contentIDList.length;l++)localIds.push(n.contentIDList[l]);uploadPicCaiyun(localIds,i.server.uploadUrl,n,i.minPageNum,i.maxPageNum)}if(i.readyphoto<i.maxPageNum&&i.maxPageNum&&r>i.maxPageNum){for(l=0;l<i.maxPageNum-i.readyphoto;l++)localIds.push(n.contentIDList[l]);uploadPicCaiyun(localIds,i.server.uploadUrl,n,i.minPageNum,i.maxPageNum)}}}catch(c){try{if(window._jylog){var d=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告",c,JSON.parse(d).orderNo])}}catch(e){console.log(e)}i.$layer.alert(c),ht(i.minPageNum,i.maxPageNum,i.pageKey.historyCalenderTemp,i.submitButtonName,i.server,i.checksubmitstate,i.isTaoBan,i.pageKey,i)}}console.log(a)})},downLoadUrlList:function(t){var i=this;$("#uploadIndex").hide(),$("#loadingDatacaiyun").show(),Object(H["h"])(t).then(function(t){if(t.result);else{try{if(window._jylog){var a=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","图片下载失败",JSON.parse(a).orderNo])}}catch(e){console.log(e)}layer.alert("图片下载失败！"),$("#uploadIndex").show()}i.getCalenderTemp(localStorage.getItem(i.pageKey.token)),$("#loadingDatacaiyun").hide()}).catch(function(e){i.getCalenderTemp(localStorage.getItem(i.pageKey.token)),$("#loadingDatacaiyun").hide()})},getCalenderTemp:function(e){var t=this.$route.query.isfirst;t&&"string"==typeof t&&(t="false"!=t);var i=[],a=this,o={};o.token=e,o.pagenum=this.pageIndex,o.pageSize=this.pageSize,Object(H["N"])(o).then(function(e){var t=[],o=localStorage.getItem(a.pageKey.historyCalenderTemp);o&&"null"!=o&&null!=o&&(t=JSON.parse(o)),$("#imageList").empty();var s=null;if(s="string"==typeof e?JSON.parse(e):e,s.result){var n=null;if(n="string"==typeof s.data?JSON.parse(s.data.list):s.data.list,n.length>0?a.isSelectHistory=!0:1==a.pageIndex&&n.length>0&&(a.isSelectHistory=!0),""!=n&&n.length>0){a.isshowuploadiocn=!0,a.readyphoto=n.length;for(var r=0;r<n.length;r++){var l=r;1!=a.pageIndex&&(l=t.length+r);var d={isUse:!0};d.index=l,d.history=!0,d.id=n[r].id,d.name=n[r].name,d.url=n[r].picname,d.src=Object(Q["d"])(n[r].picname)+Object(Q["e"])(n[r].picname,n[r].imageinfo,a.thumbnailToken);Object(q["a"])(n[r].imageinfo);if(""!=n[r].imageinfo){var c=JSON.parse(n[r].imageinfo),h="";h=c.primaryImageInfo?c.primaryImageInfo:c,d.dateTime=c.dateTime,d.width=h.width,d.height=h.height,d.sortId=h.sortId,(h.width<At||h.height<Nt)&&(d.pixellow=1)}i.push(d)}}else a.isNoHistoryPhoto=!0;var g=localStorage.getItem(a.pageKey.calenderTemp);if(null!=g&&void 0!=g||(g=[]),i.length>0){if(i.length==g.length)for(r=0;r<i.length;r++)if(i[r].id!=g[r].id){localStorage.removeItem(a.pageKey.uid),localStorage.removeItem(a.pageKey.autoSave),localStorage.removeItem(a.pageKey.detailJson),console.log(11111111111111111e39);break}i=t.concat(i),localStorage.setItem(a.pageKey.historyCalenderTemp,JSON.stringify(i))}else localStorage.removeItem(a.pageKey.uid),localStorage.removeItem(a.pageKey.autoSave),localStorage.removeItem(a.pageKey.detailJson)}else localStorage.removeItem(a.pageKey.calenderTemp),localStorage.removeItem(a.pageKey.historyCalenderTemp),localStorage.removeItem(a.pageKey.uid),localStorage.removeItem(a.pageKey.autoSave),localStorage.removeItem(a.pageKey.detailJson);bt(!0,a.minPageNum,a.maxPageNum,a.storageNamebase,a)}),bt(!0,a.minPageNum,a.maxPageNum,a.storageNamebase,a)},deletePic:function(){var e=$("#imageList")[0].children,t=[],i=localStorage.getItem(this.pageKey.calenderTemp);null!=i&&"null"!=i&&void 0!=i&&(i=JSON.parse(i));for(var a=0;a<i.length;a++)for(var o=0;o<e.length;o++)e[o].attributes.imageid.value!=i[a].id&&e[o].attributes.imageid.value!=i[a].index||t.push(e[o]);console.info("开始删除照片了！！！"),t.length>0&&(console.info("进入删除照片了！！！"),gt(t,this.minPageNum,this.maxPageNum)),this.editing=!1,$(".weui-cell").show()},resetupload:function(){hideModal()},closeShowtanchaungnew:function(){this.showtanchaungnew=!1},clickNext:function(){var e=localStorage.getItem(this.pageKey.calenderTemp);this.$route.query.isSimple;if(null!=e&&"null"!=e||void 0!=e){if(e=JSON.parse(e),-1==this.id&&e.length<this.minPageNum){var t=this;return this.tipsFont=!0,void setTimeout(function(){t.tipsFont=!1},3e3)}e.length<this.minPageNum?this.showtanchaungnew=!0:this.next()}else this.$toast("请先选择照片")},next:function(){var t=this;if(isupping)showConfirm("#uping-photo");else{var i=!1,a=localStorage.getItem(this.pageKey.calenderTemp);try{if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面跳转","上传跳设计页","页面跳转","[]"==a?"上传照片数量0张":"上传照片数量"+JSON.parse(a).length+"张",JSON.parse(o).orderNo])}}catch(e){console.log(e)}if(null!=a&&"null"!=a||void 0!=a){a=JSON.parse(a);var s=this.$route.query.isSimple;if(a.length<this.minPageNum&&(s||-1==this.id))return this.tipsFont=!0,void setTimeout(function(){t.tipsFont=!1},3e3);for(var n=0;n<a.length;n++)if(1==a[n].pixellow){i=!0;break}var r=[];if(this.uploadcomplete);else{var l=localStorage.getItem(this.pageKey.uploadCalenderTemp);if(l){var d=JSON.parse(l);r=d.concat(a)}else r=a}localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(r));var c=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(c=!0)}),c)showConfirm("#fail-photo");else{t=this;if(1!=this.isTeamBook&&"true"!=this.isTeamBook)if(this.isTaoBan)if(i)this.showModal("#low-photo");else{t=this;layer.confirm("确认提交套版吗?",function(i){try{t.nextStep(1)}catch(e){}layer.close(i)})}else this.isSimple,t.nextStep(0);else i?this.showModal("#low-photo"):this.nextStep(1)}}}},chooseFail:function(){this.checkAll&&resetEdit(),chooseFailBox(),this.hideModal()},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},goFxupload:function(){location.href="fxUpload?id="+this.id+"&p="+this.p+"&isTeamBook="+this.isTeamBook+"&isfirst="+!0},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},nextStep:function(t){if(isupping)showConfirm("#uping-photo");else{this.hideModal();var i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));try{if(window._czc){var a="";a=0==t?"时间排序":"智能排序",window._czc.push(["_trackEvent","剪影","上传页面",a])}if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","进入设计",a,JSON.parse(o).orderNo])}}catch(e){console.log(e)}this.$emit("baseUploadNextStep",this.id,this.p,i,t)}},showUpload:function(){$(".uploadZoone").show(),$(".no-infor").hide()},checkAllphoto:function(){It()},onFileAdded:function(e){if($("#uploadIndex").hide(),$("#uploadShow").show(),e&&e._info&&e._info.width>1e4&&e._info.height>1e4&&alert("图片:"+e.name+" 文件宽高过大！系统不支持！"),e.size>this.options.size)return this.showModal("#type-size"),window.setTimeout(function(){hideModal()},2e3),void(e.ignored=!0);addFileSimple(e)},onFileSuccess:function(e,t,i,a){var o=JSON.parse(i);uploadSuccess(t,o,this.minPageNum,this.maxPageNum)},fileProgress:function(e,t,i){if(this.progress=t.progress(),!t.starttime){var a=(new Date).getTime();console.info("上传开始时间"),console.info(a),t.starttime=a}uploadProgressSimple(t,this.progress),this.averageSpeed=t.averageSpeed,this.currentSpeed=t.currentSpeed,this.timeRemaining=t.timeRemaining(),this.uploadedSize=t.sizeUploaded();this.isUploading,this.isComplete},onFileError:function(e,t,i,a){faileureSimple(t)},fileRemoved:function(e){var t=this;this.$nextTick(function(){t.file_total=t.$refs["uploader"].files.length})},getHistoryPhoto:function(){this.isuploadbutton=!1,this.ishistoryuploadbutton=!0,$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNum=0,this.checkAll=!1,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.historyCalenderTemp,$("#historyuploadbutton").addClass("active"),$("#uploadbutton").removeClass("active"),$("#designGO").hide(),$("#insertupload").show(),this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},changebutton:function(){this.isuploadbutton=!0,this.ishistoryuploadbutton=!1,$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNum=0,this.checkAll=!1,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.calenderTemp,this.chooseNum=0,$("#designGO").show(),$("#uploadIndex").show(),$(".addImagediv").show(),$("#insertupload").hide(),$("#uploadbutton").addClass("active"),$("#historyuploadbutton").removeClass("active"),handleImagebeforeupload_new(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this)},submitUpload:function(){var e=this;this.$nextTick(function(){for(var t=0;t<e.$refs["uploader"].files.length;t++)e.$refs["uploader"].files[t].resume()})},closeErrorDialog:function(){this.errorDialog=!1},handelClose:function(){this.clearcache(),this.thirdDialog=!1},clearcache:function(){this.file_total=0,this.errorfilelist=[],this.controllerErrorFileDialog=!1,this.$refs.uploader.uploader.cancel(),this.getresourceDetail()},cancelUpload:function(){console.info("取消上传"),this.thirdDialog=!1,this.clearcache()},progressStyle:function(){var e=Math.floor(100*this.progress),t="translateX(".concat(Math.floor(e-100),"%)");return{progress:"".concat(e,"%"),webkitTransform:t,mozTransform:t,msTransform:t,transform:t}},status:function(){statuschange();var e=this.isUploading,t=this.isComplete,i=this.error,a=this.paused;return t?"success":i?"error":e?"uploading":a?"paused":"waiting"},onFilesubmitted:function(e,t){console.info("asjjjj")},changePhotoUploadList:function(){var e=JSON.parse(localStorage.getItem(this.pageKey.historyCalenderTemp)),t=[],i=localStorage.getItem(this.pageKey.calenderTemp);if("[]"==i?(console.info("7418473==="),t=[]):t=JSON.parse(i),t.length>this.maxPageNum){var a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";layer.alert(a)}else{for(var o=$("#imageList").find(".weui-check"),s=0;s<o.length;s++)if(o[s].checked)for(var n=$(o[s]).parents(".phoBox").attr("imageid"),r=0;r<e.length;r++)if(n==e[r].id){if(t.length>=this.maxPageNum){localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t));a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";return layer.alert(a),console.info("22222"),void this.changebutton()}t.push(e[r]);break}localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t)),this.changebutton()}},handleScroll:function(e){var t=e.target.scrollHeight,i=e.target.clientHeight,a=e.target.scrollTop;console.log(t,i,a);var o=this.$route.query.isfirst;o?"string"==typeof o&&(o="false"!=o):o=!1,!o||this.isNoHistoryPhoto||this.isfinish||a+i>=t&&(this.pageIndex++,this.getCalenderTemp(localStorage.getItem(this.pageKey.token)),console.log("加载更多"))}}},Jt=Et,Dt=(a("b3ec"),a("6013"),Object(b["a"])(Jt,it,at,!1,null,"cac77d92",null)),Bt=Dt.exports,Kt={name:"newupload",components:{NewBaseUpload:Bt},data:function(){return{storageName:null,submitButtonName:"进入设计",history:!1,uid:"",id:"",pageKey:null,isPart:!1,isChangxian:!1,isSimple:!1,iscomplete:!1,server:{upload:J["a"].basicUrl+"/upload/photo",uploadData:{},delete:"/tbdiy/uploade/deleteImg.do",urlConfig:J["a"],uploadUrl:J["a"].basicUrl+"/upload/downloadCaiyun"},checksubmitstate:!0,minPageNum:0,maxPageNum:0,uploadflag:"",currentPageIndex:"",isTeamBook:!1,uploadcomplete:"",options:{target:"",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:15728640,query:{}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"}}},created:function(){document.body.style.position="absolute";var e=localStorage.getItem("isAlipay"),t=navigator.userAgent.toLowerCase();("undefined"!=typeof my||"alipayclient"==t.match(/AlipayClient/i)||e)&&(this.is_alipay=!0),this.id=this.$route.query.id,this.isSimple=this.$route.query.isSimple,this.uploadcomplete=this.$route.query.uploadcomplete,this.isPart=this.$route.query.isPart,this.history=this.$route.query.history,this.uid=this.$route.query.uid;var i=this.$route.query.p;this.isTeamBook=this.$route.query.isTeamBook,this.isfirst=this.$route.query.isfirst,this.isChangxian=this.$route.query.isChangxian,this.bianjiflag=this.$route.query.bianjiflag,this.uploadflag=this.$route.query.uploadflag,this.currentPageIndex=this.$route.query.currentPageIndex,"true"!=this.isTeamBook&&1!=this.isTeamBook||"true"==this.isfirst||1==this.isfirst?this.pageKey=ee["a"]:this.pageKey=ee["c"],(this.isPart||this.history)&&(this.pageKey=ee["c"]),this.logFrom("普通上传"),localStorage.removeItem(this.pageKey.calenderTemp),localStorage.removeItem(this.pageKey.historyCalenderTemp);var a=localStorage.getItem(this.pageKey.token);if(null!=a&&void 0!=a&&"null"!=a&&"undefined"!=a){this.storageName=this.pageKey.calenderTemp,!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isTeamBook=!1,this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)):(this.isTeamBook=!0,this.isPart&&1!=this.isChangxian?(this.minPageNum=i,this.maxPageNum=5*i,localStorage.setItem(this.pageKey.minnum,i),localStorage.setItem(this.pageKey.maxnum,5*i)):(this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)));a=localStorage.getItem(this.pageKey.token);this.server.uploadData.token=a}else this.$router.push({name:"404"})},mounted:function(){},beforeRouteEnter:function(e,t,i){var a=localStorage.getItem("readyupload");i(function(e){if("/mtemplate"!=t.path&&a&&"true"==a){var i=localStorage.getItem(e.pageKey.orderInfo);if(i){var o=JSON.parse(i),s=e.getUrlKey(o.url,"sku"),n=e.getUrlKey(o.url,"flagURL"),r=e.getUrlKey(o.url,"orderNo"),l=e.getUrlKey(o.url,"memberid"),d=e.getUrlKey(o.url,"returnURL"),c=e.getUrlKey(o.url,"id"),h=e.getUrlKey(o.url,"num"),g=e.getUrlKey(o.url,"spmc"),m=e.getUrlKey(o.url,"token"),p="fromDesign",u=e.getUrlKey(o.url,"hasDraft");e.$router.push({name:"newdrafts",query:{sku:s,flagURL:n,orderNo:r,memberid:l,returnURL:d,id:c,num:h,spmc:g,token:m,fromDesign:p,hasDraft:u}})}}})},methods:{getUrlKey:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null},nextStep:function(t,i,a,o){var s=localStorage.getItem(this.pageKey.calenderTemp);localStorage.getItem(this.pageKey.diytype);try{if(window._jylog){var n=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面跳转","上传跳设计页","页面跳转","[]"==s?"上传照片数量0张":"上传照片数量"+JSON.parse(s).length+"张",JSON.parse(n).orderNo])}}catch(e){console.log(e)}if(this.isfirst&&"[]"!=s){var r=JSON.parse(s);if(-1==this.id&&r.length<this.minPageNum)return void layer.alert("空白模板，上传照片数量不能小于最小照片数量")}localStorage.getItem(this.pageKey.hassort);localStorage.setItem(this.pageKey.hassort,o),localStorage.removeItem(this.pageKey.cal_pageList);var l=!1;1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(l=!0),localStorage.setItem(this.pageKey.areadyInsert,"1");navigator.userAgent.toLowerCase();var d=navigator.userAgent,c=!!d.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(0!=this.uploadflag&&1!=this.uploadflag)if(0!=this.bianjiflag&&1!=this.bianjiflag)if(c)this.isSimple?location.href="simpledesign?id="+this.id+(null==i||void 0==i||""==i?"":"&p="+i)+(null==l||void 0==l||""==l?"":"&isEditCover="+l)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort=0&submit=true&editType=1&iscomplete="+this.iscomplete:location.href="design_new?id="+this.id+(null==i||void 0==i||""==i?"":"&p="+i)+(null==l||void 0==l||""==l?"":"&isEditCover="+l)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+o+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid);else if(this.isSimple)this.$router.push({name:"simpledesign",query:{id:this.id,p:i,isEditCover:l,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:0,submit:!0,editType:1,iscomplete:this.iscomplete}});else{var h={id:this.id,p:i,isEditCover:l,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:0,iscomplete:this.iscomplete};this.history&&(h.history=this.history,h.uid=this.uid),this.$router.push({name:"design_new",query:h})}else location.href="bianji?id="+this.id+(null==i||void 0==i||""==i?"":"&p="+i)+(null==l||void 0==l||""==l?"":"&isEditCover="+l)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+o+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid)+"&bianjiflag="+this.bianjiflag+(null==this.currentPageIndex||void 0==this.currentPageIndex||""==this.currentPageIndex?"":"&currentPageIndex="+this.currentPageIndex);else location.href="photoOrderNew?id="+this.id+(null==i||void 0==i||""==i?"":"&p="+i)+(null==l||void 0==l||""==l?"":"&isEditCover="+l)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+o+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid)+"&uploadflag="+this.uploadflag+(null==this.currentPageIndex||void 0==this.currentPageIndex||""==this.currentPageIndex?"":"&currentPageIndex="+this.currentPageIndex)},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录",this.isSimple?"极简上传":"上传页面",t,i,JSON.parse(a).orderNo])}startUploadLog()}catch(e){console.log(e)}}}},Mt=Kt,$t=Object(b["a"])(Mt,Ze,et,!1,null,null,null),Ut=$t.exports,Wt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("fx-base-upload",{attrs:{storageName:e.storageName,submitButtonName:e.submitButtonName,server:e.server,checksubmitstate:e.checksubmitstate,isTaoBan:!1,minPageNum:e.minPageNum,maxPageNum:e.maxPageNum,uploadcomplete:e.uploadcomplete,pageKey:e.pageKey},on:{baseUploadNextStep:e.nextStep}})],1)},Ft=[],Rt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"anniu"},[i("button",{staticClass:"active",attrs:{id:"uploadbutton"},on:{click:function(e){}}},[e._v("照片上传")])]),i("div",{staticClass:"uploaderBox pr",attrs:{id:"uploadIndex"}},[i("a",{staticClass:"uploader_input sjky",attrs:{href:"javascript:void(0);",id:"loadUpload",title:"选择照片"}},[e._v("")]),e.minPageNum!=e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")]):e._e(),e.minPageNum!=e.maxPageNum||e.isTeamBook?e._e():i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"张照片")]),e.minPageNum==e.maxPageNum&&e.isTeamBook?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("建议上传"+e._s(e.minPageNum)+"张照片")]):e._e()]),i("section",{staticClass:"mobile_web pb100",attrs:{id:"uploadShow"}},[i("div",{staticClass:"weui-cells sjky-list-tip sjky-list-tip2 sjky-list-tip3"},[i("div",{staticClass:"weui-cell"},[i("div",{staticClass:"weui-cell__hd"},[i("div",{staticClass:"checkbox weui-cells_checkbox"},[i("input",{staticClass:"weui-check weui-check_box2",attrs:{type:"checkbox",name:"photos"},on:{click:e.finishEdit_fx}}),i("i",{staticClass:"weui-icon-checked"})])]),e._m(0),i("div",{staticClass:"weui-cell__ft"},[[i("a",{staticClass:"sjky-btn-grey sjky-btn-grey2 delete-btn",attrs:{id:"deletephoto",href:"javascript:void(0);"},on:{click:function(t){return e.deletePic()}}},[e._v("删除("+e._s(e.chooseNumfx)+")")])]],2)])]),i("section",{staticClass:"phoList clearfix page",on:{scroll:e.handleScroll}},[i("div",{staticStyle:{display:"none"},attrs:{id:"filePicker"}}),i("div",{attrs:{id:"imageList"}})]),i("footer",{staticClass:"sjky-btn-bottom sjky-btn-bottom2",staticStyle:{display:"none"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipsFont,expression:"tipsFont"}],staticClass:"num-tips"},[e._v("\n\t\t\t\t          最少上传"+e._s(e.minPageNum)+"张，再上传几张吧。\n\t\t\t\t")]),i("div",{staticClass:"l tc addImagediv"},[i("a",{staticClass:"addImage",staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);",id:"addImage"}},[e._v("继续上传"),i("span",[e._v("("+e._s(e.upladNum)+")")])]),i("p",{attrs:{id:"info"}},[e._v("还需上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")])]),i("a",{staticClass:"weui-btn weui-btn_primary",staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);",id:"designGO"},on:{click:function(t){return e.nextfx()}}},[e._v("进入设计")]),i("div",[i("a",{staticClass:"weui-btn weui-btn_primary",staticStyle:{display:"none"},attrs:{href:"javascript:void(0);",id:"insertupload"},on:{click:e.changePhotoUploadListfx}},[e._v("确定使用("+e._s(e.chooseNumfx)+")")])])])]),e._m(1),i("section",{staticClass:"modal modal-out",attrs:{id:"px-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),e._m(2)]),e._m(3),e._m(4),i("section",{staticClass:"modal modal-out",attrs:{id:"morethan-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("我们根据您选取顺序上传"+e._s(e.arrnum)+"张")])]),e._m(5)]),e._m(6),i("section",{staticClass:"overlay"}),e._m(7),i("section",{staticClass:"modal modal-out",attrs:{id:"low-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("返回")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.nextStep()}}},[e._v("确定")])])]),e._m(8),i("section",{staticClass:"modal modal-out",attrs:{id:"duplicate-photo"}},[e._m(9),i("footer",{staticClass:"modal-buttons"},[i("span",{staticClass:"modal-button btn-cancel ddel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.resetupload()}}},[e._v("确定")])])]),e._m(10),e._m(11)])},qt=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-cell__bd"},[i("div",[i("p",{staticClass:"sub-title",attrs:{id:"chooseNumShow"}},[e._v("全选")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maskLayer",staticStyle:{display:"none"}},[i("p",[e._v("上传中")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"uping-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("正在上传中，请稍等！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"fail-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("有未成功加载的照片，请先删除！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"taoban-show"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("【随机套版】将对您上传的图片随机排版，暂时无法查看效果及修改的哦，建议您选择【我去设计】自由设计。")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("我知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"del-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("确认删除此照片？")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold ddel"},[e._v("确定")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"choose-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片上传失败")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel ddel"},[e._v("删除")]),i("span",{staticClass:"modal-button modal-button-bold aagain"},[e._v("重新上传")])]),i("input",{attrs:{type:"hidden",id:"file_id",value:""}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片重复，是否上传")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-denied"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片类型错误")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-size"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片过大")])])])}],Gt=(a("a2b0"),800),zt=800,Ht=0,Vt=0,Yt=0,Xt=0,Qt=null,Zt="进入设计",ei="";function ti(e,t,i,a,o){if(kt=!1,Ot=new Array,Lt=[],Tt=[],Yt=e,Xt=t,i.baseUrl,Qt=i.upload,jt=i,Pt=o,Ct=a,"0"!=Yt&&"undefined"!=Yt){Yt=parseInt(Yt),Xt=parseInt(Xt);var s=localStorage.getItem(Ct.calenderTemp);if(null!=s&&"null"!=s&&"undefined"!=s){s=JSON.parse(s);var n=new Array,r=s.length;if(r>Xt){for(var l=0;l<r;l++)l<Xt&&n.push(s[l]);s=n}$.each(s,function(e,t){-1!=t.src.indexOf(urlConfig.thumbnailUrl)&&(t.src=t.src.replace("commonUpload/",""),-1!=t.src.indexOf("fsferry")&&(t.src=t.src.replace("fsferry/","")),-1==t.src.indexOf("token")&&(t.src=t.src+"?token="+localStorage.getItem(Pt.pageKey.thumbnailToken)));var i=new Image;i.src=t.src,t.index="L"+t.index;var a=$('<div id="uploadList_'+t.index+'" data-index="'+t.index+'"imageid="'+t.index+'" onClick="photochoose_fx(this,'+t.index+","+Yt+","+Xt+')"NaN'+t.src+');"></div>');if(1==t.pixellow){var o=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');o.appendTo(a),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var s=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<span class="chooseIndexSpan_pub"></span>\t</label></div>\t');s.appendTo(a),a.prepend($("#imageList"));var n={url:t.url,index:t.index,width:t.width,height:t.height,dateTime:t.dateTime,history:t.history,isUse:!0,id:t.id,name:t.name};Ot.push(n)}),"none"==$("#showIOSDialog2").css("display")&&$("#showIOSDialog2").hide(),s.length>0?(localStorage.setItem(Ct.calenderTemp,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),s.length<Yt?$("#info").text("可上传"+Yt+"-"+Xt+"张"):s.length<Xt&&s.length>=Yt?($("#info").text("已上传"+s.length+"张，进入设计"),$("#designGO").css("pointer-events","auto")):(s.length>Xt&&di("#morethan-photo"),$("#info").text("已上传"+s.length+"张，进入设计"),$("#designGO").css("pointer-events","auto"))):Yt==Xt?$("#info").text("需上传"+Yt+"张照片"):$("#info").text("需上传"+Yt+"-"+Xt+"张照片"),console.log("imageList:"),console.log(Ot),console.log("imageArray:"),console.log(s)}else s=[],localStorage.setItem(Ct.calenderTemp,JSON.stringify(s));$("#addImage").bind("click",function(e){try{if(window._jylog){var t=localStorage.getItem(Ct.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信继续上传",Pt.upladNum,JSON.parse(t).orderNo])}}catch(e){console.log(e)}$(".sjky-btn-greytxt").hide(),ai()})}else alert("商品问题，请联系客服！")}var ii=!1;function ai(){ii||(ii=!0,setTimeout(function(){ii=!1},1e3),wx.chooseImage({count:9,sizeType:["original"],sourceType:["album"],success:function(e){ii=!0,setTimeout(function(){ii=!1},3e3),$(".sjky-btn-greytxt").hide(),$(".weui-cell").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),$(".sjky-btn-bottom2").show(),Tt=e.localIds;var t=localStorage.getItem(Ct.calenderTemp);if(null!=t&&""!=t&&"[]"!=t)if(t=JSON.parse(t),t.length+e.localIds.length<=Xt)0==Lt.length?(Lt=e.localIds,console.log("aaaaa333==="+JSON.stringify(Lt))):(Lt=Lt.concat(e.localIds),console.log("aaaaa444==="+JSON.stringify(Lt))),mi();else{layer.open({content:"我们根据您选取顺序上传"+Xt+"张",skin:"msg",time:3});for(var i=new Array,a=0;a<Xt-t.length;a++)i.push(e.localIds[a]);Lt=0==Lt.length?i:Lt.concat(i);var o=Xt;o<=Tt.length||(o=Tt.length);for(a=0;a<o;a++);Lt.length>0&&oi()}else if(e.localIds.length<=Xt){0==Lt.length?(Lt=e.localIds,console.log("aaaaa1==="+JSON.stringify(Lt))):(Lt=Lt.concat(e.localIds),console.log("aaaaa222==="+JSON.stringify(Lt)));for(a=0;a<Tt.length;a++);Lt.length>0&&oi()}else{layer.open({content:"我们根据您选取顺序上传"+Xt+"张",skin:"msg",time:3});for(i=new Array,a=0;a<Yt;a++)i.push(e.localIds[a]);Lt=0==Lt.length?i:Lt.concat(i);for(a=0;a<Tt.length;a++);Lt.length>0&&oi()}},fail:function(e){onsole.log("aaaaa666===失败！！"),console.log(e),layer.open({content:e,skin:"msg",time:3})},complete:function(){}}))}var oi=function(){if($("#waitUploadmask_"+Vt).hide(),$("#uploadMask_"+Vt).hide(),Lt.length>0){for(var e=0;e<Lt.length;e++){var t=!1;ni(Lt[e],Ht),t=e==Lt.length-1,si(Lt[e],Ht,t),Ht++,"none"==$("#showIOSDialog2").css("display")&&($(".sjky-list-tip3").show(),$("#showIOSDialog2").hide())}Lt=[]}};function si(t,i,a){kt=!0,console.info("isUpload============="),console.info(a),wx.uploadImage({localId:t,isShowProgressTips:1,success:function(o){var s=o.serverId;localStorage.setItem(Ct.serverId,s);var n=localStorage.getItem(Ct.accessToken),r=localStorage.getItem(Ct.token),l={mediaId:s,accessToken:n,commonUpload:jt.commonUpload,appKey:jt.appKey,appSecret:jt.appSecret,serverKey:jt.serverKey,unionId:jt.unionId,token:r};$.ajax({url:Qt,type:"post",dataType:"json",data:l,success:function(o){var s=localStorage.getItem(Ct.historyCalenderTemp);null!=s&&"null"!=s&&"undefined"!=s&&(Ot=JSON.parse(s));var n=[];if("1"==o.r){try{if(window._jylog){var r=localStorage.getItem(Ct.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信上传",o.id+"，ip="+Pt.server.uploadData.ipAddress,JSON.parse(r).orderNo])}}catch(e){console.log(e)}$("#uploadList_"+(Vt-1)).attr("uploading","1");var l="",d="",c="";o.imageInfo.primaryImageInfo?(l=o.imageInfo.primaryImageInfo.width,d=o.imageInfo.primaryImageInfo.height,c=o.imageInfo.primaryImageInfo.dateTime):(l=o.imageInfo.width,d=o.imageInfo.height,c=o.imageInfo.dateTime);var h={url:o.url,index:i,width:l,height:d,dateTime:c,id:o.id,isUse:!0,name:t};n.push(h);var g=!1;if(l>=d?(l<Gt||d<zt)&&(g=!0):(l<zt||d<Gt)&&(g=!0),g&&($("#uploadDel_"+(Vt-1)).show(),$("#uploadMask_"+(Vt-1)).show(),$("#showIOSDialog3").hide()),window.localStorage){var m=[];$.each(n,function(e,t){var i=_i(t.url)+vi(t.url,t.width,t.height,jt);-1!=i.indexOf(jt.urlConfig.thumbnailUrl)&&(i=i.replace("commonUpload/",""),-1!=i.indexOf("fsferry")&&(i=i.replace("fsferry/","")),-1==i.indexOf("?token")&&(i=i+"?token="+localStorage.getItem(Pt.pageKey.thumbnailToken))),$("#uploadList_"+t.index).attr("style","background-image:url("+i+");");var a=0;$("#uploadMask_"+t.index).is(":visible")&&(a=1);var o={url:t.url,index:t.index,src:i,pixellow:a,width:t.width,height:t.height,dateTime:t.dateTime,history:t.history,isUse:!0,id:t.id,name:t.name};m.push(o)});var p=localStorage.getItem(Ct.historyCalenderTemp);if(p){var u=JSON.parse(p);u.length>0&&(m=m.concat(u))}localStorage.setItem(Ct.historyCalenderTemp,JSON.stringify(m)),m.length<Yt?$("#info").text("可上传"+Yt+"-"+Xt+"张"):m.length<Xt&&m.length>=Yt?($("#info").text("可上传"+Yt+"-"+Xt+"张, "+Zt),$("#designGO").css("pointer-events","auto")):(m.length>Xt&&di("#morethan-photo"),$("#info").text("可上传"+Yt+"-"+Xt+"张, "+Zt),$("#designGO").css("pointer-events","auto"))}}else{if($("#uploadFailure_"+i).show(),$("#uploadFailure_span_"+i).text("图片保存失败"),o){var f="返回结果："+JSON.stringify(o)+",ip="+Pt.server.uploadData.ipAddress;Pt.commonLog("微信九张上传",f)}$("#uploadDel_"+i).show(),$("#uploadList_"+i).attr("localId",t),$("#uploadList_"+i).attr("uploading","1")}Lt.length>0?($("#uploadDel_"+i).show(),$("#uploadList_"+i).find(".upload-state").hide()):(kt=!1,0==a?console.info("不隐藏了1"):(console.info("隐藏了1"),$("#loadingData").hide()),$(".upload-state").hide(),$(".sjky-btn-greytxt").show(),$(".sjky-btn-grey").show(),$(".weui-cell").show(),$("#uploadDel_"+i).show())},error:function(e){if($("#uploadFailure_"+i).show(),e){var o="返回结果："+JSON.stringify(e)+",ip="+Pt.server.uploadData.ipAddress;Pt.commonLog("微信九张上传",o)}if($("#uploadFailure_span_"+i).text("保存方法失败"),$("#uploadList_"+i).attr("localId",t),$("#uploadList_"+i).attr("uploading","1"),$("#uploadDel_"+i).show(),!(Lt.length>0))return kt=!1,0==a?console.info("不隐藏了2"):(console.info("隐藏了2"),$("#loadingData").hide()),void $(".upload-state").hide()}})},fail:function(e){if($("#uploadFailure_"+i).show(),e){var o="返回结果："+JSON.stringify(e)+",ip="+Pt.server.uploadData.ipAddress;Pt.commonLog("微信九张上传",o)}if($("#uploadFailure_span_"+i).text("微信上传失败"),$("#uploadList_"+i).attr("localId",t),$("#uploadList_"+i).attr("uploading","1"),!(Lt.length>0))return kt=!1,void(0==a?console.info("不隐藏了3"):(console.info("隐藏了3"),$("#loadingData").hide()))}})}function ni(e,t){var i=$('<div id="uploadList_'+t+'" data-index="'+t+'"imageid="'+t+'"onClick="photochoose_fx(this,'+t+","+Pt.minPageNum+","+Pt.maxPageNum+')" uploading="0" localId="" failCount="0" class="phoBox" style=""></div>'),a=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t+'">\t<span class="chooseIndexSpan_pub"></span>\t</label></div>\t');a.appendTo(i);var o=$('<div class="tips-pixel-out" id="uploadMask_'+t+'" style="display:none"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');o.appendTo(i);var s=$('   <div id="uploadFailure_'+t+'" class="waitUpload tc" style="display:none">\t\t<span id="uploadFailure_span_"'+t+' class="wh fs12 mt2 dib">网络连接异常</span>\t</div>');s.appendTo(i);var n=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">正在上传</p></div>');n.appendTo(i),i.attr("style","background-image:url("+e+");"),i.on("click",function(){var e=$(this).attr("uploading");if("0"!=e){var t=$(this).attr("data-index");$(this).attr("localId"),$(this).attr("failCount");$(".ddel").click(function(){ri(t)})}}),$("#imageList").prepend(i)}function ri(e){var t=new Array;if($.each(Ot,function(i,a){a.index==e||t.push(a)}),Ot=t,window.localStorage){var i=localStorage.getItem(Ct.calenderTemp);if(null!=i&&"null"!=i){i=JSON.parse(i);var a=new Array;$.each(i,function(t,i){i.index==e||a.push(i)}),i=a}else i=new Array;localStorage.setItem(Ct.calenderTemp,JSON.stringify(i)),i.length<Yt?$("#info").text("可上传"+Yt+"-"+Xt+"张"):i.length<Xt&&i.length>=Yt?($("#info").text("可上传"+Yt+"-"+Xt+"张, "+Zt),$("#designGO").css("pointer-events","auto")):(i.length>Xt&&di("#morethan-photo"),$("#info").text("可上传"+Yt+"-"+Xt+"张, "+Zt),$("#designGO").css("pointer-events","auto")),0==i.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+Yt+"-"+Xt+"张照片"));for(var o=!1,s=0;s<i.length;s++)if(1==i[s].pixellow){o=!0;break}o||$("#showIOSDialog2").hide();var n=$("#uploadList_"+e);n.remove()}}function li(t,i,a){$(".ddel").unbind("click"),$(".ddel").click(function(){for(var o=0,s=0;s<t.length;s++)t[s].innerText&&(hi(t[s],i,a),o++);gi();var n=localStorage.getItem(Ct.calenderTemp);n=null!=n&&"null"!=n?JSON.parse(n):[];try{if(window._jylog){var r=localStorage.getItem(Ct.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信删除照片","删除:"+o+",剩余:"+n.length,JSON.parse(r).orderNo])}}catch(e){console.log(e)}ei="已选"+Pt.chooseNumfx+"张",$("#vm.chooseNumShow").html(ei)}),di("#del-photo")}function di(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)}function ci(e,t,i){layer.open({style:"width:5rem;",className:"layerSkin",content:"确定要删除吗？",btn:["确定","取消"],yes:function(a){var o=$(e).parent().attr("data-index"),s=new Array;if($.each(Ot,function(e,t){console.log(e),console.log(t),t.index==o||s.push(t)}),Ot=s,window.localStorage){var n=localStorage.getItem(Ct.calenderTemp);if(null!=n&&"null"!=n){n=JSON.parse(n);var r=new Array;$.each(n,function(e,t){t.index==o||r.push(t)}),n=r}n.length<t?$("#info").text("可上传"+t+"-"+i+"张"):n.length<i&&n.length>=t?($("#info").text("可上传"+t+"-"+i+"张, "+Zt),$("#designGO").css("pointer-events","auto")):(n.length>i&&di("#morethan-photo"),$("#info").text("可上传"+t+"-"+i+"张, "+Zt),$("#designGO").css("pointer-events","auto")),0==n.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var l=!1,d=0;d<n.length;d++)if(1==n[d].pixellow){l=!0;break}l||$("#showIOSDialog2").hide(),localStorage.setItem(Ct.calenderTemp,JSON.stringify(n))}$(e).parent().remove(),layer.close(a)}})}function hi(t,i,a){var o=$(t).parents(".phoBox").attr("data-index"),s=new Array,n={},r="",l=0;Ot=JSON.parse(localStorage.getItem(Ct.historyCalenderTemp)),o=$(t).parents(".phoBox").attr("imageid"),$.each(Ot,function(e,t){t.id==o||t.index==o?(l++,""==r?r=t.id:r+=t.id):s.push(t)});try{if(window._jylog){var d=localStorage.getItem(Ct.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信删除照片",l,JSON.parse(d).orderNo])}}catch(e){console.log(e)}if(""!=r&&(n.ids=r,n.materialType="al",Ot=s,$.ajax({type:"POST",url:jt.urlConfig.basicUrl+"/diy/deleteimg",data:n,dataType:"json",success:function(e){}})),0==Ot.length&&($(".weui-check_box2").attr("checked",!1),Pt.checkAll=!1),window.localStorage){var c=localStorage.getItem(Ct.calenderTemp);if(null!=c&&"null"!=c){c=JSON.parse(c);var h=new Array;$.each(c,function(e,t){t.index==o||t.id==o||h.push(t)}),c=h}var g=localStorage.getItem(Ct.historyCalenderTemp);if(null!=g&&"null"!=g){g=JSON.parse(g);h=new Array;$.each(g,function(e,t){t.id==r||h.push(t)}),g=h,localStorage.setItem(Ct.historyCalenderTemp,JSON.stringify(g))}Pt.upladNum=c.length,c.length<i&&$("#info").text("可上传"+i+"-"+a+"张"),c.length>=i&&c.length<a&&($("#info").text("可上传"+i+"-"+a+"张, 进入设计"),$("#designGO").css("pointer-events","auto"),$("#addImage").css("pointer-events","auto")),0==g.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+i+"-"+a+"张照片"));for(var m=!1,p=0;p<c.length;p++)if(1==c[p].pixellow){m=!0;break}m||$("#showIOSDialog2").hide(),localStorage.setItem(Ct.calenderTemp,JSON.stringify(c)),Ot=c}$(t).parents(".phoBox").remove(),$("#deletephoto").text("删除("+Pt.upladNum+")"),$("#addImage").text("继续上传("+Pt.upladNum+")"),Pt.chooseNumfx=$("#imageList").find("input[type=checkbox]:checked").length,Pt.ishistoryuploadbutton&&$("#historyuploadbutton").click()}function gi(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)}function mi(){isConfirmUpload=!1,$("#uploadIndex").hide(),$("#uploadShow").show();var e=Lt,t=[],i=[],a=localStorage.getItem(Ct.historyCalenderTemp);if(null!=a&&""!=a&&void 0!=a){JSON.parse(a);for(var o=0;o<e.length;o++){for(var s=!1,n=o;n<e.length-1;n++)if(e[o]==e[n+1]){s=!0,isConfirmUpload=!0;break}null!=a&&"null"!=a&&"[]"!=a&&-1!=a.indexOf(e[o])&&(s=!0,isConfirmUpload=!0),s?i.push(e[o]):t.push(e[o])}if(isConfirmUpload)isConfirmUpload=!1,layer.open({skin:"unpload-layer",title:!1,content:'<p style="padding:10px 30px;font-size: 16px;">检测到重复图片<br/>是否上传这些重复的图片？</p>',btn:["上传","不上传"],closeBtn:0,yes:function(e){for(var t=0;t<Tt.length;t++);Lt.length>0&&oi(),layer.close(e)},btn2:function(e){console.log(t),Lt=t;for(var i=0;i<t.length;i++);Lt.length>0&&oi(),layer.close(e)}});else{for(o=0;o<Tt.length;o++);Lt.length>0&&oi()}}}function pi(){return kt}function ui(e){1==e.checked&&($(".weui-cell").show(),$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide()),Pt.chooseNumfx=$("#imageList").find("input[type=checkbox]:checked").length;var t=localStorage.getItem(Pt.pageKey.calenderTemp);if(null!=t&&"null"!=t&&"undefined"!=t)if(t=JSON.parse(t),t.length,Pt.chooseNumfx==t.length&&0!=Pt.chooseNumfx){for(var i=$(".weui-check_box2"),a=0;a<i.length;a++)i[a].checked=!0;Pt.checkAll=!0}else{for(i=$(".weui-check_box2"),a=0;a<i.length;a++)i[a].checked=!1;Pt.checkAll=!1}0==Pt.chooseNumfx?0==t.length||$(".sjky-list-tip3").show():(ei="已选"+Pt.chooseNumfx+"张",$("#vm.chooseNumShow").html(ei))}function fi(){$(".sjky-btn-resettxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-greytxt").show();for(var e=$(".weui-check_box_wx"),t=0;t<e.length;t++)e[t].checked=!1;Pt.chooseNumfx=0,ei="已选0张",$("#vm.chooseNumShow").html(ei)}function yi(){$(".sjky-btn-greytxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-resettxt").show();for(var e=$(".weui-check_box_wx"),t=0;t<e.length;t++)e[t].checked=!0;Pt.chooseNumfx=e.length,ei="已选"+e.length+"张",$("#vm.chooseNumShow").html(ei)}function _i(e){return-1!=e.indexOf(jt.urlConfig.thumbnailUrl)?jt.urlConfig.thumbnailUrl:-1!=e.indexOf(jt.urlConfig.baseUrl)?jt.urlConfig.baseUrl:!e||-1==e.indexOf("material/")&&-1==e.indexOf("yingxiangdiy/")&&-1==e.indexOf("commonUpload/")?e&&(e.endsWith("svg")||e.endsWith("xml"))?jt.urlConfig.thumbnailUrl:e&&-1!=e.indexOf("oss-")?jt.urlConfig.ossPhotoUrl:e&&-1!=e.indexOf("img.alicdn.com")?"":-1!=e.indexOf(jt.urlConfig.orgBaseUrl)?jt.urlConfig.orgBaseUrl:jt.urlConfig.baseUrl:-1!=e.indexOf("yingxiangdiy/")?-1!=e.indexOf(jt.urlConfig.orgBaseUrl3)?jt.urlConfig.orgBaseUrl3:jt.urlConfig.baseUrl3:jt.urlConfig.thumbnailUrl}function vi(e,t,i,a){var o="";a.thumbnailToken&&(o=a.thumbnailToken);var s=0,n=0;if(!e||-1==e.indexOf("material/")&&-1==e.indexOf("/yingxiangdiy/")&&-1==e.indexOf("commonUpload/"))return e&&-1!=e.indexOf(".xml")?"mongo_yx/"+e+"?token="+o:e&&e.charAt(0)<="f"?(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,"mongo_yx/"+e+"!"+s+"x"+n+"?token="+o):e;if(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+s+"x"+n+"?token="+o;if(-1!=e.indexOf("commonUpload/")){var r=e.split("commonUpload/");return r[1]+"!"+s+"x"+n+"?token="+o}var l=e.split("/");return l.splice(1,0,s+"x"+n),l.join("/")}window.fxloadingDelimage=ci,window.changeBox_wx=ui;new Array;var wi,bi,Ii,Si=800,xi=800,ki={name:"FxBaseUpload",props:["storageName","submitButtonName","uploadcomplete","minPageNum","maxPageNum","server","checksubmitstate","orderInfo","isTaoBan","pageKey"],data:function(){var e;return e={id:"",tipsFont:!1,isSimple:!1,pageNum:"",productId:"",calendar_type:"",pageIndex:1,pageSize:40,p:-1,editing:!1,showDeleteModal:!1,flagURL:"",isTeamBook:!1,chooseNumfx:0,checkAll:!1,arrnum:""},Object(L["a"])(e,"isTeamBook",!1),Object(L["a"])(e,"upladNum",0),Object(L["a"])(e,"isfirst",0),Object(L["a"])(e,"storageNamebase",""),Object(L["a"])(e,"thumbnailToken",""),Object(L["a"])(e,"isfinish",!1),Object(L["a"])(e,"ishistoryuploadbutton",!1),Object(L["a"])(e,"historytips",!0),e},created:function(){this.isSimple=this.$route.query.isSimple;var e=localStorage.getItem(this.pageKey.id);this.isTeamBook=this.$route.query.isTeamBook;var t=localStorage.getItem(this.pageKey.isfirst),i=[];localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(i)),localStorage.removeItem(this.pageKey.historyCalenderTemp);var a=localStorage.getItem(this.pageKey.calenderTemp);t&&"1"==t?null==a||"[]"==a?this.isfirst=0:(this.isfirst=1,this.piclist=JSON.parse(a),this.upladNum=JSON.parse(a).length):(localStorage.setItem(this.pageKey.isfirst,this.isfirst),null==a||"[]"==a||(this.piclist=JSON.parse(a),this.upladNum=JSON.parse(a).length)),null==e||""==e||"undefined"==e?(this.id=this.$route.query.id,this.flagURL=this.$route.query.flagURL,localStorage.setItem(this.pageKey.id,this.id)):this.id=e,this.initjssdk(),this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},mounted:function(){$(".zzz").click(function(){hideModal()});var t=localStorage.getItem(this.pageKey.source);this.flagURL=localStorage.getItem(this.pageKey.flagURL),"wechat"==this.flagURL&&(t="wechat",localStorage.setItem(this.pageKey.source,t));JSON.parse(localStorage.getItem(this.pageKey.goodsid));if(this.calendar_type=localStorage.getItem(this.pageKey.calendar_type),this.productId=JSON.parse(localStorage.getItem(this.pageKey.productId)),this.p=JSON.parse(localStorage.getItem(this.pageKey.pnum)),null==this.p&&(this.p=-1),1==this.isfirst){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","提示","改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！")}var a=window.location.href;this.getApiSign(t,encodeURIComponent(a)),$("#loadUpload").bind("click",function(e){$(".sjky-btn-greytxt").hide(),$(".sjky-btn-bottom2").show()}),this.arrnum=this.maxPageNum},methods:{changeHistoryTips:function(){this.historytips=!1},editPhotos:function(){this.editing=!0,$("#imageList").find(".checkbox").show(),$("#imageList").find(".btn-delete").hide()},finishEdit_fx:function(){var e=localStorage.getItem(this.pageKey.historyCalenderTemp),t=localStorage.getItem(this.pageKey.calenderTemp),i=[],a=[];a=JSON.parse(e),i=JSON.parse(t);for(var o=[],s=$("#imageList").children(),n=0;n<s.length;n++){var r=s[n].attributes.imageid.nodeValue;a.map(function(e){return e.id!=r&&e.index!=r||o.push(e),e})}a=o;var l=a.length;if(a.length>=this.maxPageNum&&(l=this.maxPageNum),i.length<l?this.checkAll=!1:l==i.length&&(this.checkAll=!0),this.checkAll){this.chooseUploadImage=[],i=[];d=this.maxPageNum,c=a;c.length<=this.maxPageNum&&(d=c.length);for(h=0;h<d;h++){delete c[h].chooseIndex;g=$("#uploadList_"+c[h].index),s=$(g).children().find("span[class=chooseIndexSpan]");handleStyle(!1,s),s.text("")}this.checkAll=!1;for(m=$(".weui-check_box2"),h=0;h<m.length;h++)m[h].checked=!1;a=c,this.chooseUploadImage=this.chooseUploadImage}else{this.chooseUploadImage=[],i=[];var d=this.maxPageNum,c=a;c.length<=this.maxPageNum&&(d=c.length);for(var h=0;h<c.length;h++){delete c[h].chooseIndex;var g=$("#uploadList_"+c[h].index),s=$(g).children().find("span[class=chooseIndexSpan]");handleStyle(!1,s),s.text("")}for(var h=0;h<d;h++){c[h].chooseIndex=c[h].chooseIndex=h+1,i.push(c[h]),this.chooseUploadImage.push(c[h]);var g=$("#uploadList_"+c[h].index);s=$(g).children().find("span[class=chooseIndexSpan]");handleStyle(!0,s),s.text(h+1)}this.checkAll=!0;for(var m=$(".weui-check_box2"),h=0;h<m.length;h++)m[h].checked=!0;a=c,this.chooseUploadImage=this.chooseUploadImage}console.info("全选方法！"),localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(i)),localStorage.setItem(this.pageKey.historyCalenderTemp,JSON.stringify(a)),this.upladNum=this.chooseUploadImage.length,$("#deletephoto").text("删除("+this.upladNum+")"),$("#addImage").text("继续上传("+this.upladNum+")"),this.storageNamebase="historyCalenderTemp",this.handleImagehistoryuploadfx(this,this.minPageNum,this.maxPageNum,this.storageNamebase,this)},finishEdit_fxOld:function(){this.checkAll?(fi(),this.checkAll=!1):(yi(),this.checkAll=!0)},deletePic:function(){var e=$("#imageList").find("span[class=chooseIndexSpan]");e.length>0&&li(e,this.minPageNum,this.maxPageNum),this.editing=!1,$(".sjky-btn-resettxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-greytxt").show()},resetupload:function(){hideModal()},nextfx:function(){var e=this,t=pi();if(t)showConfirm("#uping-photo");else{var i=!1,a=localStorage.getItem(this.storageName);if(null!=a&&"null"!=a){if(a=JSON.parse(a),(this.isSimple||-1==this.id)&&a.length<this.minPageNum)return this.tipsFont=!0,void setTimeout(function(){e.tipsFont=!1},3e3);for(var o=0;o<a.length;o++)if(1==a[o].pixellow){i=!0;break}var s=[];if(this.uploadcomplete);else{var n=localStorage.getItem(this.pageKey.uploadCalenderTemp);if(n){var r=JSON.parse(n);s=r.concat(a)}else s=a}localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(s));var l=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(l=!0)}),l)showConfirm("#fail-photo");else{e=this;1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isSimple,e.nextStep(0)):i?this.showModal("#low-photo"):this.nextStep(1)}}}},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},nextStep:function(t){this.hideModal();var i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));try{if(window._czc){var a="";a=0==t?"时间排序":"智能排序",window._czc.push(["_trackEvent","剪影","上传页面",a])}if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信进入设计",a,JSON.parse(o).orderNo])}}catch(e){}this.$emit("baseUploadNextStep",this.id,this.p,i,t)},showUpload:function(){$(".uploadZoone").show(),$(".no-infor").hide()},getCalenderTemp:function(e){var t=[],i=this,a={};a.token=e,a.pagenum=this.pageIndex,a.pageSize=this.pageSize,Object(H["N"])(a).then(function(e){var a=[],o=localStorage.getItem(i.pageKey.historyCalenderTemp);o&&"null"!=o&&null!=o&&(a=JSON.parse(o));var s=null;if(s="string"==typeof e?JSON.parse(e):e,s.result){var n=null,r="";if("string"==typeof s.data?(n=JSON.parse(s.data).list,r=JSON.parse(s.data).total):(n=s.data.list,r=s.data.total),a.length==r&&(i.isfinish=!0),""!=n&&n.length>0)for(var l=0;l<n.length;l++){var d={};1!=i.pageIndex&&a.length+l,d.isUse=!0,d.index=l,d.id=n[l].id,d.name=n[l].name,d.url=n[l].picname,d.history=!0,d.src=Object(Q["d"])(n[l].picname)+Object(Q["e"])(n[l].picname,n[l].imageinfo,i.thumbnailToken);Object(q["a"])(n[l].imageinfo);if(""!=n[l].imageinfo){var c=JSON.parse(n[l].imageinfo),h="";h=c.primaryImageInfo?c.primaryImageInfo:c,d.dateTime=c.dateTime,d.width=h.width,d.height=h.height,(h.width<Si||h.height<xi)&&(d.pixellow=1)}t.push(d)}var g=localStorage.getItem(i.pageKey.calenderTemp);if(null!=g&&void 0!=g||(g=[]),t.length>0){if(t.length==g.length)for(l=0;l<t.length;l++)if(t[l].id!=g[l].id){localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson),console.log(11111111111111111e39);break}t=a.concat(t);var m={};t=t.reduce(function(e,t){return!m[t.id]&&(m[t.id]=e.push(t)),e},[]),localStorage.setItem(i.pageKey.historyCalenderTemp,JSON.stringify(t)),t.length>0&&($(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show())}}i.storageNamebase="historyCalenderTemp",i.handleImagehistoryuploadfx(!0,i.minPageNum,i.maxPageNum,i.storageNamebase,i)})},handleScroll:function(e){var t=e.target.scrollHeight,i=e.target.clientHeight,a=e.target.scrollTop;console.log(t,i,a);var o=this.$route.query.isfirst;o?"string"==typeof o&&(o="false"!=o):o=!1,!o||this.isNoHistoryPhoto?(console.log("加载更多1"),this.isfinish||(console.log("继续加载"),a+i+100>=t&&(this.pageIndex++,this.getCalenderTemp(localStorage.getItem(this.pageKey.token)),console.log("加载更多")))):this.isfinish||a+i+100>=t&&(this.pageIndex++,this.getCalenderTemp(localStorage.getItem(this.pageKey.token)),console.log("加载更多"))},getApiSign:function(t,i){var a=this;Object(H["i"])(t,i).then(function(t){var i=t.userData;wx.config({debug:!1,appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonceStr,signature:i.signature,jsApiList:["chooseImage","uploadImage","closeWindow"]}),wx.error(function(t){console.log(t);try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","获取签名失败！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("获取签名失败！")}),localStorage.setItem(a.pageKey.accessToken,i.accessToken),$("#loadUpload").bind("click",function(e){ai()})}).catch(function(t){console.log("catch data::",t);try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","调用上传方法失败！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("调用上传方法失败！")})},getHistoryPhotofx:function(){$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),this.historytips=!1,this.chooseNumfx=0,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.historyCalenderTemp,this.ishistoryuploadbutton=!0,$("#historyuploadbutton").addClass("active"),$("#uploadbutton").removeClass("active"),$("#designGO").hide(),$(".addImagediv").hide(),$("#insertupload").show();var e=localStorage.getItem(this.pageKey.historyCalenderTemp);e?(e=JSON.parse(e),e!=[]&&e.length>0?this.handleImagehistoryuploadfx(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this):this.getCalenderTemp(localStorage.getItem(this.pageKey.token))):this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},changebuttonfx:function(){$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),this.chooseNumfx=0,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.calenderTemp,this.ishistoryuploadbutton=!1,this.checkAll=!1,this.chooseNumfx=0,$("#designGO").show(),$("#uploadIndex").show(),$(".addImagediv").show(),$("#insertupload").hide(),$("#uploadbutton").addClass("active"),$("#historyuploadbutton").removeClass("active"),this.handleImagebeforeuploadfx(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this)},handleImagehistoryuploadfx:function(e,t,i,a,o){if($("#imageList").empty(),null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);null!=s&&"null"!=s&&"undefined"!=s?(s=JSON.parse(s),$.each(s,function(e,a){-1!=a.src.indexOf(J["a"].thumbnailUrl)&&(a.src=a.src.replace("commonUpload/",""),-1!=a.src.indexOf("fsferry")&&(a.src=a.src.replace("fsferry/","")),-1==a.src.indexOf("token")&&(a.src=a.src+"?token="+localStorage.getItem(o.pageKey.thumbnailToken)));var s=new Image;s.src=a.src,a.index="l"+a.index;var n=$('<div id="uploadList_'+a.index+'" imageid="'+a.id+'" data-index="'+a.index+'" uploading="1" class="phoBox" onClick="photochoose_fx(this,'+a.id+","+t+","+i+')" style="background-image:url('+s.src+');"></div>');if(1==a.pixellow){var r=$('<div class="tips-pixel-out" id="uploadMask_'+a.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');r.appendTo(n),$("#showIOSDialog3").hide()}if(a.chooseIndex&&""!=a.chooseIndex){var l=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+a.index+'">\t<span class="chooseIndexSpan">'+a.chooseIndex+"</span>\t</label></div>\t");l.appendTo(n)}n.appendTo($("#imageList"));var d=$("#uploadList_"+a.index),c=$(d).children().find("span[class=chooseIndexSpan]");a.chooseIndex&&handleStyle(!0,c)}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),s.length>0&&(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show())):(s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)))}else alert("商品问题，请联系客服！")},handleImagebeforeuploadfx:function(e,t,i,a,o){if($("#imageList").empty(),null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);if(null!=s&&"null"!=s&&"undefined"!=s){s=JSON.parse(s);var n=new Array,r=s.length;if(r>i){for(var l=0;l<r;l++)if(l<i)n.push(s[l]);else if(isTaoBan){var d=[];d.push(s[l].id),delImageTaobanSimple(d)}s=n}$.each(s,function(e,a){-1!=a.src.indexOf(J["a"].thumbnailUrl)&&(a.src=a.src.replace("commonUpload/",""),-1!=a.src.indexOf("fsferry")&&(a.src=a.src.replace("fsferry/","")),-1==a.src.indexOf("token")&&(a.src=a.src+"?token="+localStorage.getItem(o.pageKey.thumbnailToken)));var s=new Image;s.src=a.src,a.index="l"+a.index;var n=$('<div id="uploadList_'+a.index+'" imageid="'+a.id+'" data-index="'+a.index+'" uploading="1" class="phoBox" onClick="photochoose_fx(this,'+a.id+","+t+","+i+')" style="background-image:url('+s.src+');"></div>');if(1==a.pixellow){var r=$('<div class="tips-pixel-out" id="uploadMask_'+a.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');r.appendTo(n),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var l=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+a.index+'">\t<span class="chooseIndexSpan"></span>\t</label></div>\t');l.appendTo(n),n.prependTo($("#imageList"))}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),o.upladNum=s.length,s.length>0?(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),s.length<t?isTaoBan?$("#info").text("已上传"+s.length+"张","可上传"+t+"-"+i+"张"):$("#info").text("可上传"+t+"-"+i+"张"):s.length<i&&s.length>=t?$("#info").text("可上传"+t+"-"+i+"张"):(s.length>i&&(showModal("#morethan-photo"),$("#info").css("color","#a5a6a6")),$("#info").text("可上传"+t+"-"+i+"张"))):t==i?$("#info").text("需上传"+t+"张照片"):$("#info").text("需上传"+t+"-"+i+"张照片")}else s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(pageKey.isfirst,0)}else alert("商品问题，请联系客服！")},changePhotoUploadListfx:function(){var e=JSON.parse(localStorage.getItem(this.pageKey.historyCalenderTemp)),t=[],i=localStorage.getItem(this.pageKey.calenderTemp);if("[]"==i?(console.info("7418473==="),t=[]):t=JSON.parse(i),t.length>this.maxPageNum){var a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";layer.alert(a)}else{for(var o=$("#imageList").find(".weui-check"),s=0;s<o.length;s++)if(o[s].checked)for(var n=$(o[s]).parents(".phoBox").attr("imageid"),r=0;r<e.length;r++)if(n==e[r].id){if(t.length>=this.maxPageNum){localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t));a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";return layer.alert(a),console.info("22222"),void this.changebuttonfx()}t.push(e[r]);break}localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t)),this.changebuttonfx()}},initjssdk:function(){var t=this;console.info("初始化微信插件");var i=localStorage.getItem(this.pageKey.token);try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo),o="调用newgetCommonUploadConfig的token===="+i;window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","newgetCommonUploadConfig微信进入设计",o,JSON.parse(a).orderNo])}}catch(e){}Object(H["n"])(i).then(function(i){if(console.info("初始化微信插件111"),console.info(i),i.result){t.server.commonUpload=i.data.commonUpload,t.server.appKey=i.data.appKey,t.server.appSecret=i.data.appSecret,t.server.serverKey=i.data.serverKey,t.server.unionId=i.data.unionId,t.server.thumbnailToken=i.data.base64Token,t.thumbnailToken=i.data.base64Token,t.server.uploadData.ipAddress=i.data.ipAddress,localStorage.setItem(t.pageKey.thumbnailToken,i.data.base64Token);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"支付宝上传":"上传页面","ip地址",i.data.ipAddress,JSON.parse(a).orderNo])}}catch(e){console.log(e)}}console.info("初始化微信插件222"),console.info(t.server),ti(t.minPageNum,t.maxPageNum,t.server,t.pageKey,t)})}}},Oi=ki,Li=(a("fa47"),Object(b["a"])(Oi,Rt,qt,!1,null,"0dcbb128",null)),Ti=Li.exports,Ci="进入设计",Pi="";function ji(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)}function Ai(e,t,i){layer.open({style:"width:5rem;",className:"layerSkin",content:"确定要删除吗？",btn:["确定","取消"],yes:function(a){var o=$(e).parent().attr("data-index"),s=new Array;if($.each(wi,function(e,t){console.log(e),console.log(t),t.index==o||s.push(t)}),wi=s,window.localStorage){var n=localStorage.getItem(bi.calenderTemp);if(null!=n&&"null"!=n){n=JSON.parse(n);var r=new Array;$.each(n,function(e,t){t.index==o||r.push(t)}),n=r}n.length<t?$("#info").text("可上传"+t+"-"+i+"张"):n.length<i&&n.length>=t?($("#info").text("可上传"+t+"-"+i+"张, "+Ci),$("#designGO").css("pointer-events","auto")):(n.length>i&&ji("#morethan-photo"),$("#info").text("可上传"+t+"-"+i+"张, "+Ci),$("#designGO").css("pointer-events","auto")),0==n.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var l=!1,d=0;d<n.length;d++)if(1==n[d].pixellow){l=!0;break}l||$("#showIOSDialog2").hide(),localStorage.setItem(bi.calenderTemp,JSON.stringify(n))}$(e).parent().remove(),layer.close(a)}})}function Ni(e){1==e.checked&&($(".weui-cell").show(),$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide()),Ii.chooseNumfx=$("#imageList").find("input[type=checkbox]:checked").length;var t=localStorage.getItem(Ii.pageKey.calenderTemp);if(null!=t&&"null"!=t&&"undefined"!=t)if(t=JSON.parse(t),t.length,Ii.chooseNumfx==t.length&&0!=Ii.chooseNumfx){for(var i=$(".weui-check_box2"),a=0;a<i.length;a++)i[a].checked=!0;Ii.checkAll=!0}else{for(i=$(".weui-check_box2"),a=0;a<i.length;a++)i[a].checked=!1;Ii.checkAll=!1}0==Ii.chooseNumfx?0==t.length||$(".sjky-list-tip3").show():(Pi="已选"+Ii.chooseNumfx+"张",$("#vm.chooseNumShow").html(Pi))}window.fxloadingDelimage=Ai,window.changeBox_wx=Ni;var Ei,Ji={name:"fxUpload",components:{FxBaseUpload:Ti},data:function(){return{storageName:"",history:!1,uid:"",id:"",submitButtonName:"进入设计",server:{upload:J["a"].basicUrl+"/upload/wxPhoto",uploadData:{},delete:"/tbdiy/uploade/deleteImg.do",baseUrl:J["a"].baseUrl,urlConfig:J["a"]},checksubmitstate:!0,iscomplete:!1,uploadcomplete:!1,isChangxian:0,minPageNum:0,maxPageNum:0,pageKey:"",isTeamBook:!1,isSimple:!1,isPart:!1}},created:function(){var e=this;document.body.style.position="absolute";var t=localStorage.getItem("isAlipay"),i=navigator.userAgent.toLowerCase();("undefined"!=typeof my||"alipayclient"==i.match(/AlipayClient/i)||t)&&(this.is_alipay=!0),this.id=this.$route.query.id,this.isSimple=this.$route.query.isSimple,this.isPart=this.$route.query.isPart,this.history=this.$route.query.history,this.uid=this.$route.query.uid;var a=this.$route.query.p;this.isTeamBook=this.$route.query.isTeamBook,this.isfirst=this.$route.query.isfirst,this.isChangxian=this.$route.query.isChangxian;this.$route.query.uploadcomplete,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var o=this.$route.query.id,s=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(t){!t.miniprogram&&s&&e.$router.push({name:"upload",query:{id:o,p:a,isTeamBook:e.isTeamBook,isfirst:e.isfirst}})})}"true"!=this.isTeamBook&&1!=this.isTeamBook||"true"!=!this.isfirst&&1!=!this.isfirst?this.pageKey=ee["a"]:this.pageKey=ee["c"],(this.isPart||this.history)&&(this.pageKey=ee["c"]),this.logFrom("微信上传"),localStorage.removeItem(this.pageKey.calenderTemp);var n=localStorage.getItem(this.pageKey.token);if(null!=n&&void 0!=n&&"null"!=n&&"undefined"!=n){this.storageName=this.pageKey.calenderTemp,!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isTeamBook=!1,this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)):(this.isTeamBook=!0,this.isPart&&1!=this.isChangxian?(this.minPageNum=a,this.maxPageNum=5*a,localStorage.setItem(this.pageKey.minnum,a),localStorage.setItem(this.pageKey.maxnum,5*a)):(this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)));n=localStorage.getItem(this.pageKey.token);this.server.uploadData.token=n}else this.$router.push({name:"404"})},mounted:function(){},methods:{nextStep:function(e,t,i,a){var o=localStorage.getItem(this.pageKey.calenderTemp);localStorage.getItem(this.pageKey.diytype),localStorage.getItem(this.pageKey.hassort);if(localStorage.setItem(this.pageKey.hassort,a),localStorage.removeItem(this.pageKey.cal_pageList),this.isfirst&&"[]"!=o){var s=JSON.parse(o);if(-1==this.id&&s.length<this.minPageNum)return void layer.alert("空白模板，上传照片数量不能小于最小照片数量")}if("[]"!=o&&""!=o&&void 0!=o&&"undefined"!=o){var n=JSON.parse(o);if(n.length<"1")return void layer.alert("请先选择照片")}else{n=JSON.parse(o);if(n.length<"1")return void layer.alert("请先选择照片")}localStorage.setItem(this.pageKey.areadyInsert,"1");var r=!1;1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(r=!0);navigator.userAgent.toLowerCase();var l=navigator.userAgent,d=!!l.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(d)this.isSimple?location.href="simpledesign?id="+this.id+(null==t||void 0==t||""==t?"":"&p="+t)+(null==r||void 0==r||""==r?"":"&isEditCover="+r)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort=0&submit=true&editType=1&iscomplete="+this.iscomplete:location.href="design?id="+this.id+(null==t||void 0==t||""==t?"":"&p="+t)+(null==r||void 0==r||""==r?"":"&isEditCover="+r)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+a+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid);else{var c={id:this.id,p:t,isEditCover:r,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:0,iscomplete:this.iscomplete,designsorce:"isweixin"};this.isSimple?(c.submit=!0,c.editType=1,this.$router.push({name:"simpledesign",query:c})):(this.history&&(c.history=this.history,c.uid=this.uid),this.$router.push({name:"design",query:c}))}},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录",this.isSimple?"极简微信上传":"微信上传页面",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}}}},Di=Ji,Bi=Object(b["a"])(Di,Wt,Ft,!1,null,null,null),Ki=Bi.exports,Mi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.items&&e.items.length>0?i("div",{staticClass:"template"},[i("van-search",{attrs:{maxlength:"25",placeholder:"请输入搜索关键词"},on:{input:function(t){return e.selectAll()},search:function(t){return e.serachMeth()},cancel:function(t){return e.cancelData()}},scopedSlots:e._u([{key:"left",fn:function(){return[e.changeModelAll||e.is_byte?i("div",{staticClass:"sjky-flex",staticStyle:{"margin-right":"4px"},on:{click:e.goBack}},[i("a",{staticStyle:{"font-size":"16px"}},[i("img",{attrs:{src:a("2f02"),alt:""}})])]):e._e()]},proxy:!0}],null,!1,1728083685),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),i("section",{staticClass:"content",attrs:{id:"temp_hist_cont"}},[e.items.length>0?i("div",{staticClass:"cTit mA"},[i("div",{staticClass:"proTit"},[i("span",{staticClass:"on",on:{click:function(t){return e.loadData(0,0)}}},[e._v("最新")]),i("span",{on:{click:function(t){return e.loadData(0,1)}}},[e._v("推荐")]),e._l(e.items,function(t,a){return i("span",{key:t.id,staticClass:"v-binding ng-scope ",on:{click:function(i){return e.querybyId(t.id,a)}}},[e._v(e._s(t.name))])})],2)]):e._e(),i("div",{staticClass:"page templatetop",attrs:{id:"templatespage"},on:{scroll:e.handleScroll}},[i("ul",{staticClass:"three-column"},e._l(e.templates,function(t,a){return 0==a&&"-1"==t.id&&e.changeModelAll?e._e():i("li",{key:t.id,staticStyle:{position:"relative"},attrs:{"on-finish-render-filters":""}},[0==a&&"-1"==t.id?i("a",{staticClass:"img-box",staticStyle:{position:"absolute",height:"83%"},attrs:{type:"buttom"},on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}}):e._e(),0==a&&"-1"==t.id?i("div",{staticClass:"order-id",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"100%",position:"absolute",bottom:"0"}},[i("span",{staticClass:"fR22",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[e._v(e._s(t.name))])]):e._e(),0==a&&"-1"!=t.id?i("a",{staticClass:"img-box",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[i("img",{attrs:{src:t.previewimage}})]):e._e(),0==a&&"-1"!=t.id?i("div",{staticClass:"order-id",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"100%"}},[i("span",{staticClass:"fR22",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[e._v(e._s(t.name))])]):e._e(),0!=a?i("a",{staticClass:"img-box",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[i("img",{attrs:{src:t.previewimage}})]):e._e(),0!=a?i("div",{staticClass:"order-id",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"100%"}},[i("span",{staticClass:"fR22",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[e._v(e._s(t.name))])]):e._e()])}),0)])]),i("div",{staticClass:"mask",staticStyle:{display:"none"}}),i("div",{staticClass:"sjky-img-edit selectDate",staticStyle:{display:"none"}},[e._m(0),i("div",{staticClass:"sjky-design-img"},[i("p",{staticClass:"pop-txt-tips"},[e._v("              \n\t\t\t\t  您可以选择任一连续的12个月定制的跨年台历"),i("br"),e._v("\n\t\t\t\t  起始月： "),i("select",{attrs:{id:"changeDate"},on:{change:function(t){return e.selectChange("")}}},[e._l(e.dataArr,function(t,a){return i("option",{key:t.id,domProps:{value:a}},[e._v(e._s(t))])}),e._v("\n\t\t\t\t\t请选择初始日期")],2),i("br"),e._v("\n\t\t\t\t  您选的月份为："+e._s(e.startDate)+"到"+e._s(e.endDate)+"\n\t\t\t\t")])]),i("div",{staticClass:"weui-dialog__ft"},[i("a",{staticClass:"weui-dialog__btn primary",attrs:{href:"javascript:;"},on:{click:function(t){return e.confirmBtn()}}},[e._v("选择模板")])])]),i("div",{staticClass:"sjky-img-edit editImage",attrs:{id:"modelPreview"}},[i("div",{staticClass:"sjk-top"},[i("span",{staticClass:"pop-title"}),i("i",{staticClass:"sjky close-icon",on:{click:function(t){return e.hideImageEditPage()}}},[e._v("")])]),i("div",{staticClass:"sjky-design-img",attrs:{id:"modelPreviewShow"}},[i("div",{staticClass:"sjky-modal-preview"},[i("img",{attrs:{src:e.previewImageUrl},on:{load:e.reloadCom,error:e.handleImageLoaded}}),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showNum,expression:"showNum"}],staticClass:"sjky-btn-grey sjky-btn-grey3 sjky-page-site",attrs:{href:"javascript:void(0);"}},[e._v(e._s(e.imageIndex+1)+" / "+e._s(e.previewImageUrlArr.length))]),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showReload,expression:"showReload"}],staticClass:"sjky-btn-grey sjky-btn-grey3 sjky-page-site",attrs:{href:"javascript:void(0);"},on:{click:e.reloadPic}},[e._v("点击重新加载")])]),i("i",{directives:[{name:"show",rawName:"v-show",value:e.prevImage,expression:"prevImage"}],staticClass:"sjky sjky-preview-btn sjky-btn-left",attrs:{id:"left",title:"上一页"},on:{click:function(t){return e.findImageByIndex(-1)}}},[e._v("")]),i("i",{directives:[{name:"show",rawName:"v-show",value:e.nextImage,expression:"nextImage"}],staticClass:"sjky sjky-preview-btn sjky-btn-right",attrs:{id:"right",title:"下一页"},on:{click:function(t){return e.findImageByIndex(1)}}},[e._v("")])]),e.isTeamBook||e.changeModelAll?e._e():i("a",{staticClass:"btn-circle-theme",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design()}}},[e._v("上传图片("+e._s(e.minnum)+"-"+e._s(e.maxnum)+")")]),e.changeModelAll?i("a",{staticClass:"btn-circle-theme",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.handleChangeModel()}}},[e._v("替换模板")]):e._e(),e.isTeamBook?i("div",{staticClass:"TeamBookShow preview-btn-group"},[i("div",{staticClass:"btn-circle-theme",staticStyle:{width:"40%",float:"left"}},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.showPartner()}}},[e._v("给小伙伴看看")])]),i("div",{staticClass:"btn-circle-theme",staticStyle:{width:"40%",float:"right"}},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design()}}},[e._v("就它了")])])]):e._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design loadingBook"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v(e._s(e.wenanText))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.changeSelectDate,expression:"changeSelectDate"}],staticClass:"teasingdate "},[i("i",{staticClass:"sjky icon-date",on:{click:function(t){return e.changeChoosDate()}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.changeDateShow,expression:"changeDateShow"}],staticClass:"bgout"},[i("a",{staticClass:"close clender_close",on:{click:function(t){return e.closeDate()}}}),i("div",{staticClass:"bg",on:{click:function(t){return e.changeChoosDate()}}},[e._v("当前选中:"+e._s(e.chooseDateNow))]),i("div",{staticClass:"bg_bottom animation"}),i("div",{staticClass:"bg_bottom2 animation2 "})])])],1):e._e()},$i=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sjk-top"},[i("span",{staticClass:"pop-title"},[e._v("\n\t\t\t   选择台历的起始年份\n\t\t\t ")])])}],Ui=a("b7ff"),Wi=Ui["a"],Fi=(a("f131"),Object(b["a"])(Wi,Mi,$i,!1,null,null,null)),Ri=Fi.exports,qi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"template"},[i("van-search",{attrs:{maxlength:"25",placeholder:"请输入搜索关键词"},on:{input:function(t){return e.selectAll()},search:function(t){return e.serachMeth()},cancel:function(t){return e.cancelData()}},scopedSlots:e._u([{key:"left",fn:function(){return[e.changeModelAll||e.is_byte?i("div",{staticClass:"sjky-flex",staticStyle:{"margin-right":"4px"},on:{click:e.goBack}},[i("a",{staticStyle:{"font-size":"16px"}},[i("img",{attrs:{src:a("2f02"),alt:""}})])]):e._e()]},proxy:!0}]),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),i("section",{staticClass:"content",attrs:{id:"temp_hist_cont"}},[i("div",{staticClass:"cTit mA"},[i("div",{staticClass:"proTit"},[i("span",{staticClass:"on",on:{click:function(t){return e.loadData(0,0)}}},[e._v("最新")]),i("span",{on:{click:function(t){return e.loadData(0,1)}}},[e._v("推荐")]),e._l(e.items,function(t,a){return i("span",{key:t.id,staticClass:"v-binding ng-scope ",on:{click:function(i){return e.querybyId(t.id,a)}}},[e._v(e._s(t.name))])})],2)]),i("div",{staticClass:"page templatetop",attrs:{id:"templatespage"},on:{scroll:e.handleScroll}},[i("ul",{staticClass:"three-column"},e._l(e.templates,function(t,a){return 0==a&&"-1"==t.id&&e.changeModelAll?e._e():i("li",{key:t.id,staticStyle:{position:"relative"},attrs:{"on-finish-render-filters":""}},[0==a&&"-1"==t.id?i("a",{staticClass:"img-box",staticStyle:{position:"absolute",height:"83%"},attrs:{type:"buttom"},on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}}):e._e(),0==a&&"-1"==t.id?i("div",{staticClass:"order-id",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"100%",position:"absolute",bottom:"0"}},[i("span",{staticClass:"fR22",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[e._v(e._s(t.name))])]):e._e(),0==a&&"-1"!=t.id?i("a",{staticClass:"img-box",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[i("img",{attrs:{src:t.previewimage}})]):e._e(),0==a&&"-1"!=t.id?i("div",{staticClass:"order-id",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"100%"}},[i("span",{staticClass:"fR22",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[e._v(e._s(t.name))])]):e._e(),0!=a?i("a",{staticClass:"img-box",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[i("img",{attrs:{src:t.previewimage}})]):e._e(),0!=a?i("div",{staticClass:"order-id",staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"100%"}},[i("span",{staticClass:"fR22",on:{click:function(i){return e.showtemple(e.productno,t.id,t.motherid,t.diytype,t.typeid,t.mobilestyleid,t.goodsid,t.productid)}}},[e._v(e._s(t.name))])]):e._e()])}),0)])]),i("div",{staticClass:"mask",staticStyle:{display:"none"}}),i("div",{staticClass:"sjky-img-edit selectDate",staticStyle:{display:"none"}},[e._m(0),i("div",{staticClass:"sjky-design-img"},[i("p",{staticClass:"pop-txt-tips"},[e._v("              \n\t\t\t\t  您可以选择任一连续的12个月定制的跨年台历"),i("br"),e._v("\n\t\t\t\t  起始月： "),i("select",{attrs:{id:"changeDate"},on:{change:function(t){return e.selectChange("")}}},[e._l(e.dataArr,function(t,a){return i("option",{key:t.id,domProps:{value:a}},[e._v(e._s(t))])}),e._v("\n\t\t\t\t\t请选择初始日期")],2),i("br"),e._v("\n\t\t\t\t  您选的月份为："+e._s(e.startDate)+"到"+e._s(e.endDate)+"\n\t\t\t\t")])]),i("div",{staticClass:"weui-dialog__ft"},[i("a",{staticClass:"weui-dialog__btn primary",attrs:{href:"javascript:;"},on:{click:function(t){return e.confirmBtn()}}},[e._v("选择模板")])])]),i("div",{staticClass:"sjky-img-edit editImage",attrs:{id:"modelPreview"}},[i("div",{staticClass:"sjk-top"},[i("span",{staticClass:"pop-title"}),i("i",{staticClass:"sjky close-icon",on:{click:function(t){return e.hideImageEditPage()}}},[e._v("")])]),i("div",{staticClass:"sjky-design-img",attrs:{id:"modelPreviewShow"}},[i("div",{staticClass:"sjky-modal-preview"},[i("img",{attrs:{src:e.previewImageUrl},on:{load:e.reloadCom,error:e.handleImageLoaded}}),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showNum,expression:"showNum"}],staticClass:"sjky-btn-grey sjky-btn-grey3 sjky-page-site",attrs:{href:"javascript:void(0);"}},[e._v(e._s(e.imageIndex+1)+" / "+e._s(e.previewImageUrlArr.length))]),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showReload,expression:"showReload"}],staticClass:"sjky-btn-grey sjky-btn-grey3 sjky-page-site",attrs:{href:"javascript:void(0);"},on:{click:e.reloadPic}},[e._v("点击重新加载")])]),i("i",{directives:[{name:"show",rawName:"v-show",value:e.prevImage,expression:"prevImage"}],staticClass:"sjky sjky-preview-btn sjky-btn-left",attrs:{id:"left",title:"上一页"},on:{click:function(t){return e.findImageByIndex(-1)}}},[e._v("")]),i("i",{directives:[{name:"show",rawName:"v-show",value:e.nextImage,expression:"nextImage"}],staticClass:"sjky sjky-preview-btn sjky-btn-right",attrs:{id:"right",title:"下一页"},on:{click:function(t){return e.findImageByIndex(1)}}},[e._v("")])]),e.isTeamBook?e._e():i("a",{staticClass:"btn-circle-theme",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design()}}},[e._v("上传图片("+e._s(e.minnum)+"-"+e._s(e.maxnum)+")")]),e.isTeamBook?i("div",{staticClass:"TeamBookShow preview-btn-group"},[i("div",{staticClass:"btn-circle-theme",staticStyle:{width:"40%",float:"left"}},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.showPartner()}}},[e._v("给小伙伴看看")])]),i("div",{staticClass:"btn-circle-theme",staticStyle:{width:"40%",float:"right"}},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design()}}},[e._v("就它了")])])]):e._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design loadingBook"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v(e._s(e.wenanText))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.changeSelectDate,expression:"changeSelectDate"}],staticClass:"teasingdate "},[i("i",{staticClass:"sjky icon-date",on:{click:function(t){return e.changeChoosDate()}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.changeDateShow,expression:"changeDateShow"}],staticClass:"bgout"},[i("a",{staticClass:"close clender_close",on:{click:function(t){return e.closeDate()}}}),i("div",{staticClass:"bg",on:{click:function(t){return e.changeChoosDate()}}},[e._v("当前选中:"+e._s(e.chooseDateNow))]),i("div",{staticClass:"bg_bottom animation"}),i("div",{staticClass:"bg_bottom2 animation2 "})])])],1)},Gi=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sjk-top"},[i("span",{staticClass:"pop-title"},[e._v("\n\t\t\t   选择台历的起始年份\n\t\t\t ")])])}],zi=a("87ab"),Hi=zi["a"],Vi=(a("aaa1"),Object(b["a"])(Hi,qi,Gi,!1,null,null,null)),Yi=Vi.exports,Xi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"goodsinfo"},[i("body",[i("header",{staticClass:"bar bar-nav"},[i("a",{staticClass:"icon icon-back l",attrs:{href:"javascript:history.go(-1)"}}),"fxxt"!=e.source?i("h2",{staticClass:"title-left"},[e._v("订单号："+e._s(e.orderNo))]):e._e(),"fxxt"==e.source?i("h2",{staticClass:"title-left"},[e._v("订单号："+e._s(e.sheetCode))]):e._e()]),i("article",{staticClass:"page"},[i("section",{staticClass:"content cardSpace"},[e._m(0),e.isDesignOk?i("figure",{staticClass:"proList"},[i("div",{staticClass:"imgBox pr"},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design(e.order)}}},[""!=e.order.previewimage?i("img",{staticClass:"w pr",attrs:{src:e.baseUrl+e.order.previewimage}}):e._e(),""==e.order.previewimage?i("img",{staticClass:"w pr",attrs:{src:a("8793")}}):e._e()]),e._m(1),i("a",{staticClass:"pa proTip w wh tc",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.design(e.order)}}},[e._v("快速设计")])]),i("figcaption",[e._v(e._s(e.order.name))])]):e._e(),e.isDesignOk?e._e():i("figure",{staticClass:"proList"},[e._m(2),i("figcaption")])])])])])},Qi=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h3",{staticClass:"fGreen f34 proListTit"},[e._v("订单详情\n\t\t\t       \t\t\t"),i("span",{staticClass:"r"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"protext pa ng-scope"},[e._v("\n\t\t\t       \t\t\t\t\t\t总数量"),i("span",{staticClass:"red f38 fb pl5 pr5"},[e._v("1")]),e._v("本\n\t\t\t       \t\t\t\t\t")])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"imgBox pr"},[i("a",{attrs:{href:"javascript:void(0);"}},[i("img",{staticClass:"w pr",attrs:{src:"img/nogoods.png"}})]),i("div",{staticClass:"protext pa ng-scope"},[e._v("\n\t\t\t       \t\t\t\t\t\t总数量"),i("span",{staticClass:"red f38 fb pl5 pr5"},[e._v("1")]),e._v("本\n\t\t\t       \t\t\t\t\t")]),i("a",{staticClass:"pa proTip w wh tc",staticStyle:{background:"#f4a491"},attrs:{href:"javascript:void(0)"}},[e._v("不可定制，请联系客服")])])}],Zi={name:"goodsinfo",data:function(){return{token:"",sku:"",orderNo:"",source:"",name:"",memberid:"",baseUrl:J["a"].baseUrl,redirecType:"",sheetCode:"",wxSkuStr:"",pageKey:null,isDesignOk:!1,iscaiyun:0,order:{}}},created:function(){this.token=this.$route.query.token,this.pageKey=ee["a"],""!=this.token&&null!=this.token&&void 0!=this.token?(localStorage.setItem(this.pageKey.token,this.token),this.getTokenDetail(this.token)):(this.sku=Object(H["M"])("sku"),this.orderNo=Object(H["M"])("orderNo"),this.source=Object(H["M"])("source"),this.redirecType=Object(H["M"])("redirecType"),this.sheetCode=Object(H["M"])("sheetCode"),this.wxSkuStr=localStorage.getItem(this.pageKey.wxSku)),""!=this.source&&null!=this.source&&void 0!=this.source&&"undefined"!=this.source||(this.source="third"),localStorage.setItem(this.pageKey.source,this.source)},mounted:function(){},methods:{getTokenDetail:function(e){var t=this;Object(H["L"])(e).then(function(e){if(e.result){var i=e.data.tradenum.mshopSign;localStorage.setItem(t.pageKey.mshopSign,i),1==i&&(t.sku=e.data.tradenum.content.sku,t.memberid=e.data.unionid,t.orderNo=e.data.tradenum.content.orderNo,t.redirectUrl=e.data.tradenum.content.redirectUrl,localStorage.setItem(t.pageKey.thirdDatil,JSON.stringify(e.data.tradenum))),2==i?(t.iscaiyun=1,t.sku=e.data.tradenum.content.sku,t.memberid=e.data.unionid,t.orderNo=e.data.tradenum.content.orderNo,t.redirectUrl=e.data.tradenum.content.redirectUrl,localStorage.setItem(t.pageKey.thirdDatil,JSON.stringify(e.data.tradenum))):i||(t.sku=e.data.tradenum.sku,t.memberid=e.data.memberid,t.orderNo=e.data.tradenum.orderNo,t.thirdGoodsCode=e.data.tradenum.thirdGoodsCode,t.appNo=e.data.tradenum.appNo,t.redirectUrl=e.data.tradenum.redirectUrl,localStorage.setItem(t.pageKey.thirdDatil,JSON.stringify(e.data.tradenum))),t.getlist(t.sku)}})},getlist:function(e){var t=this;Object(H["G"])(e).then(function(e){1!=e.result?t.isDesignOk=!1:(t.isDesignOk=!0,t.order=e.data,t.name=e.data.name),console.log(e)})},design:function(e){localStorage.setItem(this.pageKey.orderSource,this.source),localStorage.setItem(this.pageKey.source,this.source),localStorage.setItem(this.pageKey.redirecType,this.redirecType),this.designtwo(e)},designtwo:function(e){var t={orderNo:e.orderNo,productNo:e.sku,goodsname:e.name,num:1,shopName:"mr",memberid:this.memberid,source:"third"};this.$store.dispatch("updateOrderInfo",t),localStorage.setItem(this.pageKey.orderInfo,JSON.stringify(t)),this.totemplate()},totemplate:function(){this.$router.push({name:"mtemplate",query:{sku:this.sku,token:this.token,iscaiyun:this.iscaiyun}})}},computed:{}},ea=Zi,ta=Object(b["a"])(ea,Xi,Qi,!1,null,null,null),ia=ta.exports,aa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"whole",attrs:{id:"d-whole"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showlog,expression:"showlog"}],staticClass:"cd-popup3"},[i("div",{staticClass:"cd-popup-container3"},[i("div",{staticClass:"upPhotoc upPhotoCon"},[i("h3",[e._v("添加照片")]),i("a",{staticClass:"bgred",attrs:{href:"#"},on:{click:e.goUploadCaiyun}},[e._v("和彩云网盘")]),i("a",{staticClass:"bgwhite",attrs:{href:"#"},on:{click:e.goUploadLocal}},[e._v("手机本地上传")])])])]),i("div",{staticClass:"checkAll",attrs:{id:"d-top"}},[i("div",{staticClass:"weui-cells  weui-cells_checkbox"},[i("label",{staticClass:"weui-cell weui-cell_active weui-check__label"},[i("div",{staticClass:"weui-cell__hd"},[i("input",{staticClass:"weui-check weui-check_top",attrs:{type:"checkbox"},on:{click:function(t){return e.checkAllBox()}}}),i("i",{staticClass:"weui-icon-checked"})]),i("div",{staticClass:"weui-cell__bd"},[i("p",[e._v("全选("+e._s(e.checkNum)+")")])])])])]),i("div",{staticClass:"imgCaiyun",attrs:{id:"imgCaiyuna"}},e._l(e.caiYunList,function(t){return i("div",{staticClass:"imgBg"},[i("img",{attrs:{src:t.src,id:t.contentID,picname:t.contentName}}),i("div",{staticClass:"weui-cells weui-cellsP weui-cells_checkbox"},[i("label",{staticClass:"weui-cell weui-cell_active weui-check__label"},[i("div",{staticClass:"weui-cell__hd"},[i("input",{staticClass:"weui-check weui-checkIn",attrs:{type:"checkbox",name:"checkbox1",id:t.contentID,picname:t.contentName},on:{change:e.changeEvent}}),i("i",{staticClass:"weui-icon-checked"})])])])])}),0),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design loadingBook"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v(e._s(e.wenanText))])]),i("div",{staticClass:"subBtn"},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:e.savePicture}},[e._v("提交")])]),e._m(0)])},oa=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-loadmore",staticStyle:{opacity:".4",display:"none"}},[i("i",{staticClass:"weui-loading"}),i("span",{staticClass:"weui-loadmore__tips",attrs:{id:"list"}},[e._v("正在加载")])])}],sa={name:"upphoto",data:function(){return{showlog:!0,checkNum:0,checkAll:!0,isSubmit:!1,s3flag:!1,commonUpload:!1,isTeamBook:!1,isShowLoading:!1,wenanText:"",photo:[],p:"",id:"",maxNum:0,msisdn:"",startNum:1,endNum:10,pageSize:5,finish:0,normalKey:"",pageKey:"",hcyToken:"",caiYunList:[],photolist:[]}},components:{},created:function(){$(function(){$(".imgBg img").lazyload({effect:"fadeIn",placeholder:"@/assets/img/lg.gif"})}),this.id=this.$route.query.id,this.p=this.$route.query.p,this.isTeamBook=this.$route.query.isTeamBook,this.normalKey=ee["f"],this.pageKey=ee["a"];var e=localStorage.getItem(this.pageKey.thirdDatil);this.maxNum=localStorage.getItem(this.pageKey.maxnum),this.getS3UpConfig(),e&&(this.msisdn=JSON.parse(e).content.account,this.hcyToken=JSON.parse(e).content.hcyToken)},mounted:function(){window.addEventListener("scroll",this.handleScroll,!0)},methods:{showDalog:function(){this.showDalog=!0},goUploadCaiyun:function(){$(".cd-popup3").hide(),this.getPictureList(this.msisdn)},goUploadLocal:function(){var e={id:this.id,p:this.p,isTeamBook:this.isTeamBook,isfirst:!0};this.goUpload(e)},goUpload:function(e){this.$router.push({name:"upload",query:e})},checkAllBox:function(){if(this.checkNum=0,this.checkAll){for(var e=$(".weui-checkIn"),t=0;t<e.length;t++)this.checkNum++,e[t].checked=!0;this.checkAll=!1}else{for(e=$(".weui-checkIn"),t=0;t<e.length;t++)this.checkNumm--,e[t].checked=!1;this.checkAll=!0}},changeEvent:function(e){this.checkNum;if(this.checkAll=!0,0==e.currentTarget.checked)this.checkNum--,$(".weui-check_top")[0].checked=!1;else{this.checkNum++;for(var t=$(".weui-checkIn"),i=0;i<t.length;i++){if(0==t[i].checked){$(".weui-check_top")[0].checked=!1;break}$(".weui-check_top")[0].checked=!0}}},getPictureList:function(e){var t=this;Object(H["D"])(e,this.startNum,this.endNum,this.hcyToken).then(function(e){if(e.result&&(t.finish=e.data.finish,void 0!=t.finish))if(0==e.data.picList.length);else{for(var i=0;i<e.data.picList.length;i++)e.data.picList[i].contentID&&e.data.picList[i].src&&t.photo.push(e.data.picList[i]);t.caiYunList=t.photo}})},savePicture:function(){for(var e=this,t=[],i=$(".weui-checkIn"),a=localStorage.getItem(this.pageKey.token),o=0;o<i.length;o++)if(i[o].checked){var s={};s.id=i[o].id,s.name=$(i[o]).attr("picname"),t.push(s),console.log(s)}if(t.length>this.maxNum)layer.alert("最多只能选择"+this.maxNum+"张照片");else if(this.isSubmit)layer.alert("正在提交，请稍候！");else if(this.isSubmit=!0,t.length>0){var n={};n.contentIDList=t,n.MSISDN=this.msisdn,n.token=a,n.hcyToken=this.hcyToken,n.s3flag=this.s3flag,n.commonUpload=this.commonUpload,localStorage.setItem(this.pageKey.caiyunContent,JSON.stringify(n)),layer.confirm("您选中"+t.length+"张照片，确定要提交吗",{btn:["确定","取消"]},function(t){var i={id:e.id,p:e.p,isTeamBook:e.isTeamBook,isfirst:!0,caiyun:"1"};e.goUpload(i),layer.close(t)},function(){localStorage.removeItem(e.pageKey.caiyunContent),e.isSubmit=!1})}else layer.confirm("您还没有选中照片，确定要提交吗",{btn:["确定","取消"]},function(t){var i={id:e.id,p:e.p,isTeamBook:e.isTeamBook,isfirst:!0,caiyun:"1"};e.goUpload(i),layer.close(t)},function(){e.isSubmit=!1})},handleScroll:function(){if(1==this.finish||void 0==this.finish);else{this.checkAll=!0,$(".weui-check_top")[0].checked=!1;var e=document.getElementById("imgCaiyuna").scrollHeight,t=document.getElementById("imgCaiyuna").scrollTop,i=document.getElementById("imgCaiyuna").offsetHeight;t+i==e&&(this.startNum=this.endNum+1,this.endNum=this.endNum+this.pageSize,this.getPictureList(this.msisdn))}},getS3UpConfig:function(){var e=this;Object(H["H"])().then(function(t){t.result&&(e.s3flag=t.data.s3flag)})},getCommonUploadConfig:function(){var t=this,i=localStorage.getItem(this.pageKey.token);try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo),o="调用newgetCommonUploadConfig的token===="+i;window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","newgetCommonUploadConfig和彩云上传",o,JSON.parse(a).orderNo])}}catch(e){}Object(H["n"])(i).then(function(e){e.result&&(t.commonUpload=e.data.commonUpload)})}},computed:{},watch:{},destroyed:function(){window.removeEventListener("scroll",this.handleScroll,!0)}},na=sa,ra=(a("7b46"),Object(b["a"])(na,aa,oa,!1,null,"889a2f6a",null)),la=ra.exports,da=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},ca=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("body",{staticClass:"body-bg"},[i("section",[i("div",{staticClass:"weui-cells"},[i("a",{staticClass:"weui-cell weui-cell_access",attrs:{href:"preview-submit.html"}},[i("div",{staticClass:"weui-cell__bd"},[i("p",{staticClass:"sjky-txt-color"},[e._v("1本"),i("br"),i("span",{staticClass:"sjky-num-time"},[e._v("2019.08.27  11:25:02")])])]),i("div",{staticClass:"weui-cell__ft"})]),i("a",{staticClass:"weui-cell weui-cell_access",attrs:{href:"preview-submit.html"}},[i("div",{staticClass:"weui-cell__bd"},[i("p",{staticClass:"sjky-txt-color"},[e._v("2本"),i("br"),i("span",{staticClass:"sjky-num-time"},[e._v("2019.08.27  11:25:02")])])]),i("div",{staticClass:"weui-cell__ft"})])])])])}],ha={name:"list1",data:function(){return{}},created:function(){},methods:{}},ga=ha,ma=Object(b["a"])(ga,da,ca,!1,null,null,null),pa=ma.exports,fa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("base-upload",{attrs:{storageName:e.storageName,pageKey:e.pageKey,submitButtonName:e.submitButtonName,server:e.server,checksubmitstate:e.checksubmitstate,isTaoBan:!0,minPageNum:e.minPageNum,maxPageNum:e.maxPageNum},on:{baseUploadNextStep:e.nextStep}}),i("div",{staticClass:"op_style",staticStyle:{display:"none"},attrs:{id:"op_rlayer"}},[i("div",{staticClass:"text_area ng-scope"},[i("p",[i("label",[e._v("作品名")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],attrs:{type:"text",id:"diyname",placeholder:"请输入作品名",maxlength:"20"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),i("p",[i("label",[e._v("数    量")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.num,expression:"num"}],attrs:{type:"number",id:"num",placeholder:"请输入数量",maxlength:"4"},domProps:{value:e.num},on:{input:function(t){t.target.composing||(e.num=t.target.value)}}})])]),i("div",{staticClass:"btn_box"},[i("div",{staticClass:"l_btn",on:{click:e.hideConfirm}},[i("i",{staticClass:"btn_back"}),e._v("返回")]),i("div",{staticClass:"r_btn",on:{click:function(t){return e.enterSaveTaoban()}}},[e._v("确认")])])])],1)},ya=[],_a={name:"taobanupload",components:{BaseUpload:He},data:function(){return{orderInfo:null,safe:!0,name:"",num:null,storageName:null,submitButtonName:"提交",pageKey:null,server:{upload:J["a"].taobanUrl+"/tbdiy/uploade/addProclateImg.do",uploadData:{},delete:J["a"].taobanUrl+"/tbdiy/uploade/deleteImg.do",baseUrl:J["a"].taobanUrl},returnURL:"",minPageNum:0,maxPageNum:0,imgUrl:J["a"].taobanUrl+"/tbdiy/uploade/queryTbImages.do",findTaobanUrl:J["a"].taobanUrl+"/find_book3_taoban.do",saveTaobanUrl:J["a"].taobanUrl+"/tbdiy/saveTaoban.do",doPageNumCheckUrl:J["a"].taobanUrl+"/tbdiy/uploade/doPageNumCheck.do",findTaobanPicnumUrl:J["a"].taobanUrl+"/tooldiy/find_taoban_picnum.do",checksubmitstate:!0}},created:function(){this.pageKey=ee["a"],this.storageName=this.pageKey.taobanTemp,this.createBaseUpload()},mounted:function(){},methods:{createBaseUpload:function(){showModal("#taoban-show");var e=this,t=null;if(this.orderInfo=t,null==t||"null"==t||null==t.sku){var i=this.$route.query.orderNo,a=this.$route.query.orderId,o=this.$route.query.sku,s=this.$route.query.spmc,n=this.$route.query.remainNum,r=this.$route.query.shopName,l=this.$route.query.memberid,d=this.$route.query.attrs;this.orderInfo={orderNo:i,orderId:a,sku:o,goodsname:s,remainNum:n,picnum:0,shopName:r,memberid:l,spmc:s,attrs:d},t=this.orderInfo,localStorage.removeItem(this.storageName),localStorage.removeItem(this.pageKey.imageArray),localStorage.removeItem(this.pageKey.imageList),localStorage.setItem(this.pageKey.orderInfo,JSON.stringify(t))}this.$route.query.flagURL;this.returnURL=this.$route.query.returnURL,this.returnURL=this.returnURL+"/photo/list.do?orderNo="+t.orderNo+"&terminal=1",console.log(this.returnURL);var c=0;0==this.orderInfo.picnum&&$.ajax({url:this.findTaobanPicnumUrl+"?sku="+t.sku,type:"get",async:!1,success:function(t){t.result?e.orderInfo.picnum=parseInt(t.data):(e.$layer.alert("产品不支持套版，请返回自主设计"),e.jump(c,e.returnURL))}});var h=encodeURI(t.memberid,"utf-8");$.ajax({url:e.findTaobanUrl+"?memberid="+h+"&orderId="+this.orderInfo.orderId+"&orderNo="+t.orderNo,type:"get",async:!1,success:function(t){if(console.log(t),e.orderInfo.thirdOrderNo=t.thirdOrderNo,e.orderInfo.width=t.width,e.orderInfo.height=t.height,null!=t.imgUploadedList&&t.imgUploadedList.length>0){for(var i=0;i<t.imgUploadedList.length;i++){var a=t.imgUploadedList[i];a.index="0"+i,null!=a.url&&void 0!=a.url||(a.url=a.destimgname),null!=a.url&&void 0!=a.url||(a.url=a.destimgname),a.src=e.imgUrl+"?filePath="+a.url,null!=a.pixellow&&void 0!=a.pixellow||(a.pixellow=parseInt(a.state)),a.name=a.sourceimgname}localStorage.setItem(e.storageName,JSON.stringify(t.imgUploadedList))}}}),this.server.uploadData={goodsId:this.orderInfo.orderId,orderNo:this.orderInfo.orderNo,shopName:this.orderInfo.shopName,sku:this.orderInfo.sku,spmc:this.orderInfo.spmc,width:this.orderInfo.width,height:this.orderInfo.height,memberid:this.orderInfo.memberid,thirdOrderNo:this.orderInfo.thirdOrderNo,pageNum:this.orderInfo.picnum},this.minPageNum=this.orderInfo.picnum,this.maxPageNum=this.orderInfo.picnum},jump:function(e,t){location.href=t},nextStep:function(e,t,i){$(".op_style").show(),$("#op_rlayer").addClass("r_action")},checkalredystate:function(e,t){var i,a=!1;return $.ajax((i={url:this.doPageNumCheckUrl,type:"post",async:!1,data:{thirdOrderNo:this.orderInfo.thirdOrderNo,sku:this.orderInfo.sku}},Object(L["a"])(i,"async",!1),Object(L["a"])(i,"cache",!1),Object(L["a"])(i,"success",function(e){a=!(e.pageCode>0)}),i)),a},enterSaveTaoban:function(){var t=this,i=this.num,a=this.name;if(this.hideConfirm(),!this.safe){try{if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","您点的太快了，请稍等一会儿哦",JSON.parse(o).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","您点的太快了，请稍等一会儿哦",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("您点的太快了，请稍等一会儿哦"),!1}var s=!0,n=localStorage.getItem(storageName);null!=n&&"null"!=n&&(n=JSON.parse(n),$.each(n,function(e,t){1==parseInt(t.pixellow)&&(s=!1)}));var r=this.orderInfo.remainNum;if(""==a){try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","亲，请填写作品名称",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return alert("亲，请填写作品名称。"),!1}if(this.getStrLength(a)>50){try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","亲，请起一个简短易记的名字吧。",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return alert("亲，请起一个简短易记的名字吧。"),!1}var l=/[^a-z|A-Z|0-9|\-|_|\u4e00-\u9fa5]/g;if(l.test(a)){try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","作品名称包含汉字、数字、字母、下划线和中划线，其它不支持。",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return alert("作品名称包含汉字、数字、字母、下划线和中划线，其它不支持。"),!1}if(""==i){try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","亲，请输入数量。",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("亲，请输入数量。"),!1}var d=/^[1-9]\d*$/;if(!d.test(i)){try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","亲，请输入大于0的整数。",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("亲，请输入大于0的整数。"),!1}if(parseInt(i)>parseInt(r)){try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","亲，您制作的太多了，超过"+r+"本。",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("亲，您制作的太多了，超过"+r+"本。"),!1}if(s)if(this.checkalredystate()){if(parseInt(i)>1){var c="您确认"+i+"本按照相同照片套版吗？点确定将生产"+i+"本，点击取消可重新填写！";t=this;this.$layer.confirm(c,{btn:["确定","取消"],title:"提示"},function(){h(),t.$layer.close(index)})}else h();this.safe=!0}else{try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","上传数量与所需的数量不符合",JSON.parse(o).orderNo])}}catch(e){console.log(e)}this.$layer.alert("上传数量与所需的数量不符合")}else{try{if(window._jylog){o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","套版上传","提示","亲，请先删除像素不足的照片哦！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}this.$layer.alert("亲，请先删除像素不足的照片哦！")}function h(){window._czc&&window._czc.push(["_trackEvent","剪影","套版页面","提交保存"]);var e={ww:t.orderInfo.memberid,num:i,shopName:t.orderInfo.shopName,orderId:t.orderInfo.orderId,orderNo:t.orderInfo.orderNo,sku:t.orderInfo.sku,memberid:t.orderInfo.memberid,spmc:t.orderInfo.spmc,attrs:t.orderInfo.attrs,thirdOrderNo:t.orderInfo.thirdOrderNo,name:encodeURI(a,"utf-8"),mobile:"true"};$.ajax({url:t.saveTaobanUrl,type:"post",data:e,success:function(e){var i=e;"true"==i.Success?(t.$layer.msg("操作成功",{icon:1}),localStorage.removeItem(t.storageName),localStorage.removeItem(t.pageKey.orderInfo),setTimeout(function(){t.jump(0,t.returnURL)},2e3)):(t.$layer.msg(i.errorMsg,{icon:2}),t.safe=!0)},error:function(){t.safe=!0,t.$layer.alert("服务器异常,请稍后重试。")}})}},hideConfirm:function(){$(".op_style").hide(),$("#op_rlayer").removeClass("r_action")},getStrLength:function(e){for(var t=e.length,i=0,a=0;a<t;a++)0!=(65280&e.charCodeAt(a))&&i++,i++;return i}}},va=_a,wa=Object(b["a"])(va,fa,ya,!1,null,null,null),ba=wa.exports,Ia=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"video_box"},[i("video",{ref:"videoPlayer",staticClass:"video-js vjs-fluid"},[e._v('\n        type="video/mp4"\n      />\n    ')])])},Sa=[],xa={name:"player",data:function(){return{player:null,number:"",pwd:""}},created:function(){this.number=this.$route.query.number},mounted:function(){var e=this,t={controls:!0,preload:"auto",autoplay:"muted",width:"640",height:"247",controlBar:{children:[{name:"playToggle"},{name:"progressControl"},{name:"currentTimeDisplay"},{name:"timeDivider"},{name:"durationDisplay"},{name:"volumePanel",inline:!1},{name:"pictureInPictureToggle"},{name:"fullscreenToggle"}]}},i=this.$route.query.uuid;this.player=this.$video(this.$refs.videoPlayer,t,function(){console.log("onPlayerReady",this)});var a=this;Object(H["O"])({id:i}).then(function(t){if(t.data.haspassword)e.$layer.open({content:'请输入密码:<input id="psw" type="password" />',btn:["确认","取消"],yes:function(e,t){console.log($("#psw").val()),Object(H["O"])({id:i,password:$("#psw").val()}).then(function(t){if(!t.data.errorpassword){var i={src:J["a"].baseUrl2+t.data.path};a.player.pause(),a.player.src(i),a.player.load(i),a.player.play(),a.$layer.close(e)}})},cancel:function(){}});else{var o={src:J["a"].baseUrl2+t.data.path};e.player.pause(),e.player.src(o),e.player.load(o),e.player.play()}})},beforeDestroy:function(){this.player&&this.player.dispose()},methods:{}},ka=xa,Oa=(a("2380"),Object(b["a"])(ka,Ia,Sa,!1,null,null,null)),La=Oa.exports,Ta=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ground-style"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[i("canvas",{staticClass:"hideCanvas",staticStyle:{border:"1px solid #000000"},attrs:{id:"screenShot"}})]),i("div",{staticClass:"coor-inf"},[i("van-image",{attrs:{fit:"cover",src:e.name.srcImg}}),i("div",{staticClass:"related-inf"},[i("div",{staticClass:"user"},[e._v(e._s(e.name.albumname))]),i("div",{staticClass:"item-inf"},[e._v("\n                    已做："),i("strong",[e._v(e._s(e.count.finish))]),e._v("\n                    进行中："),i("strong",[e._v(e._s(e.count.now))]),e._v("\n                    剩余："),i("strong",[e._v(e._s(e.count.remain))])]),i("div",{staticClass:"time"},[e._v(e._s(e.name.albumtime))])]),i("div",{staticClass:"coor-btn-action"},[i("van-button",{attrs:{plain:"",hairline:"",round:"",type:"primary",size:"small",color:"#00BCD4"},on:{click:e.previewModelPage}},[e._v("查看模板")]),i("van-button",{attrs:{plain:"",hairline:"",round:"",type:"primary",size:"small",color:"#00BCD4"},on:{click:e.invitePage}},[e._v("邀请协作")])],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:0==e.count.finish,expression:"count.finish==0"}],staticClass:"no-cover"},[i("van-image",{attrs:{fit:"cover",src:e.coverImageUrl,width:"70px"}}),e._m(0)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.count.finish,expression:"count.finish!=0"}],staticClass:"has-cover sjky-design-area2",attrs:{id:"drawing"}}),i("div",{staticClass:"btn-action"},[i("div",{staticClass:"fill-btn",on:{click:e.showNote}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"fankui"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("个人备注")])],1),0==e.count.remain||1!=e.cooperater&&2!=e.cooperater?e._e():i("div",{staticClass:"fill-btn",on:{click:function(t){return e.creatPage()}}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"upload"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("创建页面")])],1),0==e.cooperater?i("div",{staticClass:"line-btn",on:{click:function(t){return e.createAlbum()}}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"create"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("创建相册")])],1):e._e(),0==e.cooperater&&0!=e.count.remain?i("div",{staticClass:"fill-btn",on:{click:e.joinTeam}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"team"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("加入协作")])],1):e._e(),2==e.cooperater&&0==e.count.remain?i("div",{staticClass:"line-btn",on:{click:e.editPage}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"edit"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("编辑")])],1):e._e(),2==e.cooperater&&0==e.count.remain?i("div",{staticClass:"fill-btn",on:{click:e.submitPage}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"submit"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("提交")])],1):e._e(),2!=e.cooperater&&0==e.count.remain?i("div",{staticClass:"line-btn",on:{click:function(t){return e.previewPage()}}},[i("van-icon",{attrs:{slot:"icon","class-prefix":"cloud-icon",name:"preview"},slot:"icon"}),i("div",{staticClass:"title"},[e._v("预览")])],1):e._e()]),i("van-popup",{staticClass:"design-pattern-style",attrs:{closeable:"",position:"bottom"},model:{value:e.show1,callback:function(t){e.show1=t},expression:"show1"}},[i("div",{staticClass:"popbox-header"},[e._v("请选择设计模式")]),i("ul",{staticClass:"popbox-body select-mode"},[i("li",{on:{click:function(t){e.changeStatus(0,0),e.selectMode()}}},[i("h3",[e._v("经典模式")]),i("p",[e._v("智能组合形成布局")]),i("van-radio-group",{model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[i("van-radio",{attrs:{name:"1","checked-color":"#07c160"}})],1)],1),i("li",{on:{click:function(t){e.changeStatus(1,1),e.herfTo()}}},[i("h3",[e._v("尝鲜模式")]),i("p",[e._v("选择页面填充照片")]),i("van-radio-group",{model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[i("van-radio",{attrs:{name:"2","checked-color":"#07c160"}})],1)],1)])]),i("van-popup",{staticClass:"popbox-input-style",attrs:{round:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[i("div",{staticClass:"popbox-header"},[e._v("确认页数")]),i("div",{staticClass:"popbox-body"},[i("van-field",{attrs:{type:"digit",placeholder:"请输入您要的整数"},model:{value:e.p,callback:function(t){e.p=t},expression:"p"}})],1),i("div",{staticClass:"popbox-footer popbox-footer-inline"},[i("van-button",{attrs:{hairline:"",round:"",type:"primary",size:"small",color:"#00BCD4"},on:{click:e.uploadPage}},[e._v("确认")]),i("van-button",{attrs:{plain:"",hairline:"",round:"",type:"primary",size:"small",color:"#00BCD4"},on:{click:e.cancelCreat}},[e._v("取消")])],1)]),i("van-popup",{staticClass:"popbox-input-style",attrs:{round:""},model:{value:e.noteShow,callback:function(t){e.noteShow=t},expression:"noteShow"}},[i("div",{staticClass:"popbox-header"},[e._v("修改名称")]),i("div",{staticClass:"popbox-body"},[i("van-field",{attrs:{placeholder:"请输入您的昵称"},model:{value:e.editname,callback:function(t){e.editname=t},expression:"editname"}})],1),i("div",{staticClass:"popbox-footer popbox-footer-inline"},[i("van-button",{attrs:{hairline:"",round:"",type:"primary",size:"small",color:"#00BCD4"},on:{click:e.editNote}},[e._v("确认")]),i("van-button",{attrs:{plain:"",hairline:"",round:"",type:"primary",size:"small",color:"#00BCD4"},on:{click:e.cancelNote}},[e._v("取消")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v("加载中")])])],1)},Ca=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",{staticStyle:{"margin-top":"0.225rem"}},[e._v("\n                相册已经建好了~"),i("br"),e._v("\n                快去邀请小伙伴一起制作吧\n            ")])}],Pa=(a("96cf"),a("3b8d")),ja=(a("e17f"),a("2241")),Aa=(a("4ddd"),a("9f14")),Na=(a("a44c"),a("e27c")),Ea=(a("a909"),a("3acc")),Ja=(a("3c32"),a("417e")),Da=(a("e7e5"),a("d399")),Ba=(a("be7f"),a("565f")),Ka=(a("8a58"),a("e41f")),Ma=(a("4056"),a("44bf")),$a=(a("a56f"),a("d80f")),Ua=(a("5ad2"),a("473b")),Wa=(a("611c"),a("999a")),Fa=a("9621"),Ra=a("738b"),qa=(a("1dab"),a("a28f")),Ga=a("e4b8"),za=a("4ba4"),Ha=a("66a2"),Va=a("a244");function Ya(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function Xa(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ya(i,!0).forEach(function(t){Object(L["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ya(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var Qa={name:"ground",components:(Ei={},Object(L["a"])(Ei,n["a"].name,n["a"]),Object(L["a"])(Ei,Ma["a"].name,Ma["a"]),Object(L["a"])(Ei,d["a"].name,d["a"]),Object(L["a"])(Ei,Ka["a"].name,Ka["a"]),Object(L["a"])(Ei,Ba["a"].name,Ba["a"]),Object(L["a"])(Ei,Da["a"].name,Da["a"]),Object(L["a"])(Ei,Ja["a"].name,Ja["a"]),Object(L["a"])(Ei,Ea["a"].name,Ea["a"]),Object(L["a"])(Ei,Na["a"].name,Na["a"]),Object(L["a"])(Ei,Aa["a"].name,Aa["a"]),Ei),data:function(){return{checked:!0,radio:"1",changeActive:0,uid:"",show:!1,show1:!1,player:null,number:"",editname:"",browser:{},userToken:"",isShowLoading:!0,pwd:"",p:null,cooperater:0,openid:"",is_weixn:!1,expect:1,timer:null,normalKey:ee["f"],pageOrderBottomSpace:30,coverImageUrl:a("ba75"),name:{albumname:"",albumtime:"",srcImg:""},count:{total:0,finish:0,now:0,remain:0,own:0},pageKey:null,noteShow:!1,screenShotCanvas:null,page0_preveiwImg:null,changScreenImgSuccess:!1,wenanText:"努力加载中"}},created:function(){var e=this;this.$store.dispatch("getFontCss"),this.uid=this.$route.query.uid,this.openid=this.$route.query.openid,this.imgUrl=this.$route.query.imgUrl,this.nickName=this.$route.query.nickName;var t=this.$route.query.token;t&&localStorage.setItem(ee["f"].userToken,t);var i=this;if(this.timer=setInterval(function(){Object(H["W"])({uid:i.uid}).then(function(e){console.log(e),i.count.now=e.data})},1e4),Object(H["V"])({uid:this.uid}).then(function(t){console.log(t),e.expect=t.data.num}),null!=this.openid?Object(H["Z"])({uid:this.uid,openid:this.openid,avatarurl:this.imgUrl,nickname:this.nickName,membertype:"taobao-xls-新零售"}).then(function(t){console.log(t),localStorage.setItem(ee["f"].userToken,t.data.token),e.cooperater=t.data.cooperater,e.createGround()}):Object(H["Z"])({uid:this.uid,token:localStorage.getItem(ee["f"].userToken)}).then(function(t){e.cooperater=t.data.cooperater,e.createGround()}),this.browser={versions:function(){var e=navigator.userAgent;navigator.appVersion;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile/i)||!!e.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1||e.indexOf("Mac")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},this.browser.versions.android){var a=navigator.userAgent.toLowerCase();"micromessenger"==a.match(/MicroMessenger/i)&&(this.is_weixn=!0)}},beforeDestroy:function(){clearInterval(this.timer),this.screenShotCanvas&&ae["a"].create("screenShot").remove("toDataURLComplete",this.screenShotComplete)},mounted:function(){document.title="如琢毕业册",ae["a"].create("screenShot").listen("toDataURLComplete",this.screenShotComplete),this.screenShotCanvas=new fabric.StaticCanvas("screenShot")},computed:Xa({},Object(E["b"])(["detailJson"])),watch:{detailJson:function(){this.initLauncher()}},methods:{createGround:function(){var e=this;for(var t in this.pageKey=ee["c"],this.pageKey)localStorage.removeItem(this.pageKey[t]);this.$route.query.token&&localStorage.setItem(ee["f"].userToken,this.$route.query.token),this.userToken=localStorage.getItem(ee["f"].userToken),localStorage.setItem(this.pageKey.token,this.userToken);var i={uid:this.uid,pageKey:this.pageKey,edittype:2,isTeamBook:!0,token:this.userToken},a=this;this.$store.dispatch("getJsonFun",i).then(function(e){var t=JSON.parse(e.data);a.$store.dispatch("getAllFontInfo").then(function(e){Object(V["c"])("#drawing",t,a,null,!0,!0)})}).catch(function(t){console.log(t),e.$layer.alert("模板数据加载失败")})},initLauncher:function(){this.count.own=0,this.count.finish=0,this.count.remain=0;var e=!0,t=!1,i=void 0;try{for(var a,o=this.detailJson.pageList[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var s=a.value;s.openid?(s.openid==this.openid&&this.count.own++,this.count.finish++):this.count.remain++}}catch(n){t=!0,i=n}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}this.count.total=this.detailJson.pageList.length,this.name.albumname=this.detailJson.albumname,this.name.albumtime=this.detailJson.albumtime,this.name.srcImg=this.detailJson.avatarurl,this.isShowLoading=!1},creatPage:function(){this.show1=!0},selectMode:function(){2==this.cooperater?this.show=!0:1==this.cooperater&&this.createSinglePage()},createSinglePage:function(){this.count.own>=this.getExpectNumber()?ja["a"].alert({title:"提醒",message:"只允许个人一共创建"+this.getExpectNumber()+"页"}):this.createPages(1)},createAlbum:function(){wx.miniProgram.reLaunch({url:"/pages/index/index?isFirst=false"})},uploadPage:function(){this.createPages(this.p)},cancelCreat:function(){this.show=!1,this.p=null},editNote:function(){var e=this;null!=this.editname&&void 0!=this.editname&&""!=this.editname&&Object(H["jb"])({uid:this.uid,token:this.userToken,nickname:this.editname}).then(function(t){var i=e;i.noteShow=!1,Da["a"].success({message:"修改成功",onClose:function(){window.location.reload()}})})},cancelNote:function(){this.noteShow=!1,this.editname=""},showNote:function(){this.noteShow=!0},previewPage:function(){this.$router.push({name:"preview",query:{uid:this.uid,isTeamBook:!0}})},previewModelPage:function(){this.$router.push({name:"previewModel",query:{id:this.detailJson.id,sku:this.detailJson.sku}})},invitePage:function(){var e=this;Object(H["Y"])({uid:this.uid}).then(function(t){wx.miniProgram.navigateTo({url:"/pages/share/share?workId="+e.detailJson.albumid+"&pages=pages/ground/ground&userName="+e.nickName+"&uid="+e.uid})})},submitPage:function(){var e=this.someCheck(),t=e.hitTextStr,i=e.isPassCheck;if(i){localStorage.setItem(this.pageKey.token,this.userToken),localStorage.setItem(this.pageKey.motherid,this.detailJson.templateInfo.mid),localStorage.setItem(this.pageKey.goodsid,this.detailJson.goodsid),localStorage.setItem(this.pageKey.pnum,this.detailJson.p);var a=this;if(""!=t)t+="的页面上文字有重叠，可能产生售后，请调整",this.$layer.confirm(t,{btn:["继续提交","返回修改"],cancel:function(e,t){}},function(e){var t="";a.detailJson.previewImage&&(t=a.detailJson.previewImage),this.$router.push({name:"preview",query:{uid:this.uid,history:!0,editType:2,isTeamBook:!0,submit:!0,fromDesign:!0,coverPreviewImage:t}}),a.$layer.close(e)},function(e){a.$layer.close(e)});else{var o="";a.detailJson.previewImage&&(o=a.detailJson.previewImage),this.$router.push({name:"preview",query:{uid:this.uid,history:!0,editType:2,isTeamBook:!0,submit:!0,fromDesign:!0,coverPreviewImage:o}})}}},editPage:function(){this.$router.push({name:"design",query:{uid:this.uid,history:!0,isTeamBook:!0}})},isDrawingPage:function(e){return e.nickname},joinTeam:function(){this.cooperater=1},getExpectNumber:function(){return 0==this.expect?1:this.count.total<this.expect?1:Math.floor(this.count.total/this.expect)},createPages:function(e,t){var i=this;e<=0||Object(H["X"])({uid:this.uid}).then(function(a){if(console.log(a),a.data.notdesignnum>=Number(e)+Number(i.count.now)){if(localStorage.removeItem(i.pageKey.detailJson),localStorage.setItem(i.pageKey.diytype,i.detailJson.diyType),localStorage.setItem(i.pageKey.productId,i.detailJson.productId),localStorage.setItem(i.pageKey.goodsid,i.detailJson.goodsid),localStorage.setItem(i.pageKey.calenderTemp,i.detailJson.calenderTemp),localStorage.setItem(i.pageKey.token,i.userToken),localStorage.setItem(i.pageKey.fold,i.detailJson.fold),localStorage.setItem(i.pageKey.motherid,i.detailJson.templateInfo.mid),localStorage.setItem(i.pageKey.rk,i.detailJson.rk),localStorage.setItem(i.pageKey.videonum,i.detailJson.pageList.length),localStorage.setItem(i.pageKey.isTeamBook,!0),localStorage.setItem(i.pageKey.uid,i.uid),localStorage.setItem(i.pageKey.orderInfo,JSON.stringify({productId:i.detailJson.sku})),localStorage.setItem(i.pageKey.pnum,e),localStorage.setItem(i.pageKey.isPart,!0),localStorage.setItem(i.pageKey.isVideo,i.detailJson.isVideo),localStorage.setItem(i.pageKey.source,"isTeamBook"),localStorage.setItem(i.pageKey.id,i.detailJson.id),2==i.cooperater)localStorage.setItem(i.pageKey.exceptCount,a.data.notdesignnum);else if(localStorage.setItem(i.pageKey.exceptCount,i.getExpectNumber()-i.count.own),i.getExpectNumber()-i.count.own==0){var o=i;return void Da["a"].fail({message:"您创建的足够多了，给别人点机会吧",onClose:function(){}})}if(t)return localStorage.setItem(i.pageKey.changxian,1),void i.$router.push({name:"groundModel",query:{uid:i.uid,history:!0,isTeamBook:!0}});localStorage.setItem(i.pageKey.changxian,0),i.is_weixn?location.href="fxUpload?id="+i.detailJson.id+"&p="+e+"&isTeamBook="+!0+"&isPart="+!0:i.$router.push({name:"upload",query:{id:i.detailJson.id,p:e,isTeamBook:!0,isPart:!0}})}else{o=i;Da["a"].fail({message:"您创建的足够多了，给别人点机会吧",onClose:function(){o.$router.go(0)}})}})},someCheck:function(){var e={isPassCheck:!0,hitTextStr:""},t=localStorage.getItem(this.pageKey.detailJson);if(""!=t&&null!=t&&void 0!=t){for(var i=JSON.parse(t).pageList,a="",o=0;o<i.length;o++){var s=i[o].content.itemList,n=JSON.stringify(s);-1!=n.indexOf("img/nophoto.jpg")&&(0==o?a=i[o].title+"、":a+=i[o].title+"、")}""!=a&&(a="页码为:"+a+"的页面上有相框未填充照片! ",1!=this.isPart&&"true"!=this.isPart||(a="页面上有相框未填充照片! "),this.$layer.alert(a),e.isPassCheck=!1)}if(2==JSON.parse(t).templateInfo.coverper&&JSON.parse(t).coverInfo.hascover&&"photo"==JSON.parse(t).diyType){var r=JSON.parse(t).pageList[0].diyWorkAreaWidth/JSON.parse(t).pageList[0].workAreaWidth,l=JSON.parse(t).pageList[0].content.itemList[0].location.x,d=(JSON.parse(t).pageList[0].content.itemList[0].location.y,JSON.parse(t).pageList[0].content.itemList[0].location.width),c=(JSON.parse(t).pageList[0].content.itemList[0].location.height,Ha["a"].bookSpace*r),h=d-Ha["a"].yignkeProductBleedSpace*r*2,g=localStorage.getItem(this.pageKey.rk);4==g&&(h=d-Ha["a"].rkBleedSpace*r*2,c=Ha["a"].rkBookSpace*r);var m=l+Ha["a"].yignkeProductBleedSpace*r+h/2-c/2;g=localStorage.getItem(this.pageKey.rk);4==g&&(m=l+Ha["a"].rkBleedSpace*r+h/2-c/2);var p=0,u=c,f=JSON.parse(t).pageList[0].diyDisplayHeight,y={left:m,top:p,width:u,height:f},_=JSON.parse(t).pageList[0].content.itemList,v=!1;for(var w in _){if(1==this.isPart||"true"==this.isPart)break;if((_[w].media.mediaType==$a["a"].TEXT||_[w].media.mediaType==$a["a"].IMAGE)&&"yes"==_[w].moveable){var b={left:_[w].printLocation.x,top:_[w].printLocation.y,width:_[w].printLocation.width,height:_[w].printLocation.height};if(v=Object(Fa["b"])(b,y),v)break}}v&&(this.$layer.alert("页码为:"+JSON.parse(t).pageList[0].title+"的正中间的书脊区域不能放文字及装饰物，请调整位置！"),e.isPassCheck=!1)}var I="",S=[],x="",k=JSON.parse(t).pageList,O="",L=new Array,T=new Array;for(o=0;o<k.length;o++){k[o].isBeyond&&(0==o?I=k[o].title+"、":I+=k[o].title+"、");_=k[o].content.itemList;var C=!1,P=!1;for(w=0;w<_.length;w++){if(_[w].media.mediaType==$a["a"].TEXT&&"yes"==_[w].moveable&&""!=_[w].media.text){P=this.checkTextOverLap(_,w);var j="text_"+o+"_"+w,A=document.getElementById(j).getBBox().width,N=document.getElementById(j).getBBox().height,E=SVG("#"+j);if(A>_[w].location.width&&E.width(A),N>_[w].location.height&&E.height(N),A>_[w].location.width||N>_[w].location.height)if(0==E.transform("rotate"))_[w].location.width=E.width(),_[w].location.height=E.height(),_[w].printLocation.width=E.width(),_[w].printLocation.height=E.height();else{var J=Object(Va["b"])(E.x(),E.y(),E.transform("rotate"),E.cx(),E.cy());_[w].location.width=E.width(),_[w].location.height=E.height();var D=Object(Va["a"])(J.x,J.y,E.width(),E.height(),E.transform("rotate"));_[w].printLocation.width=D.width,_[w].printLocation.height=D.height}_[w].media.text,D={x:_[w].printLocation.x,y:_[w].printLocation.y,width:_[w].printLocation.width,height:_[w].printLocation.height};var B=Object(za["b"])(D,JSON.parse(t),o,null,this);B&&(S.push(k[o].title),C=!0)}"advancedImageMask"==_[w].media.mediaType&&L.push(_[w].media.maskSource);var K=_[w].cutArea;if(null!=K&&void 0!=K&&""!=K&&"image"==_[w].media.mediaType&&1==_[w].cutArea.fromAiCut&&L.push(_[w].media.imgPath),"image"==_[w].media.mediaType&&"yes"==_[w].moveable){var M={id:_[w].media.materialId,num:1,materialype:0,flag:1};T.push(M)}}C&&(0==o?x=k[o].title+"、":x+=k[o].title+"、"),P&&(0==o?O=k[o].title+"、":O+=k[o].title+"、")}localStorage.setItem(this.pageKey.photoSize,L.length),localStorage.setItem(this.pageKey.materials,JSON.stringify(T)),""!=x&&(x="页码为:"+x+"的页面上文字超过红色出血线，生产时将被裁切! 请调整",1!=this.isPart&&"true"!=this.isPart||(x="页面上有文字超过红色出血线，生产时将被裁切! 请调整"),this.$layer.alert(x),e.isPassCheck=!1),""!=I&&(I="请检查:"+I+"的页面上重要部位被遮挡的照片！以免造成售后!",1!=this.isPart&&"true"!=this.isPart||(I="请检查页面上重要部位被遮挡的照片！以免造成售后!"),this.$layer.alert(I));var U=this.testPhotoMask(JSON.parse(t).pageList,JSON.parse(t));""!=U&&(U="页码为:"+U+"的页面上相框遮罩效果失效! 请刷新调整",1!=this.isPart&&"true"!=this.isPart||(U="页面上有相框遮罩效果失效! 请刷新调整"),this.$layer.alert(U),e.isPassCheck=!1);var W=JSON.parse(t),F=this,R=!0;return $(".text_style").each(function(e,t){console.log($(this).text);var i=$(this).text(),a=/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\u2764/g;if(i.match(a)){var o=$(this).parent().parent().attr("sp");return R=!1,1==this.isPart||"true"==this.isPart?F.$layer.alert("页面文字含有特殊表情字符，请您删除"):F.$layer.alert(W.pageList[o].title+"——此页文字含有特殊表情字符，请您删除"),!1}var s=new RegExp("[^a-zA-Z0-9一-龥@!:',.．;“‘；?？.~、~：，。！...）%*$#&￥<>《》+=-（()@-_-\r\n ]");if(s.test(i)){o=$(this).parent().parent().attr("sp");return R=!1,1==this.isPart||"true"==this.isPart?F.$layer.alert("页面文字含有特殊表情字符，请您删除"):F.$layer.alert(W.pageList[o].title+"——此页文字含有特殊字符，请您删除"),!1}}),R||(e.isPassCheck=!1),e.hitTextStr=O,e},testPhotoMask:function(e,t){for(var i="",a=0;a<e;a++){for(var o=SVG("#svg_"+a).children(),s=!1,n=0;n<o.length;n++){if(o[n].attr("ty")==$a["a"].ADVANCED_IMAGE_MASK){for(var r=o[n].id(),l=r.split("_"),d=l[2],c=document.getElementById(r).getAttribute("mask"),h=SVG("#svg_"+d).defs().children(),g=0;g<h.length;g++)if("mask"==h[g].type&&-1!=c.indexOf(h[g].id())){s=!0;break}if(s)break}if(o[n].attr("ty")==$a["a"].IMAGE&&t.pageList[a].content.itemList[n].cutArea){r=o[n].id(),l=r.split("_"),d=l[2];var m=getAttribute("clip-path");for(h=SVG("#svg_"+d).defs().children(),g=0;g<h.length;g++)if("clipPath"==h[g].type&&-1!=m.indexOf(h[g].id())){s=!0;break}if(s)break}}s||(0==a?i=t.pageList[a].title+"、":i+=t.pageList[a].title+"、")}return i},savePagePreview:function(){var e=Object(Pa["a"])(regeneratorRuntime.mark(function e(t,i){var a,o,s,n,r,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=this,!1,t){e.next=6;break}e.next=27;break;case 6:return console.log("截图完毕！！"),o=this.detailJson.pageList[0].previewImagePath,s={picpath:[[0,t,o,!1]],userFlag:2},e.prev=9,e.next=12,Object(H["r"])(s);case 12:n=e.sent,console.log(n),a.page0_preveiwImg=n.pics[0].previewpics,r=JSON.parse(localStorage.getItem(a.pageKey.detailJson)),r.previewImage=a.page0_preveiwImg,l=JSON.stringify(r),localStorage.setItem(a.pageKey.detailJson,l),a.$store.dispatch("updatePages",r),!0,e.next=27;break;case 23:e.prev=23,e.t0=e["catch"](9),console.log("base64图片转换失败"),console.log(e.t0);case 27:case"end":return e.stop()}},e,this,[[9,23]])}));function t(t,i){return e.apply(this,arguments)}return t}(),screenShotComplete:function(e){this.savePagePreview(e)},checkTextOverLap:function(e,t){for(var i=!1,a=0;a<e.length;a++)if(a!=t){if(i)break;if(e[a].media.mediaType==$a["a"].TEXT&&"yes"==e[a].moveable&&""!=e[a].media.text){var o={left:e[t].printLocation.x,top:e[t].printLocation.y,width:e[t].printLocation.width,height:e[t].printLocation.height},s={left:e[a].printLocation.x,top:e[a].printLocation.y,width:e[a].printLocation.width,height:e[a].printLocation.height};if(i=Object(Fa["b"])(o,s),i)break}}return i},changeStatus:function(e,t){this.changeActive=e},herfTo:function(){this.createPages(1,!0)}}},Za=Qa,eo=(a("de95"),Object(b["a"])(Za,Ta,Ca,!1,null,"bea1ac3a",null)),to=eo.exports,io=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("section",{staticClass:"mobile_web pb100",attrs:{id:"uploadShow"}},[i("div",{staticClass:"weui-cells sjky-list-tip sjky-list-tip2 sjky-list-tip3",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell__hd"},[i("div",{staticClass:"checkbox weui-cells_checkbox"},[i("input",{staticClass:"weui-check weui-check_box2",attrs:{type:"checkbox",name:"photos"},on:{click:e.finishEdit}}),i("i",{staticClass:"weui-icon-checked"})])]),i("div",{staticClass:"weui-cell__bd"},[i("div",[i("p",{staticClass:"sub-title",attrs:{id:"chooseNumShow"}},[e._v("已选"+e._s(e.chooseNum)+"张")])])])]),i("a",{staticClass:"tips",staticStyle:{display:"none"},attrs:{id:"showIOSDialog2"},on:{click:function(t){return e.showModal("#px-photo")}}},[i("i",{staticClass:"weui-icon-warn vm"}),i("span",{staticClass:"vm"},[e._v("像素不足，可能影响印刷质量")])]),e._m(0)]),e._m(1),i("footer",{staticClass:"sjky-btn-bottom sjky-btn-bottom2"},[i("a",{staticClass:"weui-btn weui-btn_primary disabled",staticStyle:{"pointer-events":"none"},attrs:{href:"javascript:void(0);",id:"designGO"},on:{click:function(t){return e.next()}}},[e._v("提交")])])]),i("section",{staticClass:"modal modal-out",attrs:{id:"low-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("返回")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.nextStep()}}},[e._v("确定")])])])])},ao=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{staticClass:"tips",staticStyle:{display:"none"},attrs:{id:"showIOSDialog3"}},[i("span",{staticClass:"vm icon-box sjky"},[e._v("")]),i("span",{staticClass:"vm"},[e._v("请上传PNG/JPG格式的图片")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"phoList clearfix page"},[i("div",{staticStyle:{display:"none"},attrs:{id:"filePicker"}}),i("div",{attrs:{id:"imageList"}})])}],oo=(new Array,{name:"baseUploadCaiyun",props:["storageName","submitButtonName","minPageNum","pageKey","maxPageNum","server","checksubmitstate","orderInfo","isTaoBan"],data:function(){return{id:"",pageNum:"",productId:"",calendar_type:"",p:-1,editing:!1,showDeleteModal:!1,arrnum:"",chooseNum:0,checkAll:!1,isTeamBook:!1,isfirst:0}},created:function(){var e=localStorage.getItem(this.pageKey.id),t=localStorage.getItem(this.pageKey.isfirst),i=localStorage.getItem(this.pageKey.calenderTemp);t&&"1"==t?this.isfirst=null==i||"[]"==i?0:1:localStorage.setItem(this.pageKey.isfirst,this.isfirst),this.isTeamBook=this.$route.query.isTeamBook,null==e||""==e||"undefined"==e?(this.id=this.$route.query.id,localStorage.setItem(this.pageKey.id,this.id)):this.id=e},mounted:function(){$(".zzz").click(function(){hideModal()});JSON.parse(localStorage.getItem(this.pageKey.goodsid));this.calendar_type=localStorage.getItem(this.pageKey.calendar_type),this.productId=JSON.parse(localStorage.getItem(this.pageKey.productId)),this.p=JSON.parse(localStorage.getItem(this.pageKey.pnum)),null==this.p&&(this.p=-1);var t=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(t=!0)}),t)showConfirm("#fail-photo");else{if(1==this.isfirst){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","和彩云上传","提示","改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！")}if($("#loadUpload").bind("click",function(e){$(".sjky-btn-greytxt").hide(),$(".webuploader-element-invisible")[0]||this.$layer.alert("上传插件实例化失败，请刷新返回重新进入"),$(".webuploader-element-invisible")[0].click()}),this.arrnum=this.maxPageNum,console.log("undefined"===typeof loadUpload?"undefined":Object(q["a"])(loadUpload)),"function"==typeof loadUpload)try{loadUpload(this.minPageNum,this.maxPageNum,this.storageName,this.submitButtonName,this.server,this.checksubmitstate,this.isTaoBan,this.pageKey,this)}catch(a){this.$layer.alert(a)}else this.$layer.alert("加载失败，请刷新返回重新进入")}},methods:{editPhotos:function(){this.editing=!0},finishEdit:function(){console.info("全选方法！"),this.checkAll?(resetEdit(),this.checkAll=!1):(checkAllBox(),this.checkAll=!0)},deletePic:function(){var e=$("#imageList").find(".weui-check");e.length>0&&deleteDelimage(e,this.minPageNum,this.maxPageNum),this.editing=!1,$(".sjky-btn-resettxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-greytxt").show(),localStorage.removeItem(this.pageKey.detailJson)},resetupload:function(){hideModal()},next:function(){if(isupping)showConfirm("#uping-photo");else{var e=!1,t=localStorage.getItem(this.storageName);if(null!=t&&"null"!=t&&(t=JSON.parse(t),!(t.length<this.minPageNum))){for(var i=0;i<t.length;i++)if(1==t[i].pixellow){e=!0;break}var a=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(a=!0)}),a)showConfirm("#fail-photo");else{var o=this;1!=this.isTeamBook&&"true"!=this.isTeamBook?$.actions({title:"照片排列方式",onClose:function(){$(".weui-actionsheet").remove(),$(".weui-actions_mask").remove(),console.log("close")},actions:[{text:"时间排序",className:"color-primary",onClick:function(){o.nextStep(0)}},{text:"智能排序",className:"color-primary",onClick:function(){o.nextStep(1)}}]}):e?this.showModal("#low-photo"):this.nextStep(1)}}}},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},nextStep:function(e){if(isupping)showConfirm("#uping-photo");else{this.hideModal();var t=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));if(window._czc){var i="";i=0==e?"时间排序":"智能排序",window._czc.push(["_trackEvent","剪影","上传页面",i])}this.$emit("baseUploadNextStep",this.id,this.p,t,e)}},showUpload:function(){$(".uploadZoone").show(),$(".no-infor").hide()}}}),so=oo,no=(a("c791"),Object(b["a"])(so,io,ao,!1,null,null,null)),ro=no.exports,lo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about"},[i("div",{staticClass:"orderId"},[i("a",{directives:[{name:"show",rawName:"v-show",value:e.is_byte,expression:"is_byte"}],staticStyle:{"font-size":"16px"},on:{click:function(t){return e.gosomthing()}}},[i("img",{attrs:{src:a("7108"),alt:""}})]),e._v("\n\t\t订单编号:"+e._s(e.orderNo))]),i("div",{staticClass:"list_box",staticStyle:{"padding-bottom":"60px"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.designList||0==e.designList.length,expression:"(!designList) || (designList.length == 0) "}],staticClass:"noDrafts"},[i("img",{attrs:{src:a("1640")}}),i("span",[e._v("暂无设计")])]),e._l(e.designList,function(t,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:e.designList.length>0,expression:"(designList.length > 0)"}],staticClass:"list"},[i("img",{attrs:{src:""==t.previewimage?e.photourl:t.previewimage}}),i("div",[i("p",[e._v(e._s(t.name))]),i("span",[e._v(e._s(t.modifydate))]),i("ul",[i("button",{on:{click:function(i){return e.toDesign(t)}}},[e._v("编辑设计")]),i("button",{on:{click:function(i){return e.deleteItem(t.id)}}},[e._v("删除")])])])])})],2),i("div",{staticClass:"she",on:{click:function(t){return e.createDesign()}}},[e._v("创建设计")]),e.isPinduoduo?i("div",{staticStyle:{position:"fixed",bottom:"80px"}},[i("img",{staticStyle:{width:"70px"},attrs:{src:a("7300")},on:{click:e.goWenjuan}})]):e._e()])},co=[],ho=a("23d5"),go=ho["a"],mo=(a("e8bf"),Object(b["a"])(go,lo,co,!1,null,null,null)),po=mo.exports,uo=(a("1c432"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"dbarrow"}),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLast,expression:"!isLast"}],staticClass:"numPage"},[e._v(e._s(e.num))]),e.photoBecomBook?i("div",{staticClass:"music",staticStyle:{"padding-top":"2px","font-size":"12px",color:"white"},on:{click:function(t){return t.stopPropagation(),e.goEdit(t)}}},[e._v("\n\t\t\t  修改"),i("br"),e._v("设计\n")]):e._e(),i("div",{attrs:{id:"fullpage"}},[i("section",{directives:[{name:"show",rawName:"v-show",value:e.isRender,expression:"isRender"}],staticClass:" section endBg"},[e._m(0),i("a",{staticClass:"bookbtn",attrs:{id:"copyShare",href:"javascript:;",title:"我也做一本"}},[e._v("我也做一本")])])])])}),fo=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"position_zz"},[i("img",{staticClass:" jyLogo",attrs:{src:a("15e1")}}),i("p",{staticClass:"jyTxt"},[e._v("出片人 / 简影")]),i("p",{staticClass:"jyTxt2"},[e._v("您的故事。。。未完待续")])])}];function yo(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function _o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?yo(i,!0).forEach(function(t){Object(L["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yo(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var vo={name:"album",data:function(){return{uid:null,pageKey:null,isInit:!1,tbPass:null,isAlbum:!0,isLast:!1,isRender:!1,num:"",photoBecomBook:!1,designsorce:null}},created:function(){var e=this;this.photoBecomBook=this.$route.query.photoBecomBook,this.designsorce=this.$route.query.designsorce,this.photoBecomBook&&(localStorage.removeItem(ee["f"].fromAlipyShop),localStorage.removeItem(ee["f"].fromAlipyShopCartEdit)),this.$store.dispatch("getFontCss");$("#txc").hide();if(this.uid=this.$route.query.uid,null!=this.uid&&void 0!=this.uid){for(var t in this.pageKey=ee["g"],this.pageKey)localStorage.removeItem(this.pageKey[t]);var i={uid:this.uid,pageKey:this.pageKey,isTeamBook:!1,edittype:2};this.$store.dispatch("getJsonFunNoToken",i).then(function(t){var i=JSON.parse(t.data);localStorage.setItem(e.pageKey.thumbnailToken,i.base64Token)}).catch(function(t){console.log(t),e.$layer.alert("模板数据加载失败")})}else this.$layer.alert("找不到设计")},mounted:function(){var e=!1;$("#musicon").click(function(){e?($(this).css({"-webkit-animation-play-state":"running"}),$("#audio").get(0).play(),e=!1):($(this).css({"-webkit-animation-play-state":"paused"}),$("#audio").get(0).pause(),e=!0)})},methods:{goEdit:function(){this.$router.push({name:"design",query:{uid:this.uid,history:!0,photoBecomBook:this.photoBecomBook,designsorce:this.designsorce}})},initPage:function(){for(var e=this,t=this,i=[],a=this.detailJson.pageList.length-1;a>-1;a--)$("#fullpage").prepend('<div class = "section" id="page_'+a+'"></div>'),Object(V["b"])("#page_"+a,this.detailJson,a,null,this,!0,!1,!1),i.push("#efd9c7");this.isRender=!0,Object(H["ab"])({id:this.uid}).then(function(t){e.tbPass=t.data,null==e.tbPass&&$("#copyShare").hide()});var o=new WOW({boxClass:"wow",animateClass:"animated",offset:0,mobile:!0,live:!0});$("#fullpage").fullpage({sectionsColor:i,verticalCentered:!0,css3:!0,lockAnchors:!1,scrollingSpeed:1e3,scrollBar:!0,afterRender:function(){o.init()},onLeave:function(e,t){o.init()},afterLoad:function(e,i){i>t.detailJson.pageList.length?t.isLast=!0:(t.isLast=!1,t.num=t.detailJson.pageList[i-1].title)}}),$("#copyShare").on("click",function(){t.makeSimple()})},makeSimple:function(){var e=this.tbPass;window._czc&&window._czc.push(["_trackEvent","剪影","分享页面","淘口令复制"]),this.copyText(e,"口令已经复制，快去打开吧!")},copyText:function(e,t){var i=this;this.$copyText(e).then(function(e){i.$layer.alert(t)},function(e){i.$toast("复制失败")})}},computed:_o({},Object(E["b"])(["detailJson"])),watch:{detailJson:function(){var e=this;this.isInit||(this.isInit=!0,this.$store.dispatch("getAllFontInfo").then(function(t){console.log("开始\t初始化页面"),e.initPage()}))}}},wo=vo,bo=(a("d0ab"),Object(b["a"])(wo,uo,fo,!1,null,"e1428992",null)),Io=bo.exports,So=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("uploader",{ref:"uploader",staticClass:"uploader-example",attrs:{options:e.options,"file-status-text":e.statusText,"auto-start":!0},on:{status:e.status,"file-added":e.onFileAdded,"file-progress":e.fileProgress,"progress-style":e.progressStyle,"progressing-class":e.progressingClass,"file-success":e.onFileSuccess,"file-error":e.onFileError,"file-removed":e.fileRemoved,"files-submitted":e.onFilesubmitted}},[i("uploader-btn",{attrs:{attrs:e.attrs}},[e._v("select images")]),i("div",{staticClass:"list"},e._l(e.picList,function(t,a){return i("div",{staticClass:"picListDiv"},[i("img",{attrs:{src:""==t?"../assets/logo.png":t}}),i("span",{staticClass:"fail",attrs:{id:"fail_"+a}},[e._v("网络")])])}),0)],1)},xo=[],ko={name:"simpleUploader",data:function(){return{options:{target:"//10.168.21.51:8090/fupload1/fileUpload/minioUploadFile.do",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:15728640,query:{token:"7D366C5C6A3C450A87C98C6740494D28",appkey:"zhengjianzhao",checkId:"diy12",methodId:"zjz_methodid1",sign:"a0bec65dc7b982dec0285499504d788e"}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"},picList:[],progress:0,progressingClass:"uploader-file-progressing",file_total:1,errorfilelist:[]}},methods:{onFileAdded:function(e){if(e.size>this.options.size)return console.info("照片过大"),void(e.ignored=!0)},onFileSuccess:function(e,t,i,a){var o=JSON.parse(i);if(1e4!==o.code){var s={rootname:"无",name:t.name,errorinfo:o.message};!0===e.isFolder&&(s["rootname"]=e.name),this.errorfilelist.push(s),this.controllerErrorFileDialog=!0}var n=o.data[0].lookUrl+o.data[0].lookPath;this.picList.push(n)},fileProgress:function(e,t,i){this.progress=t.progress(),this.averageSpeed=t.averageSpeed,this.currentSpeed=t.currentSpeed,this.timeRemaining=t.timeRemaining(),this.uploadedSize=t.sizeUploaded()},onFileError:function(e,t,i,a){var o={rootname:"无",name:t.name,errorinfo:"文件上传失败"};!0===e.isFolder&&(o["rootname"]=e.name),this.errorfilelist.push(o),this.controllerErrorFileDialog=!0},fileRemoved:function(e){var t=this;this.$nextTick(function(){t.file_total=t.$refs["uploader"].files.length})},submitUpload:function(){var e=this;this.$nextTick(function(){for(var t=0;t<e.$refs["uploader"].files.length;t++)e.$refs["uploader"].files[t].resume()})},closeErrorDialog:function(){this.errorDialog=!1},handelClose:function(){this.clearcache(),this.thirdDialog=!1},clearcache:function(){this.file_total=0,this.errorfilelist=[],this.controllerErrorFileDialog=!1,this.$refs.uploader.uploader.cancel(),this.getresourceDetail()},cancelUpload:function(){console.info("取消上传"),this.thirdDialog=!1,this.clearcache()},progressStyle:function(){var e=Math.floor(100*this.progress),t="translateX(".concat(Math.floor(e-100),"%)");return{progress:"".concat(e,"%"),webkitTransform:t,mozTransform:t,msTransform:t,transform:t}},status:function(){var e=this.isUploading,t=this.isComplete,i=this.error,a=this.paused;return t?"success":i?"error":e?"uploading":a?"paused":"waiting"},onFilesubmitted:function(e,t){console.info("asjjjj")}}},Oo=ko,Lo=(a("fda8"),Object(b["a"])(Oo,So,xo,!1,null,null,null)),To=Lo.exports,Co=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-top":"50px","padding-bottom":"10px"}},[i("a",{staticClass:"new-fanhui",on:{click:e.goBack}},[e._v("<<返回")]),e._m(0),e._l(e.detailJson.pageList,function(t,a){return[i("div",{staticClass:"new-liebiao"},e._l(t.content.itemList,function(t,o){return("advancedImageMask"==t.media.mediaType||t.cutArea&&t.cutArea.fromAiCut&&"image"==t.media.mediaType)&&1==t.visible?i("img",{class:{active:e.firstSelect==a+"_"+o||e.secondSelect==a+"_"+o},attrs:{src:"advancedImageMask"==t.media.mediaType?"img/nophoto.jpg"==t.media.maskSource?"img/nophoto1.jpg":-1!=t.media.maskSource.indexOf(e.thumbnailUrl)?t.media.maskSource.replace("fsferry/","").replace("commonUpload/","")+"?token="+e.thumbnailToken:t.media.maskSource:"img/nophoto.jpg"==t.media.imgPath?"img/nophoto1.jpg":-1!=t.media.imgPath.indexOf(e.thumbnailUrl)?t.media.imgPath.replace("fsferry/","").replace("commonUpload/","")+"?token="+e.thumbnailToken:t.media.imgPath,"data-index":a+"_"+o},on:{click:e.checkOrChange}}):e._e()}),0),i("div",{staticClass:"new-titlee"},[e._v(e._s(t.title))])]}),i("div",{staticClass:"new-height"}),i("div",{staticClass:"new-xiayibu",on:{click:e.next}},[i("span",[e._v("下一步")])])],2)},Po=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"new-huhuan"},[i("img",{attrs:{src:"img/new-deng.png"}}),i("span",[e._v("点击图片互换位置")])])}];function jo(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function Ao(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?jo(i,!0).forEach(function(t){Object(L["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jo(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var No,Eo,Jo={name:"photoOrder",data:function(){return{editType:null,pageKey:null,firstSelect:null,secondSelect:null,fromSimple:null,thumbnailToken:"",thumbnailUrl:J["a"].thumbnailUrl}},computed:Ao({},Object(E["b"])(["detailJson","photos"])),created:function(){var e=this;this.id=this.$route.query.id,this.p=this.$route.query.p,this.uid=this.$route.query.uid,this.history=this.$route.query.history,this.editType=this.$route.query.editType,this.admin=this.$route.query.admin,this.isTeamBook=this.$route.query.isTeamBook,this.isPart=this.$route.query.isPart,this.iscomplete=this.$route.query.iscomplete,this.fromSimple=this.$route.query.fromSimple,this.uid&&2==this.editType?this.pageKey=ee["c"]:this.pageKey=ee["a"];var t={uid:this.$route.query.uid,pageKey:this.pageKey,edittype:2,fromCache:!0};this.thumbnailToken=localStorage.getItem(this.pageKey.thumbnailToken),this.$store.dispatch("getJsonFunNoToken",t).then(function(t){JSON.stringify(t.detail);console.log(e.detailJson)}).catch(function(t){console.log(t),e.$layer.alert("模板数据加载失败")})},mounted:function(){$(window).scrollTop(0)},methods:{checkOrChange:function(e){var t=e.currentTarget.getAttribute("data-index"),i=null;if(this.firstSelect==t||this.secondSelect==t)return this.firstSelect=null,void(this.secondSelect=null);if(null!=this.firstSelect||null!=this.secondSelect){i=null!=this.firstSelect?this.firstSelect:this.secondSelect;try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","照片顺序","照片顺序",t+"<->"+i,JSON.parse(a).orderNo])}}catch(e){console.log(e)}var o,s,n,r,l,d,c,h,g,m,p,u,f=t.split("_"),y=i.split("_"),_={},v={};if(_="advancedImageMask"==this.detailJson.pageList[f[0]].content.itemList[f[1]].media.mediaType?{location:{maskFactWidth:this.detailJson.pageList[f[0]].content.itemList[f[1]].location.maskFactWidth,maskFactHeight:this.detailJson.pageList[f[0]].content.itemList[f[1]].location.maskFactHeight},media:{maskSource:this.detailJson.pageList[f[0]].content.itemList[f[1]].media.maskSource,imgX:this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgX,imgY:this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgY,imgWidth:this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgWidth,imgHeight:this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgHeight}}:{location:{maskFactWidth:this.detailJson.pageList[f[0]].content.itemList[f[1]].location.factWidth,maskFactHeight:this.detailJson.pageList[f[0]].content.itemList[f[1]].location.factHeight},media:{maskSource:this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgPath}},this.detailJson.pageList[f[0]].content.itemList[f[1]].photoFacePosition&&(_.photoFacePosition=this.detailJson.pageList[f[0]].content.itemList[f[1]].photoFacePosition,delete this.detailJson.pageList[f[0]].content.itemList[f[1]].photoFacePosition),this.detailJson.pageList[f[0]].content.itemList[f[1]].characterArea&&(_.characterArea=this.detailJson.pageList[f[0]].content.itemList[f[1]].characterArea,delete this.detailJson.pageList[f[0]].content.itemList[f[1]].characterArea),this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea&&(_.cutArea={},_.cutArea.bigFactWidth=this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.bigFactWidth,_.cutArea.bigFactHeight=this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.bigFactHeight,_.cutArea.lastWidth=this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.lastWidth,delete this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.bigFactWidth,delete this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.bigFactHeight,delete this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.lastWidth),v="advancedImageMask"==this.detailJson.pageList[y[0]].content.itemList[y[1]].media.mediaType?{location:{maskFactWidth:this.detailJson.pageList[y[0]].content.itemList[y[1]].location.maskFactWidth,maskFactHeight:this.detailJson.pageList[y[0]].content.itemList[y[1]].location.maskFactHeight},media:{maskSource:this.detailJson.pageList[y[0]].content.itemList[y[1]].media.maskSource,imgX:this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgX,imgY:this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgY,imgWidth:this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgWidth,imgHeight:this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgHeight}}:{location:{maskFactWidth:this.detailJson.pageList[y[0]].content.itemList[y[1]].location.factWidth,maskFactHeight:this.detailJson.pageList[y[0]].content.itemList[y[1]].location.factHeight},media:{maskSource:this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgPath}},this.detailJson.pageList[y[0]].content.itemList[y[1]].photoFacePosition&&(v.photoFacePosition=this.detailJson.pageList[y[0]].content.itemList[y[1]].photoFacePosition,delete this.detailJson.pageList[y[0]].content.itemList[y[1]].photoFacePosition),this.detailJson.pageList[y[0]].content.itemList[y[1]].characterArea&&(v.characterArea=this.detailJson.pageList[y[0]].content.itemList[y[1]].characterArea,delete this.detailJson.pageList[y[0]].content.itemList[y[1]].characterArea),this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea&&(v.cutArea={},v.cutArea.bigFactWidth=this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.bigFactWidth,v.cutArea.bigFactHeight=this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.bigFactHeight,v.cutArea.lastWidth=this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.lastWidth,delete this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.bigFactWidth,delete this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.bigFactHeight,delete this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.lastWidth),"advancedImageMask"==this.detailJson.pageList[f[0]].content.itemList[f[1]].media.mediaType){if(this.detailJson.pageList[f[0]].content.itemList[f[1]].location.maskFactWidth=v.location.maskFactWidth,this.detailJson.pageList[f[0]].content.itemList[f[1]].location.maskFactHeight=v.location.maskFactHeight,this.detailJson.pageList[f[0]].content.itemList[f[1]].media.maskSource=v.media.maskSource,l=this.detailJson.pageList[f[0]].content.itemList[f[1]].location.width,d=this.detailJson.pageList[f[0]].content.itemList[f[1]].location.height,r=l/d,n=v.location.maskFactWidth/v.location.maskFactHeight,n>=r?(m=d,g=d*n,c=(l-g)/2,h=0):(g=l,m=l/n,c=0,h=(d-m)/2),v.photoFacePosition){var w=v.media.imgWidth;p=g/w}this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgX=c,this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgY=h,this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgWidth=g,this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgHeight=m,o=this.detailJson.pageList[f[0]].content.itemList[f[1]].media.maskSource,o=Object(Q["f"])(o,this.detailJson.pageList[f[0]].content.itemList[f[1]])}else this.detailJson.pageList[f[0]].content.itemList[f[1]].location.factWidth=v.location.maskFactWidth,this.detailJson.pageList[f[0]].content.itemList[f[1]].location.factHeight=v.location.maskFactHeight,this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgPath=v.media.maskSource,o=this.detailJson.pageList[f[0]].content.itemList[f[1]].media.imgPath,o=Object(Q["f"])(o,this.detailJson.pageList[f[0]].content.itemList[f[1]]);if(v.photoFacePosition&&(this.detailJson.pageList[f[0]].content.itemList[f[1]].photoFacePosition=v.photoFacePosition,p))for(var b=this.detailJson.pageList[f[0]].content.itemList[f[1]].photoFacePosition,I=0;I<b.length;I++)b[I].x=b[I].x*p,b[I].y=b[I].y*p,b[I].width=b[I].width*p,b[I].height=b[I].height*p;if(v.characterArea&&(this.detailJson.pageList[f[0]].content.itemList[f[1]].characterArea=v.characterArea),v.cutArea&&this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea&&(this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.bigFactWidth=v.cutArea.bigFactWidth,this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.bigFactHeight=v.cutArea.bigFactHeight,this.detailJson.pageList[f[0]].content.itemList[f[1]].cutArea.lastWidth=v.cutArea.lastWidth),"advancedImageMask"==this.detailJson.pageList[y[0]].content.itemList[y[1]].media.mediaType){if(this.detailJson.pageList[y[0]].content.itemList[y[1]].location.maskFactWidth=_.location.maskFactWidth,this.detailJson.pageList[y[0]].content.itemList[y[1]].location.maskFactHeight=_.location.maskFactHeight,this.detailJson.pageList[y[0]].content.itemList[y[1]].media.maskSource=_.media.maskSource,l=this.detailJson.pageList[y[0]].content.itemList[y[1]].location.width,d=this.detailJson.pageList[y[0]].content.itemList[y[1]].location.height,r=l/d,n=_.location.maskFactWidth/_.location.maskFactHeight,n>=r?(m=d,g=d*n,c=(l-g)/2,h=0):(g=l,m=l/n,c=0,h=0),_.photoFacePosition){w=_.media.imgWidth;u=g/w}this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgX=c,this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgY=h,this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgWidth=g,this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgHeight=m,s=this.detailJson.pageList[y[0]].content.itemList[y[1]].media.maskSource,s=Object(Q["f"])(s,this.detailJson.pageList[y[0]].content.itemList[y[1]])}else this.detailJson.pageList[y[0]].content.itemList[y[1]].location.factWidth=_.location.maskFactWidth,this.detailJson.pageList[y[0]].content.itemList[y[1]].location.factHeight=_.location.maskFactHeight,this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgPath=_.media.maskSource,s=this.detailJson.pageList[y[0]].content.itemList[y[1]].media.imgPath,s=Object(Q["f"])(s,this.detailJson.pageList[y[0]].content.itemList[y[1]]);if(_.photoFacePosition&&(this.detailJson.pageList[y[0]].content.itemList[y[1]].photoFacePosition=_.photoFacePosition,u))for(b=this.detailJson.pageList[y[0]].content.itemList[y[1]].photoFacePosition,I=0;I<b.length;I++)b[I].x=b[I].x*u,b[I].y=b[I].y*u,b[I].width=b[I].width*u,b[I].height=b[I].height*u;_.characterArea&&(this.detailJson.pageList[y[0]].content.itemList[y[1]].characterArea=_.characterArea),_.cutArea&&this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea&&(this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.bigFactWidth=_.cutArea.bigFactWidth,this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.bigFactHeight=_.cutArea.bigFactHeight,this.detailJson.pageList[y[0]].content.itemList[y[1]].cutArea.lastWidth=_.cutArea.lastWidth),this.changePhotos(o,s,f,y);var S=JSON.stringify(this.detailJson);this.$store.dispatch("updatePages",this.detailJson),localStorage.setItem(this.pageKey.detailJson,S),this.firstSelect=null,this.secondSelect=null;var x,k,O=this.detailJson.pageList[f[0]].content.itemList[f[1]],L=this.detailJson.pageList[f[0]];if(O.characterArea&&O.characterArea.areaX){O.characterArea.areaX,O.media.imgWidth,O.media.imgX,O.printLocation.x,O.characterArea.areaY,O.media.imgHeight,O.media.imgY,O.printLocation.y,O.characterArea.areaW,O.media.imgWidth,O.characterArea.areaH,O.media.imgHeight;var T={notable:{x:O.characterArea.areaX,y:O.characterArea.areaY,w:O.characterArea.areaW,h:O.characterArea.areaH},factWidth:v.location.maskFactWidth,factHeight:v.location.maskFactHeight};if(O.cutArea&&O.cutArea.fromAiCut){var C=O.cutArea.width/O.cutArea.bigFactWidth,P=O.cutArea.height/O.cutArea.bigFactHeight,j=O.location.width/C,A=O.location.height/P,N=j/O.cutArea.bigFactWidth,E=0-O.cutArea.x*N,J=0-O.cutArea.y*N;x=O.location.x+E,k=O.location.y+J;var D=O.cutArea.bigFactWidth/O.cutArea.bigFactHeight;this.getBigSize(D,O.location.factWidth,O.location.factHeight);O.characterArea.areaX*j+x,O.characterArea.areaY*A+k,O.characterArea.areaW*j,O.characterArea.areaH*A;var B=this.changeFaceArea(T,O,L),K=this.createNewItem(v.media.maskSource,O.location.factWidth,O.location.factHeight,B);O.cutArea=K.cutArea,console.log("裁切",O.cutArea.width,O.cutArea.height),console.log("相框",O.location.width,O.location.height);S=JSON.stringify(this.detailJson);this.$store.dispatch("updatePages",this.detailJson),localStorage.setItem(this.pageKey.detailJson,S)}else B=this.changeFaceArea(T,O,L)}else{var M=Object(Q["d"])(v.media.maskSource),$=o.replace(M,""),U=v.location.maskFactWidth,W=v.location.maskFactHeight;if(O.cutArea){C=O.cutArea.width/O.cutArea.bigFactWidth,P=O.cutArea.height/O.cutArea.bigFactHeight,j=O.location.width/C,A=O.location.height/P;var F=this,R=function(e){var t=F.createNewItem(v.media.maskSource,v.location.maskFactWidth,v.location.maskFactHeight,e);O.cutArea=t.cutArea,console.log("裁切",O.cutArea.width,O.cutArea.height),console.log("相框",O.location.width,O.location.height);var i=JSON.stringify(F.detailJson);F.$store.dispatch("updatePages",F.detailJson),localStorage.setItem(F.pageKey.detailJson,i)};B=this.getAndTestFace($,U,W,j,A,O,L,R)}else this.getAndTestFace($,U,W,O.media.imgWidth,O.media.imgHeight,O,L)}O=this.detailJson.pageList[y[0]].content.itemList[y[1]],L=this.detailJson.pageList[y[0]];if(O.characterArea&&O.characterArea.areaX){O.characterArea.areaX,O.media.imgWidth,O.media.imgX,O.printLocation.x,O.characterArea.areaY,O.media.imgHeight,O.media.imgY,O.printLocation.y,O.characterArea.areaW,O.media.imgWidth,O.characterArea.areaH,O.media.imgHeight,T={notable:{x:O.characterArea.areaX,y:O.characterArea.areaY,w:O.characterArea.areaW,h:O.characterArea.areaH},factWidth:_.location.maskFactWidth,factHeight:_.location.maskFactHeight};if(O.cutArea&&O.cutArea.fromAiCut){C=O.cutArea.width/O.cutArea.bigFactWidth,P=O.cutArea.height/O.cutArea.bigFactHeight,j=O.location.width/C,A=O.location.height/P,N=j/O.cutArea.bigFactWidth,E=0-O.cutArea.x*N,J=0-O.cutArea.y*N;x=O.location.x+E,k=O.location.y+J;D=O.cutArea.bigFactWidth/O.cutArea.bigFactHeight,this.getBigSize(D,O.location.factWidth,O.location.factHeight);O.characterArea.areaX*j+x,O.characterArea.areaY*A+k,O.characterArea.areaW*j,O.characterArea.areaH*A,console.log("裁切",O.cutArea.width,O.cutArea.height),console.log("相框",O.location.width,O.location.height);B=this.changeFaceArea(T,O,L),K=this.createNewItem(_.media.maskSource,O.location.factWidth,O.location.factHeight,B);O.cutArea=K.cutArea;S=JSON.stringify(this.detailJson);this.$store.dispatch("updatePages",this.detailJson),localStorage.setItem(this.pageKey.detailJson,S)}else B=this.changeFaceArea(T,O,L)}else{M=Object(Q["d"])(_.media.maskSource),$=s.replace(M,""),U=_.location.maskFactWidth,W=_.location.maskFactHeight;if(O.cutArea){C=O.cutArea.width/O.cutArea.bigFactWidth,P=O.cutArea.height/O.cutArea.bigFactHeight,j=O.location.width/C,A=O.location.height/P,F=this,R=function(e){var t=F.createNewItem(_.media.maskSource,_.location.maskFactWidth,_.location.maskFactHeight,e);O.cutArea=t.cutArea,console.log("裁切",O.cutArea.width,O.cutArea.height),console.log("相框",O.location.width,O.location.height);var i=JSON.stringify(F.detailJson);F.$store.dispatch("updatePages",F.detailJson),localStorage.setItem(F.pageKey.detailJson,i)};this.getAndTestFace($,U,W,j,A,O,L,R)}else this.getAndTestFace($,U,W,O.media.imgWidth,O.media.imgHeight,O,L)}}else this.firstSelect=t},getAndTestFace:function(e,t,i,a,o,s,n,r){var l,d=[{src:e,factWidth:t,factHeight:i}],c=this;$.ajax((l={url:J["a"].basicUrl+"/member/getextract",type:"POST",data:JSON.stringify(d),contentType:"application/json; charset=utf-8",dataType:"json"},Object(L["a"])(l,"type","POST"),Object(L["a"])(l,"async",!1),Object(L["a"])(l,"success",function(e){if(console.log(e),e.result){var l=e.data[0],d=l.split(",");d[1],s.printLocation.x,s.media.imgX,d[3],d[2],s.printLocation.y,s.media.imgY,d[4];if(s.cutArea){var h=a/s.cutArea.bigFactWidth,g=0-s.cutArea.x*h,m=0-s.cutArea.y*h,p=s.location.x+g,u=s.location.y+m;d[1]*a+p,d[3]*a,d[2]*o+u,d[4]*o}else d[1]*a+s.printLocation.x+s.media.imgX,d[3]*a,d[2]*o+s.printLocation.y+s.media.imgY,d[4]*o;var f={};f.areaX=d[1],f.areaY=d[2],f.areaW=d[3],f.areaH=d[4],s.characterArea=f;var y={notable:{x:d[1],y:d[2],w:d[3],h:d[4]},factWidth:t,factHeight:i};r?r(c.changeFaceArea(y,s,n)):c.changeFaceArea(y,s,n)}}),Object(L["a"])(l,"error",function(e){}),l))},changeFaceArea:function(e,t,i){var a=this;if(e.notable){i.hasWarn=!1,t.isBeyond=!1,a.diytype=localStorage.getItem(a.pageKey.diytype);var o=Number(e.factWidth),s=Number(e.factHeight),n=t.location.width,r=t.location.height,l=Math.max(n/o,r/s),d=o*l,c=s*l,h={x:e.notable.x*d,y:e.notable.y*c,w:e.notable.w*d,h:e.notable.h*c},g=h.w-n,m=h.h-r;if(g>0){var p=g/h.w;p>.05?(t.isBeyond=!0,"wall_calendar"!=a.diytype&&"other_object"!=a.diytype&&"mug_cup"!=a.diytype&&-1==i.title.indexOf("封面")&&-1==i.title.indexOf("封底")&&(i.hasWarn=!0)):delete t.isBeyond}if(m>0){var u=m/h.h;u>.05?(t.isBeyond=!0,"wall_calendar"!=a.diytype&&"other_object"!=a.diytype&&"mug_cup"!=a.diytype&&-1==i.title.indexOf("封面")&&-1==i.title.indexOf("封底")&&(i.hasWarn=!0)):delete t.isBeyond}var f=h.x,y=h.y;f+n>d&&(f=d-n),y+r>c&&(y=c-r),f<0&&(f=0),y<0&&(y=0);var _=t.media;_.imgX=-f,_.imgY=-y,delete _.autoFill;var v=JSON.stringify(this.detailJson);return this.$store.dispatch("updatePages",this.detailJson),localStorage.setItem(this.pageKey.detailJson,v),h.x=f/d,h.y=y/c,h.w=n/d,h.h=r/c,h}},createNewItem:function(e,t,i,a){var o,s,n={};n.userPhoto=!0,null!=a&&(n.crop=a);var r=t/i,l=600;r>1?(t<l&&(l=t),o=l,s=l/r):(i<l&&(l=i),o=l*r,s=l);var d={};return d.x=a.x*o,d.y=a.y*s,d.width=a.w*o,d.height=a.h*s,d.noCutWidth=-1,d.fromAiCut=!0,d.maskFactWidth=t,d.maskFactHeight=i,n.cutArea=d,n},hitFaceArea:function(e,t,i,a,o,s){var n=this,r=e,l=t,d=r+i,c=l+a,h=o.printLocation.x,g=o.printLocation.y,m=h+o.printLocation.width,p=g+o.printLocation.height,u=!1;if(r>=h&&l>=g&&Math.floor(d)<=m&&Math.floor(c)<=p){o.isBeyond=!1;var f=s.content.itemList,y=!0;for(var _ in f)f[_].isBeyond&&(y=!1);y&&(s.isBeyond=!1);var v=JSON.stringify(n.detailJson);n.$store.dispatch("updatePages",n.detailJson),localStorage.setItem(n.pageKey.detailJson,v)}else{o.isBeyond=!0,n.diytype=localStorage.getItem(n.pageKey.diytype),"wall_calendar"!=n.diytype&&"other_object"!=n.diytype&&"mug_cup"!=n.diytype&&-1==s.title.indexOf("封面")&&-1==s.title.indexOf("封底")&&(s.hasWarn=!0);v=JSON.stringify(n.detailJson);n.$store.dispatch("updatePages",n.detailJson),localStorage.setItem(n.pageKey.detailJson,v),u=!0}return u},getBigSize:function(e,t,i){var a,o,s={},n=600;return e>1?(t<n&&(n=t),a=n,o=n/e):(i<n&&(n=i),a=n*e,o=n),s.bigWidth=a,s.bigHeight=o,s},changePhotos:function(e,t,i,a){var o=this.pageKey.uploadCalenderTemp;this.fromSimple&&(o=this.pageKey.calenderTemp);for(var s,n,r=JSON.parse(localStorage.getItem(o)),l=0;l<r.length;l++)-1!=e.indexOf(r[l].url)&&(s=l),-1!=t.indexOf(r[l].url)&&(n=l);var d,c,h=this.detailJson.pageList[i[0]].title,g=this.detailJson.pageList[a[0]].title;(0==s||s)&&r[s]&&(r[s].title=r[s].title.replace(g,h)),(0==n||n)&&r[n]&&(r[n].title=r[n].title.replace(h,g)),(0==s||s)&&(d=r[s]),(0==n||n)&&(c=r[n]),(0==s||s)&&c&&r.splice(s,1,c),(0==n||n)&&d&&r.splice(n,1,d),localStorage.setItem(o,JSON.stringify(r))},goBack:function(){this.fromSimple?(localStorage.removeItem(this.pageKey.detailJson),this.$router.replace({name:"simpledesign",query:{id:this.id,p:this.p,isPart:this.isPart,isTeamBook:this.isTeamBook,isfirst:this.isfirst,hassort:0,fromOrder:1,submit:!0,editType:1}})):2!=this.editType?this.$router.replace({name:"design",query:{id:this.id,p:this.p,fromOrder:1,isPart:this.isPart,isTeamBook:this.isTeamBook,iscomplete:this.iscomplete,fromAdmin:this.$route.query.fromAdmin,fromAlipyShopCart:this.$route.query.fromAlipyShopCart,photoBecomBook:this.$route.query.photoBecomBook}}):this.$router.replace({name:"design",query:{uid:this.uid,history:this.history,admin:this.admin,isPart:this.isPart,fromOrder:1,isTeamBook:this.isTeamBook,iscomplete:this.iscomplete,fromAdmin:this.$route.query.fromAdmin,fromAlipyShopCart:this.$route.query.fromAlipyShopCart,photoBecomBook:this.$route.query.photoBecomBook}})},next:function(){this.fromSimple?(localStorage.removeItem(this.pageKey.detailJson),this.$router.replace({name:"simpledesign",query:{id:this.id,p:this.p,isPart:this.isPart,isTeamBook:this.isTeamBook,isfirst:this.isfirst,fromOrder:1,hassort:0,submit:!0,editType:1}})):this.$router.replace({name:"pageOrder",query:{id:this.id,p:this.p,editType:this.editType,uid:this.uid,admin:this.admin,isTeamBook:this.isTeamBook,isPart:this.isPart,history:this.history,iscomplete:this.iscomplete,fromAdmin:this.$route.query.fromAdmin,fromAlipyShopCart:this.$route.query.fromAlipyShopCart,photoBecomBook:this.$route.query.photoBecomBook}})}}},Do=Jo,Bo=(a("0efa"),Object(b["a"])(Do,Co,Po,!1,null,"ac33c72e",null)),Ko=Bo.exports,Mo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"body-bg2",style:{overflowY:e.isCalendar?"hidden":"auto"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[i("canvas",{staticClass:"hideCanvas",staticStyle:{border:"1px solid #000000"},attrs:{id:"screenShot"}})]),i("header",{attrs:{id:"audioPlay"}},[i("div",{staticClass:"weui-navbar coupon-navbar"},[i("a",{staticClass:"left sjky",on:{click:function(t){return e.goback()}}},[e._v("")]),i("span",{staticClass:"right"},[i("button",{staticClass:"btn",on:{click:function(t){return e.changeCalendar()}}},[e.isCalendar?i("img",{attrs:{src:a("e070")}}):i("img",{attrs:{src:a("57b3a")}})]),i("button",{staticClass:"btn",on:{click:function(t){return e.toPhotoOrder()}}},[e._v("图片顺序")]),i("button",{staticClass:"btn",on:{click:function(t){return e.toDesign()}}},[e._v("高级编辑")]),i("button",{staticClass:"btn2",on:{click:e.showSave}},[e._v("提交")])])])]),e.isCalendar?i("calendar",{ref:"calendar",staticStyle:{"justify-content":"flex-start","margin-top":"10px"},attrs:{vm:e.vm,detail:e.detailJson,pageLists:e.items,time:e.time,pageKey:e.pageKey,isSubmit:e.isSubmit}}):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isCalendar,expression:"!isCalendar"}],staticClass:"sjky-design-area2",staticStyle:{"padding-bottom":"180px"},attrs:{id:"drawing-waterfall"}}),i("footer",{staticClass:"weui-btn-area sjky-btn-bottom bottomSubmit"},[e.isSubmit?i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh",attrs:{href:"javascript:void(0);"},on:{click:e.showTemplate}},[e._v("提交")]):e._e(),!e.isSubmit&&e.showSubmit?i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh",on:{click:function(t){return e.makeSimple()}}},[e._v("我也去做")]):e._e()]),e._m(0),e._m(1),i("div",{staticClass:"weui-popup__container",attrs:{id:"addPop"}},[i("div",{staticClass:"weui-popup__overlay sjky-mask"}),i("div",{staticClass:"weui-popup__modal addressOut"},[i("address-form",{attrs:{pageKey:e.pageKey},on:{addinfo1:e.addinfo1,closep:e.closep}})],1)]),i("form",{attrs:{id:"submitForm",method:"post"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design"},[i("div",{staticClass:"con",staticStyle:{"background-color":"#26C6DA"}},[i("img",{attrs:{src:a("f46a")}}),i("p",{staticStyle:{color:"#FFFFFF"}},[e._v(e._s(e.wenanText))])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowPop,expression:"isShowPop"}],staticClass:"weui-popup__container popup-bottom sjky-point-none temp-out temp-out2 weui-popup__container--visible",attrs:{id:"popTemplate3"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),i("div",{staticClass:"weui-popup__modal"},[i("div",{staticClass:"toolbar"},[i("div",{staticClass:"proTit proTitClass"},e._l(e.itemsList,function(t,a){return i("span",{key:t.id,class:{on:a==e.itemIndex},on:{click:function(i){return e.changeItem(t,a)}}},[e._v(e._s(t.name))])}),0)]),i("div",{staticClass:"modal-content sjky-modal-padding"},[i("ul",{staticClass:"sjky-template sjky-template2",attrs:{id:"materialWrap"}},e._l(e.decorateList,function(t,a){return i("li",{key:a,class:{on:a==e.decorateIndex},on:{click:function(i){return e.changeImage(t,a)}}},[0==a?i("div",{staticClass:"sjky-img-wrap",staticStyle:{width:"2.8rem"}}):e._e(),0!=a?i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:t.previewimage}})]):e._e()])}),0)])])])],1)},$o=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-popup__container",attrs:{id:"sharePop"}},[i("div",{staticClass:"weui-popup__overlay sjky-mask"}),i("div",{staticClass:"weui-popup__modal"},[i("img",{attrs:{src:a("cff1"),width:"100%"}}),i("a",{staticClass:"weui-btn weui-btn_default sjky-btn-wh close-popup",attrs:{href:"javascript:void(0);"}},[e._v("关闭")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"submit-modal"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"})]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])}],Uo=a("d2f0"),Wo=Uo["a"],Fo=(a("6655"),a("6a7a"),Object(b["a"])(Wo,Mo,$o,!1,null,"29d090af",null)),Ro=Fo.exports,qo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.showLoading,expression:"showLoading"}],staticClass:"loading-design"},[e._m(0)])},Go=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"con"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v("正在加载中...")])])}],zo=a("8f67"),Ho=zo["a"],Vo=Object(b["a"])(Ho,qo,Go,!1,null,null,null),Yo=Vo.exports,Xo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"success-wrap"},[i("img",{attrs:{src:a("d284")}}),i("h1",[e._v("正在跳转提交页面...")]),i("p",[e._v("设计单号："+e._s(e.code))]),i("p",[e._v("跳转路径："+e._s(e.redirectUrl))]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showBtn,expression:"showBtn"}]},[i("a",{staticClass:"weui-btn weui-btn_primary",on:{click:function(t){return e.goSubmit()}}},[e._v("手动跳转")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showBtn,expression:"showBtn"}],staticClass:"tips"},[e._v("如果页面长时间不跳转，请手动点击跳转按钮")])])},Qo=[],Zo={name:"wait ",data:function(){return{code:"",uid:"",redirectUrl:"",isSimple:0,orderNo:"",showBtn:!1}},created:function(){if(this.code=this.$route.query.code,this.uid=this.$route.query.uid,this.redirectUrl=decodeURI(this.$route.query.redirectUrl),this.isSimple=this.$route.query.isSimple,this.orderNo=this.$route.query.orderNo,-1!=window.location.href.indexOf("https")&&-1==this.redirectUrl.indexOf("https")&&-1==this.redirectUrl.indexOf("sjky.")){var t=this.redirectUrl.split("http");this.redirectUrl="https"+t[1]}try{window._jylog&&(window._jylog.push(["按钮点击","中转页面","进入中转",this.isSimple,this.orderNo]),startUploadLog())}catch(e){console.log(e)}var i=navigator.userAgent.toLowerCase(),a=this;setTimeout(function(){a.showBtn=!0;try{window._jylog&&window._jylog.push(["按钮点击","中转页面","跳转页面","自动",a.orderNo])}catch(e){console.log(e)}"guochao"!=a.$route.query.source||"alipayclient"!=i.match(/AlipayClient/i)&&"undefined"==typeof my&&"toutiaomicroapp"!=i.match(/ToutiaoMicroApp/i)?window.location.href=a.redirectUrl:("alipayclient"!=i.match(/AlipayClient/i)&&"undefined"==typeof my||my.navigateBack({delta:1e3}),"toutiaomicroapp"==i.match(/ToutiaoMicroApp/i)&&tt.miniProgram.navigateBack({delta:1e3}))},2e3)},methods:{goSubmit:function(){try{window._jylog&&window._jylog.push(["按钮点击","中转页面","跳转页面","手动",this.orderNo])}catch(e){console.log(e)}var t=navigator.userAgent.toLowerCase();"guochao"!=this.$route.query.source||"alipayclient"!=t.match(/AlipayClient/i)&&"undefined"==typeof my&&"toutiaomicroapp"!=t.match(/ToutiaoMicroApp/i)?window.location.href=this.redirectUrl:("alipayclient"!=t.match(/AlipayClient/i)&&"undefined"==typeof my||my.navigateBack({delta:1e3}),"toutiaomicroapp"==t.match(/ToutiaoMicroApp/i)&&tt.miniProgram.navigateBack({delta:1e3}))}}},es=Zo,ts=(a("bd61"),Object(b["a"])(es,Xo,Qo,!1,null,"821a0822",null)),is=ts.exports,as=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"has-cover sjky-design-area2",staticStyle:{"padding-bottom":"50px",padding:".5rem .2rem"},attrs:{id:"drawing"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowArea||e.isShowPhoto,expression:"isShowArea || isShowPhoto"}],staticStyle:{height:"500px",width:"100%"}}),i("button",{staticClass:"ecd-tips-button",on:{click:function(t){return e.goPreview()}}},[e._v(e._s(e.flag?"提交":"请点击头像上传照片"))]),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowArea,expression:"isShowArea"}],staticClass:"ecd-upload-area popup-window example_box"},[i("p",{staticClass:"text_box"},[e._v("上传示例")]),i("div",{staticClass:"img_box"},[i("img",{attrs:{src:a("9800"),alt:""}})]),i("div",{staticClass:"tips_box"},[i("p",[i("img",{attrs:{src:a("533d"),alt:""}}),i("span",[e._v("人脸清晰无遮挡")])]),i("p",[i("img",{attrs:{src:a("533d"),alt:""}}),i("span",[e._v("背景干净简单")])]),i("p",[i("img",{attrs:{src:a("533d"),alt:""}}),i("span",[e._v("单人正脸最佳")])])]),i("div",{staticClass:"btns_box"},[i("button",{staticClass:"ecd-tips-button",on:{click:function(t){return e.isknow()}}},[e._v(" 知道了 ")])])])]),i("transition",{attrs:{name:"fade"}},[i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowPhoto,expression:"isShowPhoto"}],staticClass:"ecd-upload-area popup-window area_box"},[i("div",{staticClass:"text_box"},[e._v("上传记录")]),i("div",{staticClass:"area_imgs_box",attrs:{id:"uploadHistory"}},e._l(e.imageArr,function(t,a){return i("div",{key:a,staticClass:"area_imgs",staticStyle:{height:"100px"},on:{click:function(i){return e.handleResult_debounce(t)}}},[i("img",{staticStyle:{height:"100px",width:"100px"},attrs:{src:-1==t.src.indexOf("commonUpload")?t.src:t.src.replace("fsferry/","").replace("commonUpload/","")+"?token="+e.thumbnailToken}})])}),0),i("button",{staticClass:"ecd-tips-button",on:{click:function(t){return e.uploadStart()}}},[e._v(" 上传照片 ")])])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowText,expression:"isShowText"}],staticClass:"ecd-upload-area popup-window isShowText"},[i("div",{staticClass:"textarea_box"},[i("p",[i("span",{on:{click:function(t){return e.closeAllPop()}}},[e._v("<修改文字")])]),i("div",{staticClass:"content"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.myText,expression:"myText"}],ref:"focusTextarea",staticClass:"sjky-textarea-txt",attrs:{id:"wenziTextArea",placeholder:"想说点什么呢？"},domProps:{value:e.myText},on:{click:function(t){return t.stopPropagation(),e.textAreaFocus(t)},input:function(t){t.target.composing||(e.myText=t.target.value)}}}),i("div",[i("button",{on:{click:e.cancelChangeText}},[e._v("取消")]),i("button",{on:{click:e.enterCHangeText}},[e._v("确定")])])]),i("ul",{staticClass:"sjky-txt-name"},e._l(e.allFontInfo,function(t,o){return i("li",{key:o,on:{click:function(i){return i.stopPropagation(),e.changTextFontFamily(t.name)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.success,expression:"fontItem.success"}],staticStyle:{position:"absolute",right:"1px",bottom:"1px",width:"10px",height:"10px"},attrs:{src:a("d1ae")}}),i("img",{staticClass:"sjky-txt-name-img",attrs:{src:e.fontUrl+t.image}})])}),0)])]),i("button",{staticStyle:{display:"none"},attrs:{id:"filePicker"}},[e._v("picker")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design"},[i("div",{staticClass:"con",staticStyle:{"background-color":"#26C6DA"}},[i("img",{attrs:{src:a("f46a")}}),i("p",{staticStyle:{color:"#FFFFFF"}},[e._v(e._s(e.wenanText))])])])],1)},os=[],ss=a("75fc"),ns=(a("5df3"),a("4f7f"),a("08b0")),rs=a("7337"),ls=a("20ca");function ds(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function cs(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ds(i,!0).forEach(function(t){Object(L["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ds(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var hs={name:"edcbook",components:{},data:function(){var e;return e={editObjArr:[],isTeambook:!1,pageKey:null,normalKey:ee["f"],pageAndIndex:null,isShow:!1},Object(L["a"])(e,"pageKey",null),Object(L["a"])(e,"isBeyond",!1),Object(L["a"])(e,"isLowPixel",!1),Object(L["a"])(e,"editType",1),Object(L["a"])(e,"multiple",!0),Object(L["a"])(e,"pageIdArr",[]),Object(L["a"])(e,"imageArr",[]),Object(L["a"])(e,"placeHolderSet",new Set),Object(L["a"])(e,"nowIndex",""),Object(L["a"])(e,"submitText","请点击头像上传照片"),Object(L["a"])(e,"wenanText",""),Object(L["a"])(e,"isShowLoading",!1),Object(L["a"])(e,"isWeixin",!1),Object(L["a"])(e,"isAlipay",!1),Object(L["a"])(e,"isInitSvgEvent",!1),Object(L["a"])(e,"isShowArea",!1),Object(L["a"])(e,"isShowPhoto",!1),Object(L["a"])(e,"isShowText",!1),Object(L["a"])(e,"isecd",!0),Object(L["a"])(e,"myText",""),Object(L["a"])(e,"maxuploadnum",1),Object(L["a"])(e,"fontUrl",J["a"].baseUrl2),Object(L["a"])(e,"flag",!1),Object(L["a"])(e,"thumbnailToken",""),Object(L["a"])(e,"server",{uploadData:{},token:"",upload:J["a"].basicUrl+"/upload/photo"}),e},created:function(){console.log(rs["a"]),this.pageKey=ee["b"],document.body.style.position="absolute",this.isAlipay=this.$route.query.isAlipay,this.isWeixin=this.$route.query.isWeixin;var e=navigator.userAgent.toLowerCase();if("alipayclient"!=e.match(/AlipayClient/i)&&!this.isAlipay||1!=this.$route.query.fromRecommend||(this.token=this.$route.query.token,localStorage.setItem(this.pageKey.token,this.token)),this.isSimple=this.$route.query.isSimple,this.id=this.$route.query.id,this.isPart=this.$route.query.isPart,this.p=this.$route.query.p,this.isTeamBook=this.$route.query.isTeamBook,this.isfirst=this.$route.query.isfirst,this.isChangxian=this.$route.query.isChangxian,this.isWeixin=this.$route.query.isWeixin,this.token=localStorage.getItem(this.pageKey.token),this.logFrom("早教书设计"),!this.$route.query.uid){var t=localStorage.getItem(this.pageKey.token);if(null==t||void 0==t||"null"==t||"undefined"==t)return void this.$router.push({name:"404"})}this.server.uploadData.token=this.token,this.getCommonUploadConfig(),this.$store.dispatch("getFontCss")},mounted:function(){var e=navigator.userAgent.toLowerCase();if(("alipayclient"==e.match(/AlipayClient/i)||isAlipay)&&1==this.$route.query.fromRecommend){for(var t in ee["b"])localStorage.removeItem(ee["b"][t]);for(var i in ee["c"])localStorage.removeItem(ee["c"][i]);this.token=this.$route.query.token,localStorage.setItem(this.pageKey.token,this.token);var a=this;loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;if("detailJson"==t.messageType){console.log(e);var i=e.data.data,o=JSON.stringify(i);localStorage.setItem(a.pageKey.detailJson,o),a.$store.dispatch("updatePages",i),a.diytype=i.diyType,localStorage.setItem(a.pageKey.diytype,i.diyType);var s={goodsname:"",id:"",memberid:"",orderNo:"",productNo:i.sku,source:"",url:""},n=JSON.stringify(s);localStorage.setItem(a.pageKey.orderInfo,n);var r=e.data.info;console.log(r),localStorage.setItem(a.pageKey.goodsid,r.goodsid),localStorage.setItem(a.pageKey.productId,r.productId),localStorage.setItem(a.pageKey.motherid,r.motherid),localStorage.setItem(a.pageKey.pnum,r.pnum),localStorage.setItem(a.pageKey.uploadCalenderTemp,JSON.stringify(r.uploadCalenderTemp)),a.$store.dispatch("getAllFontInfo").then(function(e){$("#drawing").empty(),a.query()}).catch(function(e){console.log(e),a.alertMessage("模板数据加载失败")}),a.getSkuSet(),a.resetClaendarTemp(i,0)}};var e=localStorage.getItem(a.pageKey.detailJson);e||my.postMessage({messageType:"want-detailJson"})})}this.query(),this.isInitSvgEvent||(Object(Wa["b"])(this),this.isInitSvgEvent=!0)},methods:{query:function(){var e=this;this.$store.dispatch("getAllFontInfo").then(function(t){var i=localStorage.getItem(e.pageKey.detailJson);if(i&&"undefined"!=i)i=JSON.parse(i),e.$store.dispatch("updatePages",i),e.isUpdate=!1,e.pageIdArr=Object(V["c"])("#drawing",e.detailJson,e,null),e.getCurrentFinish();else{var a={};a.tid=e.id,a.imgs=[],a.token=e.token,a.gid=localStorage.getItem(e.pageKey.goodsid),a.pid=localStorage.getItem(e.pageKey.productId),a.pnum=e.p,a.edittype=1,a.mid=e.mid,a.sku=JSON.parse(localStorage.getItem(e.pageKey.orderInfo)).productNo,a.pageKey=e.pageKey;var o=localStorage.getItem(e.pageKey.numIndex);if(o&&null!=o&&(a.startPage=o),"-1"==e.id&&(a.jijian=!0),"0"==e.hassort?a.hassort=!0:a.hassort=!1,a.seconded=e.seconded,e.isTeamBook&&!e.isPart&&(a.loadCover=e.loadCover),e.isTeamBook&&(1==e.isTeamBook||"true"==e.isTeamBook)&&(a.isTeamBook=!0,a.uid=e.uid,e.isPart&&(1==e.isPart||"true"==e.isPart))){a.isPart=!0;var s=localStorage.getItem(e.pageKey.changxian);1==s&&(a.changxian=JSON.parse(localStorage.getItem(e.pageKey.changxianIdArray)))}e.$store.dispatch("getJsonFun",a).then(function(t){if(0==t.result)return e.isShowLoading=!1,localStorage.setItem(e.pageKey.ableSelect,!1),void e.alertMessage(t.msg);var i=JSON.parse(t.data);-1==e.id&&localStorage.setItem(e.pageKey.previewImage,i.pageList[0].previewImagePath),1==i.isvideo&&(e.hasVideo=!0,"alipayclient"==ua.match(/AlipayClient/i)&&layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){my.navigateBack()})),i.isguali?(e.detailJson.diyType="wall_calendar",e.detailJson.templateInfo.diyType="wall_calendar"):e.diytype=i.diyType,localStorage.setItem(e.pageKey.diytype,e.diytype),e.isUpdate=!1,e.pageIdArr=Object(V["c"])("#drawing",e.detailJson,e,null);var a=JSON.stringify(e.detailJson);localStorage.setItem(e.pageKey.detailJson,a),e.getCurrentFinish()}).catch(function(t){console.log(t),e.isShowLoading=!1,localStorage.setItem(e.pageKey.ableSelect,!1),e.alertMessage(t.msg)})}})},goEditor:function(e,t,i){try{this.detailJson.pageList.length;if(this.pageClick=!0,t){var a=!1;if(-1!=t.id.indexOf("decrorate_")){var o=t.id.split("_");if(this.detailJson.pageList[Number(o[1])].content.itemList[Number(o[2])]){var s=this.detailJson.pageList[Number(o[1])].content.itemList[Number(o[2])];s.cutArea&&s.cutArea.fromAiCut&&(a=!0)}}if(-1!=t.id.indexOf("bgimg_photo_")||-1!=t.id.indexOf("decrorate_")&&a){try{this.handleSpeLetter()}catch(i){console.log(i)}this.isUpdateDom=!0;for(var n=this.detailJson.pageList[e].content.itemList,r=0;r<n.length;r++)if("advancedImageMask"==n[r].media.mediaType||n[r].cutArea&&n[r].cutArea.fromAiCut&&"image"==n[r].media.mediaType){var l;"advancedImageMask"==n[r].media.mediaType?l=SVG("#maskBg_"+e+"_"+r):n[r].cutArea.fromAiCut&&(l=SVG("#clip_"+e+"_"+r));var d=document.documentElement.scrollTop||document.body.scrollTop,c=i.clientY+d;0==d&&0!=e&&(c=i.clientY+(0-$("#drawing").position().top)),console.log("scrollTop:"+d),console.log("position:"+$("#drawing").position().top);var h=pointHitObj(i.pageX,c,l,e,this.detailJson);if(h){this.isShow=!0,localStorage.setItem(this.pageKey.ableSelect,!0),this.unSelectAll();var g=r;this.pageAndIndex=e+"_"+g,console.log("wRatio",this.detailJson.pageList[e].content.itemList[g].wRatio),console.log("hRatio",this.detailJson.pageList[e].content.itemList[g].hRatio),console.log("crop",this.detailJson.pageList[e].content.itemList[g].crop),this.detailJson.pageList[e].content.itemList[g].crop&&(console.log("crop-height",this.detailJson.pageList[e].content.itemList[g].crop.height),console.log("crop-width",this.detailJson.pageList[e].content.itemList[g].crop.width),console.log("crop-x",this.detailJson.pageList[e].content.itemList[g].crop.x),console.log("crop-y",this.detailJson.pageList[e].content.itemList[g].crop.y));break}}}else if(this.pageAndIndex&&-1==this.pageAndIndex.indexOf("undefined")){if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),void(that.showMoreBtn=!0);this.handleSpeLetter();var m=this.pageAndIndex.split("_");this.pageAndIndex=e+"_"+m[1];var p=this.detailJson.pageList[e].content.itemList[m[1]];p&&p.media.mediaType==$a["a"].TEXT&&(this.myText=p.media.text)}else this.pageAndIndex=e+"_"+void 0;this.removeClassAll("caledborder");var u="svg_"+e;SVG("#"+u).addClass("caledborder")}}catch(i){console.log(i)}this.pageAndIndex.split("_")[0]!=e&&(this.pageAndIndex=e+"_"+void 0),$(".tcBtn").hide(),$(".thBtn").hide(),$(".thp").hide(),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"mug_cup"!=this.diytype&&"fashion_photo"!=this.diytype&&"template_cloth"!=this.diytype&&-1==this.detailJson.pageList[e].title.indexOf("封面")&&-1==this.detailJson.pageList[e].title.indexOf("封底")&&this.detailJson.pageList[e].hasWarn&&this.tipsCount<2&&this.tipsCount++,this.editShowModel(e)},isknow:function(){var e=this.pageAndIndex.split("_");this.detailJson.pageList[e[0]].content.itemList[e[1]].mediatag&&!this.detailJson.pageList[e[0]].content.itemList[e[1]].hasImage&&(this.isShowArea=!1,this.imageArr.length>0?this.isShowPhoto=!0:this.uploadStart(),document.body.style.overflow="hidden")},clickDecrorate:function(){console.log("clcccccccc:",this.pageAndIndex),this.isShowText=!1;var e=this.pageAndIndex.split("_");this.detailJson.pageList[e[0]].content.itemList[e[1]].mediatag&&!this.detailJson.pageList[e[0]].content.itemList[e[1]].hasImage&&(this.isShowArea=!0,document.body.style.overflow="hidden")},replaceDecrorateOrText:function(){console.log(this.pageAndIndex),this.isShowText=!1;var e=this.pageAndIndex.split("_");-1==this.pageAndIndex.indexOf("undefined")&&(this.detailJson.pageList[e[0]].content.itemList[e[1]].media.mediaType!=$a["a"].TEXT?this.imageArr.length>0?this.isShowPhoto=!0:this.isShowArea=!0:this.openTextPanel(),document.body.style.overflow="hidden")},openTextPanel:function(){if(this.isShowText=!0,this.pageAndIndex){var e=this.pageAndIndex.split("_"),t=this.detailJson.pageList[e[0]].content.itemList[e[1]];if(t&&t.media.mediaType==$a["a"].TEXT){var i=$a["a"].TEXT+"_"+e[0]+"_"+e[1],a=SVG("#"+i);a&&(this.myText=a.text())}}else this.myText=""},closeAllPop:function(){this.isShowArea=!1,this.isShowPhoto=!1,this.isShowText=!1,document.body.style.overflow="scroll"},getCalenderTemp:function(e){var t=this;t.imageArr=[],Object(H["E"])(e).then(function(e){var i=null;if(i="string"==typeof e?JSON.parse(e):e,i.result){var a=null;if(a="string"==typeof i.data?JSON.parse(i.data):i.data,""!=a&&a.length>0)for(var o=0;o<a.length;o++){var s={isUse:!0};s.index=o,s.id=a[o].id,s.name=a[o].name,s.url=a[o].picname;var n=localStorage.getItem(t.pageKey.thumbnailToken);s.src=Object(Q["d"])(a[o].picname)+Object(Q["e"])(a[o].picname,a[o].imageinfo,n);Object(q["a"])(a[o].imageinfo);if(""!=a[o].imageinfo){var r=JSON.parse(a[o].imageinfo),l="";l=r.primaryImageInfo?r.primaryImageInfo:r,s.dateTime=r.dateTime,s.width=l.width,s.height=l.height,(l.width<requireWidth||l.height<requireHeight)&&(s.pixellow=1)}t.imageArr.push(s)}}})},unSelectAll:function(){for(var e in this.editObjArr){var t=this.editObjArr[e][1],i=this.editObjArr[e][0];t.borderControl.borderAndControlHide(i),i.click=!1}},removeClassAll:function(e){for(var t=0;t<this.pageIdArr.length;t++){var i=this.pageIdArr[t];SVG("#"+i)&&SVG("#"+i).removeClass(e)}},editShowModel:function(e){var t=this.detailJson.pageList.length;0==e&&1==this.detailJson.pageList[e].iscover&&(this.showModelInfo=0,this.showInfo=!1,this.showInfoTitle=!0,this.showInfoFoot=!1,this.title="封面"),1!=this.detailJson.pageList[e].iscover&&1!=this.detailJson.pageList[e].isbackcover&&(this.showModelInfo=1,this.showInfo=!0,this.showInfoTitle=!1,this.showInfoFoot=!1),e==t-1&&1==this.detailJson.pageList[e].isbackcover&&(this.showModelInfo=2,this.showInfo=!1,this.showInfoTitle=!1,this.showInfoFoot=!0,this.title="封底")},documentDelegation:function(e,t){if(-1==this.editObjArr.indexOf(t)){var i=[];i=[e,t],this.editObjArr.push(i)}if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),e.myText="",void(e.showMoreBtn=!0)},getNowItemIndex:function(){return this.pageAndIndex},addFilePreview:function(e,t,i){return this.showLoading(),!0},uploadSuccess:function(t,i){console.info(t);var a=this;console.info("上传成功");try{window._jylog&&window._jylog.push(["按钮点击","宫格设计","普通上传","",""])}catch(e){console.log(e)}if(this.server.s3flag||this.server.commonUpload)if("success"==i.result&&i.data[0].uploadResult||i.success&&i.data){var o={};if(o.token=this.token,this.server.commonUpload){var s=i.data;o.filename=s.filePath,o.originalName=s.fileName,s.prefix&&(o.prefix=s.prefix),o.ImageInfo={},o.ImageInfo.width=Number(s.width),o.ImageInfo.height=Number(s.height),o.ImageInfo.fileMd5=s.md5,s.dateTime&&(o.ImageInfo.dateTime=s.dateTime),o.lastModifiedDate=t.lastModifiedDate}else{s=i.data[0];o.filename=s.lookPath,o.store=s.store,o.originalName=s.oldFileName,o.ImageInfo={},o.ImageInfo.width=Number(s.widthpx),o.ImageInfo.height=Number(s.hightpx),o.ImageInfo.fileMd5=s.fileMd5,s.dateTime&&(o.ImageInfo.dateTime=s.dateTime),o.lastModifiedDate=t.lastModifiedDate}o=JSON.stringify(o),$.ajax({type:"POST",url:J["a"].basicUrl+"/upload/savephotoinfo",data:o,dataType:"json",contentType:"application/json",success:function(e){a.handleResult(e),a.getCalenderTemp(a.token)}})}else a.photoFailHandle(i.data[0].uploadMessage,t);else"1"==i.r?(a.handleResult(i),a.getCalenderTemp(a.token)):a.photoFailHandle("S3上传失败",t)},handleResult_debounce:function(e){var t=this;Object(ls["a"])(function(){t.handleResult(e)},300)()},handleResult:function(e){var t=this;this.showLoading("正在处理照片");var i=this.pageAndIndex.split("_"),a=this.detailJson.pageList[i[0]].content.itemList[i[1]],o=a.mediatag;if(console.log(Object({NODE_ENV:"production",VUE_APP_TITLE:"production",BASE_URL:"/jianying/"})),"cutout_head"==o||"cutout_body"==o){var s;this.showLoading("正在更换照片");var n={id:e.id,type:o};Object(H["U"])(n).then(function(e){if(console.log(e),e.data){var i=e.data;t.handleMattingImage(i,o),t.hideLoading()}else t.alertMessage(e.msg),t.hideLoading()}).catch(function(e){console.log(e),t.alertMessage("抠图失败,请重新试试"),t.hideLoading()})}else{var r={location:{},media:{}};r.location.factWidth=s.width,r.location.factHeight=s.height,s.url=Object(Q["d"])(s.url)+Object(Q["a"])(s.url,r,this.pageKey),this.handleDesign(s)}},handleMattingImage:function(e,t){var i=this.pageAndIndex.split("_"),a=this.detailJson.pageList[i[0]].content.itemList[i[1]];if("cutout_head"==t){if(e.faceanalysis.face_num<1)return this.hideLoading(),void this.showMessage("无法检测到照片中的人脸");if(e.faceanalysis.face_num>1)return this.hideLoading(),void this.showMessage("照片中的人脸数量不能大于1");if(e.faceanalysis.points.length>0&&e.faceanalysis.points[0].length>21){var o,s,n=e.faceanalysis.points[0][5],r=e.faceanalysis.points[0][21],l=(n[0]+r[0])/2,d=(n[1]+r[1])/2,c=e.width/2,h=e.height,g=c-l,m=h-d;console.log("offsetX:"+g),console.log("centerY:"+m),a.headPlaceLocation?(o=a.headPlaceLocation,s=a.headPlacePrintLocation,a.location.rotation!=o.rotation&&(a.location.rotation=o.rotation,a.printLocation.rotation=s.rotation)):(o=JSON.parse(JSON.stringify(a.location)),s=JSON.parse(JSON.stringify(a.printLocation)),a.headPlaceLocation=o,a.headPlacePrintLocation=s);var p,u=o.width/o.height,f=e.width/e.height,y=(c=s.x+s.width/2,s.y+s.height/2),_=o.x,v=o.y,w=0-o.rotation,b=Object(Va["b"])(_,v,w,c,y),I=0,S=0;if(u>f){var x=o.width;a.location.width=o.height*f,p=o.height/e.height,I=(x-a.location.width)/2}else{var k=o.height;a.location.height=o.width/f,p=o.width/e.width,S=(k-a.location.height)/2}console.log("imageOffsetX:",I),console.log("imageOffsetY:",S);b=Object(Va["b"])(_,v,w,c,y);b=Object(Va["b"])(b.x+g*p+I,b.y+m*p+S,0-w,c,y),a.location.x=b.x,a.location.y=b.y;var O=Object(Va["a"])(a.location.x,a.location.y,a.location.width,a.location.height,o.rotation);a.printLocation.height=O.height,a.printLocation.width=O.width,a.printLocation.x=O.x,a.printLocation.y=O.y}}var L={location:{},media:{}};L.location.factWidth=e.width,L.location.factHeight=e.height,e.url=Object(Q["d"])(e.url)+Object(Q["a"])(e.url,L,this.pageKey),this.handleDesign(e)},handleDesign:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰替换","",JSON.parse(i).orderNo])}}catch(e){}var a=this.pageAndIndex.split("_");this.detailJson.pageList[a[0]].content.itemList[a[1]];this.detailJson.pageList[a[0]].content.itemList[a[1]].tagid=t.tagid,this.detailJson.pageList[a[0]].content.itemList[a[1]].hasImage=!0,this.detailJson.pageList[a[0]].content.itemList[a[1]].media.imgPath=t.url;var o=JSON.stringify(this.detailJson);localStorage.setItem(this.pageKey.detailJson,o),this.$store.dispatch("updatePages",this.detailJson),this.isUpdate=!1,this.isUpdateDom=!0;var s="#svg_"+a[0],n=!1,r=!0,l=!0,d={detailJson:this.detailJson,pageId:s,vm:this,isEdit:n,isPhotoChange:r,isChangeModel:l};SVG(s).remove(),Object(ns["a"])(a[0],d),this.pageClick=!0,SVG(s).addClass("caledborder"),this.pageAndIndex=a[0]+"_undefined",this.getCurrentFinish(),this.hideLoading(),this.closeAllPop()},getCurrentFinish:function(){var e,t=!0,i=0,a=!0,o=!1,s=void 0;try{for(var n,r=this.detailJson.pageList[Symbol.iterator]();!(a=(n=r.next()).done);a=!0){var l=n.value,d=!0,c=!1,h=void 0;try{for(var g,m=l.content.itemList[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var p=g.value;if(p.mediatag&&!p.hasImage){t=!1,console.log("ij:",e,i);break}i++}}catch(u){c=!0,h=u}finally{try{d||null==m.return||m.return()}finally{if(c)throw h}}if(0==t)break;e++}}catch(u){o=!0,s=u}finally{try{a||null==r.return||r.return()}finally{if(o)throw s}}this.flag=t},photoFailHandle:function(e,t){this.hideLoading(),this.closeAllPop()},uploadError:function(e,t){this.hideLoading(),this.closeAllPop()},getApiSign:function(t,i){var a=this;Object(H["i"])(t,i).then(function(t){var i=t.userData;wx.config({debug:!1,appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonceStr,signature:i.signature,jsApiList:["chooseImage","uploadImage","closeWindow"]}),wx.error(function(t){console.log(t);try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","早教书设计","警告","获取签名失败！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("获取签名失败！")}),localStorage.setItem(a.pageKey.accessToken,i.accessToken)}).catch(function(t){console.log("catch data::",t);try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示","早教书设计","警告","调用上传方法失败！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("调用上传方法失败！")})},getCommonUploadConfig:function(){var t=this,i=this,o=localStorage.getItem(this.pageKey.token);try{if(window._jylog){var s=localStorage.getItem(this.pageKey.orderInfo),n="调用newgetCommonUploadConfig的token===="+o;window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"早教书上传":"早教书上传页面","newgetCommonUploadConfig早教书进入设计",n,JSON.parse(s).orderNo])}}catch(e){}Object(H["n"])(o).then(function(o){o.result&&(i.server.commonUpload=o.data.commonUpload,i.server.commonUpload?i.isWeixin?(i.server.appKey=o.data.appKey,i.server.appSecret=o.data.appSecret,i.server.serverKey=o.data.serverKey,i.server.unionId=o.data.unionId,i.server.upload=J["a"].basicUrl+"/upload/wxPhoto"):(i.server.uploadData.appKey=o.data.appKey,i.server.uploadData.appSecret=o.data.appSecret,i.server.uploadData.serverKey=o.data.serverKey,i.server.uploadData.unionId=o.data.unionId,i.server.uploadData.ipAddress=o.data.ipAddress,i.server.upload=J["a"].commonuploadapi+o.data.uploadUrl,i.thumbnailToken=o.data.base64Token,localStorage.setItem(i.pageKey.thumbnailToken,o.data.base64Token)):(console.info(i.server.upload),console.info(J["a"].commonuploadapi+o.data.uploadUrl)),t.getCalenderTemp(t.token),t.isWeixin?a.e("chunk-2d0d0999").then(a.bind(null,"6955")).then(function(a){if(console.log(a),No=a.loadGonggeUpload,a.startUpload,Eo=a.startTihuanUpload,t.isWeixin){var o=window.location.href;t.getApiSign("",encodeURIComponent(o))}if("function"==typeof No)try{No(i.server,i,!0)}catch(n){try{if(window._jylog){var s=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["早教书设计","警告",n,JSON.parse(s).orderNo])}}catch(e){console.log(e)}i.$layer.alert(n),No(i.server,i,!0)}}):t.isAlipay?a.e("chunk-747cf2f1").then(a.bind(null,"3c326")).then(function(a){if(console.log(a),No=a.loadGonggeUpload,a.startUpload,Eo=a.startTihuanUpload,"function"==typeof No)try{No(i.server,i,!0)}catch(s){try{if(window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["早教书设计","警告",s,JSON.parse(o).orderNo])}}catch(e){console.log(e)}i.$layer.alert(s),No(i.server,i,!0)}}):a.e("chunk-2d0aecdd").then(a.bind(null,"0c2f")).then(function(a){if(console.log(a),No=a.loadGonggeUpload,a.startUpload,Eo=a.startTihuanUpload,"function"==typeof No)try{No(i.server,i,!0)}catch(s){try{if(window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["早教书设计","警告",s,JSON.parse(o).orderNo])}}catch(e){console.log(e)}i.$layer.alert(s),No(i.server,i,!0)}})),console.log(o)})},getS3UpConfig:function(){var t=this,i=this;Object(H["H"])().then(function(o){o.result&&(i.server.s3flag=o.data.s3flag,i.server.s3flag?(i.isWeixin?i.server.upload=J["a"].basicUrl+"/upload/wxPhoto":i.server.upload=J["a"].uploadapi+o.data.s3url,i.server.uploadData.appkey=o.data.appkey,i.server.uploadData.methodId=o.data.methodId,i.server.uploadData.sign=o.data.sign,i.server.uploadData.checkId=o.data.checkId):(console.info(i.server.upload),console.info(J["a"].uploadapi+o.data.s3url)),t.isWeixin?a.e("chunk-2d0d0999").then(a.bind(null,"6955")).then(function(a){if(console.log(a),No=a.loadGonggeUpload,a.startUpload,Eo=a.startTihuanUpload,t.isWeixin){var o=window.location.href;t.getApiSign("",encodeURIComponent(o))}if("function"==typeof No)try{No(i.server,i,!0)}catch(n){try{if(window._jylog){var s=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["早教书设计","警告",n,JSON.parse(s).orderNo])}}catch(e){console.log(e)}i.$layer.alert(n),No(i.server,i,!0)}}):t.isAlipay?a.e("chunk-747cf2f1").then(a.bind(null,"3c326")).then(function(a){if(console.log(a),No=a.loadGonggeUpload,a.startUpload,Eo=a.startTihuanUpload,"function"==typeof No)try{No(i.server,i,!0)}catch(s){try{if(window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["早教书设计","警告",s,JSON.parse(o).orderNo])}}catch(e){console.log(e)}i.$layer.alert(s),No(i.server,i,!0)}}):a.e("chunk-2d0aecdd").then(a.bind(null,"0c2f")).then(function(a){if(console.log(a),No=a.loadGonggeUpload,a.startUpload,Eo=a.startTihuanUpload,"function"==typeof No)try{No(i.server,i,!0)}catch(s){try{if(window._jylog){var o=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["早教书设计","警告",s,JSON.parse(o).orderNo])}}catch(e){console.log(e)}i.$layer.alert(s),No(i.server,i,!0)}})),console.log(o)})},handleSpeLetter:function(){var t=this;if(t.pageAndIndex&&-1==t.pageAndIndex.indexOf("undefined")){var i=t.pageAndIndex.split("_"),a=i[0],o=i[1];if(!t.detailJson.pageList[a].content.itemList[o])return;if(!t.detailJson.pageList[a].content.itemList[o].media.text)return;var s=t.detailJson.pageList[a].content.itemList[o].media.text;t.detailJson.pageList[a].content.itemList[o].media.mediaType==$a["a"].TEXT&&"yes"==t.detailJson.pageList[a].content.itemList[o].moveable&&t.checkSpeLetter(s,a,o).then(function(i){var n=i.data;if(n){if(s!=n.newText){t.myText=n.newText,SVG("#text_"+a+"_"+o).text(t.myText),t.detailJson.pageList[a].content.itemList[o].media.text=n.newText;var r=JSON.stringify(t.detailJson);localStorage.setItem(t.pageKey.detailJson,r),t.$store.dispatch("updatePages",t.detailJson),t.$layer.closeAll();var l=navigator.userAgent,d=(navigator.aVersioppn,!!l.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/));if(d){var c=t.detailJson.pageList[a].title;t.$layer.alert(c+" 页面，您输入的特殊字符系统不支持!已删除,请检查该页")}else{c=t.detailJson.pageList[a].title;t.$layer.alert(c+" 页面，您输入的以下字符："+n.speText+"系统不支持!已删除,请检查该页")}}}else{t.$layer.closeAll();try{if(window._jylog){var h=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","装饰上传","特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！"+file.type,JSON.parse(h).orderNo])}}catch(e){}t.$layer.alert("特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！")}}).catch(function(i){console.log(i),t.$layer.closeAll();try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","装饰上传",'特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！" + error'+file.type,JSON.parse(a).orderNo])}}catch(e){}t.$layer.alert("特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！"+i)})}},checkSpeLetter:function(e,t,i){var a={};if(a.text=e,this.detailJson.pageList[t].content.itemList[i].media.font)return a.fontid=this.detailJson.pageList[t].content.itemList[i].media.font.id,new Promise(function(e,t){Object(Ga["a"])(a).then(function(t){e(t)}).catch(function(e){t(e)})})},changTextFontFamily:function(t){if(console.log(t),this.pageAndIndex){var i=this,a=this.pageAndIndex.split("_"),o=this.detailJson.pageList[a[0]].content.itemList[a[1]];if(o){if(o.media.mediaType!=$a["a"].TEXT)return;var s=$a["a"].TEXT+"_"+a[0]+"_"+a[1],n=SVG("#"+s);if(n){var r=function(t,a,o){var s=document.getElementById(n.id()).getBBox().width,r=document.getElementById(n.id()).getBBox().height;n.width(s),n.height(r),n.borderControl.updateBorderAndControl(n.borderControl,n);var l=i.allFontInfo,d="",c="";for(var h in l)if(l[h].name==t){d=l[h].id,i.$set(i.allFontInfo[h],"success",!0);break}for(var h in l)if(l[h].id==a.media.font.id){c=l[h].name;break}if(""!=d&&d){try{if(window._jylog){var g=c+"--"+t,m=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","改变字体",g,JSON.parse(m).orderNo])}}catch(e){console.log(e)}a.media.font.id=d,Object(qa["a"])(n,a,o,i)}else i.$layer.alert("字体ID设置失败！")};FontDetect.isFontLoaded(t)?(n.font({family:t}),r(t,o,this.detailJson),Object(za["a"])(i,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,i.detailJson,a[0],null,null,null,null,!0)):(i.showLoading("正在更换字体"),FontDetect.onFontLoaded(t,function(e){i.hideLoading(),$.toast("字体下载成功，已成功更换字体"),console.log(t+"字体下载成功"),n.font({family:t}),r(t,o,i.detailJson),Object(za["a"])(i,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,i.detailJson,a[0],null,null,null,null,!0)},function(a){i.hideLoading(),console.log(t+"字体下载失败");try{if(window._czc){var o=localStorage.getItem(i.pageKey.orderInfo);window._jylog&&window._jylog.push(["弹窗提示","设计","警告","字体下载失败，点击确定重新下载",JSON.parse(o).orderNo])}}catch(e){console.log(e)}layer.alert("字体下载失败，点击确定重新下载",{shadeClose:!1},function(e){i.changTextFontFamily(t),layer.close(e)})},{msTimeout:3e3}))}}else i.showLoading("正在更换字体"),FontDetect.onFontLoaded(t,function(e){i.hideLoading(),console.log(t+"字体下载成功");var a=i.allFontInfo;for(var o in a)if(a[o].name==t){i.$set(i.allFontInfo[o],"success",!0);break}},function(e){i.hideLoading(),console.log(t+"字体下载失败"),layer.alert("字体下载失败，点击确定重新下载",{shadeClose:!1},function(e){i.changTextFontFamily(t),layer.close(e)})},{msTimeout:3e3})}},textAreaFocus:function(e){this.pageClick=!0,localStorage.setItem(this.pageKey.ableSelect,!0),console.log("点点")},changeText:function(e){if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),this.myText="",void(this.showMoreBtn=!0);if(this.pageAndIndex&&-1==this.pageAndIndex.indexOf("undefined")){var t=this.pageAndIndex.split("_"),i=Number(t[0]),a=Number(t[1]),o=this.detailJson.pageList[i].content.itemList[a];if(o.media.mediaType!=$a["a"].TEXT)return;"no"==o.moveable&&(o.moveable="yes");var s=$a["a"].TEXT+"_"+t[0]+"_"+t[1],n=SVG("#"+s);if(n){if(""==this.myText){n=SVG("#"+s);n.parent().remove(),this.pageAndIndex=t[0]+"_undefined",this.detailJson.pageList[i].content.itemList.splice(a,1);var r=JSON.stringify(this.detailJson);localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",this.detailJson),this.editObjArr=[];var l="#svg_"+t[0],d=!1,c=!0,h=!0,g={detailJson:this.detailJson,pageId:l,vm:this,isEdit:d,isPhotoChange:c,isChangeModel:h};return SVG(l).remove(),void Object(ns["a"])(t[0],g)}n.text(this.myText);var m=this.checkTextWidth(this.myText,s,t[0]);n.text(m),this.myText=m,Object(ne["a"])(n,o),o.media.text=m;var p=!1;for(var u in this.allFontInfo)o.media.font&&this.allFontInfo[u].id==o.media.font.id&&(p=!0);!p&&o.media.font&&(o.media.font.id=this.allFontInfo[0].id);var f=document.getElementById(s).getBBox().width,y=document.getElementById(s).getBBox().height;n.width(f),n.height(y);var _=Object(za["a"])(this,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,this.detailJson,t[0],null,null,null,null,!0);if(_){f=document.getElementById(s).getBBox().width,y=document.getElementById(s).getBBox().height;n.width(f),n.height(y)}n.borderControl.borderAndControlShow(n.borderControl),n.borderControl.updateBorderAndControl(n.borderControl,n),this.documentDelegation(n.borderControl,n),Object(qa["a"])(n,o,this.detailJson,this),Object(ne["b"])(n,o,t[0],t[1])}}else{if(window._jylog){var v=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","添加文字","",JSON.parse(v).orderNo])}t=this.pageAndIndex.split("_");var w=this.detailJson.pageList[t[0]].content.itemList.length,b=(this.detailJson.pageList[t[0]].diyDisplayWidth,this.detailJson.pageList[t[0]].diyDisplayWidth/this.regularW),I=JSON.parse(JSON.stringify(Ua["a"]));I.media.font.pointSize=I.media.font.pointSize*b,e&&"string"==typeof e&&(I.media.font.gravity=e);var S=JSON.parse(localStorage.getItem(this.pageKey.detailJson));if("template_cloth"==S.diyType){var x=!0,k=!1,O=void 0;try{for(var L,T=S.pageList[t[0]].content.itemList[Symbol.iterator]();!(x=(L=T.next()).done);x=!0){var C=L.value;if(C.isDesignShape){var P=S.pageList[t[0]].diyWorkAreaWidth/S.pageList[t[0]].workAreaWidth;I.location.x=C.location.x,I.printLocation.x=C.location.x,I.location.y=C.location.y,I.printLocation.y=C.location.y;break}}}catch(H){k=!0,O=H}finally{try{x||null==T.return||T.return()}finally{if(k)throw O}}}if("week_calendar"==S.diyType){var j=!0,A=!1,N=void 0;try{for(var E,J=S.pageList[t[0]].content.itemList[Symbol.iterator]();!(j=(E=J.next()).done);j=!0){var B=E.value;if(B.isDesignShape){P=S.pageList[t[0]].diyWorkAreaWidth/S.pageList[t[0]].workAreaWidth;I.location.x=B.location.x+Ha["a"].banhuaBleedSpace*P+10,I.printLocation.x=B.location.x+Ha["a"].banhuaBleedSpace*P+10,I.location.y=B.location.y+Ha["a"].weekTopSpace*P+10,I.printLocation.y=B.location.y+Ha["a"].weekTopSpace*P+10;break}}}catch(H){A=!0,N=H}finally{try{j||null==J.return||J.return()}finally{if(A)throw N}}}var K=/[\f\t\v]+/g;this.myText=this.myText.replace(K," ");var M=/^[\s]+/;this.myText=this.myText.replace(M,""),I.media.text=this.myText,I.media.font.id=this.allFontInfo[0].id;var U=w;if(S.pageList[t[0]].content.itemList.length==w){var W=S.pageList[t[0]].content.itemList;S.pageList[t[0]].content.itemList[w]=I,W.splice.apply(W,[w-1,1].concat(Object(ss["a"])(W.splice(w,1,W[w-1]))));r=JSON.stringify(S);localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",S),this.pageAndIndex=t[0]+"_"+(w-1),U=w-1}else layer.alert("添加文字失败，请刷新页面后重新添加",function(e){layer.close(e)});var F,R=this.detailJson.pageList[t[0]].content.itemList.length-1;if("calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype||this.detailJson.pageList.length<=1&&""!=this.detailJson.pageList[t[0]].content.itemList[R].media.imgPath){var q;SVG("#svg_"+t[0]).children();q=document.getElementById("group"+t[0]+"_"+U),SVG("#group"+t[0]+"_"+U)&&SVG("#group"+t[0]+"_"+U).remove(),q?(q.id="group"+t[0]+"_"+(U+1),q.children[0].id="#decrorate_"+t[0]+"_"+(U+1)):q=document.getElementById("group"+t[0]+"_"+(U+1))}SVG("#group_"+t[0]+"_"+U)?F=SVG("#group_"+t[0]+"_"+U):(F=SVG("#svg_"+t[0]).group(),F.attr({id:"group"+t[0]+"_"+U,style:"overflow:hidden"}));var G={pageIndex:t[0],itemIndex:U,isEdit:!0,vm:this},z=new D["a"](F,I,G);z.initCustomText();s=$a["a"].TEXT+"_"+t[0]+"_"+U,n=SVG("#"+s);n.addClass("text_style"),n.text(this.myText);m=this.checkTextWidth(this.myText,s,t[0]);n.text(m),this.myText=m,Object(ne["a"])(n,I),I.media.text=m,S.pageList[t[0]].content.itemList[U].media.text=m;r=JSON.stringify(S);localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",S);f=document.getElementById(s).getBBox().width,y=document.getElementById(s).getBBox().height;n.width(f),n.height(y);_=Object(za["a"])(this,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,S,t[0],null,null,null,null,!0);if(_){f=document.getElementById(s).getBBox().width,y=document.getElementById(s).getBBox().height;n.width(f),n.height(y)}n.borderControl.borderAndControlShow(n.borderControl),n.borderControl.updateBorderAndControl(n.borderControl,n),this.documentDelegation(n.borderControl,n),Object(qa["a"])(n,I,this.detailJson,this),Object(ne["b"])(n,S.pageList[t[0]].content.itemList[U],t[0],U),"calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype||this.detailJson.pageList.length<=1&&""!=this.detailJson.pageList[t[0]].content.itemList[R].media.imgPath?q&&document.getElementById("svg_"+t[0]).appendChild(q):this.updateBleedLine(t[0],w,S)}},updateBleedLine:function(e,t,i){for(var a=SVG("#svg_"+e).children(),o=0;o<a.length;o++){var s=a[o].children();s[0]&&(-1!=s[0].id().indexOf("bleedLine_")&&a[o].remove())}var n,r=SVG("#svg_"+e).group();r.attr({id:"group"+e+"_"+(t+1),style:"overflow:hidden"}),2==i.templateInfo.coverper&&i.coverInfo.hascover&&(n=!0);var l=new Ra["a"](r,null,e,t+1,i,n,this);l.initBleedLine()},enterCHangeText:function(){this.changeText(),this.isShowText=!1,document.body.style.overflow="scroll"},checkTextWidth:function(e,t,i){document.getElementById(t).getBBox().width;var a=SVG("#"+t),o=this.detailJson.pageList[i].diyWorkAreaWidth/this.detailJson.pageList[i].workAreaWidth,s=Ha["a"].productBleedSpace,n=(Ha["a"].productBleedSpace,Ha["a"].yignkeProductBleedSpace),r=Ha["a"].rkBleedSpace,l=Ha["a"].bookSpace,d=Ha["a"].rkBookSpace;if(this.detailJson.pageList[i].pageBleed&&""!=this.detailJson.pageList[i].pageBleed){var c=this.detailJson.pageList[i].pageBleed;s=Number(c.r),Number(c.t)}this.detailJson.templateInfo.spinewidth&&""!=this.detailJson.templateInfo.spinewidth&&(l=this.detailJson.templateInfo.spinewidth,d=this.detailJson.templateInfo.spinewidth);var h=this.detailJson.pageList[i].content.itemList[0].location.x,g=(this.detailJson.pageList[i].content.itemList[0].location.y,h+s*o);"calendar"==this.diytype||"year_calendar"==this.diytype||"wall_calendar"==this.diytype||this.diytype;var m=this.detailJson.pageList[i].diyDisplayWidth-g-a.x();if("calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype){var p=this.detailJson.pageList[i].content.itemList[0].location.width;m=h+p-s*o-a.x()}if(2==this.detailJson.templateInfo.coverper&&this.detailJson.coverInfo.hascover&&0==i){g=h+n*o;var u=localStorage.getItem(this.pageKey.rk);4==u&&(g=h+r*o),m=this.detailJson.pageList[i].diyDisplayWidth-g-a.x();var f=g,y=(this.detailJson.pageList[i].diyDisplayWidth-2*g-l*o)/2;u=localStorage.getItem(this.pageKey.rk);4==u&&(y=(this.detailJson.pageList[i].diyDisplayWidth-2*g-d*o)/2);var _=g+y,v=this.detailJson.pageList[i].diyDisplayWidth-g-y,w=this.detailJson.pageList[i].diyDisplayWidth-g;a.x()>=f&&a.x()<=_&&(m=_-a.x()),a.x()>=v&&a.x()<=w&&(m=w-a.x())}var b=a.font("size"),I=/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]\u2764/g;e.match(I)&&(e=e.replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\u2764/g,""),this.showMessage("内容含有特殊字符，已删除"));for(var S=e.split(/[(\r\n)\r\n]+/),x=S.length-1;x>=0;x--){var k=/[ \f\t\v]+/g;S[x]=S[x].replace(k," ")," "==S[x]&&S.splice(x,1)}for(var O=parseInt(m/b),L=[],T=0;T<S.length;T++){var C=S[T].split("");if(S[T].length>=O){for(var P=parseInt(S[T].length/O),j=1;j<=P;j++)C.splice(O*j-1,0,"\n");L.push(C.join(""))}else T<S.length-1?L.push(S[T]+"\n"):L.push(S[T])}return L.join("")},toastTips:function(e,t){if(t)e.length>1&&$.toast("为您顺序选择1张照片");else{var i=this.getIncompletePhoto();e.length>i&&$.toast("您选择的照片数大于最大照片数，为您顺序选择"+i+"张照片")}},cancelChangeText:function(){this.isShowText=!1,document.body.style.overflow="scroll"},measureText:function(e,t){var i=e.split("\n"),a=i[0];for(var o in i)i[o].length>a.length&&(a=i[o]);var s=a.length*t.font("size");return s},alertMessage:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","早教书设计","警告",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.$layer.alert(t)},showLoading:function(e){this.wenanText=e,this.isShowLoading=!0},hideLoading:function(){this.isShowLoading=!1},goPreview:function(){this.flag&&this.$router.push({name:"preview",query:{id:this.id,p:this.p,editType:this.editType,submit:!0,isEcdbook:!0,fromDesign:!0}})},uploadStart:function(){this.isShowArea=!1,Eo()},showMessage:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","早教书设计","提示",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.$layer.alert(t)},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录","早教书设计",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}}},computed:cs({},Object(E["b"])(["detailJson","allFontInfo"])),watch:{photos:function(e){},detailJson:function(){this.isUpdateDom&&this.isUpdate}}},gs=hs,ms=(a("41be"),Object(b["a"])(gs,as,os,!1,null,"499b9ce0",null)),ps=ms.exports,us=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"template"},[i("div",{staticClass:"sjky-img-edit editImage new1-editImage",attrs:{id:"modelPreview"}},[i("div",{staticClass:"sjky-design-img",attrs:{id:"modelPreviewShow"}},[i("div",{staticClass:"sjky-modal-preview new1-sjky-modal-preview"},e._l(e.previewImageUrlArr,function(t,a){return i("div",{style:e.covers&&0==a?1==e.covers?"width:50%;":"width:100%;":e.backCover&&a==e.previewImageUrlArr.length?"width:50%;":1==e.pagePer?"width:48%;float:left;margin:0 1%":"width:100%;"},[i("img",{attrs:{src:t.imgurl},on:{load:e.reloadCom,error:e.handleImageLoaded}}),i("div",[i("span",[e._v(e._s(t.title))])])])}),0)]),e.isTeamBook?e._e():i("a",{staticClass:"btn-circle-theme",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design()}}},[e._v("上传图片("+e._s(e.minnum)+"-"+e._s(e.maxnum)+")")]),e.isTeamBook?i("div",{staticClass:"TeamBookShow preview-btn-group"},[i("div",{staticClass:"btn-circle-theme",staticStyle:{width:"40%",float:"left"}},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.showPartner()}}},[e._v("给小伙伴看看")])]),i("div",{staticClass:"btn-circle-theme",staticStyle:{width:"40%",float:"right"}},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.design()}}},[e._v("就它了")])])]):e._e()])])},fs=[],ys=(a("6b92"),a("23ed")),_s=a("054f");a("6b12");$(function(){$(".proTit span").eq(0).addClass("on"),$(".proTit span").on("click",function(){$(this).addClass("on").siblings().removeClass("on")})});var vs,ws,bs,Is,Ss,xs,ks,Os={name:"templatepreview",data:function(){return{isShowguid:!1,errorInfo:"",orderInfos:{},changeSelectDate:!1,changeDateShow:!1,chooseDateNow:"",chooseDateMiddleNow:"",showNum:!0,showReload:!1,checkReload:!1,productno:"",orderNo:"",memberid:"",doubble:!1,pageKey:null,normalKey:null,productId:"",goodsid:"",copyUrl:J["a"].copyUrl,imageArray:[],is_weixn:!1,is_alipay:!1,is_byte:!1,browser:{},templateId:0,dataArr:[],templates:[],templatesAll:[],decoratePageNum:1,totalNumberOfPages:"",startx:"",starty:"",direction:"",checkTop:"",albumid:"",items:[],price:"",history:[],page:{},pageList:[],startDate:"",endDate:"",flagURL:"",id:"",spmc:"",num:"",returnURL:"",oid:"",token:"",maxnum:"",minnum:"",isShowLoading:!1,iscaiyun:"",wenanText:"",previewImageUrl:"",previewImageUrlArr:[],prevImage:!1,nextImage:!1,imageIndex:0,isvideo:!1,pnum:"",tpnum:"",content:"",patternid:"",sort:"new",changeModelAll:!1,isTeamBook:!1,templateid:"",uid:null,source:"",wsid:"",avatarurl:"",totalStyleNum:"",nickname:"",isTS:!1,mobilestyleid:"",styleNum:1,ytid:"",appFlag:"",ycoverbacknum:"",fxOrderNo:null,value:"",shopname:"",firstModelShow:0,draftsNum:0,isPart:!1,isSimple:!1,hasDraft:!1,hasHistoryBack_tt:!1,covers:0,pagePer:1,backCover:0}},created:function(e){console.log("11"+this.$route.query),this.history=this.$route.query.history,this.history?this.pageKey=ee["c"]:this.pageKey=ee["a"];var t=localStorage.getItem("isAlipay"),i=(localStorage.getItem("isByte"),navigator.userAgent.toLowerCase());("undefined"!=typeof my||"alipayclient"==i.match(/AlipayClient/i)||t)&&(this.is_alipay=!0),"toutiaomicroapp"==i.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0),this.handleGoupload(this.$route.query)},mounted:function(){},beforeDestroy:function(){},methods:{handleGoupload:function(e){console.log(e);var t=this;t.minnum=localStorage.getItem("minnum"),t.maxnum=localStorage.getItem("maxnum"),t.previewImageUrlArr=[];var i=localStorage.getItem(this.pageKey.diytype);Object(H["x"])(e).then(function(a){for(var o in t.pagePer=a.data.spread.pagePer,t.covers=a.data.spread.covers,t.backCover=a.data.spread.backCover,a.data.coverInfo&&(a.data.coverInfo.hascover||(t.covers=0),a.data.coverInfo.hasbackcover||(t.backCover=0)),console.log(t.covers+"--"+t.backCover),a.data.imageList){var s={};localStorage.setItem(t.pageKey.thumbnailToken,a.data.base64Token);var n=new Image;n.src=Object(Q["d"])(a.data.imageList[o].previewimage)+Object(Q["h"])(a.data.imageList[o].previewimage,{},t.pageKey),s.imgurl=n.src,s.title="calendar"==i||"year_calendar"==i?a.data.imageList[o].title.replace(/(\d+)年(\d+)月/g,""):a.data.imageList[o].title,t.previewImageUrlArr.push(s)}t.previewImageUrl=t.previewImageUrlArr[t.imageIndex],localStorage.setItem(t.pageKey.previewImage,a.data.imageList[t.imageIndex].previewimage),null!=a.data.imageList&&""!=a.data&&(1==a.data.imageList.length||(t.nextImage=!0)),$(".editImage").show(),$(".mask").show(),t.queryTempId=e.tid})},reloadPic:function(){this.showNum=!0,this.showReload=!1,this.checkReload=!0,this.previewImageUrl=this.previewImageUrlArr[this.imageIndex]},reloadCom:function(){this.checkReload=!1},handleImageLoaded:function(){this.isShowLoading=!1,""==this.previewImageUrl||(this.checkReload?(this.showNum=!0,this.showReload=!1):(this.showNum=!1,this.showReload=!0)),this.previewImageUrl="img/img.png"},design:function(t){var i=this,a=this;document.body.removeEventListener("touchmove",function(){},!0),this.isShowLoading=!0,this.wenanText="努力跳转中";this.is_weixn;var o=this.is_byte,s=!1,n=JSON.parse(localStorage.getItem(this.pageKey.pnum)),r=(JSON.parse(localStorage.getItem(this.pageKey.uid)),localStorage.getItem(this.pageKey.numIndex));if(1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(s=!0),o)return this.isShowLoading=!1,void tt.miniProgram.navigateTo({url:"/pages/upload-page/upload-page?token="+a.token+"&sku="+this.productno+"&minnum="+this.minnum+"&maxnum="+this.maxnum+"&gid="+localStorage.getItem(this.pageKey.goodsid)+"&pid="+localStorage.getItem(this.pageKey.productId)+"&id="+this.queryTempId+(null==n||void 0==n||""==n?"":"&p="+n)+(null==r||void 0==r||""==r?"":"&numIndex="+r)+(null==s||void 0==s||""==s?"":"&isEditCover="+s)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+"&isContinueDesign=false&history=false&isPart=false&isfirst=true&hassort=0",success:function(e){this.isShowLoading=!1},fail:function(e){console.log("navigateTo调用失败"),this.isShowLoading=!0,this.wenanText="系统异常"}});var l=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)),d=l.goodsname;-1!=d.indexOf("竹木纹")&&localStorage.setItem(this.pageKey.cal_size,"竹木纹"),this.diytype;a=this;if(!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook)this.is_weixn?this.gofxUpload(this.queryTempId,this.minnum,this.maxnum):this.goUpload(this.queryTempId,this.minnum,this.maxnum);else{var c={};c.tid=this.queryTempId,c.albumid=this.albumid,c.token=this.token,c.gid=localStorage.getItem(this.pageKey.goodsid),c.pid=localStorage.getItem(this.pageKey.productId),c.pnum=localStorage.getItem(this.pageKey.pnum),c.edittype=1,c.mid=localStorage.getItem(this.pageKey.motherid),c.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,c.pageKey=this.pageKey,c.isTeamBook=this.isTeamBook,c.isVideo=this.videoupload,c.price=this.price,!c.isTeamBook||1!=c.isTeamBook&&"true"!=c.isTeamBook||(c.avatarurl=this.avatarurl,c.nickname=this.nickname);a=this;getTeamList(c).then(function(t){var a=null;if(a="string"==typeof t.data?JSON.parse(t.data):t.data,1==t.result)localStorage.setItem(i.pageKey.uid,a.uid),i.uid=a.uid,a.hasCoverABack?(localStorage.setItem(i.pageKey.minnum,a.coverBackPhotoNum),localStorage.setItem(i.pageKey.maxnum,a.coverBackPhotoNum),i.is_weixn?i.gofxUpload(i.queryTempId,i.minnum,i.maxnum):i.goUpload(i.queryTempId,i.minnum,i.maxnum)):i.goLandingPage(a.uid);else if(null!=a)localStorage.setItem(i.pageKey.uid,a.uid),i.uid=a.uid,a.coverBackPhotoNum&&a.coverBackPhotoNum>0?(localStorage.setItem(i.pageKey.minnum,a.coverBackPhotoNum),localStorage.setItem(i.pageKey.maxnum,a.coverBackPhotoNum),i.is_weixn?i.gofxUpload(i.queryTempId,i.minnum,i.maxnum):i.goUpload(i.queryTempId,i.minnum,i.maxnum)):i.goLandingPage(a.uid);else{try{if(window._jylog){var o=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","相册错误！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}layer.alert("相册错误！")}i.isShowLoading=!1,i.wenanText=""}).catch(function(t){try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","加载出现错误！",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("加载出现错误！"),a.isShowLoading=!1,a.wenanText=""})}},goUpload:function(e,t){var i=this.oid;if(null!=i&&""!=i&&void 0!=i&&"undefined"!=i&&"null"!=i){var a=this.orderNo;"fxxt"==this.source&&(a=this.fxOrderNo),e==JSON.parse(i)&&a==this.orderInfos.orderNo&&this.productno==this.orderInfos.productNo||(localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson)),localStorage.removeItem(this.pageKey.id)}else localStorage.removeItem(this.pageKey.id),localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson);!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||localStorage.setItem(this.pageKey.uid,this.uid);var o=localStorage.getItem(this.pageKey.diytype);"gongge"!=o?1==this.iscaiyun?this.$router.push({name:"upphoto",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.is_alipay?this.$router.push({name:"newalipayupload",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.$router.push({name:"newupload",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.$router.push({name:"gongge",query:{id:e,p:t,isfirst:!0}})}}},Ls=Os,Ts=(a("2927"),Object(b["a"])(Ls,us,fs,!1,null,null,null)),Cs=Ts.exports,Ps=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{},[e._m(0),i("div",{staticClass:"indextwo1"},[i("img",{ref:"element",style:e.scro<600?"width:60%;":e.scro<650?"width:65%;":e.scro<700?"width:70%;":e.scro<750?"width:75%;":e.scro<800?"width:80%;":"",attrs:{src:a("238a")}})]),i("div",{staticClass:"indextwobutton",style:e.scro<670?"bottom:70px;":e.scro<850?"bottom:80px;":e.scro<900?"bottom:90px;":e.scro<1100?"bottom:100px;":""},[i("button",{on:{click:e.goupload}},[e._v("立即定制")])]),i("div",{staticClass:"indexlastfont",style:e.scro<670?"bottom:30px;":e.scro<850?"bottom:40px;":e.scro<900?"bottom:50px;":e.scro<1100?"bottom:60px;":""},[e._v("\n\t\t开始定制您的专属挂历吧!\n\t")])])},js=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"indextwo"},[i("img",{attrs:{src:a("7f5f")}})])}],As={name:"guanLiIndex",data:function(){return{token:"",pageKey:"",scro:""}},created:function(){this.getToken(),this.pageKey=ee["a"]},mounted:function(){this.scro=document.body.clientHeight,this.$nextTick(function(){this.$refs.element.offsetHeight;var e=$(".indextwo1 img").height()+40;$(".indexlast").css("top",e+"px")})},methods:{goupload:function(){var e=this,t=(navigator.userAgent.toLowerCase(),navigator.userAgent),i=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);i?this.$router.push({name:"gualiupload",query:{token:e.token,minnum:13,maxPageNum:30}}):this.$router.push({name:"gualiuwechatpload",query:{token:e.token,minnum:13,maxPageNum:30}})},getToken:function(){var e=this,t=this;Object(H["Q"])("-1","yhqjd").then(function(i){1!=i.result&&"true"!=i.result||(t.token=i.token,localStorage.setItem(t.pageKey.token,t.token),localStorage.setItem(t.pageKey.source,"wsid"),localStorage.setItem(t.pageKey.wsid,e.wsid),localStorage.setItem(t.pageKey.minnum,"13"),localStorage.setItem(t.pageKey.maxnum,"30"))})}}},Ns=As,Es=(a("7843"),Object(b["a"])(Ns,Ps,js,!1,null,null,null)),Js=Es.exports,Ds=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("gualiWechat-base-upload",{attrs:{storageName:e.storageName,submitButtonName:e.submitButtonName,server:e.server,checksubmitstate:e.checksubmitstate,isTaoBan:!1,minPageNum:e.minPageNum,maxPageNum:e.maxPageNum,uploadcomplete:e.uploadcomplete,pageKey:e.pageKey},on:{baseUploadNextStep:e.nextStep}}),i("div",{staticClass:"weui-popup__container",attrs:{id:"addPop"}},[i("div",{staticClass:"weui-popup__overlay sjky-mask"}),i("div",{staticClass:"weui-popup__modal addressOut",staticStyle:{background:"#fff"}},[i("guali-address-form",{attrs:{pageKey:e.pageKey},on:{addinfo1:e.addinfo1,closep:e.closep}})],1)])],1)},Bs=[],Ks=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._m(0),i("div",{staticClass:"uploaderBox pr",attrs:{id:"uploadIndex"}},[i("a",{staticClass:"uploader_input sjky",attrs:{href:"javascript:void(0);",id:"loadUpload",title:"选择照片"}},[e._v("")]),e.minPageNum!=e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")]):e._e(),e.minPageNum!=e.maxPageNum||e.isTeamBook?e._e():i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"张照片")]),e.minPageNum==e.maxPageNum&&e.isTeamBook?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("建议上传"+e._s(e.minPageNum)+"张照片")]):e._e()]),i("section",{staticClass:"mobile_web pb100",attrs:{id:"uploadShow"}},[i("div",{staticClass:"weui-cells sjky-list-tip sjky-list-tip2 sjky-list-tip3",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell__hd"},[i("div",{staticClass:"checkbox weui-cells_checkbox"},[i("input",{staticClass:"weui-check weui-check_box2",attrs:{type:"checkbox",name:"photos"},on:{click:e.finishEdit_fx}}),i("i",{staticClass:"weui-icon-checked"})])]),e._m(1),i("div",{staticClass:"weui-cell__ft"},[[i("a",{staticClass:"sjky-btn-grey sjky-btn-grey2 delete-btn",attrs:{id:"deletephoto",href:"javascript:void(0);"},on:{click:function(t){return e.deletePic()}}},[e._v("删除("+e._s(e.chooseNumfx)+")")])]],2)]),i("a",{staticClass:"tips",staticStyle:{display:"none"},attrs:{id:"showIOSDialog2"},on:{click:function(t){return e.showModal("#px-photo")}}},[i("i",{staticClass:"weui-icon-warn vm"}),i("span",{staticClass:"vm"},[e._v("像素不足，可能影响印刷质量")])]),e._m(2)]),e._m(3),i("footer",{staticClass:"sjky-btn-bottom sjky-btn-bottom2",staticStyle:{display:"none"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipsFont,expression:"tipsFont"}],staticClass:"num-tips"},[e._v("\n\t\t\t\t          最少上传"+e._s(e.minPageNum)+"张，再上传几张吧。\n\t\t\t\t")]),i("div",{staticClass:"l tc addImagediv"},[i("a",{staticClass:"addImage",staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);",id:"addImage"}},[e._v("继续上传"),i("span",[e._v("("+e._s(e.upladNum)+")")])]),i("p",{attrs:{id:"info"}},[e._v("还需上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")])]),i("a",{staticClass:"weui-btn weui-btn_primary",staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);",id:"designGO"},on:{click:function(t){return e.nextfx()}}},[e._v("提交")]),i("div",[i("a",{staticClass:"weui-btn weui-btn_primary",staticStyle:{display:"none"},attrs:{href:"javascript:void(0);",id:"insertupload"},on:{click:e.changePhotoUploadListfx}},[e._v("加入上传("+e._s(e.chooseNumfx)+")")])])])]),e._m(4),i("section",{staticClass:"modal modal-out",attrs:{id:"px-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),e._m(5)]),e._m(6),e._m(7),i("section",{staticClass:"modal modal-out",attrs:{id:"morethan-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("我们根据您选取顺序上传"+e._s(e.arrnum)+"张")])]),e._m(8)]),e._m(9),i("section",{staticClass:"overlay"}),e._m(10),i("section",{staticClass:"modal modal-out",attrs:{id:"low-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("返回")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.nextStep()}}},[e._v("确定")])])]),e._m(11),i("section",{staticClass:"modal modal-out",attrs:{id:"duplicate-photo"}},[e._m(12),i("footer",{staticClass:"modal-buttons"},[i("span",{staticClass:"modal-button btn-cancel ddel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.resetupload()}}},[e._v("确定")])])]),e._m(13),e._m(14)])},Ms=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"anniu"},[i("button",{attrs:{id:"uploadbutton"}},[e._v("上传照片")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-cell__bd"},[i("div",[i("p",{staticClass:"sub-title",attrs:{id:"chooseNumShow"}},[e._v("全选")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{staticClass:"tips",staticStyle:{display:"none"},attrs:{id:"showIOSDialog3"}},[i("span",{staticClass:"vm icon-box sjky"},[e._v("")]),i("span",{staticClass:"vm"},[e._v("请上传PNG/JPG格式的图片")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"phoList clearfix page"},[i("div",{staticStyle:{display:"none"},attrs:{id:"filePicker"}}),i("div",{attrs:{id:"imageList"}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maskLayer",staticStyle:{display:"none"}},[i("p",[e._v("上传中")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"uping-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("正在上传中，请稍等！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"fail-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("有未成功加载的照片，请先删除！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"taoban-show"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("【随机套版】将对您上传的图片随机排版，暂时无法查看效果及修改的哦，建议您选择【我去设计】自由设计。")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("我知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"del-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("确认删除此照片？")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold ddel"},[e._v("确定")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"choose-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片上传失败")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel ddel"},[e._v("删除")]),i("span",{staticClass:"modal-button modal-button-bold aagain"},[e._v("重新上传")])]),i("input",{attrs:{type:"hidden",id:"file_id",value:""}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片重复，是否上传")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-denied"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片类型错误")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-size"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片过大")])])])}],$s=1e3,Us=1e3,Ws=0,Fs=0,Rs=0,qs=0,Gs=null,zs="进入设计",Hs="";function Vs(e,t,i,a,o){if(vs=!1,ws=new Array,bs=[],Is=[],Rs=e,qs=t,i.baseUrl,Gs=i.upload,ks=i,xs=o,Ss=a,"0"!=Rs&&"undefined"!=Rs){Rs=parseInt(Rs),qs=parseInt(qs);var s=localStorage.getItem(Ss.calenderTemp);if(null!=s&&"null"!=s&&"undefined"!=s){s=JSON.parse(s);var n=new Array,r=s.length;if(r>qs){for(var l=0;l<r;l++)l<qs&&n.push(s[l]);s=n}$.each(s,function(e,t){var i=new Image;i.src=t.src,t.index="L"+t.index;var a=$('<div id="uploadList_'+t.index+'" data-index="'+t.index+'" uploading="1" class="phoBox" style="background-image:url('+t.src+');"></div>');if(1==t.pixellow){var o=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');o.appendTo(a),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var s=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<input type="checkbox" class="weui-check weui-check_box_wx" onchange="changeBox_wx(this)" name="photos" id="photoCheck_'+t.index+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');s.appendTo(a),$("#imageList").prepend(a);var n={url:t.url,index:t.index,width:t.width,height:t.height,dateTime:t.dateTime,history:t.history,isUse:!0,id:t.id,name:t.name};ws.push(n)}),"none"==$("#showIOSDialog2").css("display")&&$("#showIOSDialog2").hide(),xs.upladNum=s.length,s.length>0?(localStorage.setItem(Ss.calenderTemp,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),s.length<Rs?$("#info").text("可上传"+Rs+"-"+qs+"张"):s.length<qs&&s.length>=Rs?($("#info").text("已上传"+s.length+"张，进入设计"),$("#designGO").css("pointer-events","auto")):(s.length>qs&&on("#morethan-photo"),$("#info").text("已上传"+s.length+"张，进入设计"),$("#designGO").css("pointer-events","auto"))):Rs==qs?$("#info").text("需上传"+Rs+"张照片"):$("#info").text("需上传"+Rs+"-"+qs+"张照片"),console.log("imageList:"),console.log(ws),console.log("imageArray:"),console.log(s)}else s=[],localStorage.setItem(Ss.calenderTemp,JSON.stringify(s));$("#addImage").bind("click",function(e){try{if(window._jylog){var t=localStorage.getItem(Ss.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信继续上传",xs.upladNum,JSON.parse(t).orderNo])}}catch(e){console.log(e)}$(".sjky-btn-greytxt").hide(),Xs()})}else alert("商品问题，请联系客服！")}var Ys=!1;function Xs(){Ys||(Ys=!0,setTimeout(function(){Ys=!1},1e3),wx.chooseImage({count:9,sizeType:["original"],sourceType:["album"],success:function(e){Ys=!0,setTimeout(function(){Ys=!1},3e3),$(".sjky-btn-greytxt").hide(),$(".weui-cell").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),$(".sjky-btn-bottom2").show(),Is=e.localIds;var t=localStorage.getItem(Ss.calenderTemp);if(null!=t&&""!=t&&"[]"!=t)if(t=JSON.parse(t),t.length+e.localIds.length<=qs)0==bs.length?(bs=e.localIds,console.log("aaaaa333==="+JSON.stringify(bs))):(bs=bs.concat(e.localIds),console.log("aaaaa444==="+JSON.stringify(bs))),ln();else{layer.open({content:"我们根据您选取顺序上传"+qs+"张",skin:"msg",time:3});for(var i=new Array,a=0;a<qs-t.length;a++)i.push(e.localIds[a]);bs=0==bs.length?i:bs.concat(i);var o=qs;o<=Is.length||(o=Is.length);for(a=0;a<o;a++)en(Is[a]),Ws++;bs.length>0&&Qs()}else if(e.localIds.length<=qs){0==bs.length?(bs=e.localIds,console.log("aaaaa1==="+JSON.stringify(bs))):(bs=bs.concat(e.localIds),console.log("aaaaa222==="+JSON.stringify(bs)));for(a=0;a<Is.length;a++)en(Is[a]),Ws++;bs.length>0&&Qs()}else{layer.open({content:"我们根据您选取顺序上传"+qs+"张",skin:"msg",time:3});for(i=new Array,a=0;a<Rs;a++)i.push(e.localIds[a]);bs=0==bs.length?i:bs.concat(i);for(a=0;a<Is.length;a++)en(Is[a]),Ws++;bs.length>0&&Qs()}},fail:function(e){onsole.log("aaaaa666===失败！！"),console.log(e),layer.open({content:e,skin:"msg",time:3})},complete:function(){}}))}var Qs=function(){var e=bs.shift();$("#waitUploadmask_"+Fs).hide(),$("#uploadMask_"+Fs).hide(),setTimeout(function(){Zs(e),"none"==$("#showIOSDialog2").css("display")&&($(".sjky-list-tip3").show(),$("#showIOSDialog2").hide())},200)};function Zs(t){vs=!0,Fs++,wx.uploadImage({localId:t,isShowProgressTips:1,success:function(i){var a=i.serverId;localStorage.setItem(Ss.serverId,a);var o=localStorage.getItem(Ss.accessToken),s=localStorage.getItem(Ss.token),n={mediaId:a,accessToken:o,commonUpload:ks.commonUpload,appKey:ks.appKey,appSecret:ks.appSecret,serverKey:ks.serverKey,unionId:ks.unionId,token:s};$.ajax({url:Gs,type:"post",dataType:"json",data:n,success:function(i){if("1"==i.r){try{if(window._jylog){var a=localStorage.getItem(Ss.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信上传",i.id,JSON.parse(a).orderNo])}}catch(e){console.log(e)}$("#uploadList_"+(Fs-1)).attr("uploading","1");var o="",s="",n="";i.imageInfo.primaryImageInfo?(o=i.imageInfo.primaryImageInfo.width,s=i.imageInfo.primaryImageInfo.height,n=i.imageInfo.primaryImageInfo.dateTime):(o=i.imageInfo.width,s=i.imageInfo.height,n=i.imageInfo.dateTime);var r={url:i.url,index:Fs-1,width:o,height:s,dateTime:n,id:i.id,isUse:!0,name:t};ws.push(r);var l=!1;if(o>=s?(o<$s||s<Us)&&(l=!0):(o<Us||s<$s)&&(l=!0),l&&($("#uploadDel_"+(Fs-1)).show(),$("#uploadMask_"+(Fs-1)).show(),$("#showIOSDialog3").hide()),window.localStorage){var d=[];$.each(ws,function(e,t){var i=gn(t.url)+mn(t.url,t.width,t.height,ks);console.info("src====================="+i),-1!=i.indexOf(ks.urlConfig.thumbnailUrl)&&(i=i.replace("commonUpload/",""),-1!=i.indexOf("fsferry")&&(i=i.replace("fsferry/","")),-1==i.indexOf("?token")&&(i=i+"?token="+localStorage.getItem(xs.pageKey.thumbnailToken))),$("#uploadList_"+t.index).attr("style","background-image:url("+i+");");var a=0;$("#uploadMask_"+t.index).is(":visible")&&(a=1);var o={url:t.url,index:t.index,src:i,pixellow:a,width:t.width,height:t.height,dateTime:t.dateTime,history:t.history,isUse:!0,id:t.id,name:t.name};d.push(o)}),localStorage.setItem(Ss.calenderTemp,JSON.stringify(d)),xs.upladNum=d.length,d.length<Rs?$("#info").text("可上传"+Rs+"-"+qs+"张"):d.length<qs&&d.length>=Rs?($("#info").text("可上传"+Rs+"-"+qs+"张, "+zs),$("#designGO").css("pointer-events","auto")):(d.length>qs&&on("#morethan-photo"),$("#info").text("可上传"+Rs+"-"+qs+"张, "+zs),$("#designGO").css("pointer-events","auto"))}}else{if($("#uploadFailure_"+(Fs-1)).show(),$("#uploadFailure_span_"+(Fs-1)).text("图片保存失败"),i){var c="返回结果："+JSON.stringify(i);xs.commonLog("微信九张上传",c)}$("#uploadDel_"+(Fs-1)).show(),$("#uploadList_"+(Fs-1)).attr("localId",t),$("#uploadList_"+(Fs-1)).attr("uploading","1")}bs.length>0?($("#uploadDel_"+(Fs-1)).show(),$("#uploadList_"+(Fs-1)).find(".upload-state").hide(),Qs()):(vs=!1,$("#loadingData").hide(),$(".upload-state").hide(),$(".sjky-btn-greytxt").show(),$(".sjky-btn-grey").show(),$(".weui-cell").show(),$("#uploadDel_"+(Fs-1)).show())},error:function(e){if($("#uploadFailure_"+(Fs-1)).show(),e){var i="返回结果："+JSON.stringify(e);xs.commonLog("微信九张上传",i)}if($("#uploadFailure_span_"+(Fs-1)).text("保存方法失败"),$("#uploadList_"+(Fs-1)).attr("localId",t),$("#uploadList_"+(Fs-1)).attr("uploading","1"),$("#uploadDel_"+(Fs-1)).show(),!(bs.length>0))return vs=!1,$("#loadingData").hide(),void $(".upload-state").hide();Qs()}})},fail:function(e){if($("#uploadFailure_"+(Fs-1)).show(),e){var i="返回结果："+JSON.stringify(e);xs.commonLog("微信九张上传",i)}if($("#uploadFailure_span_"+(Fs-1)).text("微信上传失败"),$("#uploadList_"+(Fs-1)).attr("localId",t),$("#uploadList_"+(Fs-1)).attr("uploading","1"),!(bs.length>0))return vs=!1,void $("#loadingData").hide();Qs()}})}function en(e){$("#loadingData").show();var t=$('<div id="uploadList_'+Ws+'" data-index="'+Ws+'" uploading="0" localId="" failCount="0" class="phoBox" style=""></div>'),i=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+Ws+'">\t<input type="checkbox" class="weui-check weui-check_box_wx" onchange="changeBox_wx(this)" name="photos" id="photoCheck_'+Ws+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');i.appendTo(t);var a=$('<div class="tips-pixel-out" id="uploadMask_'+Ws+'" style="display:none"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');a.appendTo(t);var o=$('   <div id="uploadFailure_'+Ws+'" class="waitUpload tc" style="display:none">\t\t<span id="uploadFailure_span_"'+Ws+' class="wh fs12 mt2 dib">网络连接异常</span>\t</div>');o.appendTo(t);var s=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">正在上传</p></div>');s.appendTo(t),t.attr("style","background-image:url("+e+");"),t.on("click",function(){var e=$(this).attr("uploading");if("0"!=e){var t=$(this).attr("data-index");$(this).attr("localId"),$(this).attr("failCount");$(".ddel").click(function(){tn(t)})}}),$("#imageList").prepend(t)}function tn(e){var t=new Array;if($.each(ws,function(i,a){a.index==e||t.push(a)}),ws=t,window.localStorage){var i=localStorage.getItem(Ss.calenderTemp);if(null!=i&&"null"!=i){i=JSON.parse(i);var a=new Array;$.each(i,function(t,i){i.index==e||a.push(i)}),i=a}else i=new Array;localStorage.setItem(Ss.calenderTemp,JSON.stringify(i)),xs.upladNum=i.length,i.length<Rs?$("#info").text("可上传"+Rs+"-"+qs+"张"):i.length<qs&&i.length>=Rs?($("#info").text("可上传"+Rs+"-"+qs+"张, "+zs),$("#designGO").css("pointer-events","auto")):(i.length>qs&&on("#morethan-photo"),$("#info").text("可上传"+Rs+"-"+qs+"张, "+zs),$("#designGO").css("pointer-events","auto")),0==i.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+Rs+"-"+qs+"张照片"));for(var o=!1,s=0;s<i.length;s++)if(1==i[s].pixellow){o=!0;break}o||$("#showIOSDialog2").hide();var n=$("#uploadList_"+e);n.remove()}}function an(e,t,i){$(".ddel").unbind("click"),$(".ddel").click(function(){for(var a=0;a<e.length;a++)e[a].checked&&(nn(e[a],t,i),0);rn();var o=localStorage.getItem(Ss.calenderTemp);o=null!=o&&"null"!=o?JSON.parse(o):[],Hs="已选"+xs.chooseNumfx+"张",$("#vm.chooseNumShow").html(Hs),$("#deletephoto").text("删除(0)"),$("#chooseNumNext").text("(0)")}),on("#del-photo")}function on(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)}function sn(e,t,i){layer.open({style:"width:5rem;",className:"layerSkin",content:"确定要删除吗？",btn:["确定","取消"],yes:function(a){var o=$(e).parent().attr("data-index"),s=new Array;if($.each(ws,function(e,t){console.log(e),console.log(t),t.index==o||s.push(t)}),ws=s,window.localStorage){var n=localStorage.getItem(Ss.calenderTemp);if(null!=n&&"null"!=n){n=JSON.parse(n);var r=new Array;$.each(n,function(e,t){t.index==o||r.push(t)}),n=r}xs.upladNum=n.length,n.length<t?$("#info").text("可上传"+t+"-"+i+"张"):n.length<i&&n.length>=t?($("#info").text("可上传"+t+"-"+i+"张, "+zs),$("#designGO").css("pointer-events","auto")):(n.length>i&&on("#morethan-photo"),$("#info").text("可上传"+t+"-"+i+"张, "+zs),$("#designGO").css("pointer-events","auto")),0==n.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var l=!1,d=0;d<n.length;d++)if(1==n[d].pixellow){l=!0;break}l||$("#showIOSDialog2").hide(),localStorage.setItem(Ss.calenderTemp,JSON.stringify(n))}$(e).parent().remove(),layer.close(a)}})}function nn(e,t,i){var a=$(e).parents(".phoBox").attr("data-index"),o=new Array,s={},n="";if($.each(ws,function(e,t){t.index==a?(0,n=t.id):o.push(t)}),""!=n&&(s.ids=n,s.materialType="al",ws=o,$.ajax({type:"POST",url:ks.urlConfig.basicUrl+"/diy/deleteimg",data:s,dataType:"json",success:function(e){}})),0==ws.length&&($(".weui-check_box2").attr("checked",!1),xs.checkAll=!1),window.localStorage){var r=localStorage.getItem(Ss.calenderTemp);if(null!=r&&"null"!=r){r=JSON.parse(r);var l=new Array;$.each(r,function(e,t){t.index==a||l.push(t)}),r=l}xs.upladNum=r.length,r.length<t&&$("#info").text("可上传"+t+"-"+i+"张"),r.length>=t&&r.length<i&&($("#info").text("可上传"+t+"-"+i+"张, 进入设计"),$("#designGO").css("pointer-events","auto"),$("#addImage").css("pointer-events","auto")),0==r.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var d=!1,c=0;c<r.length;c++)if(1==r[c].pixellow){d=!0;break}d||$("#showIOSDialog2").hide(),localStorage.setItem(xs.pageKey.calenderTemp,JSON.stringify(r)),ws=r}$(e).parents(".phoBox").remove(),xs.chooseNumfx=$("#imageList").find("input[type=checkbox]:checked").length}function rn(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)}function ln(){isConfirmUpload=!1,$("#uploadIndex").hide(),$("#uploadShow").show();var e=bs,t=[],i=[],a=localStorage.getItem(Ss.calenderTemp);if(null!=a&&""!=a&&void 0!=a){JSON.parse(a);for(var o=0;o<e.length;o++){for(var s=!1,n=o;n<e.length-1;n++)if(e[o]==e[n+1]){s=!0,isConfirmUpload=!0;break}null!=a&&"null"!=a&&"[]"!=a&&-1!=a.indexOf(e[o])&&(s=!0,isConfirmUpload=!0),s?i.push(e[o]):t.push(e[o])}if(isConfirmUpload)isConfirmUpload=!1,layer.open({skin:"unpload-layer",title:!1,content:'<p style="padding:10px 30px;font-size: 16px;">检测到重复图片<br/>是否上传这些重复的图片？</p>',btn:["上传","不上传"],closeBtn:0,yes:function(e){for(var t=0;t<Is.length;t++)en(Is[t]),Ws++;bs.length>0&&Qs(),layer.close(e)},btn2:function(e){console.log(t),bs=t;for(var i=0;i<t.length;i++)en(t[i]),Ws++;bs.length>0&&Qs(),layer.close(e)}});else{for(o=0;o<Is.length;o++)en(Is[o]),Ws++;bs.length>0&&Qs()}}}function dn(){return vs}function cn(){$(".sjky-btn-resettxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-greytxt").show();for(var e=$(".weui-check_box_wx"),t=0;t<e.length;t++)e[t].checked=!1;xs.chooseNumfx=0,Hs="已选0张",$("#vm.chooseNumShow").html(Hs)}function hn(){$(".sjky-btn-greytxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-resettxt").show();for(var e=$(".weui-check_box_wx"),t=0;t<e.length;t++)e[t].checked=!0;xs.chooseNumfx=e.length,Hs="已选"+e.length+"张",$("#vm.chooseNumShow").html(Hs)}function gn(e){return-1!=e.indexOf(ks.urlConfig.thumbnailUrl)?ks.urlConfig.thumbnailUrl:-1!=e.indexOf(ks.urlConfig.baseUrl)?ks.urlConfig.baseUrl:!e||-1==e.indexOf("material/")&&-1==e.indexOf("yingxiangdiy/")&&-1==e.indexOf("commonUpload/")?e&&(e.endsWith("svg")||e.endsWith("xml"))?ks.urlConfig.thumbnailUrl:e&&-1!=e.indexOf("oss-")?ks.urlConfig.ossPhotoUrl:e&&-1!=e.indexOf("img.alicdn.com")?"":-1!=e.indexOf(ks.urlConfig.orgBaseUrl)?ks.urlConfig.orgBaseUrl:ks.urlConfig.baseUrl:-1!=e.indexOf("yingxiangdiy/")?-1!=e.indexOf(ks.urlConfig.orgBaseUrl3)?ks.urlConfig.orgBaseUrl3:ks.urlConfig.baseUrl3:ks.urlConfig.thumbnailUrl}function mn(e,t,i,a){var o="";a.thumbnailToken&&(o=a.thumbnailToken);var s=0,n=0;if(!e||-1==e.indexOf("material/")&&-1==e.indexOf("/yingxiangdiy/")&&-1==e.indexOf("commonUpload/"))return e&&-1!=e.indexOf(".xml")?"mongo_yx/"+e+"?token="+o:e&&e.charAt(0)<="f"?(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,"mongo_yx/"+e+"!"+s+"x"+n+"?token="+o):e;if(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+s+"x"+n+"?token="+o;if(-1!=e.indexOf("commonUpload/")){var r=e.split("commonUpload/");return r[1]+"!"+s+"x"+n+"?token="+o}var l=e.split("/");return l.splice(1,0,s+"x"+n),l.join("/")}window.fxloadingDelimage=sn,window.changeBox_wx=changeBox_wx;new Array;var pn,un,fn,yn,_n,vn,wn,bn,In,Sn,xn=800,kn=800,On={name:"FxBaseUpload",props:["storageName","submitButtonName","uploadcomplete","minPageNum","maxPageNum","server","checksubmitstate","orderInfo","isTaoBan","pageKey"],data:function(){var e;return e={id:"",tipsFont:!1,isSimple:!1,pageNum:"",productId:"",calendar_type:"",p:-1,editing:!1,showDeleteModal:!1,flagURL:"",isTeamBook:!1,chooseNumfx:0,checkAll:!1,arrnum:""},Object(L["a"])(e,"isTeamBook",!1),Object(L["a"])(e,"upladNum",0),Object(L["a"])(e,"isfirst",0),Object(L["a"])(e,"storageNamebase",""),Object(L["a"])(e,"thumbnailToken",""),e},created:function(){this.isSimple=this.$route.query.isSimple;var e=localStorage.getItem(this.pageKey.id);this.isTeamBook=this.$route.query.isTeamBook;var t=localStorage.getItem(this.pageKey.isfirst),i=[];localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(i));var a=localStorage.getItem(this.pageKey.calenderTemp);t&&"1"==t?null==a||"[]"==a?this.isfirst=0:(this.isfirst=1,this.piclist=JSON.parse(a),this.upladNum=JSON.parse(a).length):(localStorage.setItem(this.pageKey.isfirst,this.isfirst),null==a||"[]"==a||(this.piclist=JSON.parse(a),this.upladNum=JSON.parse(a).length)),null==e||""==e||"undefined"==e?(this.id=this.$route.query.id,this.flagURL=this.$route.query.flagURL,localStorage.setItem(this.pageKey.id,this.id)):this.id=e,this.initjssdk()},mounted:function(){$(".zzz").click(function(){hideModal()});var t=localStorage.getItem(this.pageKey.source);this.flagURL=localStorage.getItem(this.pageKey.flagURL),"wechat"==this.flagURL&&(t="wechat",localStorage.setItem(this.pageKey.source,t));JSON.parse(localStorage.getItem(this.pageKey.goodsid));if(this.calendar_type=localStorage.getItem(this.pageKey.calendar_type),this.productId=JSON.parse(localStorage.getItem(this.pageKey.productId)),this.p=JSON.parse(localStorage.getItem(this.pageKey.pnum)),null==this.p&&(this.p=-1),1==this.isfirst){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","提示","改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("改变照片数量,或者排版方式都会改变设计页面的排版，请谨慎！")}var a=window.location.href;console.info("url"),console.info(a),this.getApiSign(t,encodeURIComponent(a)),$("#loadUpload").bind("click",function(e){$(".sjky-btn-greytxt").hide(),$(".sjky-btn-bottom2").show()}),this.arrnum=this.maxPageNum,this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},methods:{editPhotos:function(){this.editing=!0,$("#imageList").find(".checkbox").show(),$("#imageList").find(".btn-delete").hide()},finishEdit_fx:function(){this.checkAll?(cn(),this.checkAll=!1):(hn(),this.checkAll=!0)},deletePic:function(){var e=$("#imageList").find(".weui-check");e.length>0&&an(e,this.minPageNum,this.maxPageNum),this.editing=!1,$(".sjky-btn-resettxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-greytxt").show()},resetupload:function(){hideModal()},nextfx:function(){var e=localStorage.getItem(this.pageKey.calenderTemp);if(null!=e||void 0!=e){var t=JSON.parse(e);if(t.length<this.minPageNum)return void layer.alert("最少上传"+this.minPageNum+"张照片");this.$emit("baseUploadNextStep")}else layer.alert("最少上传"+this.minPageNum+"张照片")},nextfx11:function(){var e=this,t=dn();if(t)showConfirm("#uping-photo");else{var i=!1,a=localStorage.getItem(this.storageName);if(null!=a&&"null"!=a){if(a=JSON.parse(a),(this.isSimple||-1==this.id)&&a.length<this.minPageNum)return this.tipsFont=!0,void setTimeout(function(){e.tipsFont=!1},3e3);for(var o=0;o<a.length;o++)if(1==a[o].pixellow){i=!0;break}var s=[];if(this.uploadcomplete);else{var n=localStorage.getItem(this.pageKey.uploadCalenderTemp);if(n){var r=JSON.parse(n);s=r.concat(a)}else s=a}localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(s));var l=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(l=!0)}),l)showConfirm("#fail-photo");else{e=this;1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isSimple,e.nextStep(0)):i?this.showModal("#low-photo"):this.nextStep(1)}}}},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},nextStep:function(t){this.hideModal();var i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));try{if(window._czc){var a="";a=0==t?"时间排序":"智能排序",window._czc.push(["_trackEvent","剪影","上传页面",a])}if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","微信进入设计",a,JSON.parse(o).orderNo])}}catch(e){}this.$emit("baseUploadNextStep",this.id,this.p,i,t)},showUpload:function(){$(".uploadZoone").show(),$(".no-infor").hide()},getCalenderTemp:function(e){var t=[],i=this;Object(H["E"])(e).then(function(e){var a=null;if(a="string"==typeof e?JSON.parse(e):e,a.result){var o=null;if(o="string"==typeof a.data?JSON.parse(a.data):a.data,""!=o&&o.length>0)for(var s=0;s<o.length;s++){var n={isUse:!0};n.index=s,n.id=o[s].id,n.name=o[s].name,n.url=o[s].picname,n.history=!0,n.src=Object(Q["d"])(o[s].picname)+Object(Q["e"])(o[s].picname,o[s].imageinfo,i.thumbnailToken);Object(q["a"])(o[s].imageinfo);if(""!=o[s].imageinfo){var r=JSON.parse(o[s].imageinfo),l="";l=r.primaryImageInfo?r.primaryImageInfo:r,n.dateTime=r.dateTime,n.width=l.width,n.height=l.height,(l.width<xn||l.height<kn)&&(n.pixellow=1)}t.push(n)}var d=localStorage.getItem(i.pageKey.calenderTemp);if(null!=d&&void 0!=d||(d=[]),t.length>0){if(t.length==d.length)for(s=0;s<t.length;s++)if(t[s].id!=d[s].id){console.log(11111111111111111e39);break}localStorage.setItem(i.pageKey.historyCalenderTemp,JSON.stringify(t))}}i.handleImagehistoryuploadfx(!0,i.minPageNum,i.maxPageNum,i.storageNamebase,i)})},getApiSign:function(t,i){var a=this;Object(H["i"])(t,i).then(function(t){var i=t.userData;wx.config({debug:!1,appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonceStr,signature:i.signature,jsApiList:["chooseImage","uploadImage","closeWindow"]}),wx.error(function(t){console.log(t);try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","获取签名失败！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("获取签名失败！")}),localStorage.setItem(a.pageKey.accessToken,i.accessToken),$("#loadUpload").bind("click",function(e){Xs()})}).catch(function(t){console.log("catch data::",t);try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示",getQueryVariable("isSimple")?"极简上传":"上传页面","警告","调用上传方法失败！",JSON.parse(i).orderNo])}}catch(e){}layer.alert("调用上传方法失败！")})},getHistoryPhotofx:function(){$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").hide(),this.chooseNumfx=0,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.historyCalenderTemp,$("#historyuploadbutton").addClass("active"),$("#uploadbutton").removeClass("active"),$("#designGO").hide(),$(".addImagediv").hide(),$("#insertupload").show(),this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},changebuttonfx:function(){$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNumfx=0,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.calenderTemp,this.checkAll=!1,this.chooseNumfx=0,$("#designGO").show(),$("#uploadIndex").show(),$(".addImagediv").show(),$("#insertupload").hide(),$("#uploadbutton").addClass("active"),$("#historyuploadbutton").removeClass("active"),this.handleImagebeforeuploadfx(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this)},handleImagehistoryuploadfx:function(e,t,i,a,o){if($("#imageList").empty(),null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);null!=s&&"null"!=s&&"undefined"!=s?(s=JSON.parse(s),$.each(s,function(e,t){t.index="l"+t.index;var i=$('<div id="uploadList_'+t.index+'" imageid="'+t.id+'" data-index="'+t.index+'" uploading="1" class="phoBox" style="background-image:url('+t.src+');"></div>');if(1==t.pixellow){var a=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');a.appendTo(i),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var o=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<input type="checkbox" class="weui-check weui-check_box_wx" name="photos" onchange="changeBox_wx(this)" id="photoCheck_'+t.index+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');o.appendTo(i),i.appendTo($("#imageList"))}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),s.length>0&&(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show())):(s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)))}else alert("商品问题，请联系客服！")},handleImagebeforeuploadfx:function(e,t,i,a,o){if($("#imageList").empty(),null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);if(null!=s&&"null"!=s&&"undefined"!=s){s=JSON.parse(s);var n=new Array,r=s.length;if(r>i){for(var l=0;l<r;l++)if(l<i)n.push(s[l]);else if(isTaoBan){var d=[];d.push(s[l].id),delImageTaobanSimple(d)}s=n}$.each(s,function(e,t){t.index="l"+t.index;var i=$('<div id="uploadList_'+t.index+'" imageid="'+t.id+'" data-index="'+t.index+'" uploading="1" class="phoBox" style="background-image:url('+t.src+');"></div>');if(1==t.pixellow){var a=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');a.appendTo(i),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var o=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<input type="checkbox" class="weui-check weui-check_box_wx" name="photos" onchange="changeBox_wx(this)" id="photoCheck_'+t.index+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');o.appendTo(i),i.appendTo($("#imageList"))}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),o.upladNum=s.length,s.length>0?(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),s.length<t?isTaoBan?$("#info").text("已上传"+s.length+"张","可上传"+t+"-"+i+"张"):$("#info").text("可上传"+t+"-"+i+"张"):s.length<i&&s.length>=t?$("#info").text("可上传"+t+"-"+i+"张"):(s.length>i&&(showModal("#morethan-photo"),$("#info").css("color","#a5a6a6")),$("#info").text("可上传"+t+"-"+i+"张"))):t==i?$("#info").text("需上传"+t+"张照片"):$("#info").text("需上传"+t+"-"+i+"张照片")}else s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(pageKey.isfirst,0)}else alert("商品问题，请联系客服！")},changePhotoUploadListfx:function(){var e=JSON.parse(localStorage.getItem(this.pageKey.historyCalenderTemp)),t=[],i=localStorage.getItem(this.pageKey.calenderTemp);if("[]"==i?(console.info("7418473==="),t=[]):t=JSON.parse(i),t.length>this.maxPageNum){var a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";layer.alert(a)}else{for(var o=$("#imageList").find(".weui-check"),s=0;s<o.length;s++)if(o[s].checked)for(var n=$(o[s]).parents(".phoBox").attr("imageid"),r=0;r<e.length;r++)if(n==e[r].id){if(t.length>=this.maxPageNum){localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t));a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";return layer.alert(a),console.info("22222"),void this.changebuttonfx()}t.push(e[r]);break}localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t)),this.changebuttonfx()}},initjssdk:function(){var t=this;console.info("初始化微信插件");var i=localStorage.getItem(this.pageKey.token);try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo),o="调用newgetCommonUploadConfig的token===="+i;window._jylog.push(["按钮点击",getQueryVariable("isSimple")?"极简上传":"上传页面","newgetCommonUploadConfig微信进入设计",o,JSON.parse(a).orderNo])}}catch(e){}Object(H["n"])(i).then(function(e){console.info("初始化微信插件111"),console.info(e),e.result&&(t.server.commonUpload=e.data.commonUpload,t.server.appKey=e.data.appKey,t.server.appSecret=e.data.appSecret,t.server.serverKey=e.data.serverKey,t.server.unionId=e.data.unionId,t.thumbnailToken=e.data.base64Token,t.server.thumbnailToken=e.data.base64Token,localStorage.setItem(t.pageKey.thumbnailToken,e.data.base64Token)),console.info("初始化微信插件222"),console.info(t.server),Vs(t.minPageNum,t.maxPageNum,t.server,t.pageKey,t)})}}},Ln=On,Tn=(a("14fc"),Object(b["a"])(Ln,Ks,Ms,!1,null,"492c3074",null)),Cn=Tn.exports,Pn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page addr"},[i("div",{staticClass:"sjk-top",on:{click:function(t){return t.stopPropagation(),e.closeFun(t)}}},[e._v("\n\t\t个人信息\n\t\t"),i("i",{staticClass:"sjky close-icon fhIcon",on:{click:function(t){return t.stopPropagation(),e.closeFun(t)}}},[e._v("")])]),i("van-form",{on:{submit:e.adSubmit}},[i("van-field",{attrs:{name:"姓名",label:"姓名",placeholder:"姓名",rules:[{required:!0,message:"请填写姓名"}]},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),i("van-field",{attrs:{type:"tel",name:"手机",label:"手机",placeholder:"请填写手机号码",rules:e.telRules},model:{value:e.tel,callback:function(t){e.tel=t},expression:"tel"}}),i("div",{staticStyle:{margin:"16px"}},[i("van-button",{staticClass:"submit greenSubmit",attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("\n\t\t\t提交\n\t\t  ")])],1)],1)],1)},jn=[],An=(a("db2c"),a("1125")),Nn=(a("38d5"),a("772a")),En=a("5c35"),Jn={data:function(){return{value:"",showArea:!1,areaList:{},username:"",number:"",tel:"",wsid:"",ws:!1,hezuo:!1,address:"",telRules:[{required:!0,message:" 手机号码不能为空",trigger:" onBlur"},{validator:function(e){return/^(1)[0-9]{10}$/.test(e)},message:" 请输入正确格式的手机号码",trigger:" onBlur"}]}},props:["pageKey"],created:function(){this.wsid=localStorage.getItem(this.pageKey.wsid);var e=localStorage.getItem(this.pageKey.mshopSign);e&&1==e&&(this.hezuo=!0),-1==this.wsid?this.ws=!0:this.hezuo?this.ws=!0:this.ws=!1,this.areaList=En["a"]},components:(pn={},Object(L["a"])(pn,n["a"].name,n["a"]),Object(L["a"])(pn,Nn["a"].name,Nn["a"]),Object(L["a"])(pn,An["a"].name,An["a"]),Object(L["a"])(pn,Ka["a"].name,Ka["a"]),Object(L["a"])(pn,Ba["a"].name,Ba["a"]),Object(L["a"])(pn,ja["a"].name,ja["a"]),pn),methods:{onConfirm:function(e){this.value=e.map(function(e){return e.name}).join("-"),this.showArea=!1},adSubmit:function(){var e={};e.userwangwang=this.username,e.telno=this.tel;var t=this;t.$emit("addinfo1",e)},closeFun:function(){this.$emit("closep","")}}},Dn=Jn,Bn=(a("7985"),Object(b["a"])(Dn,Pn,jn,!1,null,null,null)),Kn=Bn.exports,Mn={name:"gualiuwechatpload",components:{GualiWechatBaseUpload:Cn,GualiAddressForm:Kn},data:function(){return{storageName:"",history:!1,uid:"",id:"",submitButtonName:"进入设计",server:{upload:J["a"].basicUrl+"/upload/wxPhoto",uploadData:{},delete:"/tbdiy/uploade/deleteImg.do",baseUrl:J["a"].baseUrl,urlConfig:J["a"]},checksubmitstate:!0,iscomplete:!1,uploadcomplete:!1,isChangxian:0,minPageNum:0,maxPageNum:0,pageKey:"",isTeamBook:!1,isSimple:!1,addinfo:{},showAddr:!1,isPart:!1}},created:function(){var e=this;document.body.style.position="absolute";var t=localStorage.getItem("isAlipay"),i=navigator.userAgent.toLowerCase();("undefined"!=typeof my||"alipayclient"==i.match(/AlipayClient/i)||t)&&(this.is_alipay=!0),this.id=this.$route.query.id,this.isSimple=this.$route.query.isSimple,this.isPart=this.$route.query.isPart,this.history=this.$route.query.history,this.uid=this.$route.query.uid;var a=this.$route.query.p;this.isTeamBook=this.$route.query.isTeamBook,this.isfirst=this.$route.query.isfirst,this.isChangxian=this.$route.query.isChangxian;this.$route.query.uploadcomplete,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var o=this.$route.query.id,s=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(t){!t.miniprogram&&s&&e.$router.push({name:"upload",query:{id:o,p:a,isTeamBook:e.isTeamBook,isfirst:e.isfirst}})})}"true"!=this.isTeamBook&&1!=this.isTeamBook||"true"!=!this.isfirst&&1!=!this.isfirst?this.pageKey=ee["a"]:this.pageKey=ee["c"],(this.isPart||this.history)&&(this.pageKey=ee["c"]),this.logFrom("微信上传"),localStorage.removeItem(this.pageKey.calenderTemp);var n=localStorage.getItem(this.pageKey.token);if(null!=n&&void 0!=n&&"null"!=n&&"undefined"!=n){this.storageName=this.pageKey.calenderTemp,!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isTeamBook=!1,this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)):(this.isTeamBook=!0,this.isPart&&1!=this.isChangxian?(this.minPageNum=a,this.maxPageNum=5*a,localStorage.setItem(this.pageKey.minnum,a),localStorage.setItem(this.pageKey.maxnum,5*a)):(this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)));n=localStorage.getItem(this.pageKey.token);this.server.uploadData.token=n,$(".sjky-mask").show(),$(".weui-popup__modal").show(),$("#addPop").popup()}else this.$router.push({name:"404"})},mounted:function(){},methods:{addinfo1:function(e){this.addinfo=e,this.saveguali()},closep:function(){$("#addPop").removeClass("weui-popup__container weui-popup__container--visible"),$("#addPop").hide(),$(".sjky-mask").hide(),$(".weui-popup__modal").hide()},saveguali:function(){var e=this,t=this,i=localStorage.getItem(this.pageKey.token),a={};a.token=i,a.name=this.addinfo.userwangwang,a.phoneNo=this.addinfo.telno,Object(H["ib"])(a).then(function(i){console.info("tsinghuaEmba=============="),console.info(i),i.result?(t.closep(),e.$router.push({name:"guanLiSuccess"})):layer.alert("保存失败")})},nextStep:function(){$(".sjky-mask").show(),$(".weui-popup__modal").show(),$("#addPop").popup()},nextStep123:function(e,t,i,a){var o=localStorage.getItem(this.pageKey.calenderTemp);localStorage.getItem(this.pageKey.diytype),localStorage.getItem(this.pageKey.hassort);if(localStorage.setItem(this.pageKey.hassort,a),localStorage.removeItem(this.pageKey.cal_pageList),this.isfirst&&"[]"!=o){var s=JSON.parse(o);if(-1==this.id&&s.length<this.minPageNum)return void layer.alert("空白模板，上传照片数量不能小于最小照片数量")}localStorage.setItem(this.pageKey.areadyInsert,"1");var n=!1;1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(n=!0);navigator.userAgent.toLowerCase();var r=navigator.userAgent,l=!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(l)this.isSimple?location.href="simpledesign?id="+this.id+(null==t||void 0==t||""==t?"":"&p="+t)+(null==n||void 0==n||""==n?"":"&isEditCover="+n)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort=0&submit=true&editType=1&iscomplete="+this.iscomplete:location.href="design?id="+this.id+(null==t||void 0==t||""==t?"":"&p="+t)+(null==n||void 0==n||""==n?"":"&isEditCover="+n)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+a+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid);else{var d={id:this.id,p:t,isEditCover:n,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:0,iscomplete:this.iscomplete,designsorce:"isweixin"};this.isSimple?(d.submit=!0,d.editType=1,this.$router.push({name:"simpledesign",query:d})):(this.history&&(d.history=this.history,d.uid=this.uid),this.$router.push({name:"design",query:d}))}},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录",this.isSimple?"极简微信上传":"微信上传页面",t,i,this.token]),startUploadLog()}}catch(e){console.log(e)}}}},$n=Mn,Un=Object(b["a"])($n,Ds,Bs,!1,null,null,null),Wn=Un.exports,Fn=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Rn=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{},[i("div",{staticClass:"gualiSuccess"},[i("img",{attrs:{src:a("dfb1")}})]),i("div",{staticClass:"gualiSuccessfont"},[e._v("上传成功")]),i("div",{staticClass:"gualicomplete"},[e._v("您的照片已上传，我们会尽快为您定制专属挂历！")])])}],qn={name:"guanLiIndex",data:function(){return{token:"",pageKey:""}},created:function(){this.getToken(),this.pageKey=ee["a"]},mounted:function(){},methods:{goupload:function(){var e=this;this.$router.push({name:"gualiuwechatpload",query:{token:e.token,minnum:13,maxPageNum:30}})},getToken:function(){var e=this,t=this;Object(H["Q"])("-1","yhqjd").then(function(i){1!=i.result&&"true"!=i.result||(t.token=i.token,localStorage.setItem(t.pageKey.token,t.token),localStorage.setItem(t.pageKey.source,"wsid"),localStorage.setItem(t.pageKey.wsid,e.wsid),localStorage.setItem(t.pageKey.minnum,"13"),localStorage.setItem(t.pageKey.maxnum,"30"))})}}},Gn=qn,zn=(a("2cbf"),Object(b["a"])(Gn,Fn,Rn,!1,null,null,null)),Hn=zn.exports,Vn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("GuaLi-base-upload",{attrs:{storageName:e.storageName,pageKey:e.pageKey,submitButtonName:e.submitButtonName,server:e.server,checksubmitstate:e.checksubmitstate,isTaoBan:!1,uploadcomplete:e.uploadcomplete,minPageNum:e.minPageNum,maxPageNum:e.maxPageNum},on:{baseUploadNextStep:e.nextStep}}),i("div",{staticClass:"weui-popup__container",attrs:{id:"addPop"}},[i("div",{staticClass:"weui-popup__overlay sjky-mask"}),i("div",{staticClass:"weui-popup__modal addressOut",staticStyle:{background:"#fff"}},[i("guali-address-form",{attrs:{pageKey:e.pageKey},on:{addinfo1:e.addinfo1,closep:e.closep}})],1)])],1)},Yn=[],Xn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._m(0),i("div",{staticClass:"uploaderBox pr",attrs:{id:"uploadIndex"}},[i("a",{staticClass:"uploader_input sjky",attrs:{href:"javascript:void(0);",id:"loadUpload_guali",title:"选择照片"}},[e._v("")]),e.minPageNum!=e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")]):e._e(),e.minPageNum==e.maxPageNum?i("p",{staticClass:"upload-hint mt30 tc"},[e._v("请上传"+e._s(e.minPageNum)+"张照片")]):e._e()]),i("section",{staticClass:"mobile_web pb100",attrs:{id:"uploadShow"}},[i("div",{staticClass:"weui-cells sjky-list-tip sjky-list-tip2 sjky-list-tip3",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell",staticStyle:{display:"none"}},[i("div",{staticClass:"weui-cell__hd"},[i("div",{staticClass:"checkbox weui-cells_checkbox"},[i("input",{staticClass:"weui-check weui-check_box2",attrs:{type:"checkbox",name:"photos"},on:{click:e.finishEdit}}),i("i",{staticClass:"weui-icon-checked"})])]),e._m(1),i("div",{staticClass:"weui-cell__ft"},[[i("a",{staticClass:"sjky-btn-grey sjky-btn-grey2 delete-btn",attrs:{id:"deletephoto",href:"javascript:void(0);"},on:{click:function(t){return e.deletePic()}}},[e._v("删除("+e._s(e.chooseNum)+")")])]],2)])]),e._m(2),i("footer",{staticClass:"sjky-btn-bottom sjky-btn-bottom2"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipsFont,expression:"tipsFont"}],staticClass:"num-tips"},[e._v("\n\t\t\t          最少上传"+e._s(e.minPageNum)+"张，再上传几张吧。\n\t\t\t")]),i("div",{staticClass:"l tc addImagediv"},[i("a",{staticClass:"addImage",staticStyle:{"pointer-events":"auto"},attrs:{href:"javascript:void(0);",id:"addImage"}},[e._v("继续上传"),i("span",[e._v("("+e._s(e.upladNum)+")")])]),i("p",{attrs:{id:"info"}},[e._v("还需上传"+e._s(e.minPageNum)+"-"+e._s(e.maxPageNum)+"张照片")])]),i("a",{staticClass:"weui-btn weui-btn_primary",attrs:{href:"javascript:void(0);",id:"designGO"},on:{click:function(t){return e.next()}}},[e._v(e._s("提交"))]),i("div",[i("a",{staticClass:"weui-btn weui-btn_primary",staticStyle:{display:"none"},attrs:{href:"javascript:void(0);",id:"insertupload"},on:{click:e.changePhotoUploadList}},[e._v("加入上传("+e._s(e.chooseNum)+")")])])])]),e._m(3),e._m(4),i("section",{staticClass:"modal modal-out",attrs:{id:"px-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),e._m(5)]),e._m(6),i("section",{staticClass:"modal modal-out",attrs:{id:"fail-photo"}},[e._m(7),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.chooseFail()}}},[e._v("一键选中")])])]),i("section",{staticClass:"modal modal-out",attrs:{id:"morethan-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("我们根据您选取顺序上传"+e._s(e.arrnum)+"张")])]),e._m(8)]),e._m(9),i("section",{staticClass:"overlay"}),e._m(10),i("section",{staticClass:"modal modal-out",attrs:{id:"low-photo"}},[i("header",{staticClass:"modal-inner"},[e.isTaoBan?i("div",{staticClass:"modal-text"},[e._v("照片像素不足,无法上传，请删除像素不足照片！")]):e._e(),e.isTaoBan?e._e():i("div",{staticClass:"modal-text"},[e._v("照片像素不足会印刷模糊，请谨慎使用！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("返回")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.nextStep()}}},[e._v("确定")])])]),e._m(11),i("section",{staticClass:"modal modal-out",attrs:{id:"duplicate-photo"}},[e._m(12),i("footer",{staticClass:"modal-buttons"},[i("span",{staticClass:"modal-button btn-cancel ddel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold",on:{click:function(t){return e.resetupload()}}},[e._v("确定")])])]),e._m(13),e._m(14),""!=e.options.target?i("uploader",{ref:"uploader",staticClass:"uploader-example",attrs:{options:e.options,"file-status-text":e.statusText,"auto-start":!0},on:{status:e.status,"file-added":e.onFileAdded,"file-progress":e.fileProgress,"progress-style":e.progressStyle,"progressing-class":e.progressingClass,"file-success":e.onFileSuccess,"file-error":e.onFileError,"file-removed":e.fileRemoved,"files-submitted":e.onFilesubmitted,"is-complete":e.isComplete,"is-uploading":e.isUploading}},[i("uploader-btn",{staticClass:"chooseSimple",staticStyle:{display:"none"},attrs:{attrs:e.attrs}},[e._v("select images")])],1):e._e()],1)},Qn=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"anniu"},[i("button",{attrs:{id:"uploadbutton"}},[e._v("上传照片")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-cell__bd"},[i("div",[i("p",{staticClass:"sub-title",attrs:{id:"chooseNumShow"}},[e._v("全选")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"phoList clearfix page"},[i("div",{staticStyle:{display:"none"},attrs:{id:"filePicker"}}),i("div",{attrs:{id:"imageList"}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maskLayer",staticStyle:{display:"none"}},[i("p",[e._v("上传中")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"loadBox tc wh f32",staticStyle:{display:"none"},attrs:{id:"loadingDatacaiyun"}},[i("img",{attrs:{src:"img/loading.gif"}}),i("span",[e._v("正在上传...")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"uping-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("正在上传中，请稍等！")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("有未成功加载的照片，请先删除！")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("知道了")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"taoban-show"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("【随机套版】将对您上传的图片随机排版，暂时无法查看效果及修改的哦，建议您选择【我去设计】自由设计。")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button modal-button-bold zzz"},[e._v("我知道了")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"del-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("确认删除此照片？")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel zzz"},[e._v("取消")]),i("span",{staticClass:"modal-button modal-button-bold ddel"},[e._v("确定")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"choose-photo"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片上传失败")])]),i("footer",{staticClass:"modal-buttons "},[i("span",{staticClass:"modal-button btn-cancel ddel"},[e._v("删除")]),i("span",{staticClass:"modal-button modal-button-bold aagain"},[e._v("重新上传")])]),i("input",{attrs:{type:"hidden",id:"file_id",value:""}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片重复，是否上传")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-denied"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片类型错误")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-size"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("照片过大")])])])}],Zn="";function er(e,t,i,a,o,s,n,r,l){fn=new Array,un=!1,yn=1e3,_n=1e3,In=!1,[],i=i,a=a,o=o,s=s,n=n,r=r,Sn=l,gr(s,e,t,i,Sn),$("#addImage").bind("click",function(e){"function"==typeof er&&0==Sn.isSimpleUpload?(console.info("sssssss1111"),$(".webuploader-element-invisible")[0].click()):$(".chooseSimple")[0].click()});var d,c=$("#imageList"),h=0,g=(window.devicePixelRatio,150),m=150,p="pedding",u={},f=function(){var e=new Image,t=!0;return e.onload=e.onerror=function(){1==this.width&&1==this.height||(t=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t}(),y=(function(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){e="0.0"}}e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}(),function(){var e=document.createElement("p").style,t="transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e;e=null}(),41943040),_=localStorage.getItem(r.source);function v(a,s){if("1"==a.r){$("#uploadList_"+s.id).attr("uploading","1"),$("#uploadFailure_"+s.id).remove();var n="",r="",l="";a.imageInfo.primaryImageInfo?(n=a.imageInfo.primaryImageInfo.width,r=a.imageInfo.primaryImageInfo.height,l=a.imageInfo.primaryImageInfo.dateTime):(n=a.imageInfo.width,r=a.imageInfo.height,l=a.imageInfo.dateTime);lr(a.url),dr(a.url,n,r,o);var d={url:a.url,index:s.id,id:a.id,width:n,height:r,name:s.name,dateTime:l,isUse:!0};fn.push(d);var c=!1;if(n>=r?(n<yn||r<_n)&&(c=!0):(n<_n||r<yn)&&(c=!0),c?($("#uploadDel_"+s.id).show(),$("#uploadMask_"+s.id).show(),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()):($("#uploadDel_"+s.id).hide(),$("#uploadMask_"+s.id).hide(),$("#showIOSDialog2").hide(),$("#showIOSDialog3").show()),window.localStorage){var h=[];$.each(fn,function(e,t){var i=0;$("#uploadMask_"+t.index).is(":visible")&&(i=1,$("#showIOSDialog2").show(),$("#showIOSDialog3").hide());var a={url:t.url,id:t.id,index:t.index,src:lr(t.url)+dr(t.url,t.width,t.height,o),pixellow:i,history:t.history,width:t.width,height:t.height,dateTime:t.dateTime,name:t.name,isUse:!0};h.push(a)});var g=$("#uploadFailure_"+s.id),m=$("#uploadMask_"+s.id);m.remove(),g.remove(),localStorage.setItem(i,JSON.stringify(h)),Sn.upladNum=h.length,h.length,$("#info").text("可上传"+e+"-"+t+"张")}}else $("#uploadFailure_"+s.id).show(),$("#uploadList_"+s.id).attr("uploading","1")}function w(a){$(".checkbox").hide(),$("#loadingData").show();var r=$('<div id="uploadList_'+a.id+'" imageid="'+a.id+'" data-index="'+a.id+'" uploading="0" class="phoBox" style="" ></div>'),l=$('<div class="checkbox weui-cells_checkbox" style="display:none"><label class="weui-check__label" for="photoCheck_'+a.id+'">\t<input type="checkbox" class="weui-check weui-check_box1" name="photos" onchange="changeBox_guali(this)" id="photoCheck_'+a.id+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');l.appendTo(r);var h=$('<div class="tips-pixel-out" id="uploadMask_'+a.id+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');h.appendTo(r);var p=$('<div id="uploadFailure_'+a.id+'" class="waitUpload tc" style="display:none"><span class="wh fs12 mt10 dib" id="uploadFailure_span_'+a.id+'">网络连接异常</span></div>');p.appendTo(r);var y=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">等待上传</p></div>');function _(a){s||alert("已经提交，不允许重复制作。");var n=new Array,r=$("#uploadList_"+a.id).attr("imageid")+"",l=[];l.push(r),$.ajax({url:o.delete,type:"post",data:{imgIds:l},async:!1,cache:!1,success:function(o){var s=JSON.parse(o),r=s.retCode;if($.each(fn,function(e,t){t.index==a.id||n.push(t)}),r<=0){var l=localStorage.getItem(i);if(null!=l&&"null"!=l){l=JSON.parse(l);var c=new Array;$.each(l,function(e,t){t.index==a.id||c.push(t)}),l=c}else l=new Array;Sn.upladNum=l.length,localStorage.setItem(i,JSON.stringify(l)),d.removeFile(a),or()}else{if(fn=n,window.localStorage){l=localStorage.getItem(i);if(null!=l&&"null"!=l){l=JSON.parse(l);c=new Array;$.each(l,function(e,t){t.index==a.id||c.push(t)}),l=c}else l=new Array;Sn.upladNum=l.length,localStorage.setItem(i,JSON.stringify(l)),l.length<e&&$("#info").text("可上传"+e+"-"+t+"张"),l.length>e&&$("#info").text("可上传"+e+"-"+t+"张"),0==l.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+e+"-"+t+"张照片"));for(var h=!1,g=0;g<l.length;g++)if(1==l[g].pixellow){h=!0;break}h||$("#showIOSDialog2").hide()}d.removeFile(a),or()}},error:function(){return layer.alert("服务器异常,删除失败。"),!1}})}function v(a){var o=new Array;if($.each(fn,function(e,t){t.index==a.id||o.push(t)}),fn=o,window.localStorage){var s=localStorage.getItem(i);if(null!=s&&"null"!=s){s=JSON.parse(s);var n=new Array;$.each(s,function(e,t){t.index==a.id||n.push(t)}),s=n}else s=new Array;localStorage.setItem(i,JSON.stringify(s)),fn=s,Sn.upladNum=s.length,s.length<e?$("#info").text("可上传"+e+"-"+t+"张"):s.length<t&&s.length>=e?$("#info").text("可上传"+e+"-"+t+"张"):(s.length>t&&(sr("#morethan-photo"),$("#info").css("color","#a5a6a6")),$("#info").text("已上传"+s.length+"张,可上传"+e+"-"+t+"张"),$("#addImage").css("pointer-events","none"),$("#addImage").addClass("disabled")),0==s.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+e+"-"+t+"张照片"));for(var r=!1,l=0;l<s.length;l++)if(1==s[l].pixellow){r=!0;break}r||$("#showIOSDialog2").hide()}d.removeFile(a),or()}y.appendTo(r),r.on("click",function(){var e=$(this).attr("uploading");"0"!=e&&$(".ddel").click(function(){n?_(a):v(a)})}),"invalid"===a.getStatus()?p.show():(d.makeThumb(a,function(e,t){e||(f?d.makeThumb(a,function(e,t){e?p.show():r.attr("style","background-image:url("+t+");")},g,m):p.show())},g,m),u[a.id]=[a.size,0],a.rotation=0),a.on("statuschange",function(e,t){"error"===e||"invalid"===e?(console.log(a.statusText),h.hide(),p.show(),u[a.id][1]=1):"interrupt"===e?(h.hide(),p.show()):"queued"===e?(h.hide(),p.hide(),u[a.id][1]=0):"progress"===e?(h.hide(),p.hide()):"complete"===e&&(h.hide(),p.hide())});$("div[id^='uploadList_']:visible").length;r.appendTo(c)}function b(e){var t=$("#uploadList_"+e.id);t.remove(),delete u[e.id],I()}function I(){S()}function S(){"ready"===p||d.getStats()}function x(e){var t;if(e!==p){switch(p=e,p){case"pedding":break;case"ready":c.show(),d.refresh();break;case"uploading":break;case"paused":break;case"confirm":if(t=d.getStats(),t.successNum&&!t.uploadFailNum)return void x("finish");break;case"finish":t=d.getStats(),t.successNum||(p="done",location.reload());break}S()}}"fxxt"==_&&(y=41943040),d=WebUploader.create({pick:{id:"#filePicker",label:"选择图片",multiple:!0},formData:o.uploadData,swf:"/swf/Uploader.swf",chunked:!1,chunkSize:524288,threads:25,server:o.upload,accept:{title:"Images",extensions:"jpg,jpeg,png,heic",mimeTypes:"image/*"},duplicate:!0,compress:!1,method:"POST",disableGlobalDnd:!0,fileSingleSizeLimit:y,resize:!1}),d.on("uploadError",function(e,t){$("#uploadList_"+e.id).attr("uploading","1"),$("#waitUploadmask_"+e.id).hide(),$("#uploadFailure_"+e.id).show(),$(".sjky-btn-bottom2").show()}),d.on("uploadSuccess",function(a,s){if($(".weui-cell").show(),$(".sjky-list-tip3").show(),$(".sjky-btn-bottom2").show(),$(".checkbox").hide(),n){if("4"==s.state)return b(a),!1;if("0"==s.state||"1"==s.state){$("#uploadList_"+a.id).attr("uploading","1"),$("#uploadList_"+a.id).attr("imageid",JSON.parse(s._raw).imageId);var r={id:JSON.parse(s._raw).imageId,url:s.path,index:a.id,name:a.name,isUse:!0,md5val:s.imagemd5,state:s.state};fn.push(r);if("1"==s.state&&($("#uploadDel_"+a.id).show(),$("#uploadMask_"+a.id).show(),$("#uploadCover_"+a.id).show(),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()),!window.localStorage)return void layer.alert("浏览器版本过低,请更换qq浏览器或刷新页面!");var l=[];$.each(fn,function(e,t){var i=0;$("#uploadMask_"+t.index).is(":visible")&&(i=1);var a={id:t.id,url:t.url,index:t.index,src:o.baseUrl+"/tbdiy/uploade/queryTbImages.do?filePath="+t.url,pixellow:i,history:t.history,name:t.name,isUse:!0,md5val:t.md5val,state:s.state};l.push(a)}),imageArray=l,Sn.upladNum=imageArray.length,localStorage.setItem(i,JSON.stringify(l)),l.length,$("#info").text("可上传"+e+"-"+t+"张")}else $("#uploadFailure_"+a.id).show(),$("#uploadList_"+a.id).attr("uploading","1")}else if(o.s3flag||o.commonUpload)if("success"==s.result&&s.data[0].uploadResult||s.success&&s.data){var d={};if(d.token=o.uploadData.token,o.commonUpload){var c={};c=s.data&&s.data[0]?s.data[0]:s.data,d.filename=c.filePath,d.originalName=c.fileName,c.prefix&&(d.prefix=c.prefix),d.ImageInfo={},d.ImageInfo.width=Number(c.width),d.ImageInfo.height=Number(c.height),d.ImageInfo.fileMd5=c.md5,c.dateTime&&(d.ImageInfo.dateTime=c.dateTime),d.lastModifiedDate=a.lastModifiedDate}else{c=s.data[0];d.filename=c.lookPath,d.store=c.store,d.originalName=c.oldFileName,d.ImageInfo={},d.ImageInfo.width=Number(c.widthpx),d.ImageInfo.height=Number(c.hightpx),d.ImageInfo.fileMd5=c.fileMd5,d.ImageInfo.sortId=a.id,c.dateTime&&(d.ImageInfo.dateTime=c.dateTime),d.lastModifiedDate=a.lastModifiedDate}d=JSON.stringify(d),$.ajax({type:"POST",url:o.urlConfig.basicUrl+"/upload/savephotoinfo",data:d,dataType:"json",contentType:"application/json",success:function(e){v(e,a)}})}else{$("#uploadFailure_"+a.id).show();var h="";h=s.data?-1!=s.data[0].uploadMessage.indexOf("不允许上传此文件类型")?"格式不支持":s.data[0].uploadMessage:s.message,$("#uploadFailure_span_"+a.id).text(h),$("#uploadList_"+a.id).attr("uploading","1")}else"1"==s.r?v(s,a):($("#uploadFailure_"+a.id).show(),$("#uploadList_"+a.id).attr("uploading","1"))}),d.on("uploadFinished",function(e){un&&($(".sjky-btn-greytxt").show(),$(".sjky-btn-grey").show()),un=!1,h=0,console.log(fn),$("#loadingData").hide(),$(".checkbox").show()}),d.on("ready",function(){window.uploader=d}),d.onUploadProgress=function(e,t){$("#uploadFailure_"+e.id),$("#uploadMask_"+e.id);e&&e._info&&e._info.width>1e4&&e._info.height>1e4&&(alert("图片:"+e.name+" 文件宽高过大！系统不支持！"),d.removeFile(e));var i=$("#uploadList_"+e.id),a=i.find(".upload-state");a.length||(a=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">等待上传</p></div>').appendTo(i)),a.find(".upload-state-bar").html("上传中"),a.find(".loading").show(),1==t&&(a.find(".loading").hide(),a.hide(),$("#uploadDel_"+e.id).show()),u[e.id][1]=t,I()},d.onFilesQueued=function(e){In=!1,$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show();for(var a=[],o=[],s=[],n=localStorage.getItem(i),r=(JSON.parse(n),0);r<e.length;r++)a.push(e[r].name);for(r=0;r<a.length;r++){for(var l=!1,c=r;c<a.length-1;c++)if(a[r]==a[c+1]){l=!0,In=!0;break}null!=n&&"null"!=n&&"[]"!=n&&-1!=n.indexOf(a[r])&&(l=!0,In=!0),l?s.push(e[r]):o.push(e[r])}function g(e){var a=localStorage.getItem(i);console.log(e),console.log(e.length),h=0,console.log("fileCount==="+h);var o=!0,s=!1,n=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var c=r.value;a=localStorage.getItem(i);c.size,h++,a=null!=a&&"null"!=a&&"[]"!=a?JSON.parse(a):[],a.length+h<=t?(c.lastModifiedDate=(new Date).toString(),un=!0,w(c),x("ready"),I(),d.upload(c)):(d.removeFile(c),sr("#morethan-photo"),$("#info").css("color","#a5a6a6"),$("#addImage").css("pointer-events","none"))}}catch(g){s=!0,n=g}finally{try{o||null==l.return||l.return()}finally{if(s)throw n}}}In?(In=!1,layer.open({skin:"unpload-layer",title:!1,content:'<p style="padding:10px 30px;font-size: 16px;">检测到重复图片<br/>是否上传这些重复的图片？</p>',btn:["上传","不上传"],closeBtn:0,yes:function(t){g(e),layer.close(t)},btn2:function(e){console.log(o),g(o);for(var t=0;t<s.length;t++)d.removeFile(s[t]);layer.close(e)}})):g(e)},d.onFileDequeued=function(e){h--,e.size,h||x("pedding"),b(e),I()},d.on("all",function(e){switch(e){case"uploadFinished":x("confirm");break;case"startUpload":x("uploading");break;case"stopUpload":x("paused");break}}),d.onError=function(e){console.log(e),$(".sjky-btn-greytxt").show(),$(".sjky-btn-grey").show(),e>"Q_EXCEED_NUM_LIMIT"&&($("#info").css("color","#a5a6a6"),sr("#morethan-photo")),"F_DUPLICATE"==e&&sr("#duplicate-photo"),"Q_TYPE_DENIED"==e&&(sr("#type-denied"),window.setTimeout(function(){or()},2e3)),"F_EXCEED_SIZE"==e&&(sr("#type-size"),window.setTimeout(function(){or()},2e3));var t=localStorage.getItem(i);t=null!=t&&"null"!=t&&"[]"!=t?JSON.parse(t):[],$(".sjky-btn-bottom2").show(),$("#addImage").addClass("disabled")},I()}function tr(e,t,i){$(".ddel").unbind("click"),$(".ddel").click(function(){for(var a=0;a<e.length;a++)e[a].checked&&(0,bn?ir(e[a],t,i):(console.info("开始进入删除照片方法了！！！"),console.info(e[a]),ar(e[a],t,i)));or();var o=localStorage.getItem(Sn.pageKey.calenderTemp);o=null!=o&&"null"!=o?JSON.parse(o):[],Zn="已选"+Sn.chooseNum+"张",$("#vm.chooseNumShow").html(Zn)}),sr("#del-photo")}function ir(e,t,i){var a=$(e).parents(".phoBox").attr("data-index"),o=new Array;$.each(fn,function(e,t){t.index==a||o.push(t)});var s=$(e).parents(".phoBox").attr("imageid"),n=[];n.push(s),$.ajax({url:wn.delete,type:"post",data:{imgIds:n},async:!1,cache:!1,success:function(s){var n=JSON.parse(s),r=n.retCode;if(fn=o,r<=0){var l=localStorage.getItem(vn);if(null!=l&&"null"!=l){l=JSON.parse(l);var d=new Array;$.each(l,function(e,t){t.index==a||d.push(t),Sn.chooseNum=$("#imageList").find("input[type=checkbox]:checked").length}),l=d,localStorage.setItem(vn,JSON.stringify(l))}}else if(window.localStorage){l=localStorage.getItem(vn);if(null!=l&&"null"!=l){l=JSON.parse(l);d=new Array;$.each(l,function(e,t){t.index==a||d.push(t)}),l=d}l.length<t&&$("#info").text("可上传"+t+"-"+i+"张"),l.length>=t&&l.length<i&&$("#info").text("可上传"+t+"-"+i+"张"),0==l.length&&($(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#info").text("需上传"+t+"-"+i+"张照片"));for(var c=!1,h=0;h<l.length;h++)if(1==l[h].pixellow){c=!0;break}c||$("#showIOSDialog2").hide(),localStorage.setItem(vn,JSON.stringify(l))}$(e).parents(".phoBox").remove(),Sn.upladNum=l.length,Sn.chooseNum=$("#imageList").find("input[type=checkbox]:checked").length,0==Sn.chooseNum&&($(".weui-cell").hide(),$(".sjky-list-tip3").show())}})}function ar(e,t,i){var a=$(e).parents(".phoBox").attr("data-index"),o=new Array,s={},n="",r=fn;if(Sn.ishistoryuploadbutton&&(r=JSON.parse(localStorage.getItem(Sn.pageKey.historyCalenderTemp))),$.each(r,function(e,t){t.index==a?(1,n=t.id):o.push(t)}),console.info("ids======"),console.info(n),""!=n&&(s.ids=n,s.materialType="al",$.ajax({type:"POST",url:Sn.server.urlConfig.basicUrl+"/diy/deleteimg",data:s,dataType:"json",success:function(e){console.log(e)}})),0==fn.length){e=$(".weui-check_box2");for(var l=0;l<e.length;l++)e[l].checked=!1;Sn.checkAll=!1}if(window.localStorage){var d=localStorage.getItem(Sn.pageKey.calenderTemp);if(null!=d&&"null"!=d){d=JSON.parse(d);var c=new Array;$.each(d,function(e,t){t.index==a||c.push(t)}),d=c}if(Sn.upladNum=d.length,d.length<t&&($("#info").text("可上传"+t+"-"+i+"张"),$("#addImage").css("pointer-events","auto")),d.length>=t&&d.length<i&&($("#info").text("可上传"+t+"-"+i+"张"),$("#addImage").css("pointer-events","auto")),0==d.length){$(".sjky-list-tip3").show(),$("#uploadIndex").show(),$("#uploadShow").hide(),$("#showIOSDialog2").hide(),$("#imageList").empty();for(e=$(".weui-check_box2"),l=0;l<e.length;l++)e[l].checked=!1;Sn.checkAll=!1,$("#info").text("需上传"+t+"-"+i+"张照片")}for(var h=!1,g=0;g<d.length;g++)if(1==d[g].pixellow){h=!0;break}h||$("#showIOSDialog2").hide(),localStorage.setItem(Sn.pageKey.calenderTemp,JSON.stringify(d)),fn=d}$(e).parents(".phoBox").remove(),$("#deletephoto").text("删除("+Sn.chooseNum+")"),$("#chooseNumNext").text("("+Sn.chooseNum+")")}function or(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)}function sr(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)}function nr(){$(".sjky-btn-resettxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-greytxt").show();for(var e=$(".weui-check_box1"),t=0;t<e.length;t++)e[t].checked=!1;Sn.chooseNum=0,Zn="已选0张",$("#vm.chooseNumShow").html(Zn),$("#deletephoto").text("删除(0)"),$("#chooseNumNext").text("(0)")}function rr(){$(".sjky-btn-greytxt").hide(),$(".sjky-btn-grey").show(),$(".sjky-btn-resettxt").show();for(var e=$(".weui-check_box1"),t=0;t<e.length;t++)e[t].checked=!0;Sn.chooseNum=e.length,Zn="已选"+Sn.chooseNum+"张",$("#vm.chooseNumShow").html(Zn),$("#deletephoto").text("删除("+e.length+")"),$("#chooseNumNext").text("("+e.length+")")}function lr(e){return!e||-1==e.indexOf("material/")&&-1==e.indexOf("yingxiangdiy/")&&-1==e.indexOf("commonUpload/")?e&&(e.endsWith("svg")||e.endsWith("xml"))?-1!=e.indexOf(Sn.server.urlConfig.orgBaseUrl2)?Sn.server.urlConfig.orgBaseUrl2:Sn.server.urlConfig.baseUrl2:e&&-1!=e.indexOf("oss-")?Sn.server.urlConfig.ossPhotoUrl:e&&-1!=e.indexOf("img.alicdn.com")?"":-1!=e.indexOf(this.server.urlConfig.orgBaseUrl)?this.server.urlConfig.orgBaseUrl:this.server.urlConfig.baseUrl:-1!=e.indexOf(Sn.server.urlConfig.orgBaseUrl3)?Sn.server.urlConfig.orgBaseUrl3:Sn.server.urlConfig.baseUrl3}function dr(e,t,i,a,o){var s=0,n=0;if(!e||-1==e.indexOf("material/")&&-1==e.indexOf("/yingxiangdiy/")&&-1==e.indexOf("commonUpload/"))return e&&-1!=e.indexOf(".xml")?"mongo_yx/"+e+"?token="+o:e&&e.charAt(0)<="f"?(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,"mongo_yx/"+e+"!"+s+"x"+n+"?token="+o):e;if(t=Math.floor(t),i=Math.floor(i),t>=i?s=t>=600?600:t:n=i>=600?600:i,-1!=e.indexOf("material/"))return"fs1020/"+e+"!"+s+"x"+n+"?token="+o;if(-1!=e.indexOf("commonUpload/")){var r=e.split("commonUpload/");return r[1]+"!"+s+"x"+n+"?token="+o}var l=e.split("/");return l.splice(1,0,s+"x"+n),l.join("/")}function cr(e,t,i,a){if($(".weui-cell").show(),$(".sjky-list-tip3").show(),$(".sjky-btn-bottom2").show(),bn){if("4"==t.state)return removeFile(e),!1;if("0"==t.state||"1"==t.state){$("#uploadList_"+e.id).attr("uploading","1"),$("#uploadList_"+e.id).attr("imageid",JSON.parse(t._raw).imageId);var o={id:JSON.parse(t._raw).imageId,url:t.path,index:e.id,name:e.name,isUse:!0,md5val:t.imagemd5,state:t.state};fn.push(o);if("1"==t.state&&($("#uploadDel_"+e.id).show(),$("#uploadMask_"+e.id).show(),$("#uploadCover_"+e.id).show(),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()),!window.localStorage)return void layer.alert("浏览器版本过低,请更换qq浏览器或刷新页面!");var s=[];$.each(fn,function(e,i){var a=0;$("#uploadMask_"+i.index).is(":visible")&&(a=1);var o={id:i.id,url:i.url,index:i.index,src:this.server.baseUrl+"/tbdiy/uploade/queryTbImages.do?filePath="+i.url,pixellow:a,history:i.history,name:i.name,isUse:!0,md5val:i.md5val,state:t.state};s.push(o)}),imageArray=s,Sn.upladNum=imageArray.length,localStorage.setItem(this.storageName,JSON.stringify(s)),s.length,$("#info").text("可上传"+i+"-"+a+"张")}else $("#uploadFailure_"+e.id).show(),$("#uploadList_"+e.id).attr("uploading","1")}else if(this.server.s3flag||this.server.commonUpload)if("success"==t.result&&t.data[0].uploadResult||t.success&&t.data){var n={};if(n.token=this.server.uploadData.token,this.server.commonUpload){var r=t.data;n.filename=r.filePath,n.originalName=r.fileName,r.prefix&&(n.prefix=r.prefix),n.ImageInfo={},n.ImageInfo.width=Number(r.width),n.ImageInfo.height=Number(r.height),n.ImageInfo.fileMd5=r.md5,r.dateTime&&(n.ImageInfo.dateTime=r.dateTime),n.lastModifiedDate=e.lastModifiedDate}else{r=t.data[0];n.filename=r.lookPath,n.originalName=r.oldFileName,n.ImageInfo={},n.ImageInfo.width=Number(r.widthpx),n.ImageInfo.height=Number(r.hightpx),n.ImageInfo.fileMd5=r.fileMd5,r.dateTime&&(n.ImageInfo.dateTime=r.dateTime),n.lastModifiedDate=e.lastModifiedDate}n=JSON.stringify(n),$.ajax({type:"POST",url:this.server.urlConfig.basicUrl+"/upload/savephotoinfo",data:n,dataType:"json",contentType:"application/json",success:function(t){hr(t,e,i,a)}})}else{$("#uploadFailure_"+e.id).show();var l="";l=t.data?-1!=t.data[0].uploadMessage.indexOf("不允许上传此文件类型")?"格式不支持":t.data[0].uploadMessage:t.message,$("#uploadFailure_span_"+e.id).text(l),$("#uploadList_"+e.id).attr("uploading","1")}else"1"==t.r?hr(t,e,i,a):($("#uploadFailure_"+e.id).show(),$("#uploadList_"+e.id).attr("uploading","1"))}function hr(e,t,i,a){if("1"==e.r){$("#uploadList_"+t.id).attr("uploading","1");var o="",s="",n="";e.imageInfo.primaryImageInfo?(o=e.imageInfo.primaryImageInfo.width,s=e.imageInfo.primaryImageInfo.height,n=e.imageInfo.primaryImageInfo.dateTime):(o=e.imageInfo.width,s=e.imageInfo.height,n=e.imageInfo.dateTime);var r=lr(e.url)+dr(e.url,o,s,this.server);$("#uploadList_"+t.id).css("background-image","url("+r+")");var l={url:e.url,index:t.id,id:e.id,width:o,height:s,name:t.name,dateTime:n,isUse:!0};fn.push(l);var d=!1;if(o>=s?(o<yn||s<_n)&&(d=!0):(o<_n||s<yn)&&(d=!0),d?($("#uploadDel_"+t.id).show(),$("#uploadMask_"+t.id).show(),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()):($("#uploadDel_"+t.id).hide(),$("#uploadMask_"+t.id).hide(),$("#showIOSDialog2").hide(),$("#showIOSDialog3").show()),window.localStorage){var c=[];$.each(fn,function(e,t){var i=0;$("#uploadMask_"+t.index).is(":visible")&&(i=1,$("#showIOSDialog2").show(),$("#showIOSDialog3").hide());var a={url:t.url,id:t.id,index:t.index,src:lr(t.url)+dr(t.url,t.width,t.height,this.server),pixellow:i,width:t.width,height:t.height,dateTime:t.dateTime,name:t.name,isUse:!0};c.push(a)});var h=$("#uploadFailure_"+t.id),g=$("#uploadMask_"+t.id);g.remove(),h.remove(),localStorage.setItem(this.storageName,JSON.stringify(c)),Sn.upladNum=c.length,c.length,$("#info").text("可上传"+i+"-"+a+"张")}}else $("#uploadFailure_"+t.id).show(),$("#uploadList_"+t.id).attr("uploading","1")}function gr(e,t,i,a,o){if($("#imageList").empty(),fn=[],null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);if(null!=s&&"null"!=s&&"undefined"!=s){s=JSON.parse(s);var n=new Array,r=s.length;if(r>i){for(var l=0;l<r;l++)if(l<i)n.push(s[l]);else if(bn){var d=[];d.push(s[l].id),delImageTaobanSimple(d)}s=n}$.each(s,function(e,t){t.index="l"+t.index,-1!=t.src.indexOf(o.server.urlConfig.thumbnailUrl)&&(t.src=t.src.replace("commonUpload/",""),-1!=t.src.indexOf("fsferry")&&(t.src=t.src.replace("fsferry/","")),-1==t.src.indexOf("token")&&(t.src=t.src+"?token="+localStorage.getItem(o.pageKey.thumbnailToken)));var i=$('<div id="uploadList_'+t.index+'" imageid="'+t.id+'" data-index="'+t.index+'" uploading="1" class="phoBox" style="background-image:url('+t.src+');"></div>');if(1==t.pixellow){var a=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');a.appendTo(i),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var s=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<input type="checkbox" class="weui-check weui-check_box1" name="photos" onchange="changeBox_guali(this)" id="photoCheck_'+t.index+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');s.appendTo(i),i.appendTo($("#imageList"));var n={dateTime:t.dateTime,url:t.url,id:t.id,index:t.index,width:t.width,height:t.height,history:t.history,isUse:!0,name:t.name,md5val:t.md5val};fn.push(n)}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),o.upladNum=s.length,s.length>0?(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show(),s.length<t?bn?$("#info").text("已上传"+s.length+"张","可上传"+t+"-"+i+"张"):$("#info").text("可上传"+t+"-"+i+"张"):s.length<i&&s.length>=t?$("#info").text("可上传"+t+"-"+i+"张"):(s.length>i&&(sr("#morethan-photo"),$("#info").css("color","#a5a6a6")),$("#info").text("可上传"+t+"-"+i+"张"),$("#addImage").css("pointer-events","none"),$("#addImage").addClass("disabled"))):t==i?$("#info").text("需上传"+t+"张照片"):$("#info").text("需上传"+t+"-"+i+"张照片")}else s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(o.pageKey.isfirst,0)}else alert("商品问题，请联系客服！")}function mr(e,t,i,a,o){if($("#imageList").empty(),null!=e&&void 0!=e||(e=!0),"0"!=t&&"undefined"!=t){t=parseInt(t),i=parseInt(i);var s=localStorage.getItem(a);null!=s&&"null"!=s&&"undefined"!=s?(s=JSON.parse(s),$.each(s,function(e,t){t.index="l"+t.index,-1!=t.src.indexOf(o.server.urlConfig.thumbnailUrl)&&(t.src=t.src.replace("commonUpload/",""),-1!=t.src.indexOf("fsferry")&&(t.src=t.src.replace("fsferry/","")),-1==t.src.indexOf("token")&&(t.src=t.src+"?token="+localStorage.getItem(o.pageKey.thumbnailToken)));var i=$('<div id="uploadList_'+t.index+'" imageid="'+t.id+'" data-index="'+t.index+'" uploading="1" class="phoBox" style="background-image:url('+t.src+');"></div>');if(1==t.pixellow){var a=$('<div class="tips-pixel-out" id="uploadMask_'+t.index+'"><span class="tips-pixel weui-icon-warn"></span>像素不足</div>');a.appendTo(i),$("#showIOSDialog2").show(),$("#showIOSDialog3").hide()}var s=$('<div class="checkbox weui-cells_checkbox"><label class="weui-check__label" for="photoCheck_'+t.index+'">\t<input type="checkbox" class="weui-check weui-check_box1" name="photos" onchange="changeBox_guali(this)" id="photoCheck_'+t.index+'"><i class="weui-icon-checked"></i>\t\t</label></div>\t');s.appendTo(i),i.appendTo($("#imageList"))}),"none"==$("#showIOSDialog2").css("display")&&($("#showIOSDialog3").show(),$("#showIOSDialog2").hide()),s.length>0&&(localStorage.setItem(a,JSON.stringify(s)),$(".sjky-btn-bottom2").show(),$(".sjky-list-tip3").show(),$("#uploadIndex").hide(),$("#uploadShow").show())):(s=[],localStorage.removeItem(a),localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(o.pageKey.isfirst,0))}else alert("商品问题，请联系客服！")}uploadProgressSimple=function(e,t){var i=$("#uploadList_"+e.id);$uploadState=i.find(".upload-state"),$uploadState.length||($uploadState=$('<div class="upload-state"><img src="img/loading.gif" class="loading"><p class="upload-state-bar">等待上传</p></div>').appendTo(i)),$uploadState.find(".upload-state-bar").html("上传中"),$uploadState.find(".loading").show(),1==t&&($uploadState.find(".loading").remove(),$uploadState.remove(),$(".checkbox").show(),$("#uploadDel_"+e.id).show())},sortBy=function(e,t){return t=void 0==t?1:t?1:-1,function(i,a){return i=i[e],a=a[e],i<a?-1*t:i>a?1*t:0}};new Array;var pr=800,ur=800,fr={name:"GuaLiBaseUpload",props:["storageName","submitButtonName","uploadcomplete","minPageNum","pageKey","maxPageNum","server","checksubmitstate","orderInfo","isTaoBan"],data:function(){return{id:"",readyphoto:"",tipsFont:!1,isSimple:!1,isSimpleUpload:!1,caiyun:"",pageNum:"",productId:"",calendar_type:"",paused:!1,error:!1,isComplete:!1,isUploading:!1,p:-1,editing:!1,showDeleteModal:!1,arrnum:"",chooseNum:0,checkAll:!1,isTeamBook:!1,upladNum:0,isfirst:0,piclist:[],storageNamebase:"",isWeixin:!1,isuploadbutton:!0,ishistoryuploadbutton:!1,options:{target:"",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:41943040,query:{}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"},picList:[],progress:0,progressingClass:"uploader-file-progressing",file_total:1,errorfilelist:[],thumbnailToken:""}},created:function(){this.isSimple=this.$route.query.isSimple,this.storageNamebase=this.storageName;var e=localStorage.getItem(ee["f"].isMiniProgram),t=navigator.userAgent.toLowerCase();console.log("mess:"+t.match("micromessenger")),console.log("navigator:"+navigator.userAgent.toLowerCase()),console.log("isweixin:"+e),(e||null!=t.match(/wechat/i)||null!=t.match("micromessenger"))&&(this.isWeixin=!0),window.onload=function(){var e=!1;window.addEventListener("pageshow",function(){e&&window.location.reload()}),window.addEventListener("pagehide",function(){e=!0})};var i=localStorage.getItem(this.pageKey.id),a=localStorage.getItem(this.pageKey.isfirst),o=localStorage.getItem(this.pageKey.calenderTemp);a&&"1"==a?null==o||"[]"==o?this.isfirst=0:(this.isfirst=1,this.piclist=JSON.parse(o),this.upladNum=JSON.parse(o).length):(localStorage.setItem(this.pageKey.isfirst,this.isfirst),null==o||"[]"==o||(this.piclist=JSON.parse(o),this.upladNum=JSON.parse(o).length)),this.isTeamBook=this.$route.query.isTeamBook,this.caiyun=this.$route.query.caiyun,null==i||""==i||"undefined"==i?(this.id=this.$route.query.id,localStorage.setItem(this.pageKey.id,this.id)):this.id=i,this.getCommonUploadConfig()},mounted:function(){$(".zzz").click(function(){hideModal()});JSON.parse(localStorage.getItem(this.pageKey.goodsid));this.calendar_type=localStorage.getItem(this.pageKey.calendar_type),this.productId=JSON.parse(localStorage.getItem(this.pageKey.productId)),this.p=JSON.parse(localStorage.getItem(this.pageKey.pnum)),null==this.p&&(this.p=-1);var e=!1;$("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(e=!0)}),e?showConfirm("#fail-photo"):(this.isfirst,$("#loadUpload_guali").bind("click",function(e){$(".sjky-btn-greytxt").hide(),$(".webuploader-element-invisible")[0],"function"==typeof er?$(".webuploader-element-invisible")[0].click():(this.isSimpleUpload=!0,$(".chooseSimple")[0].click())}))},methods:{editPhotos:function(){this.editing=!0},finishEdit:function(){console.info("全选方法！"),this.checkAll?(nr(),this.checkAll=!1):(rr(),this.checkAll=!0)},changeSimple:function(){this.isSimpleUpload=!0,$(".chooseSimple")[0].click()},getCommonUploadConfig:function(){console.info("获取上传参数=======");var t=this,i=localStorage.getItem(this.pageKey.token);try{if(window._czc){var a="调用newgetCommonUploadConfig的token===="+i;window._czc.push(["_trackEvent","剪影","上传页面",a])}}catch(e){console.log(e)}Object(H["n"])(i).then(function(e){if(console.info("res======="),console.info(e),e.result){t.server.commonUpload=e.data.commonUpload,t.isTaoBan&&(t.server.commonUpload=!1),t.server.commonUpload?(t.server.upload=J["a"].commonuploadapi+e.data.uploadUrl,t.options.target=J["a"].commonuploadapi+e.data.uploadUrl,t.server.uploadData.appKey=e.data.appKey,t.server.uploadData.appSecret=e.data.appSecret,t.server.uploadData.serverKey=e.data.serverKey,t.server.uploadData.unionId=e.data.unionId,t.server.uploadData.multiple=!0,t.options.query=e.data):(t.options.target=t.server.upload,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==========="),console.info(t.server.upload),console.info(e.data.uploadUrl)),t.arrnum=t.maxPageNum,t.thumbnailToken=e.data.base64Token,localStorage.setItem(t.pageKey.thumbnailToken,e.data.base64Token);var i=localStorage.getItem(t.pageKey.token);if(t.options.query.token=i,console.log(Object(q["a"])(er)),"function"==typeof er)try{er(t.minPageNum,t.maxPageNum,t.storageNamebase,t.submitButtonName,t.server,t.checksubmitstate,t.isTaoBan,t.pageKey,t);var a=localStorage.getItem(t.pageKey.caiyunContent);if("1"==t.caiyun&&a){var o=JSON.parse(a),s=t.readyphoto+o.contentIDList.length;if(t.readyphoto<t.maxPageNum&&s<=t.maxPageNum){for(var n=0;n<o.contentIDList.length;n++)localIds.push(o.contentIDList[n]);uploadPicCaiyun(localIds,t.server.uploadUrl,o,t.minPageNum,t.maxPageNum)}if(t.readyphoto<t.maxPageNum&&t.maxPageNum&&s>t.maxPageNum){for(n=0;n<t.maxPageNum-t.readyphoto;n++)localIds.push(o.contentIDList[n]);uploadPicCaiyun(localIds,t.server.uploadUrl,o,t.minPageNum,t.maxPageNum)}}}catch(r){t.$layer.alert(r),er(t.minPageNum,t.maxPageNum,t.storageNamebase,t.submitButtonName,t.server,t.checksubmitstate,t.isTaoBan,t.pageKey,t)}}})},getS3UpConfig:function(){var e=this;Object(H["H"])().then(function(t){if(t.result){e.server.s3flag=t.data.s3flag,e.isTaoBan&&(e.server.s3flag=!1),e.server.s3flag?(e.server.upload=J["a"].uploadapi+t.data.s3url,e.options.target=J["a"].uploadapi+t.data.s3url,e.server.uploadData.appkey=t.data.appkey,e.server.uploadData.methodId=t.data.methodId,e.server.uploadData.sign=t.data.sign,e.server.uploadData.checkId=t.data.checkId,e.options.query=t.data):(e.options.target=e.server.upload,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==========="),console.info(e.server.upload),console.info(J["a"].uploadapi+t.data.s3url)),e.arrnum=e.maxPageNum;var i=localStorage.getItem(e.pageKey.token);if(e.options.query.token=i,console.log(Object(q["a"])(er)),"function"==typeof er)try{er(e.minPageNum,e.maxPageNum,e.storageNamebase,e.submitButtonName,e.server,e.checksubmitstate,e.isTaoBan,e.pageKey,e);var a=localStorage.getItem(e.pageKey.caiyunContent);if("1"==e.caiyun&&a){var o=JSON.parse(a),s=e.readyphoto+o.contentIDList.length;if(e.readyphoto<e.maxPageNum&&s<=e.maxPageNum){for(var n=0;n<o.contentIDList.length;n++)localIds.push(o.contentIDList[n]);uploadPicCaiyun(localIds,e.server.uploadUrl,o,e.minPageNum,e.maxPageNum)}if(e.readyphoto<e.maxPageNum&&e.maxPageNum&&s>e.maxPageNum){for(n=0;n<e.maxPageNum-e.readyphoto;n++)localIds.push(o.contentIDList[n]);uploadPicCaiyun(localIds,e.server.uploadUrl,o,e.minPageNum,e.maxPageNum)}}}catch(r){e.$layer.alert(r),er(e.minPageNum,e.maxPageNum,e.storageNamebase,e.submitButtonName,e.server,e.checksubmitstate,e.isTaoBan,e.pageKey,e)}}console.log(t)})},downLoadUrlList:function(e){var t=this;$("#uploadIndex").hide(),$("#loadingDatacaiyun").show(),Object(H["h"])(e).then(function(e){e.result||(layer.alert("图片下载失败！"),$("#uploadIndex").show()),t.getCalenderTemp(localStorage.getItem(t.pageKey.token)),$("#loadingDatacaiyun").hide()}).catch(function(e){t.getCalenderTemp(localStorage.getItem(t.pageKey.token)),$("#loadingDatacaiyun").hide()})},getCalenderTemp:function(e){var t=[],i=this;Object(H["E"])(e).then(function(e){$("#imageList").empty();var a=null;if(a="string"==typeof e?JSON.parse(e):e,a.result){var o=null;if(o="string"==typeof a.data?JSON.parse(a.data):a.data,""!=o&&o.length>0){i.readyphoto=o.length;for(var s=0;s<o.length;s++){var n={isUse:!0};n.index=s,n.history=!0,n.id=o[s].id,n.name=o[s].name,n.url=o[s].picname,n.src=Object(Q["d"])(o[s].picname)+Object(Q["e"])(o[s].picname,o[s].imageinfo,i.thumbnailToken);Object(q["a"])(o[s].imageinfo);if(""!=o[s].imageinfo){var r=JSON.parse(o[s].imageinfo),l="";l=r.primaryImageInfo?r.primaryImageInfo:r,n.dateTime=r.dateTime,n.width=l.width,n.height=l.height,n.sortId=l.sortId,(l.width<pr||l.height<ur)&&(n.pixellow=1)}t.push(n)}}var d=localStorage.getItem(i.pageKey.calenderTemp);if(null!=d&&void 0!=d||(d=[]),t.length>0){if(t.length==d.length)for(s=0;s<t.length;s++)if(t[s].id!=d[s].id){localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson),console.log(11111111111111111e39);break}t.sort(sortBy("sortId",!0)),localStorage.setItem(i.pageKey.historyCalenderTemp,JSON.stringify(t))}else localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson)}else localStorage.removeItem(i.pageKey.calenderTemp),localStorage.removeItem(i.pageKey.historyCalenderTemp),localStorage.removeItem(i.pageKey.uid),localStorage.removeItem(i.pageKey.autoSave),localStorage.removeItem(i.pageKey.detailJson);mr(!0,i.minPageNum,i.maxPageNum,i.storageNamebase,i)})},deletePic:function(){var e=$("#imageList").find(".weui-check");console.info("开始删除照片了！！！"),e.length>0&&(console.info("进入删除照片了！！！"),tr(e,this.minPageNum,this.maxPageNum)),this.editing=!1,$(".weui-cell").show()},resetupload:function(){hideModal()},next:function(){var e=localStorage.getItem(this.pageKey.calenderTemp);if(null!=e||void 0!=e){var t=JSON.parse(e);if(t.length<this.minPageNum)return void layer.alert("最少上传"+this.minPageNum+"张照片");this.$emit("baseUploadNextStep")}else layer.alert("最少上传"+this.minPageNum+"张照片")},next111:function(){var t=this;if(isupping)showConfirm("#uping-photo");else{var i=!1,a=localStorage.getItem(this.storageNamebase);if(null!=a&&"null"!=a){a=JSON.parse(a),a.sort(sortBy("index",!0));var o=this.$route.query.isSimple;if(a.length<this.minPageNum&&(o||-1==this.id))return this.tipsFont=!0,void setTimeout(function(){t.tipsFont=!1},3e3);for(var s=0;s<a.length;s++)if(1==a[s].pixellow){i=!0;break}localStorage.setItem(this.storageNamebase,JSON.stringify(a));var n=[];if(this.uploadcomplete);else{var r=localStorage.getItem(this.pageKey.uploadCalenderTemp);if(r){var l=JSON.parse(r);n=l.concat(a)}else n=a}localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(n));var d=!1;if($("div[id^='uploadFailure_']").length>0&&$("div[id^='uploadFailure_']").each(function(){$(this).is(":visible")&&(d=!0)}),d)showConfirm("#fail-photo");else{t=this;if(1!=this.isTeamBook&&"true"!=this.isTeamBook)if(this.isTaoBan)if(i)this.showModal("#low-photo");else{t=this;layer.confirm("确认提交套版吗?",function(i){try{t.nextStep(1)}catch(e){}layer.close(i)})}else this.isSimple,t.nextStep(0);else i?this.showModal("#low-photo"):this.nextStep(1)}}}},chooseFail:function(){this.checkAll&&nr(),chooseFailBox(),this.hideModal()},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},goFxupload:function(){location.href="fxUpload?id="+this.id+"&p="+this.p+"&isTeamBook="+this.isTeamBook+"&isfirst="+!0},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},nextStep:function(t){if(isupping)showConfirm("#uping-photo");else{this.hideModal();var i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));try{if(window._czc){var a="";a=0==t?"时间排序":"智能排序",window._czc.push(["_trackEvent","剪影","上传页面",a])}}catch(e){console.log(e)}this.$emit("baseUploadNextStep",this.id,this.p,i,t)}},showUpload:function(){$(".uploadZoone").show(),$(".no-infor").hide()},onFileAdded:function(e){if($("#uploadIndex").hide(),$("#uploadShow").show(),e&&e._info&&e._info.width>1e4&&e._info.height>1e4&&alert("图片:"+e.name+" 文件宽高过大！系统不支持！"),e.size>this.options.size)return this.showModal("#type-size"),window.setTimeout(function(){hideModal()},2e3),void(e.ignored=!0);addFileSimple(e)},onFileSuccess:function(e,t,i,a){var o=JSON.parse(i);cr(t,o,this.minPageNum,this.maxPageNum)},fileProgress:function(e,t,i){this.progress=t.progress(),uploadProgressSimple(t,this.progress),this.averageSpeed=t.averageSpeed,this.currentSpeed=t.currentSpeed,this.timeRemaining=t.timeRemaining(),this.uploadedSize=t.sizeUploaded();this.isUploading,this.isComplete},onFileError:function(e,t,i,a){faileureSimple(t)},fileRemoved:function(e){var t=this;this.$nextTick(function(){t.file_total=t.$refs["uploader"].files.length})},getHistoryPhoto:function(){this.isuploadbutton=!1,this.ishistoryuploadbutton=!0,$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNum=0,this.checkAll=!1,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.historyCalenderTemp,$("#historyuploadbutton").addClass("active"),$("#uploadbutton").removeClass("active"),$("#designGO").hide(),$(".addImagediv").hide(),$("#insertupload").show(),this.getCalenderTemp(localStorage.getItem(this.pageKey.token))},changebutton:function(){this.isuploadbutton=!0,this.ishistoryuploadbutton=!1,$(".weui-check_box2").attr("checked",!1),$(".weui-cell").show(),$(".weui-cell__ft").show(),this.chooseNum=0,this.checkAll=!1,$("#showIOSDialog2").hide(),$("#showIOSDialog3").hide(),this.storageNamebase=this.pageKey.calenderTemp,this.chooseNum=0,$("#designGO").show(),$("#uploadIndex").show(),$(".addImagediv").show(),$("#insertupload").hide(),$("#uploadbutton").addClass("active"),$("#historyuploadbutton").removeClass("active"),handleImagebeforeupload(!0,this.minPageNum,this.maxPageNum,this.storageNamebase,this)},submitUpload:function(){var e=this;this.$nextTick(function(){for(var t=0;t<e.$refs["uploader"].files.length;t++)e.$refs["uploader"].files[t].resume()})},closeErrorDialog:function(){this.errorDialog=!1},handelClose:function(){this.clearcache(),this.thirdDialog=!1},clearcache:function(){this.file_total=0,this.errorfilelist=[],this.controllerErrorFileDialog=!1,this.$refs.uploader.uploader.cancel(),this.getresourceDetail()},cancelUpload:function(){console.info("取消上传"),this.thirdDialog=!1,this.clearcache()},progressStyle:function(){var e=Math.floor(100*this.progress),t="translateX(".concat(Math.floor(e-100),"%)");return{progress:"".concat(e,"%"),webkitTransform:t,mozTransform:t,msTransform:t,transform:t}},status:function(){statuschange();var e=this.isUploading,t=this.isComplete,i=this.error,a=this.paused;return t?"success":i?"error":e?"uploading":a?"paused":"waiting"},onFilesubmitted:function(e,t){console.info("asjjjj")},changePhotoUploadList:function(){var e=JSON.parse(localStorage.getItem(this.pageKey.historyCalenderTemp)),t=[],i=localStorage.getItem(this.pageKey.calenderTemp);if("[]"==i?(console.info("7418473==="),t=[]):t=JSON.parse(i),t.length>this.maxPageNum){var a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";layer.alert(a)}else{for(var o=$("#imageList").find(".weui-check"),s=0;s<o.length;s++)if(o[s].checked)for(var n=$(o[s]).parents(".phoBox").attr("imageid"),r=0;r<e.length;r++)if(n==e[r].id){if(t.length>=this.maxPageNum){localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t));a="选的照片太多了，已选取"+this.maxPageNum+"张照片加入上传";return layer.alert(a),console.info("22222"),void this.changebutton()}t.push(e[r]);break}localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(t)),this.changebutton()}}}},yr=fr,_r=(a("2ad3"),a("1c43"),Object(b["a"])(yr,Xn,Qn,!1,null,"6f21a6c7",null)),vr=_r.exports,wr={name:"gualiupload",components:{GuaLiBaseUpload:vr,GualiAddressForm:Kn},data:function(){return{storageName:null,submitButtonName:"进入设计",history:!1,uid:"",id:"",pageKey:null,isPart:!1,isChangxian:!1,isSimple:!1,iscomplete:!1,server:{upload:J["a"].basicUrl+"/upload/photo",uploadData:{},delete:"/tbdiy/uploade/deleteImg.do",urlConfig:J["a"],uploadUrl:J["a"].basicUrl+"/upload/downloadCaiyun"},checksubmitstate:!0,minPageNum:0,maxPageNum:0,isTeamBook:!1,uploadcomplete:!1,options:{target:"",maxChunkRetries:2,testChunks:!1,chunkSize:53687091200,size:15728640,query:{}},statusText:{success:"上传成功",error:"上传失败",uploading:"上传中",paused:"暂停中",waiting:"等待中"},attrs:{accept:"image/*"}}},created:function(){document.body.style.position="absolute";var e=localStorage.getItem("isAlipay"),t=navigator.userAgent.toLowerCase();("undefined"!=typeof my||"alipayclient"==t.match(/AlipayClient/i)||e)&&(this.is_alipay=!0),this.id=this.$route.query.id,this.isSimple=this.$route.query.isSimple;this.$route.query.uploadcomplete;this.isPart=this.$route.query.isPart,this.history=this.$route.query.history,this.uid=this.$route.query.uid;var i=this.$route.query.p;this.isTeamBook=this.$route.query.isTeamBook,this.isfirst=this.$route.query.isfirst,this.isChangxian=this.$route.query.isChangxian,"true"!=this.isTeamBook&&1!=this.isTeamBook||"true"==this.isfirst||1==this.isfirst?this.pageKey=ee["a"]:this.pageKey=ee["c"],(this.isPart||this.history)&&(this.pageKey=ee["c"]),this.logFrom("普通上传"),localStorage.removeItem(this.pageKey.calenderTemp);var a=localStorage.getItem(this.pageKey.token);if(null!=a&&void 0!=a&&"null"!=a&&"undefined"!=a){this.storageName=this.pageKey.calenderTemp,!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook?(this.isTeamBook=!1,this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)):(this.isTeamBook=!0,this.isPart&&1!=this.isChangxian?(this.minPageNum=i,this.maxPageNum=5*i,localStorage.setItem(this.pageKey.minnum,i),localStorage.setItem(this.pageKey.maxnum,5*i)):(this.minPageNum=localStorage.getItem(this.pageKey.minnum),this.maxPageNum=localStorage.getItem(this.pageKey.maxnum)));a=localStorage.getItem(this.pageKey.token);this.server.uploadData.token=a}else this.$router.push({name:"404"})},mounted:function(){},methods:{addinfo1:function(e){this.addinfo=e,this.saveguali()},closep:function(){$("#addPop").removeClass("weui-popup__container weui-popup__container--visible"),$("#addPop").hide(),$(".sjky-mask").hide(),$(".weui-popup__modal").hide()},nextStep:function(){$(".sjky-mask").show(),$(".weui-popup__modal").show(),$("#addPop").popup()},saveguali:function(){var e=this,t=this,i=localStorage.getItem(this.pageKey.token),a={};a.token=i,a.name=this.addinfo.userwangwang,a.phoneNo=this.addinfo.telno,Object(H["ib"])(a).then(function(i){console.info("tsinghuaEmba=============="),console.info(i),i.result?(t.closep(),e.$router.push({name:"guanLiSuccess"})):layer.alert("保存失败")})},nextStep111:function(e,t,i,a){var o=localStorage.getItem(this.pageKey.calenderTemp);localStorage.getItem(this.pageKey.diytype);if(this.isfirst&&"[]"!=o){var s=JSON.parse(o);if(-1==this.id&&s.length<this.minPageNum)return void layer.alert("空白模板，上传照片数量不能小于最小照片数量")}localStorage.getItem(this.pageKey.hassort);localStorage.setItem(this.pageKey.hassort,a),localStorage.removeItem(this.pageKey.cal_pageList);var n=!1;1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(n=!0),localStorage.setItem(this.pageKey.areadyInsert,"1");navigator.userAgent.toLowerCase();var r=navigator.userAgent,l=!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(l)this.isSimple?location.href="simpledesign?id="+this.id+(null==t||void 0==t||""==t?"":"&p="+t)+(null==n||void 0==n||""==n?"":"&isEditCover="+n)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort=0&submit=true&editType=1&iscomplete="+this.iscomplete:location.href="design?id="+this.id+(null==t||void 0==t||""==t?"":"&p="+t)+(null==n||void 0==n||""==n?"":"&isEditCover="+n)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+(null==this.isPart||void 0==this.isPart||""==this.isPart?"":"&isPart="+this.isPart)+(null==this.isfirst||void 0==this.isfirst||""==this.isfirst?"":"&isfirst="+this.isfirst)+"&hassort="+a+"&iscomplete="+this.iscomplete+(null==this.history||void 0==this.history||""==this.history?"":"&history="+this.history)+(null==this.uid||void 0==this.uid||""==this.uid?"":"&uid="+this.uid);else if(this.isSimple)this.$router.push({name:"simpledesign",query:{id:this.id,p:t,isEditCover:n,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:0,submit:!0,editType:1,iscomplete:this.iscomplete}});else{var d={id:this.id,p:t,isEditCover:n,isTeamBook:this.isTeamBook,isPart:this.isPart,isfirst:this.isfirst,hassort:0,iscomplete:this.iscomplete};this.history&&(d.history=this.history,d.uid=this.uid),this.$router.push({name:"design",query:d})}},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(ee["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},changebuttonupload:function(e){this.storageName="1"==e?this.pageKey.historyCalenderTemp:this.pageKey.calenderTemp},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{startUploadLog()}catch(e){console.log(e)}}}},br=wr,Ir=(a("5d77"),Object(b["a"])(br,Vn,Yn,!1,null,null,null)),Sr=Ir.exports;u["a"].use(x["a"]),console.log("process.env.BASE_URL:/jianying/");var xr=new x["a"]({mode:"history",base:"/jianying/",routes:[{path:"/",name:"serach",component:Oe},{path:"/about",name:"about",component:function(){return a.e("about").then(a.bind(null,"f820"))}},{path:"/guanLiIndex",name:"guanLiIndex",component:Js},{path:"/gualiuwechatpload",name:"gualiuwechatpload",component:Wn},{path:"/gualiupload",name:"gualiupload",component:Sr},{path:"/guanLiSuccess",name:"guanLiSuccess",component:Hn},{path:"/baseUploadCaiyun",name:"baseUploadCaiyun",component:ro},{path:"/templateList",name:"templateList",component:function(){return a.e("chunk-3c9adc10").then(a.bind(null,"adbd"))}},{path:"/upphoto",name:"upphoto",component:la},{path:"/mtemplate",name:"mtemplate",component:Ri},{path:"/newmtemplate",name:"newmtemplate",component:Yi},{path:"/editsearch",name:"editsearch",component:Ae},{path:"/list1",name:"list1",component:pa},{path:"/preview",name:"preview",component:_e},{path:"*",component:function(){return a.e("chunk-a54652ec").then(a.bind(null,"8cdb"))}},{path:"/design",name:"design",component:function(){return Promise.resolve().then(a.bind(null,"e507"))}},{path:"/upload",name:"upload",component:Qe},{path:"/newupload",name:"newupload",component:Ut},{path:"/fxUpload",name:"fxUpload",component:Ki},{path:"/taobanupload",name:"taobanupload",component:ba},{path:"/goodsinfo",name:"goodsinfo",component:ia},{path:"/productlist",name:"productlist",component:Ke},{path:"/player",name:"player",component:La},{path:"/pageOrder",name:"pageOrder",component:function(){return Promise.all([a.e("chunk-8ddf6b2c"),a.e("chunk-2f16aff6")]).then(a.bind(null,"8490"))}},{path:"/pageOrderNew",name:"pageOrderNew",component:function(){return Promise.all([a.e("chunk-8ddf6b2c"),a.e("chunk-cafbe074")]).then(a.bind(null,"3754"))}},{path:"/success",name:"success",component:function(){return a.e("chunk-1e3b6668").then(a.bind(null,"f77d"))}},{path:"/previewModel",name:"previewModel",component:function(){return a.e("chunk-1c144800").then(a.bind(null,"0d76"))}},{path:"/ground",name:"ground",component:to},{path:"/groundModel",name:"groundModel",component:function(){return a.e("chunk-181affcf").then(a.bind(null,"e1f3"))}},{path:"/drafts",name:"drafts",component:po},{path:"/newdrafts",name:"newdrafts",component:function(){return Promise.resolve().then(a.bind(null,"1c432"))}},{path:"/album",name:"album",component:Io},{path:"/simpleUploader",name:"simpleUploader",component:To},{path:"/alipayupload",name:"alipayupload",component:function(){return a.e("chunk-b1786d32").then(a.bind(null,"4bd5"))}},{path:"/newalipayupload",name:"newalipayupload",component:function(){return a.e("chunk-d6e6fb8c").then(a.bind(null,"3dbc"))}},{path:"/photoOrder",name:"photoOrder",component:Ko},{path:"/photoOrderNew",name:"photoOrderNew",component:function(){return a.e("chunk-7b6b29f2").then(a.bind(null,"0cbf"))}},{path:"/simpledesign",name:"simpledesign",component:Ro},{path:"/loading",name:"loading",component:Yo},{path:"/wait",name:"wait",component:is},{path:"/gongge",name:"gongge",component:function(){return a.e("chunk-7c8852a5").then(a.bind(null,"d4a8"))}},{path:"/videobook",name:"videoBook",component:function(){return a.e("chunk-72f9b014").then(a.bind(null,"fa90"))}},{path:"/videobookdesign",name:"videoBookDesign",component:function(){return a.e("chunk-5a660951").then(a.bind(null,"68b1"))}},{path:"/ecdbook",name:"ecdbook",component:ps},{path:"/namepaste",name:"namepaste",component:function(){return a.e("chunk-3411d1c8").then(a.bind(null,"de4b"))}},{path:"/namepaste_pc",name:"namepaste_pc",component:function(){return a.e("chunk-1a01030c").then(a.bind(null,"90f5"))}},{path:"/copybook",name:"copybook",component:function(){return a.e("chunk-5afea25f").then(a.bind(null,"0b93"))}},{path:"/design_new",name:"design_new",component:function(){return Promise.all([a.e("chunk-6b6dab90"),a.e("chunk-0d12f359")]).then(a.bind(null,"573c"))}},{path:"/bianji",name:"bianji",component:function(){return Promise.all([a.e("chunk-6b6dab90"),a.e("chunk-3e1b3264")]).then(a.bind(null,"a558"))}},{path:"/wait_new",name:"wait_new",component:function(){return a.e("chunk-c392e1ec").then(a.bind(null,"87b4"))}},{path:"/bookpreview",name:"bookpreview",component:function(){return a.e("chunk-ebc79894").then(a.bind(null,"3656"))}},{path:"/bookpreview2",name:"bookpreview2",component:function(){return a.e("chunk-29caf8e0").then(a.bind(null,"3542"))}},{path:"/404",name:"404",component:function(){return a.e("chunk-a54652ec").then(a.bind(null,"8cdb"))}},{path:"/templatepreview",name:"templatepreview",component:Cs}]}),kr={state:{detailJson:{},orderInfo:{},photos:[],svgxmlArr:[],currentDesignFonts:{}},mutations:{UPDATE_PAGES:function(e,t){e.detailJson=t},UPDATE_ORDERINFO:function(e,t){e.orderInfo=t},UPDATE_PHOTOS:function(e,t){e.photos=t},UPDATE_PAGE_NO_TOKEN:function(e,t){e.detailJson=t},UPDATE_SVGXMLARR:function(e,t){Array.isArray(e.svgxmlArr[t.pageIndex])?-1==e.svgxmlArr[t.pageIndex].indexOf(t.svgString)&&e.svgxmlArr[t.pageIndex].push(t.svgString):(e.svgxmlArr[t.pageIndex]=[],e.svgxmlArr[t.pageIndex].push(t.svgString))},UPDATE_DESIGNFONTS:function(e,t){Array.isArray(e.currentDesignFonts[t.fontid])?-1==e.currentDesignFonts[t.fontid].indexOf(t.selfIndex)&&e.currentDesignFonts[t.fontid].push(t.selfIndex):(e.currentDesignFonts[t.fontid]=[],e.currentDesignFonts[t.fontid].push(t.selfIndex))}},actions:{updateDesignFonts:function(e,t){var i=e.commit;i("UPDATE_DESIGNFONTS",t)},updateSvgxmlArr:function(e,t){var i=e.commit;i("UPDATE_SVGXMLARR",t)},updatePages:function(e,t){var i=e.commit;i("UPDATE_PAGES",t)},updateOrderInfo:function(e,t){var i=e.commit;i("UPDATE_ORDERINFO",t)},updatePhotos:function(e,t){var i=e.commit;i("UPDATE_PHOTOS",t)},getJsonFun:function(t,i){var a=t.commit,o=(t.dispatch,t.state,t.rootState);return new Promise(function(t,s){Object(H["z"])(i).then(function(s){if(0!=s.result){console.log(o),console.log("原始串：",JSON.parse(s.data));var n,r=localStorage.getItem(i.pageKey.isVideo),l=localStorage.getItem(i.pageKey.videonum),d=localStorage.getItem(i.pageKey.rk),c=localStorage.getItem(i.pageKey.tokenDetail),h=JSON.parse(s.data);if(localStorage.setItem(i.pageKey.thumbnailToken,h.base64Token),2==h.templateInfo.coverper&&h.coverInfo.hascover&&(n=!0),h.rk=d,"true"!=r&&1!=h.isVideo?h.isVideo=!1:(h.isVideo=!0,h.videoNum=l),c&&""!=c&&null!=c&&void 0!=c){var g=JSON.parse(c);if(g.tradenum&&g.tradenum.content&&g.tradenum.content.name&&g.tradenum.content.phone&&""!=g.tradenum.content.name&&""!=g.tradenum.content.phone){for(var m=h.pageList[0],p=m.content.itemList,u=0;u<p.length;u++){var f=p[u];if(f.mediatag&&"baoXianName"==f.mediatag){f.media.text.length;f.media.text=""+g.tradenum.content.name}if(f.mediatag&&"baoXianPhone"==f.mediatag){f.media.text.length;f.media.text=""+g.tradenum.content.phone}p[u]=f}h.pageList[0].content.itemList=p}}if(n&&h.pageList[0].iscover){var y=h.pageList[0],_=h.pageList[0].pageBleed,v=y.spine,w=0,b=h.templateInfo.spinewidth;if(b&&_&&_.m&&_.m>2&&Number(_.m)>Number(b)&&!v){y.spine=!0;var I=(_.m-b)/2;_.l=Number(_.l)+I,_.r=Number(_.r)+I,h.pageList[0].pageBleed=_;for(var S=h.pageList[0].content.itemList,x=0;x<S.length;x++)"shape"==S[x].media.mediaType&&S[x].isDesignShape&&(w=Number(S[x].location.x)+Number(S[x].location.width)/2);for(u=0;u<S.length;u++)if("shape"==S[u].media.mediaType||1==S[u].media.isBG||1==S[u].isDisplay);else{if(Number(S[u].location.x)>w)var k=Number(S[u].location.x)-I,O=Number(S[u].printLocation.x)-I;else k=Number(S[u].location.x)+I,O=Number(S[u].printLocation.x)+I;S[u].location.x=k,S[u].printLocation.x=O}h.pageList[0].content.itemList=S}}try{var L=h.pageList;for(x=0;x<L.length;x++)for(var T=L[x].content.itemList,C=0;C<T.length;C++){var P=T[C];if("advancedImageMask"==P.media.mediaType&&(P.media.originalImgWidth||(P.media.originalImgWidth=P.media.imgWidth),P.media.originalImgHeight||(P.media.originalImgHeight=P.media.imgHeight)),"text"==P.media.mediaType&&P.media.font.id){var j=!0,A=o.fontIdAndName.allFontInfo;for(var N in A)if(P.media.font.id==A[N].id){j=!1;var E={};E.fontid=P.media.font.id,E.selfIndex=x+"_"+C,a("UPDATE_DESIGNFONTS",E)}j&&(P.media.font.id=A[0].id)}if("svg"==P.media.mediaType&&P.svgString&&(P.svgString=""),"selfGroup"==P.media.mediaType)for(var J=0;J<P.childrenElement.length;J++)"svg"==P.childrenElement[J].media.mediaType&&P.childrenElement[J].svgString&&(P.childrenElement[J].svgString="")}var D=JSON.parse(localStorage.getItem(i.pageKey.orderInfo));h.oderInfo=D}catch(e){console.log(e)}console.log(h),a("UPDATE_PAGES",h),s.data=JSON.stringify(h),t(s)}else t(s)}).catch(function(e){s(e)})})},getJsonFunNoToken:function(e,t){var i=e.commit;return new Promise(function(e,a){var o=localStorage.getItem(t.pageKey.uid);if(null==t.uid||void 0==t.uid||t.uid==o||1==t.fromCache){var s=JSON.parse(localStorage.getItem(t.pageKey.detailJson));i("UPDATE_PAGE_NO_TOKEN",s);var n={result:!0};n.data=s,e(n)}else Object(H["A"])(t).then(function(a){var o=JSON.parse(a.data);if(o.isBanhua&&(o.diyType="woodcut",o.templateInfo.diyType="woodcut"),o.isguali&&(o.diyType="wall_calendar",o.templateInfo.diyType="wall_calendar"),o.iscup&&(o.diyType="mug_cup",o.templateInfo.diyType="mug_cup"),"vidoephoto"==o.diyType){var s=o.pageList,n=JSON.parse(JSON.stringify(o.pageList[0]));n.content.itemList.splice(3,1e3);for(var r=n,l=o.pageList.length-1,d=o.pageList.length+l,c=[],h=0;h<d;h++)0==h?c.push(s[0]):h%2==1?c.push(r):c.push(s[h/2]);o.pageList=c}i("UPDATE_PAGE_NO_TOKEN",o),localStorage.setItem(t.pageKey.rk,o.rk),localStorage.setItem(t.pageKey.videonum,o.videoNum),localStorage.setItem(t.pageKey.detailJson,a.data),e(a)}).catch(function(e){a(e)})})}}},Or=kr,Lr={detailJson:function(e){return e.designModle3.detailJson},photos:function(e){return e.designModle3.photos},svgxmlArr:function(e){return e.designModle3.svgxmlArr},currentDesignFonts:function(e){return e.designModle3.currentDesignFonts},idNameJson:function(e){return e.fontIdAndName.idNameJson},allFontInfo:function(e){return e.fontIdAndName.allFontInfo}},Tr=Lr,Cr={state:{idNameJson:{},allFontInfo:{}},mutations:{UPDATE_AllFont_Info:function(e,t){e.allFontInfo=t},UPDATE_IdNameJson:function(e,t){e.idNameJson=t}},actions:{getFontCss:function(e){e.commit;Object(Ga["c"])()},getAllFontInfo:function(e){var t=e.commit;return new Promise(function(e,i){Object(Ga["b"])().then(function(i){t("UPDATE_AllFont_Info",i.data);for(var a={},o=0;o<i.data.length;o++)a[i.data[o].id]=i.data[o].name;t("UPDATE_IdNameJson",a),e(i)}).catch(function(e){i(e)})})},getFontName:function(e,t){e.commit}}},Pr=Cr;u["a"].use(E["a"]);var jr=new E["a"].Store({modules:{designModle3:Or,fontIdAndName:Pr},getters:Tr}),Ar=a("ca95"),Nr=a.n(Ar),Er=a("d842"),Jr=a.n(Er),Dr=(a("2ba8"),a("f0e2")),Br=(a("4bcc"),a("3a10"),a("caf9")),Kr=a("ef55"),Mr=a.n(Kr),$r=a("4eb5"),Ur=a.n($r);u["a"].use(Ur.a),u["a"].prototype.$video=Dr["a"],u["a"].use(Mr.a),u["a"].use(Nr.a,{name:"v-touch"}),u["a"].use(p["a"]),u["a"].use(m["a"]),u["a"].use(g["a"]),u["a"].use(c["a"]),u["a"].use(d["a"]),u["a"].use(l["a"]),u["a"].use(r["a"]),u["a"].use(n["a"]),u["a"].use(s["a"]),u["a"].use(o["a"]),u["a"].prototype.$layer=Jr()(u["a"]),u["a"].use(Br["a"],{preLoad:1,error:a("cc09"),loading:a("cc09"),attempt:2}),u["a"].prototype.fabric=window.fabric,u["a"].config.productionTip=!1,jr&&jr.state&&console.log(jr);try{if(navigator.onLine)console.log("online");else{console.log("offline");try{if(window._jylog){var Wr=ee["a"];-1!=window.location.href.indexOf("uid=")&&(Wr=ee["c"]);var Fr=localStorage.getItem(Wr.orderInfo);window._jylog.push(["网络状态","mainjs文件","网络状态检测",navigator.onLine,JSON.parse(Fr).orderNo])}}catch(e){}Jr()(u["a"]).alert("您的网络离线")}window.addEventListener("offline",function(e){try{if(window._jylog){var t=ee["a"];-1!=window.location.href.indexOf("uid=")&&(t=ee["c"]);var i=localStorage.getItem(t.orderInfo);window._jylog.push(["网络状态","mainjs文件","offline事件","网络发生中断",JSON.parse(i).orderNo])}}catch(e){}Jr()(u["a"]).alert("网络发生中断")}),window.addEventListener("online",function(e){try{if(window._jylog){var t=ee["a"];-1!=window.location.href.indexOf("uid=")&&(t=ee["c"]);var i=localStorage.getItem(t.orderInfo);window._jylog.push(["网络状态","mainjs文件","online事件","网络恢复",JSON.parse(i).orderNo])}}catch(e){}Jr()(u["a"]).alert("网络恢复")})}catch(e){}if(-1!=window.location.href.indexOf("drafts")||-1!=window.location.href.indexOf("loading")||-1!=window.location.href.indexOf("design")||-1!=window.location.href.indexOf("googge")){var Rr=sl("fromAlipyShopPaid");1!=Rr&&"1"!=Rr||(localStorage.setItem(ee["f"].fromAlipyShopPaid,Rr),localStorage.removeItem(ee["f"].fromAlipyShop),localStorage.removeItem(ee["f"].fromAlipyShopCartEdit));var qr=sl("alipyShopGoodsid"),Gr=sl("alipyShopProductid"),zr=sl("fromAlipyShop"),Hr=sl("fromAlipyShopCartEdit");1!=zr&&"1"!=zr||(localStorage.setItem(ee["f"].alipyShopGoodsid,qr),localStorage.setItem(ee["f"].alipyShopProductid,Gr),localStorage.setItem(ee["f"].fromAlipyShop,zr),localStorage.removeItem(ee["f"].fromAlipyShopPaid),1==Hr||"1"==Hr?localStorage.setItem(ee["f"].fromAlipyShopCartEdit,Hr):localStorage.removeItem(ee["f"].fromAlipyShopCartEdit))}var Vr,Yr,Xr,Qr=sl("isMiniProgram");console.log(window.location.href),console.log("main isMiniProgram:"+Qr),console.log(ee["f"].isMiniProgram),1!=Qr&&"1"!=Qr||localStorage.setItem(ee["f"].isMiniProgram,Qr),new u["a"]({uploader:Mr.a,router:xr,store:jr,render:function(e){return e(S)}}).$mount("#app"),ol();var Zr=!0,el=Object(ys["a"])();console.log("mobileName=="+el),console.log("1==="+navigator.userAgent.toLowerCase());var tl,il=navigator.userAgent.toLowerCase();if(localStorage.getItem(ee["a"].thirdDatil)){var al=JSON.parse(localStorage.getItem(ee["a"].thirdDatil));"2"==al.mshopSign&&(tl=!0)}function ol(){if((-1==window.location.href.indexOf("uid=")||-1!=window.location.href.indexOf("history")&&-1==window.location.href.indexOf("admin"))&&!Vr){var t=sl("isTeamBook"),i=localStorage.getItem(ee["f"].fromAlipyShop),a=localStorage.getItem(ee["f"].fromAlipyShopPaid);1!=t&&"true"!=t?(document.title=1==i||1==a?"":"简影",Vr=setInterval(function(){if(!getSave()){var t=ee["a"];-1!=window.location.href.indexOf("uid=")&&(t=ee["c"]);try{if(Zr&&localStorage.getItem(t.detailJson))Yr=JSON.parse(localStorage.getItem(t.detailJson)),Zr=!1,console.info("第一次，进入自动保存设计"),console.info("isfirst======"),console.info(Zr);else if(localStorage.getItem(t.detailJson)){if(Xr=JSON.parse(localStorage.getItem(t.detailJson)),Yr=JSON.parse(JSON.stringify(Yr)),Yr.datetime="",Xr.datetime="",JSON.stringify(Yr)==JSON.stringify(Xr))return console.info("设计没有改变，不保存"),void nl(t);console.info("设计有改变，保存"),Yr=JSON.parse(JSON.stringify(Yr)),console.info("isfirst======"),console.info(Zr)}}catch(e){console.log(e)}if(-1!=window.location.href.indexOf("design")||-1!=window.location.href.indexOf("preview")||-1!=window.location.href.indexOf("pageOrder")||-1!=window.location.href.indexOf("simpledesign")||-1!=window.location.href.indexOf("design_new")||-1!=window.location.href.indexOf("bianji")||"vivo"==el){if(-1!=window.location.href.indexOf("preview")){var i=sl("isNamePaste");if(1==i||"true"==i)return;var a=sl("isGongge");if(1==a||"true"==a)return}var o=J["a"].baseUrl2,s=localStorage.getItem(t.token),n=JSON.parse(localStorage.getItem(t.goodsid)),r=JSON.parse(localStorage.getItem(t.productId)),l=JSON.parse(localStorage.getItem(t.motherid)),d=JSON.parse(localStorage.getItem(t.detailJson));d.datetime=(new Date).getTime(),localStorage.setItem(t.detailJson,JSON.stringify(d)),jr.dispatch("updatePages",d);for(var c=localStorage.getItem(t.isTeamBook),h=JSON.parse(localStorage.getItem(t.orderInfo)),g=JSON.parse(localStorage.getItem(t.uploadCalenderTemp)),m="",p=0;p<g.length;p++)g[p].id&&(""==m?m=g[p].id.toString():m+=","+g[p].id);d.photoIds=m;var u=d.pageList;if(!u)return;for(var f=0;f<u.length;f++)for(var y=u[f].content.itemList,_=0;_<y.length;_++)if("text"==y[_].media.mediaType&&""!=y[_].media.text&&""!=y[_].media.font.textPath?"yes"==y[_].moveable&&(y[_].moveable="yes"):"image"==y[_].media.mediaType&&0==y[_].media.isBG&&0==y[_].isDisplay||"yes"!=y[_].moveable&&delete y[_].moveable,"advancedImageMask"==y[_].media.mediaType)-1!=y[_].media.maskSource.indexOf(Object(Q["d"])(y[_].media.maskSource))&&(y[_].media.maskSource=Object(Q["f"])(y[_].media.maskSource,y[_]).replace(Object(Q["d"])(y[_].media.maskSource),"")),-1!=y[_].media.factMaskSource.indexOf(Object(Q["d"])(y[_].media.factMaskSource))&&(y[_].media.factMaskSource=Object(Q["f"])(y[_].media.factMaskSource,y[_]).replace(Object(Q["d"])(y[_].media.factMaskSource),"")),-1!=y[_].media.bgSource.indexOf(Object(Q["d"])(y[_].media.bgSource))&&(y[_].media.bgSource=Object(Q["f"])(y[_].media.bgSource,y[_]).replace(Object(Q["d"])(y[_].media.bgSource),"")),-1!=y[_].media.maskSource.indexOf("img/nophoto.jpg")?(console.log("包含nophoto,defaultState=true"),y[_].media.defaultState=!0):(console.log("不包含nophoto,defaultState=false"),y[_].media.defaultState=!1);else if("image"==y[_].media.mediaType)-1!=y[_].media.imgPath.indexOf(Object(Q["d"])(y[_].media.imgPath))&&(y[_].media.imgPath=Object(Q["f"])(y[_].media.imgPath,y[_]).replace(Object(Q["d"])(y[_].media.imgPath),"")),-1!=y[_].media.imgPath.indexOf(o)&&(y[_].media.imgPath=y[_].media.imgPath.replace(o,""));else if("text"==y[_].media.mediaType)null!=y[_].media.imgPath&&void 0!=y[_].media.imgPath&&-1!=y[_].media.imgPath.indexOf(o)&&(y[_].media.font.textPath=y[_].media.font.textPath.replace(o,"")),y[_].media.isImage&&-1!=y[_].media.font.textPath.indexOf(o)&&(y[_].media.font.textPath=y[_].media.font.textPath.replace(o,""));else if(y[_].media.mediaType.indexOf("svg")>-1)-1!=y[_].media.imgPath.indexOf(Object(Q["d"])(y[_].media.imgPath))&&(y[_].media.imgPath=Object(Q["f"])(y[_].media.imgPath,y[_]).replace(Object(Q["d"])(y[_].media.imgPath),""));else if(y[_].media.mediaType.indexOf("selfGroup")>-1){var v=!0,w=!1,b=void 0;try{for(var I,S=y[_].childrenElement[Symbol.iterator]();!(v=(I=S.next()).done);v=!0){var x=I.value;Object(Z["a"])(x)}}catch(j){w=!0,b=j}finally{try{v||null==S.return||S.return()}finally{if(w)throw b}}}var k,O=localStorage.getItem(t.uid),L=localStorage.getItem(t.autoSave),T=localStorage.getItem(t.orgTime);d.orgTime=T;var C=localStorage.getItem(t.fold);""!=C&&void 0!=C&&null!=C&&(d.fold=C),""!=h&&void 0!=h&&null!=h&&h!={}&&(d.oderInfo=h,d.sku=h.productNo),-1==window.location.href.indexOf("design_new")&&-1==window.location.href.indexOf("bianji")||(d.addinfo?d.addinfo.telno="newjianying":d.addinfo={telno:"newjianying"}),k=L?2:1,console.log("editType:"+k);var P={};1==k?P={userid:-1,name:"",submit:!1,token:s,edittype:1,gid:n,pid:r,mid:l,designerDetail:d,orderNo:h.orderNo,productno:h.productno,tid:d.templateInfo.id,pnum:localStorage.getItem(t.pnum),photoSize:0,membertype:h.shopName,isTeamBook:c,flag:4}:2==k&&(P={uid:O,designerDetail:d,edittype:2,pid:r,productno:h.productno,submit:!1,isTeamBook:c}),Object(H["cb"])(P).then(function(i){if(i.result){console.log("自动保存成功！"),localStorage.setItem(t.autoSave,1),localStorage.setItem(t.uid,i.data.uid);try{if(window._jylog){var a=localStorage.getItem(t.orderInfo);window._jylog.push(["按钮点击","设计","自动保存",i.data.uid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}}else{console.log("自动保存失败"),Yr=null,Zr=!0;try{if(window._jylog){a=localStorage.getItem(t.orderInfo);window._jylog.push(["按钮点击","设计","自动保存","失败",JSON.parse(a).orderNo])}}catch(e){console.log(e)}}nl(t)}).catch(function(i){console.log(i);try{if(window._jylog){var a=localStorage.getItem(t.orderInfo);window._jylog.push(["按钮点击","设计","自动保存","失败"+i.meesage,JSON.parse(a).orderNo])}}catch(e){console.log(e)}})}}},3e5)):document.title="如琢毕业册"}}function sl(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.href)||[,""])[1].replace(/\+/g,"%20"))||null}function nl(e){var t=localStorage.getItem(e.token),i=localStorage.getItem(e.tokenDate),a=new Date;if(i){var o=a.getTime()-new Date(i),s=Math.floor(o/864e5);if(s>=5){console.log("token大于5天了==="+s);var n={};n.token=t,n.detail=JSON.parse(localStorage.getItem(e.tokenDetail)),Object(H["K"])(n).then(function(t){t.result&&(localStorage.setItem(e.token,t.token),localStorage.setItem(e.tokenDate,Object(_s["a"])("yyyy/MM/dd")),Object(H["n"])(t.token).then(function(t){t.result&&t.data&&localStorage.setItem(e.thumbnailToken,t.data.base64Token)}))})}else{if(!t){n={};n.token=t,n.detail=JSON.parse(localStorage.getItem(e.tokenDetail)),Object(H["K"])(n).then(function(t){t.result&&(localStorage.setItem(e.token,t.token),localStorage.setItem(e.tokenDate,Object(_s["a"])("yyyy/MM/dd")),Object(H["n"])(t.token).then(function(t){t.result&&t.data&&localStorage.setItem(e.thumbnailToken,t.data.base64Token)}))})}console.log("token小于5天了==="+s)}}}"qqbrowser"==il.match(/qqbrowser/i)||"vivo"!=el||"wechat"==il.match(/wechat/i)||tl||"undefined"!=typeof my||"alipayclient"==il.match(/AlipayClient/i)||"toutiaomicroapp"==il.match(/ToutiaoMicroApp/i)||Jr()(u["a"]).alert("检测到您当前浏览器对本系统不兼容，请使用QQ浏览器"),xr.beforeEach(function(t,i,a){Jr()(u["a"]).closeAll();try{window._hmt.push(["_trackPageview","/#"+t.fullPath])}catch(e){console.log("百度统计",e)}a()}),xr.afterEach(function(e,t,i){})},"57b3":function(e,t,i){"use strict";i.d(t,"c",function(){return w}),i.d(t,"a",function(){return b}),i.d(t,"b",function(){return I});i("a481"),i("28a5"),i("4917");var a=i("5841"),o=i("f5b3"),s=i("89d6"),n=i("e091"),r=i("a09a"),l=i("738b"),d=i("1dd3"),c=i("b2a9"),h=i("103a"),g=i("66a2"),m=i("d80f"),p=i("ff08"),u=i("ec06"),f=i("eb9b"),y=i("23ed"),_=(i("f3e0"),i("201f")),v=0;function w(e,t,i,a,o,s,n,r){if(!(i.isDesignPage&&i.isMountedComplete&&i.isDesignDataComplete&&i.hasRenderDom)){i.isDesignPage&&i.isMountedComplete&&i.isDesignDataComplete&&!i.hasRenderDom&&(i.hasRenderDom=!0);var l=[],d=t.pageList.length;localStorage.getItem(i.pageKey.isTeamBook),i.isEditCover;800,800,"calendar"!=t.diyType&&"year_calendar"!=t.diyType&&"wall_calendar"!=t.diyType&&"mug_cup"!=t.diyType&&"fashion_photo"!=t.diyType||(i.hasShunxu=!1);var c=localStorage.getItem(i.normalKey.isMiniProgram),h=navigator.userAgent.toLowerCase();if(c?t.isVideo?i.hasVideo=!0:i.hasVideo=!1:"micromessenger"==h.match(/MicroMessenger/i)&&wx.miniProgram.getEnv(function(e){e.miniprogram&&(t.isVideo?i.hasVideo=!0:i.hasVideo=!1)}),i.renderPageIndex=0,v=0,i.everyTimeImgJson&&(i.everyTimeImgJson.loadComplete=!1,i.everyTimeImgJson.imgArr=[]),i.everyTimeImgJson&&d>=i.renderCount){for(var g=0;g<i.renderPageIndex+i.renderCount;g++)if("function"===typeof i.isDrawingPage){if(i.isDrawingPage(t.pageList[g])){var m=I(e,t,g,a,i,o,s,n);l.push(m)}}else{m=I(e,t,g,a,i,o,s,n);l.push(m)}i.renderPageIndex=i.renderCount}else for(g=0;g<d;g++)if("function"===typeof i.isDrawingPage){if(i.isDrawingPage(t.pageList[g])){m=I(e,t,g,a,i,o,s,n);l.push(m)}}else{m=I(e,t,g,a,i,o,s,n);l.push(m)}var p=JSON.stringify(t);localStorage.setItem(i.pageKey.detailJson,p);try{if(r){var u=!1;Object(f["a"])(i,u)}}catch(y){console.log(y)}return l.length<=1&&document.removeEventListener("scroll",i.setTestPage),l}}function b(e,t,i,a,o,s,n){if(!(t.pageList.length<=i.renderCount)){var r;r=i.renderPageIndex+i.renderCount>t.pageList.length?t.pageList.length:i.renderPageIndex+i.renderCount;for(var l=i.renderPageIndex;l<r;l++)if("function"===typeof i.isDrawingPage){if(i.isDrawingPage(t.pageList[l])){var d=I(e,t,l,a,i,o,s,n);i.pageIdArr&&i.pageIdArr.push(d)}}else{d=I(e,t,l,a,i,o,s,n);i.pageIdArr&&i.pageIdArr.push(d)}i.renderPageIndex+=i.renderCount;var c=JSON.stringify(t);localStorage.setItem(i.pageKey.detailJson,c),r>=t.pageList.length&&(i.allPageDomComplete||Object(_["c"])(i,t),!i.uid||i.allPageDomComplete||i.changeModelAll||"/photoOrder"==i.fromPage||"/pageOrder"==i.fromPage||(i.oldDesign=JSON.parse(localStorage.getItem(i.pageKey.detailJson)),i.oldDesignfirst=!1),i.allPageDomComplete=!0)}}function I(e,t,i,w,b,I,S,x){"template_cloth"==t.diyType&&(g["a"].productBleedSpace=.01);var k=localStorage.getItem(b.pageKey.thumbnailToken),O=localStorage.getItem(b.pageKey.diytype);t.pageList[i].hasWarn=!1;for(var L=0;L<t.pageList[i].content.itemList.length;L++){var T=t.pageList[i].content.itemList[L];T.isBeyond&&"wall_calendar"!=O&&"other_object"!=O&&"mug_cup"!=O&&-1==t.pageList[i].title.indexOf("封面")&&-1==t.pageList[i].title.indexOf("封底")&&(t.pageList[i].hasWarn||(t.pageList[i].hasWarn=!0,!0))}var C=JSON.stringify(t);b.$store.dispatch("updatePages",t),localStorage.setItem(b.pageKey.detailJson,C);var P,j=[],A="",N=1,E=b.pageOrderBottomSpace,J={loadComplete:!1,imgArr:[]};document.getElementById("div_"+i)?P=document.getElementById("div_"+i):(P=document.createElement("div"),P.setAttribute("id","div_"+i)),t.pageList[i].iscover||t.pageList[i].isbackcover?P.className+="page-face":P.className+="page-item";var D,B=e.split("#");if(document.getElementById(B[1]).appendChild(P),D=SVG("#svg_"+i)?SVG("#svg_"+i):SVG().addTo("#div_"+i),D.attr({id:"svg_"+i,sp:i,preserveAspectRatio:"none"}),t.pageList[i].hasWarn){var K="svg_"+i;SVG("#"+K).addClass("warnBorderShadow")}if(1==t.templateInfo.coverper&&1==t.templateInfo.backcover&&1==t.templateInfo.innerper&&"photo"==t.diyType&&(0==i&&!t.coverInfo.hascover||i==t.pageList.length-1&&!t.coverInfo.hasbackcover)||(!D.hasClickFun&&!I||b.canGoEdit)&&(
//!vm.isUpdate
D.hasClickFun=!0,D.click(function(e){console.log("index:",this.attr("sp")),b.goEditor(this.attr("sp"),e.target,e),b.finalClickPageIndex=this.attr("sp"),b.lastEditPageIndex!=this.attr("sp")&&(b.lastEditPageIndex=this.attr("sp"))})),A="svg_"+i,"calendar"!=t.diyType&&"year_calendar"!=t.diyType||"wall_calendar"==t.diyType||"mug_cup"==t.diyType||"template_cloth"==t.diyType){var M={};if("photo"==t.diyType&&I)for(var U=0;U<t.pageList[i].content.itemList.length;U++)"shape"==t.pageList[i].content.itemList[U].media.mediaType&&t.pageList[i].content.itemList[U].isDesignShape&&(M.x=t.pageList[i].content.itemList[U].location.x,M.y=t.pageList[i].content.itemList[U].location.y,M.w=t.pageList[i].content.itemList[U].location.width,M.h=t.pageList[i].content.itemList[U].location.height,j.push(M),D.viewbox(M.x,M.y,M.w,M.h));else M.x=0,M.y=0,M.w=t.pageList[i].diyDisplayWidth,M.h=t.pageList[i].diyDisplayHeight,j.push(M),D.viewbox(M.x,M.y,M.w,M.h);if(0==i&&b.screenShotCanvas){var W=Object(f["b"])(M.w,M.h);le=W.width,de=W.height,N=W.canvasScaleNum,u["a"].getInstance().canvas=b.screenShotCanvas,u["a"].getInstance().initCanvas(le,de,t,N)}}if(0!=S){var F,R,q=navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Linux")>-1,G=navigator.userAgent.toLowerCase(),z=Object(y["a"])(),H=null!=G.match(/tencenttraveler/)||null!=G.match(/qqbrowser/),V=null!=G.match(/wechat/i),Y=localStorage.getItem(b.normalKey.isMiniProgram),X=localStorage.getItem("isAlipay");if(localStorage.getItem(b.pageKey.thirdDatil)){var Q=JSON.parse(localStorage.getItem(b.pageKey.thirdDatil));"2"==Q.mshopSign&&(F=!0)}if(document.getElementById(t.pageList[i].title))R=document.getElementById(t.pageList[i].title);else{R=document.createElement("div"),R.setAttribute("class","page-order"),R.setAttribute("id",t.pageList[i].title);var Z=document.createElement("span");if(Z.innerHTML=t.pageList[i].title,R.appendChild(Z),F&&q&&!H&&"heytapbrowser"!=G.match(/heytapbrowser/i)&&"default"==z);else{var ee=document.createElement("button");ee.innerHTML="图层",ee.className="tcBtn tcBtn_"+i,R.appendChild(ee);var te=document.createElement("i");te.className="tcIcon",ee.appendChild(te)}var ie=document.createElement("button");ie.innerHTML="",ie.className="thBtn  thBtn_"+i,R.appendChild(ie);te=document.createElement("i");te.className="thIcon",ie.appendChild(te);var ae=document.createElement("p");ae.className="thp thp_"+i,ae.innerHTML="图片有遮挡?点这里试一试",R.appendChild(ae),ie.addEventListener("click",function(e){$(".thp_"+i).hide(),b.changeCurrentPage()}),ae.addEventListener("click",function(e){$(this).toggle()}),ee.addEventListener("click",function(e){if(!q||H||V||Y||"heytapbrowser"==G.match(/heytapbrowser/i)||"default"!=z||"undefined"!=typeof my||"alipayclient"==G.match(/AlipayClient/i)||X){var t=document.documentElement.scrollTop||document.body.scrollTop;b.iosScrollTop=t,b.showTuceng=!0;var a=localStorage.getItem(b.pageKey.editTucengGuide);a||(b.editTucengGuide=!0),b.showtucengList(i),$(".close-popup").click()}else layer.alert("检测到当前浏览器不支持图层功能，若用此功能请使用QQ浏览器",{shadeClose:!1,closeBtn:0},function(e){layer.close(e)})})}t.pageList[i].nickname&&(R.innerHTML=R.innerHTML+" | 创建人:"+t.pageList[i].nickname),1!=b.isPart&&"true"!=b.isPart||(R.innerHTML=""),R.style.marginBottom=E+"px",document.getElementById(B[1]).appendChild(R)}var oe=D.defs(),se=(oe.clip(),oe.mask()),ne=(oe.filter(),t.pageList[i].content.itemList);for(L=0;L<ne.length;L++){T=ne[L];if(T.isBeyond&&(t.pageList[i].isBeyond=!0),void 0==T.moveable&&(T.moveable="no"),T.mediatag&&("baoXianName"==T.mediatag||"baoXianPhone"==T.mediatag?T.moveable="no":T.moveable="yes"),"image"==T.media.mediaType){if(""!=T.media.imgPath){if(T.cutArea&&T.cutArea.fromAiCut&&(T.flipX||T.flipY)){layer.alert("数据异常，请更换模板！错误码flip.fromAiCut",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)});break}if(T.isVideo?-1==T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))&&-1==T.media.imgPath.indexOf("img/nophoto.jpg")&&(T.media.imgPath=Object(h["d"])(T.media.imgPath)+""+Object(h["a"])(T.media.imgPath,T,b.pageKey)):(-1==T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))&&-1==T.media.imgPath.indexOf("img/nophoto.jpg")&&-1==T.media.imgPath.indexOf("img.alicdn.com")&&(T.media.imgPath=Object(h["d"])(T.media.imgPath)+""+Object(h["a"])(T.media.imgPath,T,b.pageKey)),-1!=T.media.imgPath.indexOf("img.alicdn.com")&&(T.media.imgPath=Object(h["d"])(T.media.imgPath)+Object(h["a"])(T.media.imgPath,T,b.pageKey))),-1!=T.media.imgPath.indexOf("img/nophoto.jpg")&&T.cutArea&&T.cutArea.fromAiCut&&(T.media.imgPath="img/nophoto.jpg"),T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))>-1&&T.media.imgPath.indexOf("?token=")>-1&&-1==T.media.imgPath.indexOf(k)&&-1==T.media.imgPath.indexOf("img.alicdn.com")&&-1==T.media.imgPath.indexOf("img/nophoto.jpg")&&(T.media.imgPath=Object(h["g"])(T.media.imgPath,k)),T.media.imgPath.indexOf("?token=")>-1){var re=T.media.imgPath.split("?token=");T.media.imgPath=re[0]}T.isDisplay&&L==ne.length-1&&("photo"==t.diyType||t.pageList.length<=1)||1!=T.visible||(J.imgArr.push(T.media.imgPath),b.everyTimeImgJson&&T.cutArea&&T.cutArea.fromAiCut&&b.everyTimeImgJson.imgArr.push(T.media.imgPath))}}else if("advancedImageMask"==T.media.mediaType){if(T.flipX||T.flipY){layer.alert("模板相框不兼容，错误码flip",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)});break}if(T.media.defaultState=!1,""==T.media.maskSource&&(T.media.maskSource="img/nophoto.jpg",T.media.imgWidth=T.printLocation.width,T.media.imgHeight=T.printLocation.height),w?-1==T.media.maskSource.indexOf(Object(h["d"])(T.media.maskSource))&&w.length>v&&-1==T.media.maskSource.indexOf("img.alicdn.com")&&(T.media.maskSource=Object(h["d"])(w[v].url)+""+Object(h["a"])(w[v].url,T,b.pageKey)):-1==T.media.maskSource.indexOf(Object(h["d"])(T.media.maskSource))&&-1==T.media.maskSource.indexOf("img.alicdn.com")&&(T.media.maskSource=Object(h["d"])(T.media.maskSource)+Object(h["a"])(T.media.maskSource,T,b.pageKey)),-1!=T.media.maskSource.indexOf("img.alicdn.com")&&(T.media.maskSource=Object(h["d"])(T.media.maskSource)+Object(h["a"])(T.media.maskSource,T,b.pageKey)),-1==T.media.factMaskSource.indexOf(Object(h["d"])(T.media.factMaskSource))&&(T.media.factMaskSource=Object(h["d"])(T.media.factMaskSource)+""+Object(h["a"])(T.media.factMaskSource,T,b.pageKey)),-1==T.media.bgSource.indexOf(Object(h["d"])(T.media.bgSource))&&(T.media.bgSource=Object(h["d"])(T.media.bgSource)+""+Object(h["a"])(T.media.bgSource,T,b.pageKey)),-1!=T.media.maskSource.indexOf("img/nophoto.jpg")&&(T.media.maskSource="img/nophoto.jpg",T.media.defaultState=!0),T.media.maskSource.indexOf(Object(h["d"])(T.media.maskSource))>-1&&T.media.maskSource.indexOf("?token=")>-1&&-1==T.media.maskSource.indexOf(k)&&-1==T.media.maskSource.indexOf("img.alicdn.com")&&-1==T.media.maskSource.indexOf("img/nophoto.jpg")&&(T.media.maskSource=Object(h["g"])(T.media.maskSource,k)),T.media.maskSource.indexOf("?token=")>-1){re=T.media.maskSource.split("?token=");T.media.maskSource=re[0]}T.media.factMaskSource.indexOf(Object(h["d"])(T.media.factMaskSource))>-1&&T.media.factMaskSource.indexOf("?token=")>-1&&-1==T.media.factMaskSource.indexOf(k)&&(T.media.factMaskSource=Object(h["g"])(T.media.factMaskSource,k)),T.media.bgSource.indexOf(Object(h["d"])(T.media.bgSource))>-1&&T.media.bgSource.indexOf("?token=")>-1&&-1==T.media.bgSource.indexOf(k)&&(T.media.bgSource=Object(h["g"])(T.media.bgSource,k)),v++,""!=T.media.maskSource&&(J.imgArr.push(T.media.maskSource),b.everyTimeImgJson&&b.everyTimeImgJson.imgArr.push(T.media.maskSource)),T.media.isSimple?""!=T.media.factMaskSource&&J.imgArr.push(T.media.factMaskSource):""!=T.media.bgSource&&J.imgArr.push(T.media.bgSource)}else"text"==T.media.mediaType?T.media.font.textPath?(-1==T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))&&(T.media.font.textPath=a["a"].baseUrl2+""+T.media.font.textPath),T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))>-1&&T.media.imgPath.indexOf("?token=")>-1&&-1==T.media.imgPath.indexOf(k)&&(T.media.imgPath=Object(h["g"])(T.media.imgPath,k)),T.media.font.textPath&&J.imgArr.push(T.media.imgPath)):(T.media.text=T.media.text.replace(/\r\n/g,"\n"),T.media.text=T.media.text.replace(/\r/g,"\n")):T.media.mediaType.indexOf("svg")>-1&&(""!=T.media.imgPath&&-1==T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))&&(T.media.imgPath=Object(h["d"])(T.media.imgPath)+Object(h["a"])(T.media.imgPath,T,b.pageKey)),T.media.imgPath.indexOf(Object(h["d"])(T.media.imgPath))>-1&&T.media.imgPath.indexOf("?token=")>-1&&-1==T.media.imgPath.indexOf(k)&&(T.media.imgPath=Object(h["g"])(T.media.imgPath,k)));if(T.media.isBG)T.location.x,T.location.y,T.location.width,T.location.height;if("image"==T.media.mediaType&&"no"==T.moveable&&1==T.media.isBG&&("calendar"==t.diyType||"year_calendar"==t.diyType||"wall_calendar"==t.diyType||"week_calendar"==t.diyType||"mug_cup"==t.diyType||"fashion_photo"==t.diyType||"template_cloth"==t.diyType)){M={};if(!I&&"fashion_photo"!=t.diyType||"mug_cup"==t.diyType||"template_cloth"==t.diyType?(M.x=0,M.y=0,M.w=t.pageList[i].diyDisplayWidth,M.h=t.pageList[i].diyDisplayHeight):(M.x=T.location.x,M.y=T.location.y,M.w=T.location.width,M.h=T.location.height),j.push(M),D.viewbox(M.x,M.y,M.w,M.h),0==i&&b.screenShotCanvas){var le,de;W=Object(f["b"])(M.w,M.h);le=W.width,de=W.height,N=W.canvasScaleNum,u["a"].getInstance().canvas=b.screenShotCanvas,u["a"].getInstance().initCanvas(le,de,t,N)}}}for(var ce=0;ce<ne.length;ce++){var he;T=ne[ce];if(he=SVG("#group"+i+"_"+ce)?SVG("#group"+i+"_"+ce):D.group(),he.attr({id:"group"+i+"_"+ce,style:"overflow:hidden"}),T.media.mediaType==m["a"].SELF_GROUP){1!=T.visible&&he.attr({display:"none"});var ge={};b.everyTimeImgJson?ge.pageImgJson=b.everyTimeImgJson:ge.pageImgJson=J,ge.detailJson=t,ge.parentIndex=i,ge.itemIndex=ce;var me=new p["a"](he,T,ge,b);me.allchange()}if("image"==T.media.mediaType&&"no"==T.moveable&&1==T.media.isBG&&""!=T.media.imgPath){if(b.isUpdate)continue;1!=T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J;var pe=new n["a"](he,T,Te,i,ce,b);pe.initBgImg()}if("shape"==T.media.mediaType&&1==T.visible&&"no"==T.moveable&&1==T.media.isBG&&0==T.isDesignShape){var ue=new d["a"](he,T,i,ce,b);ue.initBgShape()}else if("image"==T.media.mediaType&&(1==T.visible||1==T.isDisplay||T.tuCengVisible||0==T.tuCengVisible)&&"no"==T.moveable&&0==T.media.isBG){if(ce!=ne.length-1||"calendar"==t.diyType||"year_calendar"==t.diyType||"week_calendar"==t.diyType||"template_cloth"==t.diyType||"wall_calendar"==t.diyType||"mug_cup"==t.diyType||t.pageList.length<=1&&ce==ne.length-1&&""!=T.media.imgPath){if(ce!=ne.length-1||"photo"!=t.diyType||"true"!=b.isTeamBook&&1!=b.isTeamBook){if(1!=T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J,0==i||i==t.pageList.length-1){var fe=new s["a"](he,T,Te,i,ce,!1,b);fe.initDecorateImg()}else if(!T.barTypeSign){fe=new s["a"](he,T,Te,i,ce,!1,b);fe.initDecorateImg()}}else if(2==t.templateInfo.coverper&&t.coverInfo.hascover&&(ve=!0),"fashion_photo"!=t.diyType){var ye=new l["a"](he,T,i,ce,t,ve,b);ye.initBleedLine()}}else if(Te=b.everyTimeImgJson?b.everyTimeImgJson:J,T.isDisplay)if(1==t.templateInfo.coverper&&1==t.templateInfo.backcover&&1==t.templateInfo.innerper&&"photo"==t.diyType&&(0==i&&!t.coverInfo.hascover||i==t.pageList.length-1&&!t.coverInfo.hasbackcover)){1!=T.visible&&he.attr({display:"none"});var _e=new s["a"](he,T,Te,i,ce,!1,b);_e.initDecorateImg()}else{var ve;if(2==t.templateInfo.coverper&&t.coverInfo.hascover&&(ve=!0),"fashion_photo"!=t.diyType)if("photo"==t.diyType&&0==i&&t.coverInfo.hascover&&!t.coverInfo.hasbackcover&&1==t.templateInfo.coverper&&!t.pageList[i].pageBleed&&T.media.imgPath){1!=T.visible&&he.attr({display:"none"});fe=new s["a"](he,T,Te,i,ce,!1,b);fe.initDecorateImg()}else{ye=new l["a"](he,T,i,ce,t,ve,b);ye.initBleedLine()}}else{1!=T.visible&&he.attr({display:"none"});fe=new s["a"](he,T,Te,i,ce,!1,b);fe.initDecorateImg()}}if("svg"==T.media.mediaType){1!=T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J;ge={pageImgJson:Te,i:i,m:ce};var we=new c["a"](he,T,ge,b);we.initSvgImg()}if("advancedImageMask"==T.media.mediaType){1!=T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J;ge={pageImgJson:Te,parentIndex:i,childIndex:ce,id:"bgimg_photo_"+i+"_"+ce,isEdit:!1},se=new o["a"](he,T,ge,b);se.initMask()}if("image"==T.media.mediaType&&"yes"==T.moveable)if(T.isVideo&&x);else{xe=!I,0==T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J;fe=new s["a"](he,T,Te,i,ce,xe,b);fe.initDecorateImg()}var be=!1;if("text"==T.media.mediaType){var Ie=b.$store.getters.allFontInfo;for(var U in Ie)if(T.media.font.id==Ie[U].id){var Se={};Se.fontid=T.media.font.id,Se.selfIndex=i+"_"+ce,b.$store.dispatch("updateDesignFonts",Se)}}if("text"==T.media.mediaType&&"no"==T.moveable)if(T.media.font.textPath){var xe=!1,ke=!0;0==T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J;fe=new s["a"](he,T,Te,i,ce,xe,b,ke);fe.initDecorateImg()}else if(T.mediatag&&("baoXianName"==T.mediatag||"baoXianPhone"==T.mediatag)||b.isSignleTempleBook){T.moveable="no",Te=b.everyTimeImgJson?b.everyTimeImgJson:J;ge={pageImgJson:Te,pageIndex:i,itemIndex:ce,isEdit:!1,vm:b};var Oe=new r["a"](he,T,ge);Oe.initCustomText()}else T.moveable="yes",T.changeMove=!0,be=!0;if("text"==T.media.mediaType&&"yes"==T.moveable){var Le,Te;Le=!I,0==T.visible&&he.attr({display:"none"}),Te=b.everyTimeImgJson?b.everyTimeImgJson:J;ge={pageImgJson:Te,pageIndex:i,itemIndex:ce,isEdit:Le,vm:b},Oe=new r["a"](he,T,ge);Oe.initCustomText(),be&&(T.moveable="no")}}return I&&i>=t.pageList.length-1&&Object(_["c"])(b,t),A}},"57b3a":function(e,t,i){e.exports=i.p+"static/img/bock.b47207fe.svg"},5841:function(e,t,i){"use strict";(function(e){var i={};console.log("process:"+e),i={baseUrl:"https://www.36588.com.cn/jianying/image/mong/1/",baseUrl2:"https://www.36588.com.cn/jianying/image/mong/2/",baseSmallUrl:"https://www.36588.com.cn/jianying/image/mong/3/",baseUrl3:"https://www.36588.com.cn/jianying/image/mongm/",orgBaseUrl:"http://ddiy.36588.com.cn/image/mong/1/",orgBaseUrl2:"http://ddiy.36588.com.cn/image/mong/2/",orgBaseSmallUrl:"http://ddiy.36588.com.cn/image/mong/3/",orgBaseUrl3:"http://ddiy.36588.com.cn/image/mongm/",baseUploadUrl:"api",base:"api",fontUrl:"api",fxBackUrl:"http://fx.zheliyin.com",fxUrl:"http://yxdiy.zheliyin.com",videoBackUrl:"https://tt.36588.com.cn/photoedit/photo/list.do",xlsBackUrl:"http://xls.36588.com",copyUrl:"http://www.36588.com.cn/jianying",websocketUrl:"xls.36588.com/jianying/api",wechatBackUrl:"http://www.36588.com.cn/wxshop",basicUrl:"api",evaluateUrl:"pcapi",taobanUrl:"taobanapi",uploadapi:"uploadapi",commonuploadapi:"https://gateway.36588.com.cn/common-upload",cropperUrl:"http://www.36588.com.cn/jianying/image/mong/1/",ossPhotoUrl:"http://c2bimg.36588.com.cn/c2b/photo/",checkPhotoUrl:"https://gateway.36588.com.cn/shop-alipay/",thumbnailUrl:"https://img.36588.com.cn/"},t["a"]=i}).call(this,i("f28c"))},"58d7":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZDNTlFNkIwRDZDMjExRUFBRjQ3ODgwMDFERDIwQkE4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZDNTlFNkIxRDZDMjExRUFBRjQ3ODgwMDFERDIwQkE4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkM1OUU2QUVENkMyMTFFQUFGNDc4ODAwMUREMjBCQTgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkM1OUU2QUZENkMyMTFFQUFGNDc4ODAwMUREMjBCQTgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4G87muAAADkElEQVR42syZ20sUcRTHz/5cL7O6qeiDF7BeMukhsAuFmfmkL/ZqtxcrKCFBQrA/oDcpIiiwN1/S8iWCXgoCNZUulm+lG1EEXkBE18vOquvaOdPZWnWc+f1m9tIXDr9lmJ35zO8353cu4wEHqhwNZOJQh3YW7QQdQitB8/EpIbRZtADaGNoA2lCgpnJD9V4eRbCDOLSjXUArUrzXPNpTtAcI+i2hgAhWjkMX2kXVhzLRFlofWieCTrkGRLhWHO6i5UJiRa9BB0J2OwJEMA2HHrRmSK760VoQVJcGRLh8HF6i1UJqNIzWhJBBW0CeudcphIuHbNg5k8LkxJ40wAHfs2fnQWHiEM2QPjUzw+4l5q1kMgne6sS7K2NbUPwMdtnB5QgP+DNEsgF9zPJvBjlCTFptOwT3qvoAlGR5IRBag5FgCIYXQ/BpSQc9upVoSLrgIYo4Xj7Qbrdpez0eA854IF+2YVdKC2Ed4T4v6/AWYUcRemJ1DaLuAT3M1ObhwD8jE1tfHKmAqtxsy3MWIpvGzN7/NQ9TaxtuICl2lwrOSqQCP82QnQq9GXCu2A+NRXluZ5GY6gSnTFIakQAkvQ/q0De7mIh3sV5wPiclcoh1G4cguBsTU4lynOOCk00p0U3Hl8NKcBp6/9WyQijPznSUGwvOhKW113u4F9zjqnK4vb8YblUUOQE0nMSnFNFNAK3gTuZrfwJtgQ8cbPGa8n++rIRhKRJVgot5t90WZSbBsU9ahPZmYcX4/Q5nUwYuppp8nyqfLrj6UtKdH3NwfWIarn2dloYjnSlQBpwRXBoqaXUzCoMLqxDZkocjHfVrxnkKCgiuW12J4nR3VZklHCkL4Y7t01QuPSa4qHal07h0pyTfr1q1ZR4gwCEOzI41hhHm+dzSNu/e82HkHYWYhmL54EMcbrqdSXraw3k5UIsQ5LHV/hxjWXfFrw/fYXnT9mEeYT7YJp2wOpHG7xzB0szRPji7HoHG8Z8Qto7VfxPW+JrkCQ6XkpnL52G5QJ4ftk8kehHu8s6apFN101bVCi6rBFyIWbaXnVxFdUD61RHfVDLrLDxLY23cj3Dn7ToLLdyGSLWG+d5gCci9kaYUQ8aaR7otIENSl6mBW2NJX1ZuGgWl228m/Zp7qomtZIvDtoFpm7DyBahu6eUNNBFdg17uv3TLVPDyFcz/2kQ3AY19hqin0ArWnyE+og2Cw88QvwUYAI5dY1yuzHQQAAAAAElFTkSuQmCC"},"5ad2":function(e,t,i){"use strict";i.d(t,"a",function(){return b});var a=i("d225"),o=i("b0b4"),s=i("bd86"),n=i("d80f"),r=(i("2c48"),i("a244")),l="rota",d="controlBorder",c="delete",h="replace",g="scale",m=i("f84b"),p=i("58d7"),u=i("fd6f"),f=i("c949"),y=i("963b"),_=800,v=48,w=48,b=function(){function e(t,i,o,r){Object(a["a"])(this,e),Object(s["a"])(this,"updateBorderAndControl",function(e,t){var i=SVG("#"+d+"_"+e.pageIndex+"_"+e.itemIndex),a=(t.transform("rotate"),t.attr("transform"));if(i){i.attr({style:"display:block",x:t.x(),y:t.y(),width:t.width(),height:t.height(),transform:a});var o=SVG("#"+l+"_"+e.pageIndex+"_"+e.itemIndex),s=t.x()+t.width()-o.width()/2,r=t.y()+t.height()-o.height()/2;o.x(s),o.y(r),o.attr({style:"display:block",transform:a});var m=SVG("#"+l+"_"+e.pageIndex+"_"+e.itemIndex+"_touchArea"),p=t.x()+t.width()-m.width()/2,u=t.y()+t.height()-m.height()/2;m.attr({transform:a,style:"display:block;opacity:0;"}),m.x(p),m.y(u);var _=c;e.repalceDelete&&(_=h,e.objJson.media.mediaType==n["a"].TEXT?y:f);var v=SVG("#"+_+"_"+e.pageIndex+"_"+e.itemIndex),b=t.x()-v.width()/2,I=t.y()-v.height()/2;if(v.x(b),v.y(I),v.attr({style:"display:block",transform:a}),e.objJson.media.mediaType==n["a"].TEXT&&t.width()<=2*w&&t.height()<=2*w){var S="display:block";e.setMinBorderAndControl(e,t,i,o,v,S,m)}if(e.hasScaleBtn){var x=SVG("#"+g+"_"+e.pageIndex+"_"+e.itemIndex),k=t.x()+t.width()-x.height()/2,O=t.y()-x.height()/2;x.x(k),x.y(O),x.width(0),x.height(0),x.attr({style:"display:block",transform:a})}e.click=!0}}),Object(s["a"])(this,"borderAndControlHide",function(e){var t=SVG("#"+d+"_"+e.pageIndex+"_"+e.itemIndex);if(t){t.attr({style:"display:none"});var i=SVG("#"+l+"_"+e.pageIndex+"_"+e.itemIndex);i.attr({style:"display:none"});var a=SVG("#"+l+"_"+e.pageIndex+"_"+e.itemIndex+"_touchArea");a.attr({style:"display:none;opacity:0;"});var o=c;e.repalceDelete&&(o=h);var s=SVG("#"+o+"_"+e.pageIndex+"_"+e.itemIndex);if(s.attr({style:"display:none"}),e.hasScaleBtn){var n=SVG("#"+g+"_"+e.pageIndex+"_"+e.itemIndex);if(!n)return;n.attr({style:"display:none"})}}}),Object(s["a"])(this,"borderAndControlShow",function(e){e.click=!0;var t=SVG("#"+d+"_"+e.pageIndex+"_"+e.itemIndex);t.attr({style:"display:block"});var i=SVG("#"+l+"_"+e.pageIndex+"_"+e.itemIndex);i.attr({style:"display:block"});var a=SVG("#"+l+"_"+e.pageIndex+"_"+e.itemIndex+"_touchArea");a.attr({style:"display:block;opacity:0;"});var o=c;e.repalceDelete&&(o=h);var s=SVG("#"+o+"_"+e.pageIndex+"_"+e.itemIndex);if(s.attr({style:"display:block"}),e.hasScaleBtn){var n=SVG("#"+g+"_"+e.pageIndex+"_"+e.itemIndex);n.attr({style:"display:block"})}}),this.objJson=i,this.parent=o.parent,this.pageIndex=o.pageIndex,this.itemIndex=o.itemIndex,this.hasScaleBtn=o.hasScaleBtn,this.repalceDelete=o.repalceDelete,this.vm=o.vm,this.click=!1,r&&(this.click=!0),this.setButtonSize(this.pageIndex),this.initBorderAndControl(t,this.objJson,this.hasScaleBtn)}return Object(o["a"])(e,[{key:"setButtonSize",value:function(e){try{var t=JSON.parse(localStorage.getItem(this.vm.pageKey.detailJson));if(t){var i=t.pageList[e].diyDisplayWidth/_;w=v*i,this.repalceDelete&&(w=v*i*1.2),w<40&&(w=40)}}catch(a){console.log(a)}}},{key:"initBorderAndControl",value:function(e,t,i){var a,o,s,_,v,b,I=this,S="";if(1==t.topEnable)S="rotate("+t.printLocation.rotation+","+t.printLocation.x+t.printLocation.width/2+","+t.printLocation.y+t.printLocation.height/2+")";else{var x=t.printLocation.x+t.printLocation.width/2,k=t.printLocation.y+t.printLocation.height/2;S="rotate("+t.location.rotation+","+x+","+k+")",t.location.rotation}if(x=t.printLocation.x+t.printLocation.width/2,k=t.printLocation.y+t.printLocation.height/2,0==t.location.rotation)a=t.location.x,o=t.location.y;else{var O=t.location.x,L=t.location.y,T=0-t.location.rotation,C=Object(r["b"])(O,L,T,x,k);a=C.x,o=C.y}if(SVG("#"+d+"_"+I.pageIndex+"_"+I.itemIndex))s=SVG("#"+d+"_"+I.pageIndex+"_"+I.itemIndex);else{s=I.parent.rect();var P="rotate(0,"+x+","+k+")";s.attr({transform:P}),s.attr({id:d+"_"+I.pageIndex+"_"+I.itemIndex,x:a,y:o,width:t.location.width,height:t.location.height,transform:S,"stroke-width":3,"stroke-dasharray":"10,8",stroke:"#FF4C88",fill:"none",style:"display:none"})}if(SVG("#"+l+"_"+I.pageIndex+"_"+I.itemIndex))_=SVG("#"+l+"_"+I.pageIndex+"_"+I.itemIndex);else{_=I.parent.image(m,function(){}),_.width(w),_.height(w),_.attr({id:l+"_"+I.pageIndex+"_"+I.itemIndex,style:"display:none",transform:S});var j=a+e.width()-_.width()/2,A=o+e.height()-_.height()/2;_.x(j),_.y(A)}if(SVG("#"+l+"_"+I.pageIndex+"_"+I.itemIndex+"_touchArea"))v=SVG("#"+l+"_"+I.pageIndex+"_"+I.itemIndex+"_touchArea");else{v=I.parent.rect(),v.width(w),v.height(w),v.attr({id:l+"_"+I.pageIndex+"_"+I.itemIndex+"_touchArea",transform:S,fill:"#ffffff",style:"display:none;opacity:0;"});var N=a+e.width()-v.width()/2,E=o+e.height()-v.height()/2;v.x(N),v.y(E)}var J=c,D=u;if(I.repalceDelete&&(J=h,D=I.objJson.media.mediaType==n["a"].TEXT?y:f),SVG("#"+J+"_"+I.pageIndex+"_"+I.itemIndex))b=SVG("#"+J+"_"+I.pageIndex+"_"+I.itemIndex);else{b=I.parent.image(D,function(){}),b.width(w),b.height(w),b.attr({id:J+"_"+I.pageIndex+"_"+I.itemIndex,style:"display:none",transform:S});var B=a-b.width()/2,K=o-b.height()/2;b.x(B),b.y(K)}if(I.objJson.media.mediaType==n["a"].TEXT&&e.width()<=2*w&&e.height()<=2*w){var M="display:none";I.setMinBorderAndControl(I,e,s,_,b,M,v)}if(i){var $;if(SVG("#"+g+"_"+I.pageIndex+"_"+I.itemIndex))$=SVG("#"+g+"_"+I.pageIndex+"_"+I.itemIndex);else{$=I.parent.image(p,function(){}),$.width(0),$.height(0),$.attr({id:g+"_"+I.pageIndex+"_"+I.itemIndex,style:"display:none",transform:S});var U=a+e.width()-$.height()/2,W=o-$.height()/2;$.x(U),$.y(W)}this.regularSpace=Math.round(1e3*Math.sqrt(($.cx()-e.cx())*($.cx()-e.cx())+($.cy()-e.cy())*($.cy()-e.cy())))/1e3}e.transform("rotate")}},{key:"updateRegularSpace",value:function(e,t){e&&(this.regularSpace=Math.round(1e3*Math.sqrt((e.cx()-t.cx())*(e.cx()-t.cx())+(e.cy()-t.cy())*(e.cy()-t.cy())))/1e3)}},{key:"editObj",value:function(e){var t=this,i=(e.parent().parent().id(),document.getElementById(e.id()));-1!=e.id().indexOf("text")&&console.log(e.id()),i.addEventListener("click",function(a){console.log("click"),console.log("clickkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk"),t.click||a.stopPropagation(),t.vm.unSelectAll(),t.updateBorderAndControl(t,e),t.borderAndControlShow(t),t.click=!0,t.vm.pageAndIndex=t.pageIndex+"_"+t.itemIndex,t.vm.removeClassAll("caledborder");var o="svg_"+t.pageIndex;SVG("#"+o).addClass("caledborder"),t.vm.editShowModel(t.pageIndex),-1!=i.id.indexOf("text")&&(t.vm.showMoreBtn=!0,t.vm.isecd||t.vm.openTextPanel()),-1==i.id.indexOf("decrorate")||i.getAttribute("videoId")?t.vm.closeAllPop&&t.vm.closeAllPop():(t.vm.showMoreBtn=!0,$(".sjky-site2").click(),t.vm.clickDecrorate&&(a.stopPropagation(),a.preventDefault(),t.vm.clickDecrorate())),t.objJson.cutArea&&t.objJson.media.mediaType==n["a"].ADVANCED_IMAGE_MASK||t.vm.documentDelegation(t,e)})}},{key:"setMinBorderAndControl",value:function(e,t,i,a,o,s,n,r){var l,d;l=d=2*w;var c=t.x()-(l/2-t.width()/2),h=t.y()-(d/2-t.height()/2),g=(t.transform("rotate"),t.attr("transform"));if(i){i.attr({style:s,x:c,y:h,width:l,height:d,transform:g});var m=c+l-a.width()/2,p=h+d-a.height()/2;a.x(m),a.y(p),a.attr({style:s,transform:g});var u=c+l-n.width()/2,f=h+d-n.height()/2;n.x(u),n.y(f),n.width(w),n.height(w),-1!=s.indexOf("none")?n.attr({style:"display:none;opacity:0;",transform:g}):n.attr({style:"display:block;opacity:0;",transform:g});var y=c-o.width()/2,_=h-o.height()/2;o.x(y),o.y(_),o.attr({style:s,transform:g})}}}]),e}()},"5b39":function(e,t,i){"use strict";i.d(t,"a",function(){return n});i("a481");var a=i("5841"),o=(i("d80f"),i("103a")),s=i("ec06");i("eb9b");function n(e,t,i){localStorage.getItem(i.pageKey.diytype);var n=JSON.stringify(e);localStorage.setItem(i.pageKey.detailJson,n);var r=1,l={loadComplete:!1,imgArr:[]},d={};d.x=0,d.y=0,d.w=e.pageList[t].diyDisplayWidth,d.h=e.pageList[t].diyDisplayHeight;var c=e.pageList[t].diyWorkAreaWidth,h=e.pageList[t].diyWorkAreaHeight;r=1;console.log(c+":"+h),i.canvasW=c/2,i.canvasH=h/2,s["a"].getInstance().canvas=i.paperCanvas,s["a"].getInstance().initCanvas(i.canvasW,i.canvasH,e,r);for(var g=e.pageList[t].content.itemList,m=0;m<g.length;m++){var p=g[m];if(p.isBeyond&&(e.pageList[t].isBeyond=!0),void 0==p.moveable&&(p.moveable="no"),"image"==p.media.mediaType){if(""!=p.media.imgPath){if(p.cutArea&&p.cutArea.fromAiCut&&(p.flipX||p.flipY)){layer.alert("数据异常，请更换模板！错误码flip.fromAiCut",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)});break}p.isVideo,-1==p.media.imgPath.indexOf(Object(o["d"])(p.media.imgPath))&&(p.media.imgPath=Object(o["d"])(p.media.imgPath)+""+Object(o["a"])(p.media.imgPath,p,i.pageKey)),p.isDisplay&&m==g.length-1&&("photo"==e.diyType||e.pageList.length<=1)||1!=p.visible||l.imgArr.push(p.media.imgPath)}}else if("advancedImageMask"==p.media.mediaType){if(p.flipX||p.flipY){layer.alert("模板相框不兼容，错误码flip",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)});break}p.media.defaultState=!1,photos?-1==p.media.maskSource.indexOf(Object(o["d"])(p.media.maskSource))&&photos.length>pid&&(p.media.maskSource=Object(o["d"])(photos[pid].url)+""+Object(o["a"])(photos[pid].url,p,i.pageKey)):-1==p.media.maskSource.indexOf(Object(o["d"])(p.media.maskSource))&&(p.media.maskSource=Object(o["d"])(p.media.maskSource)+Object(o["a"])(p.media.maskSource,p,i.pageKey)),-1==p.media.factMaskSource.indexOf(Object(o["d"])(p.media.factMaskSource))&&(p.media.factMaskSource=Object(o["d"])(p.media.factMaskSource)+""+Object(o["a"])(p.media.factMaskSource,p,i.pageKey)),-1==p.media.bgSource.indexOf(Object(o["d"])(p.media.bgSource))&&(p.media.bgSource=Object(o["d"])(p.media.bgSource)+""+Object(o["a"])(p.media.bgSource,p,i.pageKey)),-1!=p.media.maskSource.indexOf("img/nophoto.jpg")&&(p.media.maskSource="img/nophoto.jpg",p.media.defaultState=!0),pid++,""!=p.media.maskSource&&l.imgArr.push(p.media.maskSource),p.media.isSimple?""!=p.media.factMaskSource&&l.imgArr.push(p.media.factMaskSource):""!=p.media.bgSource&&l.imgArr.push(p.media.bgSource)}else"text"==p.media.mediaType?p.media.font.textPath?(-1==p.media.imgPath.indexOf(Object(o["d"])(p.media.imgPath))&&(p.media.font.textPath=a["a"].baseUrl2+""+p.media.font.textPath),p.media.font.textPath&&l.imgArr.push(p.media.imgPath)):(p.media.text=p.media.text.replace(/\r\n/g,"\n"),p.media.text=p.media.text.replace(/\r/g,"\n")):p.media.mediaType.indexOf("svg")>-1&&""!=p.media.imgPath&&-1==p.media.imgPath.indexOf(Object(o["d"])(p.media.imgPath))&&(p.media.imgPath=Object(o["d"])(p.media.imgPath)+Object(o["a"])(p.media.imgPath,p,i.pageKey));if(p.media.isBG)p.location.x,p.location.y,p.location.width,p.location.height}for(var u=0;u<g.length;u++){p=g[u];if(i.paperCanvas){var f=JSON.parse(JSON.stringify(p));"image"==f.media.mediaType?s["a"].getInstance().drawImg(f,u):"advancedImageMask"==f.media.mediaType?(f.location.width*=r,f.location.height*=r,s["a"].getInstance().drawContainer(f,u)):"shape"==f.media.mediaType?s["a"].getInstance().drawShape(f,u):"text"==f.media.mediaType&&("no"==f.moveable&&(f.media.font.textPath?s["a"].getInstance().drawImg(f,u):s["a"].getInstance().drawText(f,u,i)),"yes"==f.moveable&&s["a"].getInstance().drawText(f,u,i))}}}},"5bac":function(e,t,i){},"5c0b":function(e,t,i){"use strict";var a=i("5e27"),o=i.n(a);o.a},"5c0d":function(e,t,i){e.exports=i.p+"static/img/6.b5e6acb8.png"},"5c35":function(e,t,i){"use strict";t["a"]={province_list:{11e4:"北京市",12e4:"天津市",13e4:"河北省",14e4:"山西省",15e4:"内蒙古自治区",21e4:"辽宁省",22e4:"吉林省",23e4:"黑龙江省",31e4:"上海市",32e4:"江苏省",33e4:"浙江省",34e4:"安徽省",35e4:"福建省",36e4:"江西省",37e4:"山东省",41e4:"河南省",42e4:"湖北省",43e4:"湖南省",44e4:"广东省",45e4:"广西壮族自治区",46e4:"海南省",5e5:"重庆市",51e4:"四川省",52e4:"贵州省",53e4:"云南省",54e4:"西藏自治区",61e4:"陕西省",62e4:"甘肃省",63e4:"青海省",64e4:"宁夏回族自治区",65e4:"新疆维吾尔自治区",71e4:"台湾省",81e4:"香港特别行政区",82e4:"澳门特别行政区",9e5:"海外"},city_list:{110100:"北京市",120100:"天津市",130100:"石家庄市",130200:"唐山市",130300:"秦皇岛市",130400:"邯郸市",130500:"邢台市",130600:"保定市",130700:"张家口市",130800:"承德市",130900:"沧州市",131e3:"廊坊市",131100:"衡水市",140100:"太原市",140200:"大同市",140300:"阳泉市",140400:"长治市",140500:"晋城市",140600:"朔州市",140700:"晋中市",140800:"运城市",140900:"忻州市",141e3:"临汾市",141100:"吕梁市",150100:"呼和浩特市",150200:"包头市",150300:"乌海市",150400:"赤峰市",150500:"通辽市",150600:"鄂尔多斯市",150700:"呼伦贝尔市",150800:"巴彦淖尔市",150900:"乌兰察布市",152200:"兴安盟",152500:"锡林郭勒盟",152900:"阿拉善盟",210100:"沈阳市",210200:"大连市",210300:"鞍山市",210400:"抚顺市",210500:"本溪市",210600:"丹东市",210700:"锦州市",210800:"营口市",210900:"阜新市",211e3:"辽阳市",211100:"盘锦市",211200:"铁岭市",211300:"朝阳市",211400:"葫芦岛市",220100:"长春市",220200:"吉林市",220300:"四平市",220400:"辽源市",220500:"通化市",220600:"白山市",220700:"松原市",220800:"白城市",222400:"延边朝鲜族自治州",230100:"哈尔滨市",230200:"齐齐哈尔市",230300:"鸡西市",230400:"鹤岗市",230500:"双鸭山市",230600:"大庆市",230700:"伊春市",230800:"佳木斯市",230900:"七台河市",231e3:"牡丹江市",231100:"黑河市",231200:"绥化市",232700:"大兴安岭地区",310100:"上海市",320100:"南京市",320200:"无锡市",320300:"徐州市",320400:"常州市",320500:"苏州市",320600:"南通市",320700:"连云港市",320800:"淮安市",320900:"盐城市",321e3:"扬州市",321100:"镇江市",321200:"泰州市",321300:"宿迁市",330100:"杭州市",330200:"宁波市",330300:"温州市",330400:"嘉兴市",330500:"湖州市",330600:"绍兴市",330700:"金华市",330800:"衢州市",330900:"舟山市",331e3:"台州市",331100:"丽水市",340100:"合肥市",340200:"芜湖市",340300:"蚌埠市",340400:"淮南市",340500:"马鞍山市",340600:"淮北市",340700:"铜陵市",340800:"安庆市",341e3:"黄山市",341100:"滁州市",341200:"阜阳市",341300:"宿州市",341500:"六安市",341600:"亳州市",341700:"池州市",341800:"宣城市",350100:"福州市",350200:"厦门市",350300:"莆田市",350400:"三明市",350500:"泉州市",350600:"漳州市",350700:"南平市",350800:"龙岩市",350900:"宁德市",360100:"南昌市",360200:"景德镇市",360300:"萍乡市",360400:"九江市",360500:"新余市",360600:"鹰潭市",360700:"赣州市",360800:"吉安市",360900:"宜春市",361e3:"抚州市",361100:"上饶市",370100:"济南市",370200:"青岛市",370300:"淄博市",370400:"枣庄市",370500:"东营市",370600:"烟台市",370700:"潍坊市",370800:"济宁市",370900:"泰安市",371e3:"威海市",371100:"日照市",371300:"临沂市",371400:"德州市",371500:"聊城市",371600:"滨州市",371700:"菏泽市",410100:"郑州市",410200:"开封市",410300:"洛阳市",410400:"平顶山市",410500:"安阳市",410600:"鹤壁市",410700:"新乡市",410800:"焦作市",410900:"濮阳市",411e3:"许昌市",411100:"漯河市",411200:"三门峡市",411300:"南阳市",411400:"商丘市",411500:"信阳市",411600:"周口市",411700:"驻马店市",419e3:"省直辖县",420100:"武汉市",420200:"黄石市",420300:"十堰市",420500:"宜昌市",420600:"襄阳市",420700:"鄂州市",420800:"荆门市",420900:"孝感市",421e3:"荆州市",421100:"黄冈市",421200:"咸宁市",421300:"随州市",422800:"恩施土家族苗族自治州",429e3:"省直辖县",430100:"长沙市",430200:"株洲市",430300:"湘潭市",430400:"衡阳市",430500:"邵阳市",430600:"岳阳市",430700:"常德市",430800:"张家界市",430900:"益阳市",431e3:"郴州市",431100:"永州市",431200:"怀化市",431300:"娄底市",433100:"湘西土家族苗族自治州",440100:"广州市",440200:"韶关市",440300:"深圳市",440400:"珠海市",440500:"汕头市",440600:"佛山市",440700:"江门市",440800:"湛江市",440900:"茂名市",441200:"肇庆市",441300:"惠州市",441400:"梅州市",441500:"汕尾市",441600:"河源市",441700:"阳江市",441800:"清远市",441900:"东莞市",442e3:"中山市",445100:"潮州市",445200:"揭阳市",445300:"云浮市",450100:"南宁市",450200:"柳州市",450300:"桂林市",450400:"梧州市",450500:"北海市",450600:"防城港市",450700:"钦州市",450800:"贵港市",450900:"玉林市",451e3:"百色市",451100:"贺州市",451200:"河池市",451300:"来宾市",451400:"崇左市",460100:"海口市",460200:"三亚市",460300:"三沙市",460400:"儋州市",469e3:"省直辖县",500100:"重庆市",500200:"县",510100:"成都市",510300:"自贡市",510400:"攀枝花市",510500:"泸州市",510600:"德阳市",510700:"绵阳市",510800:"广元市",510900:"遂宁市",511e3:"内江市",511100:"乐山市",511300:"南充市",511400:"眉山市",511500:"宜宾市",511600:"广安市",511700:"达州市",511800:"雅安市",511900:"巴中市",512e3:"资阳市",513200:"阿坝藏族羌族自治州",513300:"甘孜藏族自治州",513400:"凉山彝族自治州",520100:"贵阳市",520200:"六盘水市",520300:"遵义市",520400:"安顺市",520500:"毕节市",520600:"铜仁市",522300:"黔西南布依族苗族自治州",522600:"黔东南苗族侗族自治州",522700:"黔南布依族苗族自治州",530100:"昆明市",530300:"曲靖市",530400:"玉溪市",530500:"保山市",530600:"昭通市",530700:"丽江市",530800:"普洱市",530900:"临沧市",532300:"楚雄彝族自治州",532500:"红河哈尼族彝族自治州",532600:"文山壮族苗族自治州",532800:"西双版纳傣族自治州",532900:"大理白族自治州",533100:"德宏傣族景颇族自治州",533300:"怒江傈僳族自治州",533400:"迪庆藏族自治州",540100:"拉萨市",540200:"日喀则市",540300:"昌都市",540400:"林芝市",540500:"山南市",540600:"那曲市",542500:"阿里地区",610100:"西安市",610200:"铜川市",610300:"宝鸡市",610400:"咸阳市",610500:"渭南市",610600:"延安市",610700:"汉中市",610800:"榆林市",610900:"安康市",611e3:"商洛市",620100:"兰州市",620200:"嘉峪关市",620300:"金昌市",620400:"白银市",620500:"天水市",620600:"武威市",620700:"张掖市",620800:"平凉市",620900:"酒泉市",621e3:"庆阳市",621100:"定西市",621200:"陇南市",622900:"临夏回族自治州",623e3:"甘南藏族自治州",630100:"西宁市",630200:"海东市",632200:"海北藏族自治州",632300:"黄南藏族自治州",632500:"海南藏族自治州",632600:"果洛藏族自治州",632700:"玉树藏族自治州",632800:"海西蒙古族藏族自治州",640100:"银川市",640200:"石嘴山市",640300:"吴忠市",640400:"固原市",640500:"中卫市",650100:"乌鲁木齐市",650200:"克拉玛依市",650400:"吐鲁番市",650500:"哈密市",652300:"昌吉回族自治州",652700:"博尔塔拉蒙古自治州",652800:"巴音郭楞蒙古自治州",652900:"阿克苏地区",653e3:"克孜勒苏柯尔克孜自治州",653100:"喀什地区",653200:"和田地区",654e3:"伊犁哈萨克自治州",654200:"塔城地区",654300:"阿勒泰地区",659e3:"自治区直辖县级行政区划",710100:"台北市",710200:"高雄市",710300:"台南市",710400:"台中市",710500:"金门县",710600:"南投县",710700:"基隆市",710800:"新竹市",710900:"嘉义市",711100:"新北市",711200:"宜兰县",711300:"新竹县",711400:"桃园县",711500:"苗栗县",711700:"彰化县",711900:"嘉义县",712100:"云林县",712400:"屏东县",712500:"台东县",712600:"花莲县",712700:"澎湖县",712800:"连江县",810100:"香港岛",810200:"九龙",810300:"新界",820100:"澳门半岛",820200:"离岛",900400:"阿富汗",900800:"阿尔巴尼亚",901e3:"南极洲",901200:"阿尔及利亚",901600:"美属萨摩亚",902e3:"安道尔",902400:"安哥拉",902800:"安提瓜和巴布达",903100:"阿塞拜疆",903200:"阿根廷",903600:"澳大利亚",904e3:"奥地利",904400:"巴哈马",904800:"巴林",905e3:"孟加拉",905100:"亚美尼亚",905200:"巴巴多斯",905600:"比利时",906e3:"百慕大",906400:"不丹",906800:"玻利维亚",907e3:"波黑",907200:"博茨瓦纳",907400:"布韦岛",907600:"巴西",908400:"伯利兹",908600:"英属印度洋领地",909e3:"所罗门群岛",909200:"英属维尔京群岛",909600:"文莱",91e4:"保加利亚",910400:"缅甸",910800:"布隆迪",911200:"白俄罗斯",911600:"柬埔寨",912e3:"喀麦隆",912400:"加拿大",913200:"佛得角",913600:"开曼群岛",914e3:"中非",914400:"斯里兰卡",914800:"乍得",915200:"智利",916200:"圣诞岛",916600:"科科斯群岛",917e3:"哥伦比亚",917400:"科摩罗",917500:"马约特",917800:"刚果（布）",918e3:"刚果（金）",918400:"库克群岛",918800:"哥斯达黎加",919100:"克罗地亚",919200:"古巴",919600:"塞浦路斯",920300:"捷克",920400:"贝宁",920800:"丹麦",921200:"多米尼克",921400:"多米尼加",921800:"厄瓜多尔",922200:"萨尔瓦多",922600:"赤道几内亚",923100:"埃塞俄比亚",923200:"厄立特里亚",923300:"爱沙尼亚",923400:"法罗群岛",923800:"马尔维纳斯群岛（ 福克兰）",923900:"南乔治亚岛和南桑威奇群岛",924200:"斐济群岛",924600:"芬兰",924800:"奥兰群岛",925e3:"法国",925400:"法属圭亚那",925800:"法属波利尼西亚",926e3:"法属南部领地",926200:"吉布提",926600:"加蓬",926800:"格鲁吉亚",927e3:"冈比亚",927500:"巴勒斯坦",927600:"德国",928800:"加纳",929200:"直布罗陀",929600:"基里巴斯",93e4:"希腊",930400:"格陵兰",930800:"格林纳达",931200:"瓜德罗普",931600:"关岛",932e3:"危地马拉",932400:"几内亚",932800:"圭亚那",933200:"海地",933400:"赫德岛和麦克唐纳群岛",933600:"梵蒂冈",934e3:"洪都拉斯",934800:"匈牙利",935200:"冰岛",935600:"印度",936e3:"印尼",936400:"伊朗",936800:"伊拉克",937200:"爱尔兰",937600:"以色列",938e3:"意大利",938400:"科特迪瓦",938800:"牙买加",939200:"日本",939800:"哈萨克斯坦",94e4:"约旦",940400:"肯尼亚",940800:"朝鲜 北朝鲜",941e3:"韩国",941400:"科威特",941700:"吉尔吉斯斯坦",941800:"老挝",942200:"黎巴嫩",942600:"莱索托",942800:"拉脱维亚",943e3:"利比里亚",943400:"利比亚",943800:"列支敦士登",944e3:"立陶宛",944200:"卢森堡",945e3:"马达加斯加",945400:"马拉维",945800:"马来西亚",946200:"马尔代夫",946600:"马里",947e3:"马耳他",947400:"马提尼克",947800:"毛里塔尼亚",948e3:"毛里求斯",948400:"墨西哥",949200:"摩纳哥",949600:"蒙古国",949800:"摩尔多瓦",949900:"黑山",95e4:"蒙塞拉特岛",950400:"摩洛哥",950800:"莫桑比克",951200:"阿曼",951600:"纳米比亚",952e3:"瑙鲁",952400:"尼泊尔",952800:"荷兰",953300:"阿鲁巴",953500:"荷兰加勒比区",954e3:"新喀里多尼亚",954800:"瓦努阿图",955400:"新西兰",955800:"尼加拉瓜",956200:"尼日尔",956600:"尼日利亚",957e3:"纽埃",957400:"诺福克岛",957800:"挪威",958e3:"北马里亚纳群岛",958100:"美国本土外小岛屿",958300:"密克罗尼西亚联邦",958400:"马绍尔群岛",958500:"帕劳",958600:"巴基斯坦",959100:"巴拿马",959800:"巴布亚新几内亚",96e4:"巴拉圭",960400:"秘鲁",960800:"菲律宾",961200:"皮特凯恩群岛",961600:"波兰",962e3:"葡萄牙",962400:"几内亚比绍",962600:"东帝汶",963e3:"波多黎各",963400:"卡塔尔",963800:"留尼汪",964200:"罗马尼亚",964300:"俄罗斯",964600:"卢旺达",965200:"圣巴泰勒米岛",965400:"圣赫勒拿",965900:"圣基茨和尼维斯",966e3:"安圭拉",966200:"圣卢西亚",966300:"法属圣马丁",966600:"圣皮埃尔和密克隆",967e3:"圣文森特和格林纳丁斯",967400:"圣马力诺",967800:"圣多美和普林西比",968200:"沙特阿拉伯",968600:"塞内加尔",968800:"塞尔维亚",969e3:"塞舌尔",969400:"塞拉利昂",970200:"新加坡",970300:"斯洛伐克",970400:"越南",970500:"斯洛文尼亚",970600:"索马里",971e3:"南非",971600:"津巴布韦",972400:"西班牙",972800:"南苏丹",972900:"苏丹",973200:"西撒哈拉",974e3:"苏里南",974400:"斯瓦尔巴群岛和 扬马延岛",974800:"斯威士兰",975200:"瑞典",975600:"瑞士",976e3:"叙利亚",976200:"塔吉克斯坦",976400:"泰国",976800:"多哥",977200:"托克劳",977600:"汤加",978e3:"特立尼达和多巴哥",978400:"阿联酋",978800:"突尼斯",979200:"土耳其",979500:"土库曼斯坦",979600:"特克斯和凯科斯群岛",979800:"图瓦卢",98e4:"乌干达",980400:"乌克兰",980700:"马其顿",981800:"埃及",982600:"英国",983100:"根西岛",983200:"泽西岛",983300:"马恩岛",983400:"坦桑尼亚",984e3:"美国",985e3:"美属维尔京群岛",985400:"布基纳法索",985800:"乌拉圭",986e3:"乌兹别克斯坦",986200:"委内瑞拉",987600:"瓦利斯和富图纳",988200:"萨摩亚",988700:"也门",989400:"赞比亚"},county_list:{110101:"东城区",110102:"西城区",110105:"朝阳区",110106:"丰台区",110107:"石景山区",110108:"海淀区",110109:"门头沟区",110111:"房山区",110112:"通州区",110113:"顺义区",110114:"昌平区",110115:"大兴区",110116:"怀柔区",110117:"平谷区",110118:"密云区",110119:"延庆区",120101:"和平区",120102:"河东区",120103:"河西区",120104:"南开区",120105:"河北区",120106:"红桥区",120110:"东丽区",120111:"西青区",120112:"津南区",120113:"北辰区",120114:"武清区",120115:"宝坻区",120116:"滨海新区",120117:"宁河区",120118:"静海区",120119:"蓟州区",130102:"长安区",130104:"桥西区",130105:"新华区",130107:"井陉矿区",130108:"裕华区",130109:"藁城区",130110:"鹿泉区",130111:"栾城区",130121:"井陉县",130123:"正定县",130125:"行唐县",130126:"灵寿县",130127:"高邑县",130128:"深泽县",130129:"赞皇县",130130:"无极县",130131:"平山县",130132:"元氏县",130133:"赵县",130181:"辛集市",130183:"晋州市",130184:"新乐市",130202:"路南区",130203:"路北区",130204:"古冶区",130205:"开平区",130207:"丰南区",130208:"丰润区",130209:"曹妃甸区",130224:"滦南县",130225:"乐亭县",130227:"迁西县",130229:"玉田县",130281:"遵化市",130283:"迁安市",130284:"滦州市",130302:"海港区",130303:"山海关区",130304:"北戴河区",130306:"抚宁区",130321:"青龙满族自治县",130322:"昌黎县",130324:"卢龙县",130390:"经济技术开发区",130402:"邯山区",130403:"丛台区",130404:"复兴区",130406:"峰峰矿区",130407:"肥乡区",130408:"永年区",130423:"临漳县",130424:"成安县",130425:"大名县",130426:"涉县",130427:"磁县",130430:"邱县",130431:"鸡泽县",130432:"广平县",130433:"馆陶县",130434:"魏县",130435:"曲周县",130481:"武安市",130502:"桥东区",130503:"桥西区",130521:"邢台县",130522:"临城县",130523:"内丘县",130524:"柏乡县",130525:"隆尧县",130526:"任县",130527:"南和县",130528:"宁晋县",130529:"巨鹿县",130530:"新河县",130531:"广宗县",130532:"平乡县",130533:"威县",130534:"清河县",130535:"临西县",130581:"南宫市",130582:"沙河市",130602:"竞秀区",130606:"莲池区",130607:"满城区",130608:"清苑区",130609:"徐水区",130623:"涞水县",130624:"阜平县",130626:"定兴县",130627:"唐县",130628:"高阳县",130629:"容城县",130630:"涞源县",130631:"望都县",130632:"安新县",130633:"易县",130634:"曲阳县",130635:"蠡县",130636:"顺平县",130637:"博野县",130638:"雄县",130681:"涿州市",130682:"定州市",130683:"安国市",130684:"高碑店市",130702:"桥东区",130703:"桥西区",130705:"宣化区",130706:"下花园区",130708:"万全区",130709:"崇礼区",130722:"张北县",130723:"康保县",130724:"沽源县",130725:"尚义县",130726:"蔚县",130727:"阳原县",130728:"怀安县",130730:"怀来县",130731:"涿鹿县",130732:"赤城县",130802:"双桥区",130803:"双滦区",130804:"鹰手营子矿区",130821:"承德县",130822:"兴隆县",130824:"滦平县",130825:"隆化县",130826:"丰宁满族自治县",130827:"宽城满族自治县",130828:"围场满族蒙古族自治县",130881:"平泉市",130902:"新华区",130903:"运河区",130921:"沧县",130922:"青县",130923:"东光县",130924:"海兴县",130925:"盐山县",130926:"肃宁县",130927:"南皮县",130928:"吴桥县",130929:"献县",130930:"孟村回族自治县",130981:"泊头市",130982:"任丘市",130983:"黄骅市",130984:"河间市",131002:"安次区",131003:"广阳区",131022:"固安县",131023:"永清县",131024:"香河县",131025:"大城县",131026:"文安县",131028:"大厂回族自治县",131081:"霸州市",131082:"三河市",131090:"开发区",131102:"桃城区",131103:"冀州区",131121:"枣强县",131122:"武邑县",131123:"武强县",131124:"饶阳县",131125:"安平县",131126:"故城县",131127:"景县",131128:"阜城县",131182:"深州市",140105:"小店区",140106:"迎泽区",140107:"杏花岭区",140108:"尖草坪区",140109:"万柏林区",140110:"晋源区",140121:"清徐县",140122:"阳曲县",140123:"娄烦县",140181:"古交市",140212:"新荣区",140213:"平城区",140214:"云冈区",140215:"云州区",140221:"阳高县",140222:"天镇县",140223:"广灵县",140224:"灵丘县",140225:"浑源县",140226:"左云县",140302:"城区",140303:"矿区",140311:"郊区",140321:"平定县",140322:"盂县",140403:"潞州区",140404:"上党区",140405:"屯留区",140406:"潞城区",140423:"襄垣县",140425:"平顺县",140426:"黎城县",140427:"壶关县",140428:"长子县",140429:"武乡县",140430:"沁县",140431:"沁源县",140502:"城区",140521:"沁水县",140522:"阳城县",140524:"陵川县",140525:"泽州县",140581:"高平市",140602:"朔城区",140603:"平鲁区",140621:"山阴县",140622:"应县",140623:"右玉县",140681:"怀仁市",140702:"榆次区",140721:"榆社县",140722:"左权县",140723:"和顺县",140724:"昔阳县",140725:"寿阳县",140726:"太谷县",140727:"祁县",140728:"平遥县",140729:"灵石县",140781:"介休市",140802:"盐湖区",140821:"临猗县",140822:"万荣县",140823:"闻喜县",140824:"稷山县",140825:"新绛县",140826:"绛县",140827:"垣曲县",140828:"夏县",140829:"平陆县",140830:"芮城县",140881:"永济市",140882:"河津市",140902:"忻府区",140921:"定襄县",140922:"五台县",140923:"代县",140924:"繁峙县",140925:"宁武县",140926:"静乐县",140927:"神池县",140928:"五寨县",140929:"岢岚县",140930:"河曲县",140931:"保德县",140932:"偏关县",140981:"原平市",141002:"尧都区",141021:"曲沃县",141022:"翼城县",141023:"襄汾县",141024:"洪洞县",141025:"古县",141026:"安泽县",141027:"浮山县",141028:"吉县",141029:"乡宁县",141030:"大宁县",141031:"隰县",141032:"永和县",141033:"蒲县",141034:"汾西县",141081:"侯马市",141082:"霍州市",141102:"离石区",141121:"文水县",141122:"交城县",141123:"兴县",141124:"临县",141125:"柳林县",141126:"石楼县",141127:"岚县",141128:"方山县",141129:"中阳县",141130:"交口县",141181:"孝义市",141182:"汾阳市",150102:"新城区",150103:"回民区",150104:"玉泉区",150105:"赛罕区",150121:"土默特左旗",150122:"托克托县",150123:"和林格尔县",150124:"清水河县",150125:"武川县",150202:"东河区",150203:"昆都仑区",150204:"青山区",150205:"石拐区",150206:"白云鄂博矿区",150207:"九原区",150221:"土默特右旗",150222:"固阳县",150223:"达尔罕茂明安联合旗",150302:"海勃湾区",150303:"海南区",150304:"乌达区",150402:"红山区",150403:"元宝山区",150404:"松山区",150421:"阿鲁科尔沁旗",150422:"巴林左旗",150423:"巴林右旗",150424:"林西县",150425:"克什克腾旗",150426:"翁牛特旗",150428:"喀喇沁旗",150429:"宁城县",150430:"敖汉旗",150502:"科尔沁区",150521:"科尔沁左翼中旗",150522:"科尔沁左翼后旗",150523:"开鲁县",150524:"库伦旗",150525:"奈曼旗",150526:"扎鲁特旗",150581:"霍林郭勒市",150602:"东胜区",150603:"康巴什区",150621:"达拉特旗",150622:"准格尔旗",150623:"鄂托克前旗",150624:"鄂托克旗",150625:"杭锦旗",150626:"乌审旗",150627:"伊金霍洛旗",150702:"海拉尔区",150703:"扎赉诺尔区",150721:"阿荣旗",150722:"莫力达瓦达斡尔族自治旗",150723:"鄂伦春自治旗",150724:"鄂温克族自治旗",150725:"陈巴尔虎旗",150726:"新巴尔虎左旗",150727:"新巴尔虎右旗",150781:"满洲里市",150782:"牙克石市",150783:"扎兰屯市",150784:"额尔古纳市",150785:"根河市",150802:"临河区",150821:"五原县",150822:"磴口县",150823:"乌拉特前旗",150824:"乌拉特中旗",150825:"乌拉特后旗",150826:"杭锦后旗",150902:"集宁区",150921:"卓资县",150922:"化德县",150923:"商都县",150924:"兴和县",150925:"凉城县",150926:"察哈尔右翼前旗",150927:"察哈尔右翼中旗",150928:"察哈尔右翼后旗",150929:"四子王旗",150981:"丰镇市",152201:"乌兰浩特市",152202:"阿尔山市",152221:"科尔沁右翼前旗",152222:"科尔沁右翼中旗",152223:"扎赉特旗",152224:"突泉县",152501:"二连浩特市",152502:"锡林浩特市",152522:"阿巴嘎旗",152523:"苏尼特左旗",152524:"苏尼特右旗",152525:"东乌珠穆沁旗",152526:"西乌珠穆沁旗",152527:"太仆寺旗",152528:"镶黄旗",152529:"正镶白旗",152530:"正蓝旗",152531:"多伦县",152921:"阿拉善左旗",152922:"阿拉善右旗",152923:"额济纳旗",210102:"和平区",210103:"沈河区",210104:"大东区",210105:"皇姑区",210106:"铁西区",210111:"苏家屯区",210112:"浑南区",210113:"沈北新区",210114:"于洪区",210115:"辽中区",210123:"康平县",210124:"法库县",210181:"新民市",210190:"经济技术开发区",210202:"中山区",210203:"西岗区",210204:"沙河口区",210211:"甘井子区",210212:"旅顺口区",210213:"金州区",210214:"普兰店区",210224:"长海县",210281:"瓦房店市",210283:"庄河市",210302:"铁东区",210303:"铁西区",210304:"立山区",210311:"千山区",210321:"台安县",210323:"岫岩满族自治县",210381:"海城市",210390:"高新区",210402:"新抚区",210403:"东洲区",210404:"望花区",210411:"顺城区",210421:"抚顺县",210422:"新宾满族自治县",210423:"清原满族自治县",210502:"平山区",210503:"溪湖区",210504:"明山区",210505:"南芬区",210521:"本溪满族自治县",210522:"桓仁满族自治县",210602:"元宝区",210603:"振兴区",210604:"振安区",210624:"宽甸满族自治县",210681:"东港市",210682:"凤城市",210702:"古塔区",210703:"凌河区",210711:"太和区",210726:"黑山县",210727:"义县",210781:"凌海市",210782:"北镇市",210793:"经济技术开发区",210802:"站前区",210803:"西市区",210804:"鲅鱼圈区",210811:"老边区",210881:"盖州市",210882:"大石桥市",210902:"海州区",210903:"新邱区",210904:"太平区",210905:"清河门区",210911:"细河区",210921:"阜新蒙古族自治县",210922:"彰武县",211002:"白塔区",211003:"文圣区",211004:"宏伟区",211005:"弓长岭区",211011:"太子河区",211021:"辽阳县",211081:"灯塔市",211102:"双台子区",211103:"兴隆台区",211104:"大洼区",211122:"盘山县",211202:"银州区",211204:"清河区",211221:"铁岭县",211223:"西丰县",211224:"昌图县",211281:"调兵山市",211282:"开原市",211302:"双塔区",211303:"龙城区",211321:"朝阳县",211322:"建平县",211324:"喀喇沁左翼蒙古族自治县",211381:"北票市",211382:"凌源市",211402:"连山区",211403:"龙港区",211404:"南票区",211421:"绥中县",211422:"建昌县",211481:"兴城市",220102:"南关区",220103:"宽城区",220104:"朝阳区",220105:"二道区",220106:"绿园区",220112:"双阳区",220113:"九台区",220122:"农安县",220182:"榆树市",220183:"德惠市",220192:"经济技术开发区",220202:"昌邑区",220203:"龙潭区",220204:"船营区",220211:"丰满区",220221:"永吉县",220281:"蛟河市",220282:"桦甸市",220283:"舒兰市",220284:"磐石市",220302:"铁西区",220303:"铁东区",220322:"梨树县",220323:"伊通满族自治县",220381:"公主岭市",220382:"双辽市",220402:"龙山区",220403:"西安区",220421:"东丰县",220422:"东辽县",220502:"东昌区",220503:"二道江区",220521:"通化县",220523:"辉南县",220524:"柳河县",220581:"梅河口市",220582:"集安市",220602:"浑江区",220605:"江源区",220621:"抚松县",220622:"靖宇县",220623:"长白朝鲜族自治县",220681:"临江市",220702:"宁江区",220721:"前郭尔罗斯蒙古族自治县",220722:"长岭县",220723:"乾安县",220781:"扶余市",220802:"洮北区",220821:"镇赉县",220822:"通榆县",220881:"洮南市",220882:"大安市",222401:"延吉市",222402:"图们市",222403:"敦化市",222404:"珲春市",222405:"龙井市",222406:"和龙市",222424:"汪清县",222426:"安图县",230102:"道里区",230103:"南岗区",230104:"道外区",230108:"平房区",230109:"松北区",230110:"香坊区",230111:"呼兰区",230112:"阿城区",230113:"双城区",230123:"依兰县",230124:"方正县",230125:"宾县",230126:"巴彦县",230127:"木兰县",230128:"通河县",230129:"延寿县",230183:"尚志市",230184:"五常市",230202:"龙沙区",230203:"建华区",230204:"铁锋区",230205:"昂昂溪区",230206:"富拉尔基区",230207:"碾子山区",230208:"梅里斯达斡尔族区",230221:"龙江县",230223:"依安县",230224:"泰来县",230225:"甘南县",230227:"富裕县",230229:"克山县",230230:"克东县",230231:"拜泉县",230281:"讷河市",230302:"鸡冠区",230303:"恒山区",230304:"滴道区",230305:"梨树区",230306:"城子河区",230307:"麻山区",230321:"鸡东县",230381:"虎林市",230382:"密山市",230402:"向阳区",230403:"工农区",230404:"南山区",230405:"兴安区",230406:"东山区",230407:"兴山区",230421:"萝北县",230422:"绥滨县",230502:"尖山区",230503:"岭东区",230505:"四方台区",230506:"宝山区",230521:"集贤县",230522:"友谊县",230523:"宝清县",230524:"饶河县",230602:"萨尔图区",230603:"龙凤区",230604:"让胡路区",230605:"红岗区",230606:"大同区",230621:"肇州县",230622:"肇源县",230623:"林甸县",230624:"杜尔伯特蒙古族自治县",230702:"伊春区",230703:"南岔区",230704:"友好区",230705:"西林区",230706:"翠峦区",230707:"新青区",230708:"美溪区",230709:"金山屯区",230710:"五营区",230711:"乌马河区",230712:"汤旺河区",230713:"带岭区",230714:"乌伊岭区",230715:"红星区",230716:"上甘岭区",230722:"嘉荫县",230781:"铁力市",230803:"向阳区",230804:"前进区",230805:"东风区",230811:"郊区",230822:"桦南县",230826:"桦川县",230828:"汤原县",230881:"同江市",230882:"富锦市",230883:"抚远市",230902:"新兴区",230903:"桃山区",230904:"茄子河区",230921:"勃利县",231002:"东安区",231003:"阳明区",231004:"爱民区",231005:"西安区",231025:"林口县",231081:"绥芬河市",231083:"海林市",231084:"宁安市",231085:"穆棱市",231086:"东宁市",231102:"爱辉区",231121:"嫩江县",231123:"逊克县",231124:"孙吴县",231181:"北安市",231182:"五大连池市",231202:"北林区",231221:"望奎县",231222:"兰西县",231223:"青冈县",231224:"庆安县",231225:"明水县",231226:"绥棱县",231281:"安达市",231282:"肇东市",231283:"海伦市",232701:"漠河市",232721:"呼玛县",232722:"塔河县",232790:"松岭区",232791:"呼中区",232792:"加格达奇区",232793:"新林区",310101:"黄浦区",310104:"徐汇区",310105:"长宁区",310106:"静安区",310107:"普陀区",310109:"虹口区",310110:"杨浦区",310112:"闵行区",310113:"宝山区",310114:"嘉定区",310115:"浦东新区",310116:"金山区",310117:"松江区",310118:"青浦区",310120:"奉贤区",310151:"崇明区",320102:"玄武区",320104:"秦淮区",320105:"建邺区",320106:"鼓楼区",320111:"浦口区",320113:"栖霞区",320114:"雨花台区",320115:"江宁区",320116:"六合区",320117:"溧水区",320118:"高淳区",320205:"锡山区",320206:"惠山区",320211:"滨湖区",320213:"梁溪区",320214:"新吴区",320281:"江阴市",320282:"宜兴市",320302:"鼓楼区",320303:"云龙区",320305:"贾汪区",320311:"泉山区",320312:"铜山区",320321:"丰县",320322:"沛县",320324:"睢宁县",320381:"新沂市",320382:"邳州市",320391:"工业园区",320402:"天宁区",320404:"钟楼区",320411:"新北区",320412:"武进区",320413:"金坛区",320481:"溧阳市",320505:"虎丘区",320506:"吴中区",320507:"相城区",320508:"姑苏区",320509:"吴江区",320581:"常熟市",320582:"张家港市",320583:"昆山市",320585:"太仓市",320590:"工业园区",320591:"高新区",320602:"崇川区",320611:"港闸区",320612:"通州区",320623:"如东县",320681:"启东市",320682:"如皋市",320684:"海门市",320685:"海安市",320691:"高新区",320703:"连云区",320706:"海州区",320707:"赣榆区",320722:"东海县",320723:"灌云县",320724:"灌南县",320803:"淮安区",320804:"淮阴区",320812:"清江浦区",320813:"洪泽区",320826:"涟水县",320830:"盱眙县",320831:"金湖县",320890:"经济开发区",320902:"亭湖区",320903:"盐都区",320904:"大丰区",320921:"响水县",320922:"滨海县",320923:"阜宁县",320924:"射阳县",320925:"建湖县",320981:"东台市",321002:"广陵区",321003:"邗江区",321012:"江都区",321023:"宝应县",321081:"仪征市",321084:"高邮市",321090:"经济开发区",321102:"京口区",321111:"润州区",321112:"丹徒区",321181:"丹阳市",321182:"扬中市",321183:"句容市",321202:"海陵区",321203:"高港区",321204:"姜堰区",321281:"兴化市",321282:"靖江市",321283:"泰兴市",321302:"宿城区",321311:"宿豫区",321322:"沭阳县",321323:"泗阳县",321324:"泗洪县",330102:"上城区",330103:"下城区",330104:"江干区",330105:"拱墅区",330106:"西湖区",330108:"滨江区",330109:"萧山区",330110:"余杭区",330111:"富阳区",330112:"临安区",330122:"桐庐县",330127:"淳安县",330182:"建德市",330203:"海曙区",330205:"江北区",330206:"北仑区",330211:"镇海区",330212:"鄞州区",330213:"奉化区",330225:"象山县",330226:"宁海县",330281:"余姚市",330282:"慈溪市",330302:"鹿城区",330303:"龙湾区",330304:"瓯海区",330305:"洞头区",330324:"永嘉县",330326:"平阳县",330327:"苍南县",330328:"文成县",330329:"泰顺县",330381:"瑞安市",330382:"乐清市",330402:"南湖区",330411:"秀洲区",330421:"嘉善县",330424:"海盐县",330481:"海宁市",330482:"平湖市",330483:"桐乡市",330502:"吴兴区",330503:"南浔区",330521:"德清县",330522:"长兴县",330523:"安吉县",330602:"越城区",330603:"柯桥区",330604:"上虞区",330624:"新昌县",330681:"诸暨市",330683:"嵊州市",330702:"婺城区",330703:"金东区",330723:"武义县",330726:"浦江县",330727:"磐安县",330781:"兰溪市",330782:"义乌市",330783:"东阳市",330784:"永康市",330802:"柯城区",330803:"衢江区",330822:"常山县",330824:"开化县",330825:"龙游县",330881:"江山市",330902:"定海区",330903:"普陀区",330921:"岱山县",330922:"嵊泗县",331002:"椒江区",331003:"黄岩区",331004:"路桥区",331022:"三门县",331023:"天台县",331024:"仙居县",331081:"温岭市",331082:"临海市",331083:"玉环市",331102:"莲都区",331121:"青田县",331122:"缙云县",331123:"遂昌县",331124:"松阳县",331125:"云和县",331126:"庆元县",331127:"景宁畲族自治县",331181:"龙泉市",340102:"瑶海区",340103:"庐阳区",340104:"蜀山区",340111:"包河区",340121:"长丰县",340122:"肥东县",340123:"肥西县",340124:"庐江县",340181:"巢湖市",340190:"高新技术开发区",340191:"经济技术开发区",340202:"镜湖区",340203:"弋江区",340207:"鸠江区",340208:"三山区",340221:"芜湖县",340222:"繁昌县",340223:"南陵县",340225:"无为县",340302:"龙子湖区",340303:"蚌山区",340304:"禹会区",340311:"淮上区",340321:"怀远县",340322:"五河县",340323:"固镇县",340402:"大通区",340403:"田家庵区",340404:"谢家集区",340405:"八公山区",340406:"潘集区",340421:"凤台县",340422:"寿县",340503:"花山区",340504:"雨山区",340506:"博望区",340521:"当涂县",340522:"含山县",340523:"和县",340602:"杜集区",340603:"相山区",340604:"烈山区",340621:"濉溪县",340705:"铜官区",340706:"义安区",340711:"郊区",340722:"枞阳县",340802:"迎江区",340803:"大观区",340811:"宜秀区",340822:"怀宁县",340824:"潜山县",340825:"太湖县",340826:"宿松县",340827:"望江县",340828:"岳西县",340881:"桐城市",341002:"屯溪区",341003:"黄山区",341004:"徽州区",341021:"歙县",341022:"休宁县",341023:"黟县",341024:"祁门县",341102:"琅琊区",341103:"南谯区",341122:"来安县",341124:"全椒县",341125:"定远县",341126:"凤阳县",341181:"天长市",341182:"明光市",341202:"颍州区",341203:"颍东区",341204:"颍泉区",341221:"临泉县",341222:"太和县",341225:"阜南县",341226:"颍上县",341282:"界首市",341302:"埇桥区",341321:"砀山县",341322:"萧县",341323:"灵璧县",341324:"泗县",341390:"经济开发区",341502:"金安区",341503:"裕安区",341504:"叶集区",341522:"霍邱县",341523:"舒城县",341524:"金寨县",341525:"霍山县",341602:"谯城区",341621:"涡阳县",341622:"蒙城县",341623:"利辛县",341702:"贵池区",341721:"东至县",341722:"石台县",341723:"青阳县",341802:"宣州区",341821:"郎溪县",341822:"广德县",341823:"泾县",341824:"绩溪县",341825:"旌德县",341881:"宁国市",350102:"鼓楼区",350103:"台江区",350104:"仓山区",350105:"马尾区",350111:"晋安区",350112:"长乐区",350121:"闽侯县",350122:"连江县",350123:"罗源县",350124:"闽清县",350125:"永泰县",350128:"平潭县",350181:"福清市",350203:"思明区",350205:"海沧区",350206:"湖里区",350211:"集美区",350212:"同安区",350213:"翔安区",350302:"城厢区",350303:"涵江区",350304:"荔城区",350305:"秀屿区",350322:"仙游县",350402:"梅列区",350403:"三元区",350421:"明溪县",350423:"清流县",350424:"宁化县",350425:"大田县",350426:"尤溪县",350427:"沙县",350428:"将乐县",350429:"泰宁县",350430:"建宁县",350481:"永安市",350502:"鲤城区",350503:"丰泽区",350504:"洛江区",350505:"泉港区",350521:"惠安县",350524:"安溪县",350525:"永春县",350526:"德化县",350527:"金门县",350581:"石狮市",350582:"晋江市",350583:"南安市",350602:"芗城区",350603:"龙文区",350622:"云霄县",350623:"漳浦县",350624:"诏安县",350625:"长泰县",350626:"东山县",350627:"南靖县",350628:"平和县",350629:"华安县",350681:"龙海市",350702:"延平区",350703:"建阳区",350721:"顺昌县",350722:"浦城县",350723:"光泽县",350724:"松溪县",350725:"政和县",350781:"邵武市",350782:"武夷山市",350783:"建瓯市",350802:"新罗区",350803:"永定区",350821:"长汀县",350823:"上杭县",350824:"武平县",350825:"连城县",350881:"漳平市",350902:"蕉城区",350921:"霞浦县",350922:"古田县",350923:"屏南县",350924:"寿宁县",350925:"周宁县",350926:"柘荣县",350981:"福安市",350982:"福鼎市",360102:"东湖区",360103:"西湖区",360104:"青云谱区",360105:"湾里区",360111:"青山湖区",360112:"新建区",360121:"南昌县",360123:"安义县",360124:"进贤县",360190:"经济技术开发区",360192:"高新区",360202:"昌江区",360203:"珠山区",360222:"浮梁县",360281:"乐平市",360302:"安源区",360313:"湘东区",360321:"莲花县",360322:"上栗县",360323:"芦溪县",360402:"濂溪区",360403:"浔阳区",360404:"柴桑区",360423:"武宁县",360424:"修水县",360425:"永修县",360426:"德安县",360428:"都昌县",360429:"湖口县",360430:"彭泽县",360481:"瑞昌市",360482:"共青城市",360483:"庐山市",360490:"经济技术开发区",360502:"渝水区",360521:"分宜县",360602:"月湖区",360603:"余江区",360681:"贵溪市",360702:"章贡区",360703:"南康区",360704:"赣县区",360722:"信丰县",360723:"大余县",360724:"上犹县",360725:"崇义县",360726:"安远县",360727:"龙南县",360728:"定南县",360729:"全南县",360730:"宁都县",360731:"于都县",360732:"兴国县",360733:"会昌县",360734:"寻乌县",360735:"石城县",360781:"瑞金市",360802:"吉州区",360803:"青原区",360821:"吉安县",360822:"吉水县",360823:"峡江县",360824:"新干县",360825:"永丰县",360826:"泰和县",360827:"遂川县",360828:"万安县",360829:"安福县",360830:"永新县",360881:"井冈山市",360902:"袁州区",360921:"奉新县",360922:"万载县",360923:"上高县",360924:"宜丰县",360925:"靖安县",360926:"铜鼓县",360981:"丰城市",360982:"樟树市",360983:"高安市",361002:"临川区",361003:"东乡区",361021:"南城县",361022:"黎川县",361023:"南丰县",361024:"崇仁县",361025:"乐安县",361026:"宜黄县",361027:"金溪县",361028:"资溪县",361030:"广昌县",361102:"信州区",361103:"广丰区",361121:"上饶县",361123:"玉山县",361124:"铅山县",361125:"横峰县",361126:"弋阳县",361127:"余干县",361128:"鄱阳县",361129:"万年县",361130:"婺源县",361181:"德兴市",370102:"历下区",370103:"市中区",370104:"槐荫区",370105:"天桥区",370112:"历城区",370113:"长清区",370114:"章丘区",370115:"济阳区",370116:"莱芜区",370117:"钢城区",370124:"平阴县",370126:"商河县",370190:"高新区",370202:"市南区",370203:"市北区",370211:"黄岛区",370212:"崂山区",370213:"李沧区",370214:"城阳区",370215:"即墨区",370281:"胶州市",370283:"平度市",370285:"莱西市",370290:"开发区",370302:"淄川区",370303:"张店区",370304:"博山区",370305:"临淄区",370306:"周村区",370321:"桓台县",370322:"高青县",370323:"沂源县",370402:"市中区",370403:"薛城区",370404:"峄城区",370405:"台儿庄区",370406:"山亭区",370481:"滕州市",370502:"东营区",370503:"河口区",370505:"垦利区",370522:"利津县",370523:"广饶县",370602:"芝罘区",370611:"福山区",370612:"牟平区",370613:"莱山区",370634:"长岛县",370681:"龙口市",370682:"莱阳市",370683:"莱州市",370684:"蓬莱市",370685:"招远市",370686:"栖霞市",370687:"海阳市",370690:"开发区",370702:"潍城区",370703:"寒亭区",370704:"坊子区",370705:"奎文区",370724:"临朐县",370725:"昌乐县",370781:"青州市",370782:"诸城市",370783:"寿光市",370784:"安丘市",370785:"高密市",370786:"昌邑市",370790:"开发区",370791:"高新区",370811:"任城区",370812:"兖州区",370826:"微山县",370827:"鱼台县",370828:"金乡县",370829:"嘉祥县",370830:"汶上县",370831:"泗水县",370832:"梁山县",370881:"曲阜市",370883:"邹城市",370890:"高新区",370902:"泰山区",370911:"岱岳区",370921:"宁阳县",370923:"东平县",370982:"新泰市",370983:"肥城市",371002:"环翠区",371003:"文登区",371082:"荣成市",371083:"乳山市",371091:"经济技术开发区",371102:"东港区",371103:"岚山区",371121:"五莲县",371122:"莒县",371302:"兰山区",371311:"罗庄区",371312:"河东区",371321:"沂南县",371322:"郯城县",371323:"沂水县",371324:"兰陵县",371325:"费县",371326:"平邑县",371327:"莒南县",371328:"蒙阴县",371329:"临沭县",371402:"德城区",371403:"陵城区",371422:"宁津县",371423:"庆云县",371424:"临邑县",371425:"齐河县",371426:"平原县",371427:"夏津县",371428:"武城县",371481:"乐陵市",371482:"禹城市",371502:"东昌府区",371521:"阳谷县",371522:"莘县",371523:"茌平县",371524:"东阿县",371525:"冠县",371526:"高唐县",371581:"临清市",371602:"滨城区",371603:"沾化区",371621:"惠民县",371622:"阳信县",371623:"无棣县",371625:"博兴县",371681:"邹平市",371702:"牡丹区",371703:"定陶区",371721:"曹县",371722:"单县",371723:"成武县",371724:"巨野县",371725:"郓城县",371726:"鄄城县",371728:"东明县",410102:"中原区",410103:"二七区",410104:"管城回族区",410105:"金水区",410106:"上街区",410108:"惠济区",410122:"中牟县",410181:"巩义市",410182:"荥阳市",410183:"新密市",410184:"新郑市",410185:"登封市",410190:"高新技术开发区",410191:"经济技术开发区",410202:"龙亭区",410203:"顺河回族区",410204:"鼓楼区",410205:"禹王台区",410212:"祥符区",410221:"杞县",410222:"通许县",410223:"尉氏县",410225:"兰考县",410302:"老城区",410303:"西工区",410304:"瀍河回族区",410305:"涧西区",410306:"吉利区",410311:"洛龙区",410322:"孟津县",410323:"新安县",410324:"栾川县",410325:"嵩县",410326:"汝阳县",410327:"宜阳县",410328:"洛宁县",410329:"伊川县",410381:"偃师市",410402:"新华区",410403:"卫东区",410404:"石龙区",410411:"湛河区",410421:"宝丰县",410422:"叶县",410423:"鲁山县",410425:"郏县",410481:"舞钢市",410482:"汝州市",410502:"文峰区",410503:"北关区",410505:"殷都区",410506:"龙安区",410522:"安阳县",410523:"汤阴县",410526:"滑县",410527:"内黄县",410581:"林州市",410590:"开发区",410602:"鹤山区",410603:"山城区",410611:"淇滨区",410621:"浚县",410622:"淇县",410702:"红旗区",410703:"卫滨区",410704:"凤泉区",410711:"牧野区",410721:"新乡县",410724:"获嘉县",410725:"原阳县",410726:"延津县",410727:"封丘县",410728:"长垣县",410781:"卫辉市",410782:"辉县市",410802:"解放区",410803:"中站区",410804:"马村区",410811:"山阳区",410821:"修武县",410822:"博爱县",410823:"武陟县",410825:"温县",410882:"沁阳市",410883:"孟州市",410902:"华龙区",410922:"清丰县",410923:"南乐县",410926:"范县",410927:"台前县",410928:"濮阳县",411002:"魏都区",411003:"建安区",411024:"鄢陵县",411025:"襄城县",411081:"禹州市",411082:"长葛市",411102:"源汇区",411103:"郾城区",411104:"召陵区",411121:"舞阳县",411122:"临颍县",411202:"湖滨区",411203:"陕州区",411221:"渑池县",411224:"卢氏县",411281:"义马市",411282:"灵宝市",411302:"宛城区",411303:"卧龙区",411321:"南召县",411322:"方城县",411323:"西峡县",411324:"镇平县",411325:"内乡县",411326:"淅川县",411327:"社旗县",411328:"唐河县",411329:"新野县",411330:"桐柏县",411381:"邓州市",411402:"梁园区",411403:"睢阳区",411421:"民权县",411422:"睢县",411423:"宁陵县",411424:"柘城县",411425:"虞城县",411426:"夏邑县",411481:"永城市",411502:"浉河区",411503:"平桥区",411521:"罗山县",411522:"光山县",411523:"新县",411524:"商城县",411525:"固始县",411526:"潢川县",411527:"淮滨县",411528:"息县",411602:"川汇区",411621:"扶沟县",411622:"西华县",411623:"商水县",411624:"沈丘县",411625:"郸城县",411626:"淮阳县",411627:"太康县",411628:"鹿邑县",411681:"项城市",411690:"经济开发区",411702:"驿城区",411721:"西平县",411722:"上蔡县",411723:"平舆县",411724:"正阳县",411725:"确山县",411726:"泌阳县",411727:"汝南县",411728:"遂平县",411729:"新蔡县",419001:"济源市",420102:"江岸区",420103:"江汉区",420104:"硚口区",420105:"汉阳区",420106:"武昌区",420107:"青山区",420111:"洪山区",420112:"东西湖区",420113:"汉南区",420114:"蔡甸区",420115:"江夏区",420116:"黄陂区",420117:"新洲区",420202:"黄石港区",420203:"西塞山区",420204:"下陆区",420205:"铁山区",420222:"阳新县",420281:"大冶市",420302:"茅箭区",420303:"张湾区",420304:"郧阳区",420322:"郧西县",420323:"竹山县",420324:"竹溪县",420325:"房县",420381:"丹江口市",420502:"西陵区",420503:"伍家岗区",420504:"点军区",420505:"猇亭区",420506:"夷陵区",420525:"远安县",420526:"兴山县",420527:"秭归县",420528:"长阳土家族自治县",420529:"五峰土家族自治县",420581:"宜都市",420582:"当阳市",420583:"枝江市",420590:"经济开发区",420602:"襄城区",420606:"樊城区",420607:"襄州区",420624:"南漳县",420625:"谷城县",420626:"保康县",420682:"老河口市",420683:"枣阳市",420684:"宜城市",420702:"梁子湖区",420703:"华容区",420704:"鄂城区",420802:"东宝区",420804:"掇刀区",420822:"沙洋县",420881:"钟祥市",420882:"京山市",420902:"孝南区",420921:"孝昌县",420922:"大悟县",420923:"云梦县",420981:"应城市",420982:"安陆市",420984:"汉川市",421002:"沙市区",421003:"荆州区",421022:"公安县",421023:"监利县",421024:"江陵县",421081:"石首市",421083:"洪湖市",421087:"松滋市",421102:"黄州区",421121:"团风县",421122:"红安县",421123:"罗田县",421124:"英山县",421125:"浠水县",421126:"蕲春县",421127:"黄梅县",421181:"麻城市",421182:"武穴市",421202:"咸安区",421221:"嘉鱼县",421222:"通城县",421223:"崇阳县",421224:"通山县",421281:"赤壁市",421303:"曾都区",421321:"随县",421381:"广水市",422801:"恩施市",422802:"利川市",422822:"建始县",422823:"巴东县",422825:"宣恩县",422826:"咸丰县",422827:"来凤县",422828:"鹤峰县",429004:"仙桃市",429005:"潜江市",429006:"天门市",429021:"神农架林区",430102:"芙蓉区",430103:"天心区",430104:"岳麓区",430105:"开福区",430111:"雨花区",430112:"望城区",430121:"长沙县",430181:"浏阳市",430182:"宁乡市",430202:"荷塘区",430203:"芦淞区",430204:"石峰区",430211:"天元区",430212:"渌口区",430223:"攸县",430224:"茶陵县",430225:"炎陵县",430281:"醴陵市",430302:"雨湖区",430304:"岳塘区",430321:"湘潭县",430381:"湘乡市",430382:"韶山市",430405:"珠晖区",430406:"雁峰区",430407:"石鼓区",430408:"蒸湘区",430412:"南岳区",430421:"衡阳县",430422:"衡南县",430423:"衡山县",430424:"衡东县",430426:"祁东县",430481:"耒阳市",430482:"常宁市",430502:"双清区",430503:"大祥区",430511:"北塔区",430521:"邵东县",430522:"新邵县",430523:"邵阳县",430524:"隆回县",430525:"洞口县",430527:"绥宁县",430528:"新宁县",430529:"城步苗族自治县",430581:"武冈市",430602:"岳阳楼区",430603:"云溪区",430611:"君山区",430621:"岳阳县",430623:"华容县",430624:"湘阴县",430626:"平江县",430681:"汨罗市",430682:"临湘市",430702:"武陵区",430703:"鼎城区",430721:"安乡县",430722:"汉寿县",430723:"澧县",430724:"临澧县",430725:"桃源县",430726:"石门县",430781:"津市市",430802:"永定区",430811:"武陵源区",430821:"慈利县",430822:"桑植县",430902:"资阳区",430903:"赫山区",430921:"南县",430922:"桃江县",430923:"安化县",430981:"沅江市",431002:"北湖区",431003:"苏仙区",431021:"桂阳县",431022:"宜章县",431023:"永兴县",431024:"嘉禾县",431025:"临武县",431026:"汝城县",431027:"桂东县",431028:"安仁县",431081:"资兴市",431102:"零陵区",431103:"冷水滩区",431121:"祁阳县",431122:"东安县",431123:"双牌县",431124:"道县",431125:"江永县",431126:"宁远县",431127:"蓝山县",431128:"新田县",431129:"江华瑶族自治县",431202:"鹤城区",431221:"中方县",431222:"沅陵县",431223:"辰溪县",431224:"溆浦县",431225:"会同县",431226:"麻阳苗族自治县",431227:"新晃侗族自治县",431228:"芷江侗族自治县",431229:"靖州苗族侗族自治县",431230:"通道侗族自治县",431281:"洪江市",431302:"娄星区",431321:"双峰县",431322:"新化县",431381:"冷水江市",431382:"涟源市",433101:"吉首市",433122:"泸溪县",433123:"凤凰县",433124:"花垣县",433125:"保靖县",433126:"古丈县",433127:"永顺县",433130:"龙山县",440103:"荔湾区",440104:"越秀区",440105:"海珠区",440106:"天河区",440111:"白云区",440112:"黄埔区",440113:"番禺区",440114:"花都区",440115:"南沙区",440117:"从化区",440118:"增城区",440203:"武江区",440204:"浈江区",440205:"曲江区",440222:"始兴县",440224:"仁化县",440229:"翁源县",440232:"乳源瑶族自治县",440233:"新丰县",440281:"乐昌市",440282:"南雄市",440303:"罗湖区",440304:"福田区",440305:"南山区",440306:"宝安区",440307:"龙岗区",440308:"盐田区",440309:"龙华区",440310:"坪山区",440311:"光明区",440402:"香洲区",440403:"斗门区",440404:"金湾区",440507:"龙湖区",440511:"金平区",440512:"濠江区",440513:"潮阳区",440514:"潮南区",440515:"澄海区",440523:"南澳县",440604:"禅城区",440605:"南海区",440606:"顺德区",440607:"三水区",440608:"高明区",440703:"蓬江区",440704:"江海区",440705:"新会区",440781:"台山市",440783:"开平市",440784:"鹤山市",440785:"恩平市",440802:"赤坎区",440803:"霞山区",440804:"坡头区",440811:"麻章区",440823:"遂溪县",440825:"徐闻县",440881:"廉江市",440882:"雷州市",440883:"吴川市",440890:"经济技术开发区",440902:"茂南区",440904:"电白区",440981:"高州市",440982:"化州市",440983:"信宜市",441202:"端州区",441203:"鼎湖区",441204:"高要区",441223:"广宁县",441224:"怀集县",441225:"封开县",441226:"德庆县",441284:"四会市",441302:"惠城区",441303:"惠阳区",441322:"博罗县",441323:"惠东县",441324:"龙门县",441402:"梅江区",441403:"梅县区",441422:"大埔县",441423:"丰顺县",441424:"五华县",441426:"平远县",441427:"蕉岭县",441481:"兴宁市",441502:"城区",441521:"海丰县",441523:"陆河县",441581:"陆丰市",441602:"源城区",441621:"紫金县",441622:"龙川县",441623:"连平县",441624:"和平县",441625:"东源县",441702:"江城区",441704:"阳东区",441721:"阳西县",441781:"阳春市",441802:"清城区",441803:"清新区",441821:"佛冈县",441823:"阳山县",441825:"连山壮族瑶族自治县",441826:"连南瑶族自治县",441881:"英德市",441882:"连州市",441901:"中堂镇",441903:"南城街道办事处",441904:"长安镇",441905:"东坑镇",441906:"樟木头镇",441907:"莞城街道办事处",441908:"石龙镇",441909:"桥头镇",441910:"万江街道办事处",441911:"麻涌镇",441912:"虎门镇",441913:"谢岗镇",441914:"石碣镇",441915:"茶山镇",441916:"东城街道办事处",441917:"洪梅镇",441918:"道滘镇",441919:"高埗镇",441920:"企石镇",441921:"凤岗镇",441922:"大岭山镇",441923:"松山湖管委会",441924:"清溪镇",441925:"望牛墩镇",441926:"厚街镇",441927:"常平镇",441928:"寮步镇",441929:"石排镇",441930:"横沥镇",441931:"塘厦镇",441932:"黄江镇",441933:"大朗镇",441934:"东莞港",441935:"东莞生态园",441990:"沙田镇",442001:"南头镇",442002:"神湾镇",442003:"东凤镇",442004:"五桂山街道办事处",442005:"黄圃镇",442006:"小榄镇",442007:"石岐区街道办事处",442008:"横栏镇",442009:"三角镇",442010:"三乡镇",442011:"港口镇",442012:"沙溪镇",442013:"板芙镇",442015:"东升镇",442016:"阜沙镇",442017:"民众镇",442018:"东区街道办事处",442019:"火炬开发区街道办事处",442020:"西区街道办事处",442021:"南区街道办事处",442022:"古镇镇",442023:"坦洲镇",442024:"大涌镇",442025:"南朗镇",445102:"湘桥区",445103:"潮安区",445122:"饶平县",445202:"榕城区",445203:"揭东区",445222:"揭西县",445224:"惠来县",445281:"普宁市",445302:"云城区",445303:"云安区",445321:"新兴县",445322:"郁南县",445381:"罗定市",450102:"兴宁区",450103:"青秀区",450105:"江南区",450107:"西乡塘区",450108:"良庆区",450109:"邕宁区",450110:"武鸣区",450123:"隆安县",450124:"马山县",450125:"上林县",450126:"宾阳县",450127:"横县",450202:"城中区",450203:"鱼峰区",450204:"柳南区",450205:"柳北区",450206:"柳江区",450222:"柳城县",450223:"鹿寨县",450224:"融安县",450225:"融水苗族自治县",450226:"三江侗族自治县",450302:"秀峰区",450303:"叠彩区",450304:"象山区",450305:"七星区",450311:"雁山区",450312:"临桂区",450321:"阳朔县",450323:"灵川县",450324:"全州县",450325:"兴安县",450326:"永福县",450327:"灌阳县",450328:"龙胜各族自治县",450329:"资源县",450330:"平乐县",450332:"恭城瑶族自治县",450381:"荔浦市",450403:"万秀区",450405:"长洲区",450406:"龙圩区",450421:"苍梧县",450422:"藤县",450423:"蒙山县",450481:"岑溪市",450502:"海城区",450503:"银海区",450512:"铁山港区",450521:"合浦县",450602:"港口区",450603:"防城区",450621:"上思县",450681:"东兴市",450702:"钦南区",450703:"钦北区",450721:"灵山县",450722:"浦北县",450802:"港北区",450803:"港南区",450804:"覃塘区",450821:"平南县",450881:"桂平市",450902:"玉州区",450903:"福绵区",450921:"容县",450922:"陆川县",450923:"博白县",450924:"兴业县",450981:"北流市",451002:"右江区",451021:"田阳县",451022:"田东县",451023:"平果县",451024:"德保县",451026:"那坡县",451027:"凌云县",451028:"乐业县",451029:"田林县",451030:"西林县",451031:"隆林各族自治县",451081:"靖西市",451102:"八步区",451103:"平桂区",451121:"昭平县",451122:"钟山县",451123:"富川瑶族自治县",451202:"金城江区",451203:"宜州区",451221:"南丹县",451222:"天峨县",451223:"凤山县",451224:"东兰县",451225:"罗城仫佬族自治县",451226:"环江毛南族自治县",451227:"巴马瑶族自治县",451228:"都安瑶族自治县",451229:"大化瑶族自治县",451302:"兴宾区",451321:"忻城县",451322:"象州县",451323:"武宣县",451324:"金秀瑶族自治县",451381:"合山市",451402:"江州区",451421:"扶绥县",451422:"宁明县",451423:"龙州县",451424:"大新县",451425:"天等县",451481:"凭祥市",460105:"秀英区",460106:"龙华区",460107:"琼山区",460108:"美兰区",460202:"海棠区",460203:"吉阳区",460204:"天涯区",460205:"崖州区",460321:"西沙群岛",460322:"南沙群岛",460323:"中沙群岛的岛礁及其海域",460401:"那大镇",460402:"和庆镇",460403:"南丰镇",460404:"大成镇",460405:"雅星镇",460406:"兰洋镇",460407:"光村镇",460408:"木棠镇",460409:"海头镇",460410:"峨蔓镇",460411:"王五镇",460412:"白马井镇",460413:"中和镇",460414:"排浦镇",460415:"东成镇",460416:"新州镇",460417:"洋浦经济开发区",460418:"华南热作学院",469001:"五指山市",469002:"琼海市",469005:"文昌市",469006:"万宁市",469007:"东方市",469021:"定安县",469022:"屯昌县",469023:"澄迈县",469024:"临高县",469025:"白沙黎族自治县",469026:"昌江黎族自治县",469027:"乐东黎族自治县",469028:"陵水黎族自治县",469029:"保亭黎族苗族自治县",469030:"琼中黎族苗族自治县",500101:"万州区",500102:"涪陵区",500103:"渝中区",500104:"大渡口区",500105:"江北区",500106:"沙坪坝区",500107:"九龙坡区",500108:"南岸区",500109:"北碚区",500110:"綦江区",500111:"大足区",500112:"渝北区",500113:"巴南区",500114:"黔江区",500115:"长寿区",500116:"江津区",500117:"合川区",500118:"永川区",500119:"南川区",500120:"璧山区",500151:"铜梁区",500152:"潼南区",500153:"荣昌区",500154:"开州区",500155:"梁平区",500156:"武隆区",500229:"城口县",500230:"丰都县",500231:"垫江县",500233:"忠县",500235:"云阳县",500236:"奉节县",500237:"巫山县",500238:"巫溪县",500240:"石柱土家族自治县",500241:"秀山土家族苗族自治县",500242:"酉阳土家族苗族自治县",500243:"彭水苗族土家族自治县",510104:"锦江区",510105:"青羊区",510106:"金牛区",510107:"武侯区",510108:"成华区",510112:"龙泉驿区",510113:"青白江区",510114:"新都区",510115:"温江区",510116:"双流区",510117:"郫都区",510121:"金堂县",510129:"大邑县",510131:"蒲江县",510132:"新津县",510181:"都江堰市",510182:"彭州市",510183:"邛崃市",510184:"崇州市",510185:"简阳市",510191:"高新区",510302:"自流井区",510303:"贡井区",510304:"大安区",510311:"沿滩区",510321:"荣县",510322:"富顺县",510402:"东区",510403:"西区",510411:"仁和区",510421:"米易县",510422:"盐边县",510502:"江阳区",510503:"纳溪区",510504:"龙马潭区",510521:"泸县",510522:"合江县",510524:"叙永县",510525:"古蔺县",510603:"旌阳区",510604:"罗江区",510623:"中江县",510681:"广汉市",510682:"什邡市",510683:"绵竹市",510703:"涪城区",510704:"游仙区",510705:"安州区",510722:"三台县",510723:"盐亭县",510725:"梓潼县",510726:"北川羌族自治县",510727:"平武县",510781:"江油市",510791:"高新区",510802:"利州区",510811:"昭化区",510812:"朝天区",510821:"旺苍县",510822:"青川县",510823:"剑阁县",510824:"苍溪县",510903:"船山区",510904:"安居区",510921:"蓬溪县",510922:"射洪县",510923:"大英县",511002:"市中区",511011:"东兴区",511024:"威远县",511025:"资中县",511083:"隆昌市",511102:"市中区",511111:"沙湾区",511112:"五通桥区",511113:"金口河区",511123:"犍为县",511124:"井研县",511126:"夹江县",511129:"沐川县",511132:"峨边彝族自治县",511133:"马边彝族自治县",511181:"峨眉山市",511302:"顺庆区",511303:"高坪区",511304:"嘉陵区",511321:"南部县",511322:"营山县",511323:"蓬安县",511324:"仪陇县",511325:"西充县",511381:"阆中市",511402:"东坡区",511403:"彭山区",511421:"仁寿县",511423:"洪雅县",511424:"丹棱县",511425:"青神县",511502:"翠屏区",511503:"南溪区",511504:"叙州区",511523:"江安县",511524:"长宁县",511525:"高县",511526:"珙县",511527:"筠连县",511528:"兴文县",511529:"屏山县",511602:"广安区",511603:"前锋区",511621:"岳池县",511622:"武胜县",511623:"邻水县",511681:"华蓥市",511702:"通川区",511703:"达川区",511722:"宣汉县",511723:"开江县",511724:"大竹县",511725:"渠县",511781:"万源市",511802:"雨城区",511803:"名山区",511822:"荥经县",511823:"汉源县",511824:"石棉县",511825:"天全县",511826:"芦山县",511827:"宝兴县",511902:"巴州区",511903:"恩阳区",511921:"通江县",511922:"南江县",511923:"平昌县",512002:"雁江区",512021:"安岳县",512022:"乐至县",513201:"马尔康市",513221:"汶川县",513222:"理县",513223:"茂县",513224:"松潘县",513225:"九寨沟县",513226:"金川县",513227:"小金县",513228:"黑水县",513230:"壤塘县",513231:"阿坝县",513232:"若尔盖县",513233:"红原县",513301:"康定市",513322:"泸定县",513323:"丹巴县",513324:"九龙县",513325:"雅江县",513326:"道孚县",513327:"炉霍县",513328:"甘孜县",513329:"新龙县",513330:"德格县",513331:"白玉县",513332:"石渠县",513333:"色达县",513334:"理塘县",513335:"巴塘县",513336:"乡城县",513337:"稻城县",513338:"得荣县",513401:"西昌市",513422:"木里藏族自治县",513423:"盐源县",513424:"德昌县",513425:"会理县",513426:"会东县",513427:"宁南县",513428:"普格县",513429:"布拖县",513430:"金阳县",513431:"昭觉县",513432:"喜德县",513433:"冕宁县",513434:"越西县",513435:"甘洛县",513436:"美姑县",513437:"雷波县",520102:"南明区",520103:"云岩区",520111:"花溪区",520112:"乌当区",520113:"白云区",520115:"观山湖区",520121:"开阳县",520122:"息烽县",520123:"修文县",520181:"清镇市",520201:"钟山区",520203:"六枝特区",520221:"水城县",520281:"盘州市",520302:"红花岗区",520303:"汇川区",520304:"播州区",520322:"桐梓县",520323:"绥阳县",520324:"正安县",520325:"道真仡佬族苗族自治县",520326:"务川仡佬族苗族自治县",520327:"凤冈县",520328:"湄潭县",520329:"余庆县",520330:"习水县",520381:"赤水市",520382:"仁怀市",520402:"西秀区",520403:"平坝区",520422:"普定县",520423:"镇宁布依族苗族自治县",520424:"关岭布依族苗族自治县",520425:"紫云苗族布依族自治县",520502:"七星关区",520521:"大方县",520522:"黔西县",520523:"金沙县",520524:"织金县",520525:"纳雍县",520526:"威宁彝族回族苗族自治县",520527:"赫章县",520602:"碧江区",520603:"万山区",520621:"江口县",520622:"玉屏侗族自治县",520623:"石阡县",520624:"思南县",520625:"印江土家族苗族自治县",520626:"德江县",520627:"沿河土家族自治县",520628:"松桃苗族自治县",522301:"兴义市",522302:"兴仁市",522323:"普安县",522324:"晴隆县",522325:"贞丰县",522326:"望谟县",522327:"册亨县",522328:"安龙县",522601:"凯里市",522622:"黄平县",522623:"施秉县",522624:"三穗县",522625:"镇远县",522626:"岑巩县",522627:"天柱县",522628:"锦屏县",522629:"剑河县",522630:"台江县",522631:"黎平县",522632:"榕江县",522633:"从江县",522634:"雷山县",522635:"麻江县",522636:"丹寨县",522701:"都匀市",522702:"福泉市",522722:"荔波县",522723:"贵定县",522725:"瓮安县",522726:"独山县",522727:"平塘县",522728:"罗甸县",522729:"长顺县",522730:"龙里县",522731:"惠水县",522732:"三都水族自治县",530102:"五华区",530103:"盘龙区",530111:"官渡区",530112:"西山区",530113:"东川区",530114:"呈贡区",530115:"晋宁区",530124:"富民县",530125:"宜良县",530126:"石林彝族自治县",530127:"嵩明县",530128:"禄劝彝族苗族自治县",530129:"寻甸回族彝族自治县",530181:"安宁市",530302:"麒麟区",530303:"沾益区",530304:"马龙区",530322:"陆良县",530323:"师宗县",530324:"罗平县",530325:"富源县",530326:"会泽县",530381:"宣威市",530402:"红塔区",530403:"江川区",530422:"澄江县",530423:"通海县",530424:"华宁县",530425:"易门县",530426:"峨山彝族自治县",530427:"新平彝族傣族自治县",530428:"元江哈尼族彝族傣族自治县",530502:"隆阳区",530521:"施甸县",530523:"龙陵县",530524:"昌宁县",530581:"腾冲市",530602:"昭阳区",530621:"鲁甸县",530622:"巧家县",530623:"盐津县",530624:"大关县",530625:"永善县",530626:"绥江县",530627:"镇雄县",530628:"彝良县",530629:"威信县",530681:"水富市",530702:"古城区",530721:"玉龙纳西族自治县",530722:"永胜县",530723:"华坪县",530724:"宁蒗彝族自治县",530802:"思茅区",530821:"宁洱哈尼族彝族自治县",530822:"墨江哈尼族自治县",530823:"景东彝族自治县",530824:"景谷傣族彝族自治县",530825:"镇沅彝族哈尼族拉祜族自治县",530826:"江城哈尼族彝族自治县",530827:"孟连傣族拉祜族佤族自治县",530828:"澜沧拉祜族自治县",530829:"西盟佤族自治县",530902:"临翔区",530921:"凤庆县",530922:"云县",530923:"永德县",530924:"镇康县",530925:"双江拉祜族佤族布朗族傣族自治县",530926:"耿马傣族佤族自治县",530927:"沧源佤族自治县",532301:"楚雄市",532322:"双柏县",532323:"牟定县",532324:"南华县",532325:"姚安县",532326:"大姚县",532327:"永仁县",532328:"元谋县",532329:"武定县",532331:"禄丰县",532501:"个旧市",532502:"开远市",532503:"蒙自市",532504:"弥勒市",532523:"屏边苗族自治县",532524:"建水县",532525:"石屏县",532527:"泸西县",532528:"元阳县",532529:"红河县",532530:"金平苗族瑶族傣族自治县",532531:"绿春县",532532:"河口瑶族自治县",532601:"文山市",532622:"砚山县",532623:"西畴县",532624:"麻栗坡县",532625:"马关县",532626:"丘北县",532627:"广南县",532628:"富宁县",532801:"景洪市",532822:"勐海县",532823:"勐腊县",532901:"大理市",532922:"漾濞彝族自治县",532923:"祥云县",532924:"宾川县",532925:"弥渡县",532926:"南涧彝族自治县",532927:"巍山彝族回族自治县",532928:"永平县",532929:"云龙县",532930:"洱源县",532931:"剑川县",532932:"鹤庆县",533102:"瑞丽市",533103:"芒市",533122:"梁河县",533123:"盈江县",533124:"陇川县",533301:"泸水市",533323:"福贡县",533324:"贡山独龙族怒族自治县",533325:"兰坪白族普米族自治县",533401:"香格里拉市",533422:"德钦县",533423:"维西傈僳族自治县",540102:"城关区",540103:"堆龙德庆区",540104:"达孜区",540121:"林周县",540122:"当雄县",540123:"尼木县",540124:"曲水县",540127:"墨竹工卡县",540202:"桑珠孜区",540221:"南木林县",540222:"江孜县",540223:"定日县",540224:"萨迦县",540225:"拉孜县",540226:"昂仁县",540227:"谢通门县",540228:"白朗县",540229:"仁布县",540230:"康马县",540231:"定结县",540232:"仲巴县",540233:"亚东县",540234:"吉隆县",540235:"聂拉木县",540236:"萨嘎县",540237:"岗巴县",540302:"卡若区",540321:"江达县",540322:"贡觉县",540323:"类乌齐县",540324:"丁青县",540325:"察雅县",540326:"八宿县",540327:"左贡县",540328:"芒康县",540329:"洛隆县",540330:"边坝县",540402:"巴宜区",540421:"工布江达县",540422:"米林县",540423:"墨脱县",540424:"波密县",540425:"察隅县",540426:"朗县",540502:"乃东区",540521:"扎囊县",540522:"贡嘎县",540523:"桑日县",540524:"琼结县",540525:"曲松县",540526:"措美县",540527:"洛扎县",540528:"加查县",540529:"隆子县",540530:"错那县",540531:"浪卡子县",540602:"色尼区",540621:"嘉黎县",540622:"比如县",540623:"聂荣县",540624:"安多县",540625:"申扎县",540626:"索县",540627:"班戈县",540628:"巴青县",540629:"尼玛县",540630:"双湖县",542521:"普兰县",542522:"札达县",542523:"噶尔县",542524:"日土县",542525:"革吉县",542526:"改则县",542527:"措勤县",610102:"新城区",610103:"碑林区",610104:"莲湖区",610111:"灞桥区",610112:"未央区",610113:"雁塔区",610114:"阎良区",610115:"临潼区",610116:"长安区",610117:"高陵区",610118:"鄠邑区",610122:"蓝田县",610124:"周至县",610202:"王益区",610203:"印台区",610204:"耀州区",610222:"宜君县",610302:"渭滨区",610303:"金台区",610304:"陈仓区",610322:"凤翔县",610323:"岐山县",610324:"扶风县",610326:"眉县",610327:"陇县",610328:"千阳县",610329:"麟游县",610330:"凤县",610331:"太白县",610402:"秦都区",610403:"杨陵区",610404:"渭城区",610422:"三原县",610423:"泾阳县",610424:"乾县",610425:"礼泉县",610426:"永寿县",610428:"长武县",610429:"旬邑县",610430:"淳化县",610431:"武功县",610481:"兴平市",610482:"彬州市",610502:"临渭区",610503:"华州区",610522:"潼关县",610523:"大荔县",610524:"合阳县",610525:"澄城县",610526:"蒲城县",610527:"白水县",610528:"富平县",610581:"韩城市",610582:"华阴市",610602:"宝塔区",610603:"安塞区",610621:"延长县",610622:"延川县",610623:"子长县",610625:"志丹县",610626:"吴起县",610627:"甘泉县",610628:"富县",610629:"洛川县",610630:"宜川县",610631:"黄龙县",610632:"黄陵县",610702:"汉台区",610703:"南郑区",610722:"城固县",610723:"洋县",610724:"西乡县",610725:"勉县",610726:"宁强县",610727:"略阳县",610728:"镇巴县",610729:"留坝县",610730:"佛坪县",610802:"榆阳区",610803:"横山区",610822:"府谷县",610824:"靖边县",610825:"定边县",610826:"绥德县",610827:"米脂县",610828:"佳县",610829:"吴堡县",610830:"清涧县",610831:"子洲县",610881:"神木市",610902:"汉滨区",610921:"汉阴县",610922:"石泉县",610923:"宁陕县",610924:"紫阳县",610925:"岚皋县",610926:"平利县",610927:"镇坪县",610928:"旬阳县",610929:"白河县",611002:"商州区",611021:"洛南县",611022:"丹凤县",611023:"商南县",611024:"山阳县",611025:"镇安县",611026:"柞水县",620102:"城关区",620103:"七里河区",620104:"西固区",620105:"安宁区",620111:"红古区",620121:"永登县",620122:"皋兰县",620123:"榆中县",620201:"市辖区",620290:"雄关区",620291:"长城区",620292:"镜铁区",620293:"新城镇",620294:"峪泉镇",620295:"文殊镇",620302:"金川区",620321:"永昌县",620402:"白银区",620403:"平川区",620421:"靖远县",620422:"会宁县",620423:"景泰县",620502:"秦州区",620503:"麦积区",620521:"清水县",620522:"秦安县",620523:"甘谷县",620524:"武山县",620525:"张家川回族自治县",620602:"凉州区",620621:"民勤县",620622:"古浪县",620623:"天祝藏族自治县",620702:"甘州区",620721:"肃南裕固族自治县",620722:"民乐县",620723:"临泽县",620724:"高台县",620725:"山丹县",620802:"崆峒区",620821:"泾川县",620822:"灵台县",620823:"崇信县",620825:"庄浪县",620826:"静宁县",620881:"华亭市",620902:"肃州区",620921:"金塔县",620922:"瓜州县",620923:"肃北蒙古族自治县",620924:"阿克塞哈萨克族自治县",620981:"玉门市",620982:"敦煌市",621002:"西峰区",621021:"庆城县",621022:"环县",621023:"华池县",621024:"合水县",621025:"正宁县",621026:"宁县",621027:"镇原县",621102:"安定区",621121:"通渭县",621122:"陇西县",621123:"渭源县",621124:"临洮县",621125:"漳县",621126:"岷县",621202:"武都区",621221:"成县",621222:"文县",621223:"宕昌县",621224:"康县",621225:"西和县",621226:"礼县",621227:"徽县",621228:"两当县",622901:"临夏市",622921:"临夏县",622922:"康乐县",622923:"永靖县",622924:"广河县",622925:"和政县",622926:"东乡族自治县",622927:"积石山保安族东乡族撒拉族自治县",623001:"合作市",623021:"临潭县",623022:"卓尼县",623023:"舟曲县",623024:"迭部县",623025:"玛曲县",623026:"碌曲县",623027:"夏河县",630102:"城东区",630103:"城中区",630104:"城西区",630105:"城北区",630121:"大通回族土族自治县",630122:"湟中县",630123:"湟源县",630202:"乐都区",630203:"平安区",630222:"民和回族土族自治县",630223:"互助土族自治县",630224:"化隆回族自治县",630225:"循化撒拉族自治县",632221:"门源回族自治县",632222:"祁连县",632223:"海晏县",632224:"刚察县",632321:"同仁县",632322:"尖扎县",632323:"泽库县",632324:"河南蒙古族自治县",632521:"共和县",632522:"同德县",632523:"贵德县",632524:"兴海县",632525:"贵南县",632621:"玛沁县",632622:"班玛县",632623:"甘德县",632624:"达日县",632625:"久治县",632626:"玛多县",632701:"玉树市",632722:"杂多县",632723:"称多县",632724:"治多县",632725:"囊谦县",632726:"曲麻莱县",632801:"格尔木市",632802:"德令哈市",632803:"茫崖市",632821:"乌兰县",632822:"都兰县",632823:"天峻县",640104:"兴庆区",640105:"西夏区",640106:"金凤区",640121:"永宁县",640122:"贺兰县",640181:"灵武市",640202:"大武口区",640205:"惠农区",640221:"平罗县",640302:"利通区",640303:"红寺堡区",640323:"盐池县",640324:"同心县",640381:"青铜峡市",640402:"原州区",640422:"西吉县",640423:"隆德县",640424:"泾源县",640425:"彭阳县",640502:"沙坡头区",640521:"中宁县",640522:"海原县",650102:"天山区",650103:"沙依巴克区",650104:"新市区",650105:"水磨沟区",650106:"头屯河区",650107:"达坂城区",650109:"米东区",650121:"乌鲁木齐县",650202:"独山子区",650203:"克拉玛依区",650204:"白碱滩区",650205:"乌尔禾区",650402:"高昌区",650421:"鄯善县",650422:"托克逊县",650502:"伊州区",650521:"巴里坤哈萨克自治县",650522:"伊吾县",652301:"昌吉市",652302:"阜康市",652323:"呼图壁县",652324:"玛纳斯县",652325:"奇台县",652327:"吉木萨尔县",652328:"木垒哈萨克自治县",652701:"博乐市",652702:"阿拉山口市",652722:"精河县",652723:"温泉县",652801:"库尔勒市",652822:"轮台县",652823:"尉犁县",652824:"若羌县",652825:"且末县",652826:"焉耆回族自治县",652827:"和静县",652828:"和硕县",652829:"博湖县",652901:"阿克苏市",652922:"温宿县",652923:"库车县",652924:"沙雅县",652925:"新和县",652926:"拜城县",652927:"乌什县",652928:"阿瓦提县",652929:"柯坪县",653001:"阿图什市",653022:"阿克陶县",653023:"阿合奇县",653024:"乌恰县",653101:"喀什市",653121:"疏附县",653122:"疏勒县",653123:"英吉沙县",653124:"泽普县",653125:"莎车县",653126:"叶城县",653127:"麦盖提县",653128:"岳普湖县",653129:"伽师县",653130:"巴楚县",653131:"塔什库尔干塔吉克自治县",653201:"和田市",653221:"和田县",653222:"墨玉县",653223:"皮山县",653224:"洛浦县",653225:"策勒县",653226:"于田县",653227:"民丰县",654002:"伊宁市",654003:"奎屯市",654004:"霍尔果斯市",654021:"伊宁县",654022:"察布查尔锡伯自治县",654023:"霍城县",654024:"巩留县",654025:"新源县",654026:"昭苏县",654027:"特克斯县",654028:"尼勒克县",654201:"塔城市",654202:"乌苏市",654221:"额敏县",654223:"沙湾县",654224:"托里县",654225:"裕民县",654226:"和布克赛尔蒙古自治县",654301:"阿勒泰市",654321:"布尔津县",654322:"富蕴县",654323:"福海县",654324:"哈巴河县",654325:"青河县",654326:"吉木乃县",659001:"石河子市",659002:"阿拉尔市",659003:"图木舒克市",659004:"五家渠市",659005:"北屯市",659006:"铁门关市",659007:"双河市",659008:"可克达拉市",659009:"昆玉市",710101:"中正区",710102:"大同区",710103:"中山区",710104:"松山区",710105:"大安区",710106:"万华区",710107:"信义区",710108:"士林区",710109:"北投区",710110:"内湖区",710111:"南港区",710112:"文山区",710199:"其它区",710201:"新兴区",710202:"前金区",710203:"芩雅区",710204:"盐埕区",710205:"鼓山区",710206:"旗津区",710207:"前镇区",710208:"三民区",710209:"左营区",710210:"楠梓区",710211:"小港区",710241:"苓雅区",710242:"仁武区",710243:"大社区",710244:"冈山区",710245:"路竹区",710246:"阿莲区",710247:"田寮区",710248:"燕巢区",710249:"桥头区",710250:"梓官区",710251:"弥陀区",710252:"永安区",710253:"湖内区",710254:"凤山区",710255:"大寮区",710256:"林园区",710257:"鸟松区",710258:"大树区",710259:"旗山区",710260:"美浓区",710261:"六龟区",710262:"内门区",710263:"杉林区",710264:"甲仙区",710265:"桃源区",710266:"那玛夏区",710267:"茂林区",710268:"茄萣区",710299:"其它区",710301:"中西区",710302:"东区",710303:"南区",710304:"北区",710305:"安平区",710306:"安南区",710339:"永康区",710340:"归仁区",710341:"新化区",710342:"左镇区",710343:"玉井区",710344:"楠西区",710345:"南化区",710346:"仁德区",710347:"关庙区",710348:"龙崎区",710349:"官田区",710350:"麻豆区",710351:"佳里区",710352:"西港区",710353:"七股区",710354:"将军区",710355:"学甲区",710356:"北门区",710357:"新营区",710358:"后壁区",710359:"白河区",710360:"东山区",710361:"六甲区",710362:"下营区",710363:"柳营区",710364:"盐水区",710365:"善化区",710366:"大内区",710367:"山上区",710368:"新市区",710369:"安定区",710399:"其它区",710401:"中区",710402:"东区",710403:"南区",710404:"西区",710405:"北区",710406:"北屯区",710407:"西屯区",710408:"南屯区",710431:"太平区",710432:"大里区",710433:"雾峰区",710434:"乌日区",710435:"丰原区",710436:"后里区",710437:"石冈区",710438:"东势区",710439:"和平区",710440:"新社区",710441:"潭子区",710442:"大雅区",710443:"神冈区",710444:"大肚区",710445:"沙鹿区",710446:"龙井区",710447:"梧栖区",710448:"清水区",710449:"大甲区",710450:"外埔区",710451:"大安区",710499:"其它区",710507:"金沙镇",710508:"金湖镇",710509:"金宁乡",710510:"金城镇",710511:"烈屿乡",710512:"乌坵乡",710614:"南投市",710615:"中寮乡",710616:"草屯镇",710617:"国姓乡",710618:"埔里镇",710619:"仁爱乡",710620:"名间乡",710621:"集集镇",710622:"水里乡",710623:"鱼池乡",710624:"信义乡",710625:"竹山镇",710626:"鹿谷乡",710701:"仁爱区",710702:"信义区",710703:"中正区",710704:"中山区",710705:"安乐区",710706:"暖暖区",710707:"七堵区",710799:"其它区",710801:"东区",710802:"北区",710803:"香山区",710899:"其它区",710901:"东区",710902:"西区",710999:"其它区",711130:"万里区",711132:"板桥区",711133:"汐止区",711134:"深坑区",711135:"石碇区",711136:"瑞芳区",711137:"平溪区",711138:"双溪区",711139:"贡寮区",711140:"新店区",711141:"坪林区",711142:"乌来区",711143:"永和区",711144:"中和区",711145:"土城区",711146:"三峡区",711147:"树林区",711148:"莺歌区",711149:"三重区",711150:"新庄区",711151:"泰山区",711152:"林口区",711153:"芦洲区",711154:"五股区",711155:"八里区",711156:"淡水区",711157:"三芝区",711158:"石门区",711287:"宜兰市",711288:"头城镇",711289:"礁溪乡",711290:"壮围乡",711291:"员山乡",711292:"罗东镇",711293:"三星乡",711294:"大同乡",711295:"五结乡",711296:"冬山乡",711297:"苏澳镇",711298:"南澳乡",711299:"钓鱼台",711387:"竹北市",711388:"湖口乡",711389:"新丰乡",711390:"新埔镇",711391:"关西镇",711392:"芎林乡",711393:"宝山乡",711394:"竹东镇",711395:"五峰乡",711396:"横山乡",711397:"尖石乡",711398:"北埔乡",711399:"峨眉乡",711414:"中坜区",711415:"平镇区",711417:"杨梅区",711418:"新屋区",711419:"观音区",711420:"桃园区",711421:"龟山区",711422:"八德区",711423:"大溪区",711425:"大园区",711426:"芦竹区",711487:"中坜市",711488:"平镇市",711489:"龙潭乡",711490:"杨梅市",711491:"新屋乡",711492:"观音乡",711493:"桃园市",711494:"龟山乡",711495:"八德市",711496:"大溪镇",711497:"复兴乡",711498:"大园乡",711499:"芦竹乡",711520:"头份市",711582:"竹南镇",711583:"头份镇",711584:"三湾乡",711585:"南庄乡",711586:"狮潭乡",711587:"后龙镇",711588:"通霄镇",711589:"苑里镇",711590:"苗栗市",711591:"造桥乡",711592:"头屋乡",711593:"公馆乡",711594:"大湖乡",711595:"泰安乡",711596:"铜锣乡",711597:"三义乡",711598:"西湖乡",711599:"卓兰镇",711736:"员林市",711774:"彰化市",711775:"芬园乡",711776:"花坛乡",711777:"秀水乡",711778:"鹿港镇",711779:"福兴乡",711780:"线西乡",711781:"和美镇",711782:"伸港乡",711783:"员林镇",711784:"社头乡",711785:"永靖乡",711786:"埔心乡",711787:"溪湖镇",711788:"大村乡",711789:"埔盐乡",711790:"田中镇",711791:"北斗镇",711792:"田尾乡",711793:"埤头乡",711794:"溪州乡",711795:"竹塘乡",711796:"二林镇",711797:"大城乡",711798:"芳苑乡",711799:"二水乡",711982:"番路乡",711983:"梅山乡",711984:"竹崎乡",711985:"阿里山乡",711986:"中埔乡",711987:"大埔乡",711988:"水上乡",711989:"鹿草乡",711990:"太保市",711991:"朴子市",711992:"东石乡",711993:"六脚乡",711994:"新港乡",711995:"民雄乡",711996:"大林镇",711997:"溪口乡",711998:"义竹乡",711999:"布袋镇",712180:"斗南镇",712181:"大埤乡",712182:"虎尾镇",712183:"土库镇",712184:"褒忠乡",712185:"东势乡",712186:"台西乡",712187:"仑背乡",712188:"麦寮乡",712189:"斗六市",712190:"林内乡",712191:"古坑乡",712192:"莿桐乡",712193:"西螺镇",712194:"二仑乡",712195:"北港镇",712196:"水林乡",712197:"口湖乡",712198:"四湖乡",712199:"元长乡",712451:"崁顶乡",712467:"屏东市",712468:"三地门乡",712469:"雾台乡",712470:"玛家乡",712471:"九如乡",712472:"里港乡",712473:"高树乡",712474:"盐埔乡",712475:"长治乡",712476:"麟洛乡",712477:"竹田乡",712478:"内埔乡",712479:"万丹乡",712480:"潮州镇",712481:"泰武乡",712482:"来义乡",712483:"万峦乡",712484:"莰顶乡",712485:"新埤乡",712486:"南州乡",712487:"林边乡",712488:"东港镇",712489:"琉球乡",712490:"佳冬乡",712491:"新园乡",712492:"枋寮乡",712493:"枋山乡",712494:"春日乡",712495:"狮子乡",712496:"车城乡",712497:"牡丹乡",712498:"恒春镇",712499:"满州乡",712584:"台东市",712585:"绿岛乡",712586:"兰屿乡",712587:"延平乡",712588:"卑南乡",712589:"鹿野乡",712590:"关山镇",712591:"海端乡",712592:"池上乡",712593:"东河乡",712594:"成功镇",712595:"长滨乡",712596:"金峰乡",712597:"大武乡",712598:"达仁乡",712599:"太麻里乡",712686:"花莲市",712687:"新城乡",712688:"太鲁阁",712689:"秀林乡",712690:"吉安乡",712691:"寿丰乡",712692:"凤林镇",712693:"光复乡",712694:"丰滨乡",712695:"瑞穗乡",712696:"万荣乡",712697:"玉里镇",712698:"卓溪乡",712699:"富里乡",712794:"马公市",712795:"西屿乡",712796:"望安乡",712797:"七美乡",712798:"白沙乡",712799:"湖西乡",712896:"南竿乡",712897:"北竿乡",712898:"东引乡",712899:"莒光乡",810101:"中西区",810102:"湾仔区",810103:"东区",810104:"南区",810201:"九龙城区",810202:"油尖旺区",810203:"深水埗区",810204:"黄大仙区",810205:"观塘区",810301:"北区",810302:"大埔区",810303:"沙田区",810304:"西贡区",810305:"元朗区",810306:"屯门区",810307:"荃湾区",810308:"葵青区",810309:"离岛区",820101:"澳门半岛",820201:"离岛"}}},"5d33":function(e,t,i){},"5d77":function(e,t,i){"use strict";var a=i("bff0"),o=i.n(a);o.a},"5e27":function(e,t,i){},6013:function(e,t,i){"use strict";var a=i("632d"),o=i.n(a);o.a},"611c":function(e,t,i){"use strict";var a={media:{isBG:!1,imgPath:"http://testdiy.36588.com.cn/image/mong/1/MXYZ-BAF806BCCE234A1B84C83B1892549434.png",mediaType:"image"},layer:{alpha:1},printLocation:{x:100,y:100,width:132.68953,height:123.4643,rotation:0},location:{x:100,y:100,width:132.68953,height:123.4643,factWidth:500,factHeight:500,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:3e3,topEnable:!1,moveable:"yes"};t["a"]=a},"632d":function(e,t,i){},6465:function(e,t,i){e.exports=i.p+"static/img/2.47c83eef.png"},6614:function(e,t,i){"use strict";var a=function(){var e,t="default";return e=function(){Array.prototype.slice;var e,i,a,o,s=Array.prototype.shift,n=Array.prototype.unshift,r={},l=function(e,t){for(var i,a=0,o=e.length;a<o;a++){var s=e[a];i=t.call(s,a,s)}return i};return e=function(e,t,i){i[e]||(i[e]=[]),i[e].push(t)},a=function(e,t,i){if(t[e])if(i)for(var a=t[e].length;a>=0;a--)t[e][a]===i&&t[e].splice(a,1);else t[e]=[]},i=function(){var e=s.call(arguments),t=s.call(arguments),i=arguments,a=this,o=e[t];if(o&&o.length)return l(o,function(){return this.apply(a,i)})},o=function(o){o=o||t;var s={},d=[],c={listen:function(t,i,a){e(t,i,s),null!==d&&("last"===a?d.length&&d.pop()():l(d,function(){this()}),d=null)},one:function(e,t,i){a(e,s),this.listen(e,t,i)},remove:function(e,t){a(e,s,t)},trigger:function(){var e,t,a=this;return n.call(arguments,s),t=arguments,e=function(){return i.apply(a,t)},d?d.push(e):e()}};return o?r[o]?r[o]:r[o]=c:c},{create:o,one:function(e,t,i){var a=this.create();a.one(e,t,i)},remove:function(e,t){var i=this.create();i.remove(e,t)},listen:function(e,t,i){var a=this.create();a.listen(e,t,i)},trigger:function(){var e=this.create();e.trigger.apply(this,arguments)}}}(),e}();t["a"]=a},6655:function(e,t,i){"use strict";var a=i("2531"),o=i.n(a);o.a},"66a2":function(e,t,i){"use strict";var a={bookSpace:47,productBleedSpace:6,banhuaBleedSpace:3,yignkeProductBleedSpace:23,rkBleedSpace:6,rkBookSpace:10,calendarUpbleed:18,dpi:300,inchmm:25.4,weekTopSpace:30};t["a"]=a},6910:function(e,t,i){e.exports=i.p+"static/img/11.5f55ec40.png"},"6a7a":function(e,t,i){"use strict";var a=i("9c7b"),o=i.n(a);o.a},"6b12":function(e,t,i){e.exports=i.p+"static/img/time.5b59d0e8.svg"},"6b92":function(e,t,i){"use strict";i("7514");(function(e){e.fn.tabNav=function(t){var i={tabNavs:".tab-item",activeClass:"on",tabConts:".tab-box",events:"click",activeNum:0},a=window.location.hash.substring(1),o=e.extend({},i,t),s=e(this).find(o.tabNavs),n=o.activeClass,r=e(this).find(o.tabConts),l=o.events,d=o.activeNum;s.each(function(){var t=e(this).attr("id");if(a===t)return d=e(this).index()}),s.removeClass(n).eq(d).addClass(n),r.hide().eq(d).show(),s.on(l,function(){var t=e(this).index();e(this).addClass(n).siblings().removeClass(n),r.hide().eq(t).show()})}})(jQuery)},"704d":function(e,t,i){"use strict";i.d(t,"a",function(){return s});var a=i("7618"),o=(i("7f7f"),i("103a"));function s(e,t,i,s){var n=[];if(""!=e&&e.length>0){for(var r=0;r<e.length;r++){var l={isUse:!0};l.index=r,l.id=e[r].id,l.name=e[r].name,l.url=e[r].picname;var d=localStorage.getItem(s.thumbnailToken);l.src=Object(o["d"])(e[r].picname)+Object(o["e"])(e[r].picname,e[r].imageinfo,d);Object(a["a"])(e[r].imageinfo);if(""!=e[r].imageinfo){var c=JSON.parse(e[r].imageinfo),h="";h=c.primaryImageInfo?c.primaryImageInfo:c,l.dateTime=c.dateTime,l.width=h.width,l.height=h.height,(h.width<requireWidth||h.height<requireHeight)&&(l.pixellow=1)}n.push(l)}localStorage.setItem(t,JSON.stringify(n)),console.log("imageList======="+JSON.stringify(n)),n.length>0&&localStorage.setItem(s.areadyInsert,"1")}}},7108:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAANNJREFUSEvN1KEOwjAQBuD/eLRuAjq5zmAwCAwKhdsMCoVBYDAYmAW5VztSsWRZ0t11YwmzTb7+d9cbYaaPZnLxP7Cxrmw+dSlVGpU4se4I4MRAJeFqOFm5AwhnDeqrUcFp5vbMuGhRFWxsviPQNQYVYWPdloAbA35glTSw7nmwFcky32BB9zFoMHFqizWDH7HlDyY2mSuI8ZyCBhP/Ag/2eCo++I6n4OKCdPCoJyfCfhBjcBXcw8UfkLh5/U2L6bk6cXuJx5t3/ZLWOxqWwPZ8NvgLzO5uF0jHTPoAAAAASUVORK5CYII="},7300:function(e,t,i){e.exports=i.p+"static/img/diaochawenjuan.d0a29f8c.png"},7337:function(e,t,i){"use strict";var a={spread:{covers:1,pagePer:1,backCover:0},diyType:"woodcut",version:200,coverInfo:{hascover:!1,coverimg:"",hasbackcover:!1,backcoverimg:""},button:"",sku:"2001020500187",coverpageList:[],backcoverpageList:[],templateInfo:{id:2099177099,name:"移动端九宫格方10心形版画",style:-1,theme:-1,diyType:"woodcut",width:266,height:266,innerwidth:266,innerheight:266,motherstyle:-1,candrag:!1,dpi:300,backcover:0,coverper:1,innerper:1,designModel:"单页模式",minPage:1,maxPage:1,mid:2207234225,hascover:!1,coverimg:"",hasbackcover:!1,backcoverimg:""},pageList:[{displayWidth:800,displayHeight:800,workAreaWidth:300,workAreaHeight:300,diyDisplayWidth:800,diyDisplayHeight:800,diyWorkAreaWidth:800,diyWorkAreaHeight:800,pageBleed:{u:"2",l:"2",t:"2",r:"2",b:"2",m:"0"},content:{diyZoom:1,itemList:[{media:{isBG:!1,color:16763904,scopeType:"rect",isFill:!1,isPrimary:!0,border:{borderType:"solidLine",borderSize:1,borderColor:6710886,borderAlpha:100},mediaType:"shape"},layer:{alpha:1},printLocation:{x:0,y:0,width:800,height:800,rotation:0},location:{x:0,y:0,width:800,height:800,factWidth:1e4,factHeight:1e4,rotation:0},resourceType:1,isPreview:!1,isComposite:!1,isDesign:!1,isEdit:!1,isDisplay:!1,isDesignShape:!0,visible:!0,selectEnabled:!1,visitLevel:1e3,topEnable:!1,moveable:"no"},{media:{isBG:!0,imgPath:"",mediaType:"image"},layer:{alpha:1},printLocation:{x:0,y:0,width:800,height:800,rotation:0},location:{x:0,y:0,width:800,height:800,factWidth:1e4,factHeight:1e4,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!1,isDisplay:!1,isDesignShape:!1,visible:!1,selectEnabled:!1,visitLevel:1e3,topEnable:!1,moveable:"no"},{media:{isBG:!0,color:16777215,scopeType:"rect",isFill:!0,isPrimary:!0,mediaType:"shape"},layer:{alpha:1},printLocation:{x:0,y:0,width:800,height:800,rotation:0},location:{x:0,y:0,width:800,height:800,factWidth:1e4,factHeight:1e4,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!1,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!1,visitLevel:1e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-16.603725,imgWidth:112.43925,imgHeight:145.6467,defaultState:!1,isSimple:!0,bgSource:"MXYZ-AE97462B47F045088327B74636C77520.png",factMaskSource:"MXYZ-AE97462B47F045088327B74636C77520.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/000dd2a2977d4754b5b5420abce181f3.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:112.43925,originalImgHeight:145.6467},layer:{alpha:1},printLocation:{x:32.89439,y:179.14027,width:112.43925,height:112.43925,rotation:0},location:{x:32.89439,y:179.14027,width:112.43925,height:112.43925,factWidth:1e3,factHeight:1e3,maskFactWidth:772,maskFactHeight:1e3,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-3.752945,imgWidth:132.45694,imgHeight:82.1233,defaultState:!1,isSimple:!0,bgSource:"MXYZ-BDEC4926931C44C0B1E26FB941623363.png",factMaskSource:"MXYZ-BDEC4926931C44C0B1E26FB941623363.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/83376f560fd142e78785d21beac8b8b1.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:132.45694,originalImgHeight:82.1233},layer:{alpha:1},printLocation:{x:180.45734,y:378.609,width:132.45694,height:74.61741,rotation:0},location:{x:180.45734,y:378.609,width:132.45694,height:74.61741,factWidth:1600,factHeight:900,maskFactWidth:600,maskFactHeight:372,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-1.035759,imgY:0,imgWidth:90.62912,imgHeight:66.4182,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/fd84ebe371954b71a06564b29cf5806f.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:90.62912,originalImgHeight:66.4182},layer:{alpha:1},printLocation:{x:56.77648,y:304.31833,width:88.5576,height:66.4182,rotation:0},location:{x:56.77648,y:304.31833,width:88.5576,height:66.4182,factWidth:1600,factHeight:1200,maskFactWidth:700,maskFactHeight:513,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-3.519043,imgY:0,imgWidth:145.03961,imgHeight:103.50115,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/c159292c806e460ea23d863d51a1f610.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:145.03961,originalImgHeight:103.50115},layer:{alpha:1},printLocation:{x:152.41562,y:140.48924,width:138.00153,height:103.50115,rotation:0},location:{x:152.41562,y:140.48924,width:138.00153,height:103.50115,factWidth:1600,factHeight:1200,maskFactWidth:1051,maskFactHeight:750,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-3.8200607,imgY:0,imgWidth:84.890274,imgHeight:57.93761,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/523d723164af45aaa384b25cba96d6ce.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:84.890274,originalImgHeight:57.93761},layer:{alpha:1},printLocation:{x:298.39175,y:186.05278,width:77.25015,height:57.93761,rotation:0},location:{x:298.39175,y:186.05278,width:77.25015,height:57.93761,factWidth:1600,factHeight:1200,maskFactWidth:400,maskFactHeight:273,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-10.031166,imgY:0,imgWidth:180.56099,imgHeight:120.37399,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/ff52acd03759467587a93ab21336b06b.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:180.56099,originalImgHeight:120.37399},layer:{alpha:1},printLocation:{x:152.41562,y:250.36253,width:160.49866,height:120.37399,rotation:0},location:{x:152.41562,y:250.36253,width:160.49866,height:120.37399,factWidth:1600,factHeight:1200,maskFactWidth:915,maskFactHeight:610,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-8.625,imgY:0,imgWidth:155.24997,imgHeight:103.49998,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/338f479380814b018740a8b46aa96d09.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:155.24997,originalImgHeight:103.49998},layer:{alpha:1},printLocation:{x:512.45624,y:140.49042,width:137.99997,height:103.49998,rotation:0},location:{x:512.45624,y:140.49042,width:137.99997,height:103.49998,factWidth:1600,factHeight:1200,maskFactWidth:636,maskFactHeight:424,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-4.937046,imgY:0,imgWidth:87.124344,imgHeight:57.93769,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/a5df1c9dc69945d19b762e718b5568b1.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:87.124344,originalImgHeight:57.93769},layer:{alpha:1},printLocation:{x:426.66333,y:186.0527,width:77.25025,height:57.93769,rotation:0},location:{x:426.66333,y:186.0527,width:77.25025,height:57.93769,factWidth:1600,factHeight:1200,maskFactWidth:400,maskFactHeight:266,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:-10.354752,imgY:0,imgWidth:181.20816,imgHeight:120.37399,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/1b4c626b46924f9fa18c39f994db217e.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:181.20816,originalImgHeight:120.37399},layer:{alpha:1},printLocation:{x:322.16,y:250.36253,width:160.49866,height:120.37399,rotation:0},location:{x:322.16,y:250.36253,width:160.49866,height:120.37399,factWidth:1600,factHeight:1200,maskFactWidth:700,maskFactHeight:465,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-16.60368,imgWidth:112.43894,imgHeight:145.6463,defaultState:!1,isSimple:!0,bgSource:"MXYZ-AE97462B47F045088327B74636C77520.png",factMaskSource:"MXYZ-AE97462B47F045088327B74636C77520.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/d104e98a065c423b8363ce04fbec3ace.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:112.43894,originalImgHeight:145.6463},layer:{alpha:1},printLocation:{x:657.4753,y:185.01814,width:112.43894,height:112.43894,rotation:0},location:{x:657.4753,y:185.01814,width:112.43894,height:112.43894,factWidth:1e3,factHeight:1e3,maskFactWidth:772,maskFactHeight:1e3,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-6.2608566,imgWidth:132.45628,imgHeight:87.138756,defaultState:!1,isSimple:!0,bgSource:"MXYZ-BDEC4926931C44C0B1E26FB941623363.png",factMaskSource:"MXYZ-BDEC4926931C44C0B1E26FB941623363.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/ffe746e478c6454591268a9ef1435cdc.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:132.45628,originalImgHeight:87.138756},layer:{alpha:1},printLocation:{x:489.95755,y:378.609,width:132.45628,height:74.61704,rotation:0},location:{x:489.95755,y:378.609,width:132.45628,height:74.61704,factWidth:1600,factHeight:900,maskFactWidth:985,maskFactHeight:648,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-25.82994,imgWidth:88.55981,imgHeight:118.07974,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/b15bc3f2b99c4f31939d4bd1f37c0088.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:88.55981,originalImgHeight:118.07974},layer:{alpha:1},printLocation:{x:657.846,y:304.31665,width:88.55981,height:66.41986,rotation:0},location:{x:657.846,y:304.31665,width:88.55981,height:66.41986,factWidth:1600,factHeight:1200,maskFactWidth:375,maskFactHeight:500,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-53.7022,imgWidth:160.49866,imgHeight:227.7784,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/c0a46b0e67dc47acaaf3631252b5cb31.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:160.49866,originalImgHeight:227.7784},layer:{alpha:1},printLocation:{x:489.95755,y:250.36253,width:160.49866,height:120.37399,rotation:0},location:{x:489.95755,y:250.36253,width:160.49866,height:120.37399,factWidth:1600,factHeight:1200,maskFactWidth:594,maskFactHeight:843,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-56.53027,imgWidth:161.60657,imgHeight:234.26546,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/c0f51bf974c3453db1d16ebb09e0cc47.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:161.60657,originalImgHeight:234.26546},layer:{alpha:1},printLocation:{x:321.01266,y:378.71878,width:161.60657,height:121.20492,rotation:0},location:{x:321.01266,y:378.71878,width:161.60657,height:121.20492,factWidth:1600,factHeight:1200,maskFactWidth:883,maskFactHeight:1280,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-22.20252,imgWidth:59.20673,imgHeight:88.81009,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/787fbe58a7894fd6a05a909ac012a6c4.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:59.20673,originalImgHeight:88.81009},layer:{alpha:1},printLocation:{x:254.50755,y:455.51865,width:59.20673,height:44.40505,rotation:0},location:{x:254.50755,y:455.51865,width:59.20673,height:44.40505,factWidth:1600,factHeight:1200,maskFactWidth:800,maskFactHeight:1200,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-18.627995,imgWidth:49.221,imgHeight:74.17174,defaultState:!1,isSimple:!0,bgSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",factMaskSource:"MXYZ-97B00F99AACC443F90DA001B85324B56.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/704e1f6985924ec4926184ab966285ce.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:49.221,originalImgHeight:74.17174},layer:{alpha:1},printLocation:{x:489.95755,y:463.00793,width:49.221,height:36.91575,rotation:0},location:{x:489.95755,y:463.00793,width:49.221,height:36.91575,factWidth:1600,factHeight:1200,maskFactWidth:1085,maskFactHeight:1635,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,imgX:0,imgY:-31.195011,imgWidth:119.4184,imgHeight:181.80843,defaultState:!1,isSimple:!0,bgSource:"MXYZ-AE97462B47F045088327B74636C77520.png",factMaskSource:"MXYZ-AE97462B47F045088327B74636C77520.png",zoom:0,maskSource:"fs3015/yingxiangdiy/20211124/fa3c52e01dc64c1395af29cd9d660d84.jpg",mediaType:"advancedImageMask",visitLevel:3e3,originalImgWidth:119.4184,originalImgHeight:181.80843},layer:{alpha:1},printLocation:{x:343.2156,y:505.65195,width:119.4184,height:119.4184,rotation:0},location:{x:343.2156,y:505.65195,width:119.4184,height:119.4184,factWidth:1e3,factHeight:1e3,maskFactWidth:490,maskFactHeight:746,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:2e3,topEnable:!1,moveable:"no"},{media:{isBG:!1,isImage:!1,font:{pointSize:42,fontColor:"#000000",isHorizontal:"true",isFontInit:!1,gravity:"left",id:1030155561,isItalic:!1,textDecoration:"",isBold:!1},text:"My Love",charSpace:0,lineSpace:1.16,mediaType:"text",upLeftToBaseLineY:16.36715238434863},layer:{alpha:1},printLocation:{x:528.7476,y:589.6144,width:188.22485,height:112.36948,rotation:-21.95306},location:{x:528.7476,y:658.4022,width:184,height:46.98879,factWidth:1e4,factHeight:1e4,rotation:-21.95306},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:3e3,topEnable:!1,moveable:"no",changeMove:!0},{media:{isBG:!1,imgPath:"https://www.36588.com.cn/jianying/image/mong/1/MXYZ-EBECAB72096A4792B25D9BBDE832CF06.png",mediaType:"image"},layer:{alpha:1},printLocation:{x:428.6517,y:52.40824,width:324.33405,height:121.73338,rotation:0},location:{x:428.6517,y:52.40824,width:324.33405,height:121.73338,factWidth:1500,factHeight:563,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:3e3,topEnable:!1,copyright:"0",moveable:"no"},{media:{isBG:!1,imgPath:"https://www.36588.com.cn/jianying/image/mong/1/MXYZ-0364CB0D94B04B22AA668914E3A8DCD6.png",mediaType:"image"},layer:{alpha:1},printLocation:{x:85.95506,y:596.54333,width:113.798,height:151.04842,rotation:0},location:{x:85.95506,y:596.54333,width:113.798,height:151.04842,factWidth:1668,factHeight:2214,rotation:0},resourceType:1,isPreview:!0,isComposite:!0,isDesign:!0,isEdit:!0,isDisplay:!1,isDesignShape:!1,visible:!0,selectEnabled:!0,visitLevel:3e3,topEnable:!1,copyright:"0",moveable:"no"},{media:{isBG:!1,imgPath:"",mediaType:"image"},layer:{alpha:1},printLocation:{x:0,y:0,width:801,height:801.5,rotation:0},location:{x:0,y:0,width:801,height:801.5,factWidth:1e4,factHeight:1e4,rotation:0},resourceType:1,isPreview:!0,isComposite:!1,isDesign:!0,isEdit:!1,isDisplay:!0,isDesignShape:!1,visible:!0,selectEnabled:!1,visitLevel:1e3,topEnable:!1,moveable:"no"}],color:{},size:{}},id:2099177100,pageOrder:1,templateID:2099177099,title:"01",photoNum:17,previewImagePath:"MXYZ-5D617791C18346CA96FA26F1F8DF4DA7.png",displayTranFlag:!0,pageGroup:!1,minPage:0,maxPage:0,fixedPage:!1,ratioDiff:!0,hasWarn:!1}],coverBackPhotoNum:0,hasCoverABack:!1,photonum:17,complexity:2,rk:"2",isVideo:!1,oderInfo:{goodsname:"移动端九宫格方10心形版画-新一代方12寸版画",id:"",memberid:"",orderNo:"",productNo:"2001020500187",source:"wsid",url:"http://ws.jndx.net/jianying/mtemplate?sku=2001020500187&wsid=-1&shopname=yhqj"}};t["a"]=a},"738b":function(e,t,i){"use strict";i.d(t,"a",function(){return m});i("c5f6");var a=i("d225"),o=i("b0b4"),s=i("66a2"),n=s["a"].bookSpace,r="bleedLine_",l=(s["a"].dpi,s["a"].productBleedSpace),d=s["a"].productBleedSpace,c=1,h="5,4",g="#FF0000",m=function(){function e(t,i,o,s,r,l,d){Object(a["a"])(this,e),this.parent=t,this.objJson=i,this.pageIndex=o,this.itemIndex=s,this.isCoverDouble=l,this.detailJson=r,this.vm=d,this.bleedW,this.bleedH,r.templateInfo.spinewidth&&(n=r.templateInfo.spinewidth),r.templateInfo.spinewidth||r.pageList[0].pageBleed&&r.pageList[0].pageBleed.m>2&&(n=r.pageList[0].pageBleed.m)}return Object(o["a"])(e,[{key:"initBleedLine",value:function(){var e=this,t=localStorage.getItem(e.vm.pageKey.rk);4==t&&(n=s["a"].rkBookSpace,this.detailJson.templateInfo.spinewidth&&""!=this.detailJson.templateInfo.spinewidth&&(n=this.detailJson.templateInfo.spinewidth),this.detailJson.templateInfo.spinewidth||this.detailJson.pageList[0].pageBleed&&this.detailJson.pageList[0].pageBleed.m>2&&(n=this.detailJson.pageList[0].pageBleed.m));e.objJson;if(!SVG("#"+r+e.pageIndex+"_"+e.itemIndex)&&e.parent){var i=e.parent.rect(),a=e.detailJson.pageList[e.pageIndex].diyWorkAreaWidth/e.detailJson.pageList[e.pageIndex].workAreaWidth;if(e.isCoverDouble&&0==e.pageIndex&&e.detailJson.pageList[0].iscover){l=s["a"].yignkeProductBleedSpace;t=localStorage.getItem(e.vm.pageKey.rk);4==t&&(l=s["a"].rkBleedSpace)}else l=s["a"].productBleedSpace;var o=JSON.parse(localStorage.getItem(e.vm.pageKey.detailJson));if(o&&"woodcut"==o.diyType&&(l=s["a"].banhuaBleedSpace),d=l,e.detailJson.pageList[e.pageIndex].pageBleed&&""!=e.detailJson.pageList[e.pageIndex].pageBleed){var m=e.detailJson.pageList[e.pageIndex].pageBleed;l=Number(m.r),d=Number(m.t)}var p=l*a,u=d*a;e.bleedW=p,e.bleedH=u;var f=e.detailJson.pageList[e.pageIndex].content.itemList[0].location.x,y=e.detailJson.pageList[e.pageIndex].content.itemList[0].location.y,_=e.detailJson.pageList[e.pageIndex].content.itemList[0].location.width,v=e.detailJson.pageList[e.pageIndex].content.itemList[0].location.height;if(i.attr({id:r+e.pageIndex+"_"+e.itemIndex,x:f+p,y:y+u,width:_-2*p,height:v-2*u,"stroke-width":c,"stroke-dasharray":h,stroke:g,fill:"none"}),e.isCoverDouble&&0==e.pageIndex){if(!e.detailJson.pageList[0].iscover)return;var w=n*a,b=i.cx()-w/2,I=i.y(),S=b,x=I+i.height(),k=e.parent.line(b,I,S,x);k.attr({"stroke-width":c,"stroke-dasharray":h,stroke:g,fill:"none"});var O=i.cx()+w/2,L=i.y(),T=O,C=L+i.height(),P=e.parent.line(O,L,T,C);P.attr({"stroke-width":c,"stroke-dasharray":h,stroke:g,fill:"none"})}else if(2==e.detailJson.templateInfo.innerper){if(e.detailJson.coverInfo.hascover&&0==e.pageIndex)return;if(e.detailJson.coverInfo.hasbackcover&&1==e.detailJson.templateInfo.backcover&&e.pageIndex==e.detailJson.pageList.length-1)return;var j=f+_/2-2*c,A=0,N=j,E=v,J=e.parent.line(j,A,N,E);J.attr({"stroke-width":6*c,"stroke-dasharray":"10,10",stroke:"#C0C0C0",fill:"none"})}}}}]),e}()},"73b9":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAADsNJREFUeF7tnXewZUURxrtVRMVU5lDmUApa5lDmUKKoWIK4goAgICC4oCIiIoJkcFmXZXFZAXfZXVhAzDnnnHPOOeccPqupvvr21Xvvnjt3eu6ZM99U8Rcz3/R8fX7b590zZ44KGx2gA4s6oPSGDtCBxR0gILw66MASDhAQXh50gIDwGqADaQ6wgqT5xlGNOEBAGkk0l5nmAAFJ842jGnGAgDSSaC4zzQECkuYbRzXiAAFpJNFcZpoDBCTNN45qxAEC0kiiucw0BwhImm8c1YgDBKSRRHOZaQ4QkDTfOKoRBwhII4nmMtMcICBpvnFUIw4QkEYSzWWmOUBA0nzjqEYcICCNJJrLTHOAgKT5xlGNOEBAGkk0l5nmAAFJ842jGnGAgDSSaC4zzQECkuYbRzXiAAFpJNFcZpoDBCTNN45qxAEC0kiiucw0BwhImm8c1YgDBKSRRHOZaQ4QkDTfOKoRBwhII4nmMtMcICBpvnFUIw4QkEYSzWWmOUBA0nzjqEYcICCNJJrLTHOAgKT5xlGNOEBAGkk0l5nmAAFJ842jGnGAgDSSaC4zzQECkuYbRxV0AMD2qvqVglP+byoCMgvXOWdnBwC8WESW2X+zgISAdE4VO5Z2AMCxInKCz/vlWUBCQEpnnfN1cgDAi0TkxHmdi0NCQDqli51KOgDghSJy8iJzFoWEgJTMPOca6wCAo0XklDEdi0FCQMamjB1KOQDgBSJyasf5ikBCQDpmg91iHQDwfBE5fcJZwiEhIBNmhN3zOwDgSBE5I1E5FBICkpgVDsvjAIAjRGTFlGphkBCQKTPD4ekOAHiuiJyZrrDVyBBICEim7FBmMgcAPEdEVk42amzv7JAQkLGes0NuBwAcLiKrcuu63ktU9fhc2gQkl5PU6eQAgMNE5KxOnSfvlBUOm56ATJ4Ejkh0AMByEVmdOHzcsOxwEJBxlvP/Z3MAwKEisiab4NZCJ6jqcRHarCARrlJzKwcAHCIi5wTZEgYHK0hQxij7fwcAHCwia4M8OVFV7X2RsMYKEmYthQEcJCLnBjkRDgcrSFDmKCsC4EARWRfkRRE4CEhQ9lqXBXCAiJwX5MNJqmpvGhZpvMUqYnM7kwDYX0TOD1pxUThYQYKy2KosgP1E5IKg9Z+sqvYabtHGClLU7uFOBmBfEVkftMKZwMEKEpTN1mQB7CMiG4LWPTM4CEhQRluSBbC3iGwMWvMpqnpMkHYnWd5idbKJnRZyAMBeIrIpyJ2Zw8EKEpTZFmQB7Ckim4PWeqqq2tE/M2+sIDNPQX0BANhDRC4Oirw3cLCCBGV4yLIAdheRLUFr7BUcBCQoy0OVBWCHSF8atL7TVNUOjetV4y1Wr9LR32AAPFlELguKsJdwsIIEZXtosgB2E5FXBa3rdFW1ExV72VhBepmW/gQFYFcRuTzo9exew8EK0p/rsJeRANjFK8eVAwI8Q1WPCtDNKskKktXO4YgBeKLDcZWAVVUBBytIQOaHIAngCX5btU3AeqqBg4AEZL92SQA7e+XYNmAtL1VVO8W9msZbrGpSFR8ogMd55bhawGzVwcEKEnAV1CoJ4LFeOa4RsIYVqmqfOKiusYJUl7L8AQPYyeHYLr+6VAsHK0jA1VCbJIBH+23VNQNirxoOAhJwRdQkCWBHrxzXDoj7TFV9XoBuUUneYhW1uz+TAXiUw3GdgKgGAQcrSMCVUYMkgEf6bdV1A+Jdqar2WbVBtOIVBMAOqmpfAmKbgQMAHuGV43oB0w8KjuIVBIB9+ce2TT9FVb8UkCBKLuEAgId55bh+gFGDg6MoIA7H6BsOXxWRZYQk4DJdRBLAQ71y3DBg1pepqn2Qc3CtyC3WPDhGJhokVkm+ODhXe7YgAA9xOG4UENpg4ShSQRaBY5SnrzkkXwhIHCXlilPWH+S3VTcOMGSVqtrXagfbQivIGDhGpn7dIfn8YF2e0cIAPNArx00DQhg8HKEVpCMco7x9wyH5XEAim5QE8ACH42YBBjQBRxggE8Ixyt83HZLPBiS0KUkA9/fbqpsHLPwsVX12gG4vJbPfYiXCMTLnWw7JZ3rpVgVBAbifV45bBITbFBzZK8iUcIzy+W2H5NMBCR60JID7eOW4ZcBCV6vq4QG6vZbMVkEywTEy6zv+nISQdLx8ANzbK8etOw6ZpFuTcGSrIJnhmAuJPSf51CSZbLEvgHs5HLcJWH+zcGQBBMD2fuLeDgHJ+a7fbn0yQHsQkgDu4bdVtw1Y0NmqeliAbjWSWW6xANzJIblrwMq/55B8IkC7akkAd/fKcfuAhTQPR5YKMkoMgDs6JHcLSNb3HZKPB2hXKQnAfLbjQO8QsIA1qro8QLc6ySwVZA4kt3NI7hngxA8cko8FaFclCcAqtR0Hav8o5W6EY46jWQExXQD2h6KdAm6/quRuP3RIPppbuBY9AHfxymG3tbkb4ZjnaHZAHJJbOST3zZ1BEfmRQ/KRAO1eS/oPIlY57hwQ6Dmq+qwA3aolQwBxSOxJrlUS2/aQu/3Yn5M0AwkAg8L+5oj4tZBwLHKFhgHikNheIIPENs7lbgaJPSf5cG7hvun5r4QGh91e5W4vV9VDc4sORS8UEIfEtlobJPZeQu72E4fkQ7mF+6Lnvw7abVXET+iEY0yiwwFxSOxlHfu2nb32mbv91CH5YG7hWesBsJ9wrXJE/HS+VlUPmfUa+z5/EUAckht4JXl4gCk/c0g+EKA9E0kA9pO5VQ57GJi7EY6OjhYDxCGxo2bsdsvOZcrdfu6QvD+3cGk9ALZtxCpHxPMkwjFBQosC4pDYYWUGiZ3sl7v9wiF5X27hUnr+HMngsA2Iudu5qvrM3KJD1isOiENiZ8EaJHZwcu72S4fkvbmFo/UA2PMju62KeMhKOBISOBNAHBI7Tdz+cLfvUuRuv3JI3pNbOEoPgL3kZJUj4uHqOlU9OCr2IevODBCHxD7WYpA8PsDkaiABYA9VDQ57XTZ3IxxTODpTQBwS+9yXQWIfjszdfu2V5N25hXPpAbCHqXZbFbHjgHBMmaiZA+KQXNUhsU8P526/cUjelVt4Wj0AdiSPVY6InQavUNWDpo2x9fG9AMQhse9xWyXZNSApv3VI3hmgnSQJ4CZeOexwt9yNcGRytDeAOCRXckh2y7S+uTK/c0jeEaA9kSQA21lglePBEw3s1vk8VT2wW1f2GudArwAZBQvgEruYxwWf8P9/75C8PWFsliEA7ABpg8MOlM7dCEdmR3sJiFeTi0Vkj8zrNbk/OCRvC9BeUhKAbbexP8gj9qQRjoCE9hYQh2SziOwZsO4/OiRvDdBeUBKAfbTGKkfEXrTzVfUZpdbS0jy9BsQh2Sgiewck5U/+0lU4JABsD5rBYZ8/y90IR25H5+j1HhCHZIOI7BPgg0FiL129JUD7CkkAtvfMbqsiNmheoKoHRMVOXZEqAPEL7QIR2S8gaX92SN6cWxuAfWLZKkfExkzCkTthC+hVA4hDcp6IRPyL+ReH5E25PAdwLa8cO+bSnKPzSlXdP0CXkvMcqAoQh2SdiET8zv9Xh+SN014lAGwjplWOx0yrtcB4whFg6mKS1QHikKwVkYjdqX9zSN6QmgMA2zkcO6VqLDGOcASYupRklYA4JOeISMQ71X93SF4/aS4AXN1vqyK28K9X1Yi/wSZdZlP9qwXEITlbRCIOO/uHQ/K6rlcDANuVbLdVEVv3CUfXRGTuVzUgDskqEYn48tE//TnJWEgAbOtw7Jw5Pya3QVWfHqBLyQ4OVA+IQ7JSRCK+122Q2HOS1y7mJYBt/LYq4n0WwtHhIo7sMghAHJIVInJEgFn/ckheM18bgG3Rt9uqiPdYCEdAMieVHAwgDskZInLkpCZ06P9vh+TVo74AbGu+PSHfpcP4SbtcqKr7TjqI/fM7MChAHJLTROSo/FbJfxySywGYb1Y5nhQwD+EIMDVVcnCAOCSniMjRqaYsMQ7+nsoyEYl4qWujqkbsOQuwog3JQQLikJwkIsdUlEbC0cNkDRYQh+QEETm2h77PD4lw9DRJgwbEITlORI7vqf8W1iZVfVqP42s6tMED4pBYFbFq0rdGOPqWkXnxNAGIQ2J/j9jfJX1pm1U14k3JvqxvEHE0A4hDYr9s2S9cs26EY9YZ6Dh/U4A4JPaMxJ6VzKpdpKp7zWpyzjuZA80B4pDY03Z76l66EY7Sjk85X5OAOCS2b8v2b5VqhKOU0xnnaRYQh8R2ANtO4Oh2sapGnO8VHXfz+k0D4pDYuyT2TklUIxxRzhbQbR4Qh2S5iKwO8HuLqj41QJeShRwgIG40gENFZE1G3wlHRjNnJUVA5jgPwE5KsRNTpm2EY1oHezKegMxLBAA7c8vO3kptl6hqxKn0qfFw3BQOEJAFzANgpzfaKY6TNsIxqWM9709AFkkQADuDys4D7touVdXdu3ZmvzocICBL5AmAvRe+vkMqCUcHk2rsQkDGZA2Avatx4RLdCEeNV37HmAlIB6MA2ObCTQt0vUxVI76l2CEqdinhAAHp6DIAe+B30ZzuhKOjdzV3IyATZA+A/RG+xY78UVU72YRt4A4QkAkTDGCZql424TB2r9QBAlJp4hh2GQcISBmfOUulDhCQShPHsMs4QEDK+MxZKnWAgFSaOIZdxgECUsZnzlKpAwSk0sQx7DIOEJAyPnOWSh0gIJUmjmGXcYCAlPGZs1TqAAGpNHEMu4wDBKSMz5ylUgcISKWJY9hlHCAgZXzmLJU6QEAqTRzDLuMAASnjM2ep1AECUmniGHYZBwhIGZ85S6UOEJBKE8ewyzhAQMr4zFkqdYCAVJo4hl3GAQJSxmfOUqkDBKTSxDHsMg4QkDI+c5ZKHSAglSaOYZdxgICU8ZmzVOoAAak0cQy7jAMEpIzPnKVSBwhIpYlj2GUcICBlfOYslTpAQCpNHMMu4wABKeMzZ6nUAQJSaeIYdhkHCEgZnzlLpQ4QkEoTx7DLOEBAyvjMWSp1gIBUmjiGXcYBAlLGZ85SqQMEpNLEMewyDhCQMj5zlkodICCVJo5hl3GAgJTxmbNU6sB/AZSxcPZkHRLuAAAAAElFTkSuQmCC"},7550:function(e,t,i){"use strict";var a=i("cf12"),o=i.n(a);o.a},"75be":function(e,t,i){},"760a":function(e,t,i){"use strict";var a=i("2e79"),o=i.n(a);o.a},"76f4":function(e,t,i){},7843:function(e,t,i){"use strict";var a=i("132a"),o=i.n(a);o.a},"78de":function(e,t,i){e.exports=i.p+"static/img/123.80dc059e.png"},7904:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAcCAYAAACdz7SqAAAAAXNSR0IArs4c6QAAASpJREFUSEvtlq1OA0EUhb87uwl/giYEBAnBlGCxQLBoHI8BpoiqDQJIIH2DWkjYN6hpXwDTEDwCheuf2Z25ZItCNJnZBAwz+mTOzDfnzr1C4Drs6IqMaGM4F+Vi+5VenosN2UZCxJX25EY3XUkfoalKdzLiavgg05B96pkWDFRoGqW7OqbVi6YLmEe8C8M4T28Mkmex/qMgHWW6JYb9ooAkwarBJgZrS1xqsC7B2gKXJtgSXCqsq+MR2AWereNWYOZDdgazYcanHF/rO8IOSjBqH6MfGsGq0v5TUwUncCcHmTaWoeF7ajVsJPBUB2+huJc3PoKRxs/B93kqXcQbu8z3NBj7qWfd1CuZkr7CHtWwPab168P26b2uTaZ0RDhzcLmk5INMSs9LzmVfE/RA9aD1qhUAAAAASUVORK5CYII="},7985:function(e,t,i){"use strict";var a=i("76f4"),o=i.n(a);o.a},"7b46":function(e,t,i){"use strict";var a=i("9de0"),o=i.n(a);o.a},"7d38":function(e,t,i){"use strict";var a=i("f0f0"),o=i.n(a);o.a},"7f5f":function(e,t,i){e.exports=i.p+"static/img/indextwo.00e85785.png"},"86cb":function(e,t,i){"use strict";var a,o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page addr"},[i("div",{staticClass:"sjk-top"},[e._v("\n\t\t地址编辑\n\t\t"),i("i",{staticClass:"sjky close-icon fhIcon",on:{click:function(t){return t.stopPropagation(),e.closeFun(t)}}},[e._v("")])]),e.ws?i("van-form",{on:{submit:e.adSubmit}},[i("van-field",{attrs:{name:"用户名",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e.hezuo?i("van-field",{attrs:{type:"tel",name:"电话号码",label:"电话号码",placeholder:"请填写电话号码",rules:[{required:!0,message:"请填写电话号码"}]},model:{value:e.tel,callback:function(t){e.tel=t},expression:"tel"}}):e._e(),i("div",{staticStyle:{margin:"16px"}},[i("van-button",{staticClass:"submit greenSubmit",attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("\n\t\t\t提交\n\t\t  ")])],1)],1):e._e(),e.ws?e._e():i("van-form",{on:{submit:e.adSubmit}},[i("van-field",{attrs:{name:"用户名",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),i("van-field",{attrs:{type:"tel",name:"电话号码",label:"电话号码",placeholder:"请填写电话号码",rules:[{required:!0,message:"请填写电话号码"}]},model:{value:e.tel,callback:function(t){e.tel=t},expression:"tel"}}),i("van-field",{attrs:{readonly:"",clickable:"",name:"area",value:e.value,label:"地区选择",placeholder:"点击选择省市区"},on:{click:function(t){e.showArea=!0}}}),i("van-popup",{attrs:{position:"bottom"},model:{value:e.showArea,callback:function(t){e.showArea=t},expression:"showArea"}},[i("van-area",{attrs:{"area-list":e.areaList},on:{confirm:e.onConfirm,cancel:function(t){e.showArea=!1}}})],1),i("van-field",{attrs:{name:"详细地址",label:"详细地址",placeholder:"请输入详细地址",rules:[{required:!0,message:"请输入详细地址"}]},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}}),i("van-field",{attrs:{type:"number",name:"数量",label:"数量",placeholder:"请输入数量",rules:[{required:!0,message:"请输入数量"}]},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}}),i("div",{staticStyle:{margin:"16px"}},[i("van-button",{staticClass:"submit greenSubmit",attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("\n\t\t        提交\n\t\t      ")])],1)],1)],1)},s=[],n=i("bd86"),r=(i("e17f"),i("2241")),l=(i("be7f"),i("565f")),d=(i("8a58"),i("e41f")),c=(i("db2c"),i("1125")),h=(i("38d5"),i("772a")),g=(i("7f7f"),i("66b9"),i("b650")),m=(i("5841"),i("a244"),i("5c35")),p={data:function(){return{value:"",showArea:!1,areaList:{},username:"",number:"",tel:"",wsid:"",ws:!1,hezuo:!1,address:""}},props:["pageKey"],created:function(){this.wsid=localStorage.getItem(this.pageKey.wsid);var e=localStorage.getItem(this.pageKey.mshopSign);e&&1==e&&(this.hezuo=!0),-1==this.wsid?this.ws=!0:this.hezuo?this.ws=!0:this.ws=!1,this.areaList=m["a"]},components:(a={},Object(n["a"])(a,g["a"].name,g["a"]),Object(n["a"])(a,h["a"].name,h["a"]),Object(n["a"])(a,c["a"].name,c["a"]),Object(n["a"])(a,d["a"].name,d["a"]),Object(n["a"])(a,l["a"].name,l["a"]),Object(n["a"])(a,r["a"].name,r["a"]),a),methods:{onConfirm:function(e){this.value=e.map(function(e){return e.name}).join("-"),this.showArea=!1},adSubmit:function(){var e={};e.userwangwang=this.username,e.telno=this.tel,e.num=this.number,e.address=this.value+"-"+this.address;var t=this;r["a"].alert({title:"注意",message:"提交后不可修改！"}).then(function(){t.$emit("addinfo1",e)})},closeFun:function(){this.$emit("closep","")}}},u=p,f=(i("760a"),i("2877")),y=Object(f["a"])(u,o,s,!1,null,null,null);t["a"]=y.exports},8793:function(e,t,i){e.exports=i.p+"static/img/taili.e49aca29.png"},"87ab":function(module,__webpack_exports__,__webpack_require__){"use strict";var D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("7618"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("55dd"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("7514"),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__),weui_min_css__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("3320"),weui_min_css__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(weui_min_css__WEBPACK_IMPORTED_MODULE_9__),jquery_weui_min_css__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("0ddc"),jquery_weui_min_css__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(jquery_weui_min_css__WEBPACK_IMPORTED_MODULE_10__),_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("1180"),_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_11__),mobileResponsive750__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("5031"),tab__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("6b92"),_baseUrl__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("5841"),vuex__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("2f62"),_utils_testMobileAndBrowser__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("23ed"),_utils_timeUtil__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("054f"),_public_img_time_svg__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("6b12"),_public_img_time_svg__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_public_img_time_svg__WEBPACK_IMPORTED_MODULE_18__),_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("103a"),_api_getJson__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("4cbb"),_storagekey__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("b60d"),isError=!1,orderNo="",requireWidth=800,requireHeight=800;$(function(){$(".proTit span").eq(0).addClass("on"),$(".proTit span").on("click",function(){$(this).addClass("on").siblings().removeClass("on")})}),__webpack_exports__["a"]={name:"newmtemplate",data:function(){return{isShowguid:!1,errorInfo:"",orderInfos:{},changeSelectDate:!1,changeDateShow:!1,chooseDateNow:"",chooseDateMiddleNow:"",showNum:!0,showReload:!1,checkReload:!1,productno:"",orderNo:"",memberid:"",doubble:!1,pageKey:null,normalKey:null,productId:"",goodsid:"",copyUrl:_baseUrl__WEBPACK_IMPORTED_MODULE_14__["a"].copyUrl,imageArray:[],is_weixn:!1,is_alipay:!1,is_byte:!1,browser:{},templateId:0,dataArr:[],templates:[],templatesAll:[],decoratePageNum:1,totalNumberOfPages:"",startx:"",starty:"",direction:"",checkTop:"",albumid:"",items:[],price:"",history:[],page:{},pageList:[],startDate:"",endDate:"",flagURL:"",id:"",spmc:"",num:"",returnURL:"",oid:"",token:"",maxnum:"",minnum:"",isShowLoading:!1,iscaiyun:"",wenanText:"",previewImageUrl:"",previewImageUrlArr:[],prevImage:!1,nextImage:!1,imageIndex:0,isvideo:!1,pnum:"",tpnum:"",content:"",patternid:"",sort:"new",changeModelAll:!1,isTeamBook:!1,templateid:"",uid:null,source:"",wsid:"",avatarurl:"",totalStyleNum:"",nickname:"",isTS:!1,mobilestyleid:"",styleNum:1,ytid:"",appFlag:"",ycoverbacknum:"",fxOrderNo:null,value:"",shopname:"",firstModelShow:0,draftsNum:0,isPart:!1,isSimple:!1,hasDraft:!1,hasHistoryBack_tt:!1,thumbnailToken:""}},created:function(){console.info("url===========",window.location.href),document.body.style.position="absolute";var t=localStorage.getItem("isAlipay"),i=(localStorage.getItem("isByte"),navigator.userAgent.toLowerCase());("undefined"!=typeof my||"alipayclient"==i.match(/AlipayClient/i)||t)&&(this.is_alipay=!0),"toutiaomicroapp"==i.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0),console.info("this.is_alipay===="),console.info(this.is_alipay),this.browser={versions:function(){var e=navigator.userAgent;navigator.appVersion;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile/i)||!!e.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1||e.indexOf("Mac")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};i=navigator.userAgent.toLowerCase();this.browser.versions.android&&"micromessenger"==i.match(/MicroMessenger/i)&&(this.is_weixn=!0);i=navigator.userAgent.toLowerCase(),t=localStorage.getItem("isAlipay");this.is_alipay&&loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}}),this.hasDraft=this.$route.query.hasDraft,this.normalKey=_storagekey__WEBPACK_IMPORTED_MODULE_21__["f"],this.history=this.$route.query.history,this.history?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_21__["c"]:this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_21__["a"],this.token=this.$route.query.token||localStorage.getItem(this.pageKey.token),this.iscaiyun=this.$route.query.iscaiyun;var a=this.$route.query.source;this.checkUid(),localStorage.removeItem(this.pageKey.numIndex),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["a"].isxcx);var o=this;if(this.changeModelAll=this.$route.query.changeModelAll,this.uid=this.$route.query.uid,this.changeModelAll||(localStorage.setItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["f"].mobileUrl,window.location.href),this.token&&"null"!=this.token&&this.token,"third"==localStorage.getItem(this.pageKey.source)||localStorage.removeItem(this.pageKey.source)),this.wsid=this.$route.query.wsid,-1==this.wsid){for(var s in this.pageKey)localStorage.removeItem(this.pageKey[s]);for(var s in _storagekey__WEBPACK_IMPORTED_MODULE_21__["f"])localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["f"][s])}var n=this.$route.query.avatarurl,r=this.$route.query.nickname,l=this.$route.query.albumid,d=this.$route.query.price,c=this.$route.query.tid,h=this.$route.query.coverbacknum;if(this.isTS=this.$route.query.isTS,l&&(this.albumid=l,this.avatarurl=n,this.nickname=r,this.ytid=c,this.price=d,this.ycoverbacknum=h),localStorage.removeItem(o.pageKey.rk),-1!=window.location.href.indexOf("zheliyin.com")&&!a){a="fxxt";try{window._czc&&window._czc.push(["_trackEvent","剪影","分销模板列表页",a])}catch(e){console.log(e)}}if(this.source=a,"fxxt"==a){var g=this.$route.query.redirecType;this.fxOrderNo=this.$route.query.fxOrderNo,localStorage.setItem(this.pageKey.source,a),localStorage.setItem(this.pageKey.redirecType,g)}localStorage.setItem(this.pageKey.orgTime,(new Date).getTime()),this.templateid=this.$route.query.templateid,this.oid=localStorage.getItem(this.pageKey.id),this.returnURL=decodeURI(this.$route.query.returnURL),this.num=this.$route.query.num,this.spmc=decodeURI(this.$route.query.spmc),this.id=this.$route.query.id,this.flagURL=this.$route.query.flagURL,"wechat"==this.flagURL&&(this.source="wechat",localStorage.setItem(this.pageKey.source,this.source),localStorage.setItem(this.pageKey.returnURL,this.returnURL)),"guochao"==a&&(this.source="guochao",localStorage.setItem(this.pageKey.source,this.source)),"wechat"==this.source||this.checkMobile(),this.productno=this.$route.query.sku||localStorage.getItem(this.pageKey.sku),null!=this.productno&&""!=this.productno&&"string"==typeof this.productno&&(this.productno=this.productno.trim()),this.memberid=decodeURI(this.$route.query.memberid),this.orderNo=this.$route.query.orderNo;var m=localStorage.getItem(this.pageKey.detailJson);if(m&&(this.orderInfos=JSON.parse(m).oderInfo),null==this.token||void 0==this.token||""==this.token||"undefined"==this.token)this.wsid&&""!=this.wsid?(this.shopname=this.$route.query.shopname,null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.getTemplateList()):(this.token=localStorage.getItem(this.pageKey.token)||this.$route.query.token,this.productno=this.orderInfos.productNo,this.templateList(this.productno,this.token));else{a=localStorage.getItem(this.pageKey.source);if(this.wsid&&""!=this.wsid?(this.productno=this.$route.query.sku,null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.getTemplateList()):(this.productno||(this.productno=this.orderInfos.productNo),this.templateList(this.productno,this.token)),"third"!=a&&!this.changeModelAll){var p=this.orderNo;localStorage.setItem(this.pageKey.token,this.token),localStorage.setItem(this.normalKey.userToken,this.token);var u={goodsname:this.spmc,id:this.id,memberid:this.memberid,num:this.num,orderNo:p,productNo:this.productno,source:this.source,url:window.location.href};this.$store.dispatch("updateOrderInfo",u),localStorage.setItem(this.pageKey.orderInfo,JSON.stringify(u))}this.getTokenDetail(this.token)}console.log("token===========",this.token)},mounted:function(){this.is_byte||history.pushState({state:2},null,window.location.href),this.is_byte||window.addEventListener("popstate",this.returnBack_tt,!1);var e=$("#goTop"),t=document.getElementById("modelPreviewShow");t.addEventListener("touchstart",function(e){this.startx=e.touches[0].pageX,this.starty=e.touches[0].pageY},!1),t.addEventListener("touchmove",function(e){e.changedTouches[0].pageX,e.changedTouches[0].pageY},!1);var i=this;i.imageIndex=0,t.addEventListener("touchend",function(e){var a,o;t.scrollTop,a=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY;var s=i.getDirection(this.startx,this.starty,a,o);if(3==s)if(i.imageIndex>=i.previewImageUrlArr.length-1){try{if(window._jylog){var n=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","已经是最后一页！"+res,JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert("已经是最后一页！"),i.imageIndex=i.previewImageUrlArr.length-1}else i.findImageByIndex(1);if(4==s)if(i.imageIndex<=0){try{if(window._jylog){n=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","当前是第一页！"+res,JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert("当前是第一页！"),i.imageIndex=0}else i.findImageByIndex(-1)},!1),$(window).scroll(function(){var t=$(window).scrollTop();t>150?e.css({opacity:1,visibility:"visible"}):e.css({opacity:0,visibility:"hidden"})});var a=new Date,o="",s=a.getMonth();s<6&&(o=a.getFullYear()),s>=6&&s<=11&&(o=a.getFullYear()),this.dataArr=[o+"年1月",o+"年2月",o+"年3月",o+"年4月",o+"年5月",o+"年6月",o+"年7月",o+"年8月",o+"年9月",o+"年10月",o+"年11月",o+"年12月",o+1+"年1月"],this.startDate=this.dataArr[0],this.endDate=this.dataArr[this.dataArr.length-1];var n=$("#temp_hist").find(".tab-link"),r=$("#temp_hist_cont").find(".tab-cont");r.hide().eq(0).show(),n.removeClass("active").eq(0).addClass("active"),n.click(function(){if(!$(this).hasClass("active"))if($(this).addClass("active").siblings().removeClass("active"),r.hide().eq($(this).index()).show(),0==$(this).index()){if(this.templates.length>0)return;this.queryTemplate(0)}else{var e=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));this.memberid=e.memberid}})},beforeDestroy:function(){window.removeEventListener("popstate",this.returnBack_tt,!1)},methods:{returnBack_tt:function(){if(this.is_byte){if(this.hasHistoryBack_tt)return;tt.miniProgram.navigateBack({delta:1})}else 0==this.hasDraft||"false"==this.hasDraft?"fxxt"==this.source||"wechat"==this.source||"thrid"==this.source?history.go(-1):this.is_alipay?my.navigateBack({delta:1}):history.go(-2):history.go(-1)},selectAll:function(){if(""==this.value){try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","搜索",this.value,JSON.parse(t).orderNo])}}catch(e){console.log(e)}this.loadData(0,0),$(".proTit").find("span").eq(0).html("最新")}},bodyScroll:function(e){e.preventDefault()},templateList:function(t,i){var a=this,o=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["t"])(t,i,o.decoratePageNum,o.mobilestyleid,!1,o.sort).then(function(t){if(t.result){if(o.items=t.data.ptList,o.thumbnailToken=t.data.base64Token,o.wsid&&""!=o.wsid&&o.items.length>0){var i=JSON.parse(localStorage.getItem(o.pageKey.orderInfo));i.goodsname=t.data.tlist[0].name,o.$store.dispatch("updateOrderInfo",i),localStorage.setItem(a.pageKey.orderInfo,JSON.stringify(i))}for(var s=0;s<t.data.tlist.length;s++)0==s&&""==t.data.tlist[s].previewimage&&(t.data.tlist[s].previewimage="MXYZ-0CCC71D78F0A42A7A65A452A7B0F5A33.png"),"woodcut"==t.data.tlist[s].diytype&&(t.data.tlist[s].name.indexOf("横款")>-1?t.data.tlist[s].name="横款-"+t.data.tlist[s].name:t.data.tlist[s].name="竖款-"+t.data.tlist[s].name);if(1==o.decoratePageNum&&(o.templates=[],o.templatesAll=[]),t.data.tlist.forEach(function(e){o.ytid&&""!=o.ytid?o.ytid==e.id&&(o.templates.push(e),o.templatesAll.push(e)):(o.templates.push(e),o.templatesAll.push(e))}),0==o.templatesAll.length){try{if(window._jylog){var n=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","没有相关模板",JSON.parse(n).orderNo])}}catch(e){console.log(e)}return void layer.alert("没有相关模板！")}var r="";if(t.data.doubleface&&(r=t.data.doubleface),"双页模式"==t.data.tlist[0].designmodel&&"year_calendar"==t.data.tlist[0].diytype?1!=r&&(a.doubble=!0,localStorage.setItem(a.pageKey.designmodel,"pair")):localStorage.removeItem(a.pageKey.designmodel),o.productId=t.data.productid,o.goodsid=t.data.goodsids,o.motherid=t.data.motherid,o.pnum=t.data.pnum,o.tpnum=t.data.tpnum,o.minnum=t.data.minnum,o.maxnum=t.data.maxnum,o.totalNumberOfPages=t.data.totalNumberOfPages,o.videoupload=t.data.videoupload,o.videonum=t.data.videonum,localStorage.setItem(o.pageKey.pnum,t.data.pnum),localStorage.setItem(o.pageKey.goodsid,o.goodsid),localStorage.setItem(o.pageKey.motherid,o.motherid),localStorage.setItem(o.pageKey.productId,o.productId),localStorage.setItem(o.pageKey.minnum,o.minnum),localStorage.setItem(o.pageKey.maxnum,o.maxnum),localStorage.setItem(o.pageKey.isVideo,o.videoupload),localStorage.setItem(o.pageKey.videonum,o.videonum),localStorage.setItem(o.pageKey.thumbnailToken,o.thumbnailToken),localStorage.setItem(o.pageKey.isTeamBook,t.data.isTeamBook),localStorage.setItem(o.pageKey.isPart,!1),localStorage.setItem(o.pageKey.rk,t.data.producttype),localStorage.setItem(o.pageKey.diytype,o.templates[0].diytype),"year_calendar"==o.templates[0].diytype){var l=new Date,d=(l.getFullYear(),l.getMonth()),c=0;d<6&&(c=12),d>=6&&d<=10&&(c=d,1!=o.decoratePageNum||o.changeModelAll||($(".mask").show(),$(".selectDate").show())),11==d&&(c=12,1!=o.decoratePageNum||o.changeModelAll||($(".mask").show(),$(".selectDate").show()));var h=localStorage.getItem(o.pageKey.numIndex);h||o.selectChange(c)}else localStorage.removeItem(o.pageKey.numIndex);o.isTeamBook=t.data.isTeamBook,o.isTeamBook&&(localStorage.setItem(o.pageKey.source,"isTeamBook"),document.title="如琢毕业册"),o.videoupload&&(o.isVideo=o.videoupload),o.isWxEnv(o.isVideo);for(s=0;s<o.templates.length;s++)""!=o.templates[s].previewimage&&-1==o.templates[s].previewimage.indexOf("http")&&(o.templates[s].previewimage=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__["d"])(o.templates[s].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__["h"])(o.templates[s].previewimage,{},o.pageKey))}else{try{if(window._jylog){n=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告",t.msg,JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert(t.msg)}o.changeModelAll?o.logFrom("换模板"):o.logFrom("sku")})},getMore:function(t,i,a,o,s,n){var r=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["u"])(this.token,this.productno,a,o,s,this.value,!1,n).then(function(t){if(r.totalStyleNum=t.data.totalNumberOfPages,1==r.styleNum&&(r.templates=[],r.templatesAll=[]),t.data.tlist.forEach(function(e){""==e.previewimage&&(e.previewimage="MXYZ-0CCC71D78F0A42A7A65A452A7B0F5A33.png"),r.ytid?r.ytid==e.id&&(r.templates.push(e),r.templatesAll.push(e)):(r.templates.push(e),r.templatesAll.push(e))}),0!=r.templatesAll.length)for(var i=0;i<r.templates.length;i++)""!=r.templates[i].previewimage&&-1==r.templates[i].previewimage.indexOf("http")&&(r.templates[i].previewimage=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__["d"])(r.templates[i].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__["h"])(r.templates[i].previewimage,{},r.pageKey));else{if(r.ytid){try{if(window._jylog){var a=localStorage.getItem(r.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","已选定模板，不可替换！",JSON.parse(a).orderNo])}}catch(e){console.log(e)}return void layer.alert("已选定模板，不可替换！")}try{if(window._jylog){a=localStorage.getItem(r.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","没有相关模板！",JSON.parse(a).orderNo])}}catch(e){console.log(e)}layer.alert("没有相关模板！")}})},getStartDate:function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1;this.startDate=t+"年"+i+"月",i+11>12?(i--,t++):i+=11,this.endDate=t+"年"+i+"月"},setEndDate:function(e){var t=parseInt(e.substr(0,e.indexOf("年"))),i=parseInt(e.substr(parseInt(e.indexOf("年"))+1,e.indexOf("月")));i+11>12?(i--,t++):i+=11,this.endDate=t+"年"+i+"月"},loadData:function(e,t){this.mobilestyleid=0==e?"":e,this.sort=0==t?"new":1==t?"bouthsortnum":"",this.getMore(this.motherid,this.goodsid,this.tpnum,this.styleNum,this.mobilestyleid,this.sort);var i=$(".proTit").find("span").eq(t);i.hasClass("on")||i.addClass("on").siblings().removeClass("on")},design:function(t){var i=this,a=this;document.body.removeEventListener("touchmove",this.bodyScroll,!1),this.isShowLoading=!0,this.wenanText="努力跳转中";this.is_weixn;var o=this.is_byte,s=!1,n=JSON.parse(localStorage.getItem(this.pageKey.pnum)),r=(JSON.parse(localStorage.getItem(this.pageKey.uid)),localStorage.getItem(this.pageKey.numIndex));if(1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(s=!0),o)return this.isShowLoading=!1,void tt.miniProgram.navigateTo({url:"/pages/upload-page/upload-page?token="+a.token+"&sku="+this.productno+"&minnum="+this.minnum+"&maxnum="+this.maxnum+"&gid="+localStorage.getItem(this.pageKey.goodsid)+"&pid="+localStorage.getItem(this.pageKey.productId)+"&id="+this.queryTempId+(null==n||void 0==n||""==n?"":"&p="+n)+(null==r||void 0==r||""==r?"":"&numIndex="+r)+(null==s||void 0==s||""==s?"":"&isEditCover="+s)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+"&isContinueDesign=false&history=false&isPart=false&isfirst=true&hassort=0",success:function(e){this.isShowLoading=!1},fail:function(e){console.log("navigateTo调用失败"),this.isShowLoading=!0,this.wenanText="系统异常"}});var l=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)),d=l.goodsname;-1!=d.indexOf("竹木纹")&&localStorage.setItem(this.pageKey.cal_size,"竹木纹"),this.diytype;a=this;if(!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook)this.is_weixn?this.gofxUpload(this.queryTempId,this.minnum,this.maxnum):this.goUpload(this.queryTempId,this.minnum,this.maxnum);else{var c={};c.tid=this.queryTempId,c.albumid=this.albumid,c.token=this.token,c.gid=localStorage.getItem(this.pageKey.goodsid),c.pid=localStorage.getItem(this.pageKey.productId),c.pnum=localStorage.getItem(this.pageKey.pnum),c.edittype=1,c.mid=localStorage.getItem(this.pageKey.motherid),c.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,c.pageKey=this.pageKey,c.isTeamBook=this.isTeamBook,c.isVideo=this.videoupload,c.price=this.price,!c.isTeamBook||1!=c.isTeamBook&&"true"!=c.isTeamBook||(c.avatarurl=this.avatarurl,c.nickname=this.nickname);a=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["J"])(c).then(function(t){var a=null;if(a="string"==typeof t.data?JSON.parse(t.data):t.data,1==t.result)localStorage.setItem(i.pageKey.uid,a.uid),i.uid=a.uid,a.hasCoverABack?(localStorage.setItem(i.pageKey.minnum,a.coverBackPhotoNum),localStorage.setItem(i.pageKey.maxnum,a.coverBackPhotoNum),i.is_weixn?i.gofxUpload(i.queryTempId,i.minnum,i.maxnum):i.goUpload(i.queryTempId,i.minnum,i.maxnum)):i.goLandingPage(a.uid);else if(null!=a)localStorage.setItem(i.pageKey.uid,a.uid),i.uid=a.uid,a.coverBackPhotoNum&&a.coverBackPhotoNum>0?(localStorage.setItem(i.pageKey.minnum,a.coverBackPhotoNum),localStorage.setItem(i.pageKey.maxnum,a.coverBackPhotoNum),i.is_weixn?i.gofxUpload(i.queryTempId,i.minnum,i.maxnum):i.goUpload(i.queryTempId,i.minnum,i.maxnum)):i.goLandingPage(a.uid);else{try{if(window._jylog){var o=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","相册错误！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}layer.alert("相册错误！")}i.isShowLoading=!1,i.wenanText=""}).catch(function(t){try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","加载出现错误！",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("加载出现错误！"),a.isShowLoading=!1,a.wenanText=""})}},showPartner:function(){document.body.removeEventListener("touchmove",this.bodyScroll,!1);var e="previewModel?id="+this.queryTempId+"&sku="+this.productno,t=encodeURIComponent(this.previewImageUrlArr[0]);wx.miniProgram.navigateTo({url:"/pages/share/share?uid="+encodeURIComponent(e)+"&pages=pages/web/web&image="+t})},copyText:function(e,t){var i=this;this.$copyText(e).then(function(e){console.log(e),$.toast(t,"text")},function(e){i.$toast("复制失败","text")})},getApiSignPost:function(e){function t(t,i,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t,i,a){var o=this,s={};s.url=i,s.source=t,getApiSignPost(s).then(function(t){var i=t.userData;wx.config({debug:!1,appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonceStr,signature:i.signature,jsApiList:["onMenuShareAppMessage","updateAppMessageShareData"]}),wx.error(function(t){console.log(t);try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","获取签名失败",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("获取签名失败！")}),wx.ready(function(){wx.onMenuShareAppMessage({title:"分享模板",desc:"我们的梦想！在飞！在翱翔！",link:window.location.href.split("#")[0],imgUrl:"",success:function(){layer.alert("success!")},cancel:function(){layer.alert("cancel!")}})})}).catch(function(t){console.log("catch data::",t);try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","调用上传方法失败！"+t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("调用上传方法失败！")})}),serachMeth:function(){try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","搜索",this.value,JSON.parse(t).orderNo])}}catch(e){console.log(e)}this.styleNum=1,this.templates=[],this.loadData(0,-1),$(".proTit").find("span").eq(0).html("查询"),$(".proTit").find("span").eq(0).addClass("on")},cancelData:function(){this.styleNum=1,this.templates=[],this.value="";try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","搜索",this.value,JSON.parse(t).orderNo])}}catch(e){console.log(e)}this.loadData(0,0),$(".proTit").find("span").eq(0).html("最新")},share:function(e){wx.onMenuShareAppMessage({title:"分享模板",desc:"我们的梦想！在飞！在翱翔！",link:e,imgUrl:"",success:function(){alert("success!")},cancel:function(){alert("cancel!")}})},getDiyDetailInfo:function(e,t,i,a,o){var s=this;getDiyDetail(e,t,i,a,o).then(function(t){console.log(t);var i=t,a=t.detail.pageList,o=a[0].diyDisplayWidth,n=a[0].diyDisplayHeight;o<n?localStorage.setItem(s.pageKey.calendar_hs,"s"):localStorage.setItem(s.pageKey.calendar_hs,"h");var r=t.detail.templateInfo.name,l=r.replace(/[^0-9]/gi,"");"0"==l.substring(l.length-1)?localStorage.setItem(s.pageKey.cal_size,l.substring(l.length-2)):"8"==l.substring(l.length-1)?localStorage.setItem(s.pageKey.cal_size,l.substring(l.length-1)):localStorage.setItem("cal_size",6),-1!=r.indexOf("卡片")?localStorage.setItem(s.pageKey.cal_size,"卡片"):-1!=r.indexOf("竹木纹")&&localStorage.setItem(s.pageKey.cal_size,"竹木纹");var d=t.detail.templateInfo.designModel;$(".mask").hide(),localStorage.setItem(s.pageKey.cal_pageList,JSON.stringify(a)),s.goUpload(e,s.minnum,s.maxnum),localStorage.setItem(s.pageKey.calendar_designModel,d),localStorage.setItem(s.pageKey.cal_detail,JSON.stringify(i.detail))})},confirmBtn:function(){var e=document.getElementById("changeDate").value;0==e&&localStorage.setItem(this.pageKey.numIndex,1),this.chooseDateNow=this.chooseDateMiddleNow,$(".mask").hide(),$(".selectDate").hide(),this.changeSelectDate=!0,this.changeDateShow=!0},cancelBtn:function(){$(".selectDate").hide(),$(".mask").hide(),this.changeSelectDate=!0,this.changeDateShow=!0},cancelTemple:function(){$(".showtemple").hide(),$(".mask").hide()},selectChange:function(t){var i="";t&&""!=t?(i=t,document.getElementById("changeDate")&&(document.getElementById("changeDate").value=t)):document.getElementById("changeDate")&&(i=document.getElementById("changeDate").value);var a=parseInt(i)+1;if(this.doubble?(a=2*parseInt(i)+1,localStorage.setItem(this.pageKey.numIndex,a)):localStorage.setItem(this.pageKey.numIndex,a),this.startDate=this.dataArr[i],""!=this.startDate){var o="",s="",n=this.startDate.substring(0,this.startDate.indexOf("年"))+"",r=this.startDate.substring(this.startDate.indexOf("年")+1,this.startDate.indexOf("月"));s=r<10?"0"+r:r,o=n+s,localStorage.setItem(this.pageKey.dateStr,o)}this.setEndDate(this.startDate),this.chooseDateMiddleNow=this.dataArr[i];try{window._jylog&&window._jylog.push(["按钮点击","模板页","台历选择日期","选择日期==>"+o+",起始页==>"+a,this.orderNo])}catch(e){console.log(e)}},goUpload:function(e,t){var i=this.oid;if(null!=i&&""!=i&&void 0!=i&&"undefined"!=i&&"null"!=i){var a=this.orderNo;"fxxt"==this.source&&(a=this.fxOrderNo),e==JSON.parse(i)&&a==this.orderInfos.orderNo&&this.productno==this.orderInfos.productNo||(localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson)),localStorage.removeItem(this.pageKey.id)}else localStorage.removeItem(this.pageKey.id),localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson);!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||localStorage.setItem(this.pageKey.uid,this.uid);var o=localStorage.getItem(this.pageKey.diytype);"gongge"!=o?1==this.iscaiyun?this.$router.push({name:"upphoto",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.is_alipay?this.$router.push({name:"newalipayupload",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.$router.push({name:"newupload",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.$router.push({name:"gongge",query:{id:e,p:t,isfirst:!0}})},gofxUpload:function(e,t){var i=this.oid;localStorage.setItem(this.pageKey.flagURL,this.flagURL);var a=this.orderNo;if("fxxt"==this.source&&(a=this.fxOrderNo),null!=i&&""!=i&&void 0!=i&&"undefined"!=i&&"null"!=i){a=this.orderNo;"fxxt"==this.source&&(a=this.fxOrderNo),e==JSON.parse(i)&&a==this.orderInfos.orderNo&&this.productno==this.orderInfos.productNo||(localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson)),localStorage.removeItem(this.pageKey.id)}else localStorage.removeItem(this.pageKey.id),localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson);!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||localStorage.setItem(this.pageKey.uid,this.uid),location.href="fxUpload?id="+e+"&p="+t+"&isTeamBook="+this.isTeamBook+"&isfirst="+!0},goLandingPage:function(e){for(var t in this.pageKey)localStorage.removeItem(this.pageKey[t]);wx.miniProgram.reLaunch({url:"/pages/ground/ground?scene="+e})},showtemple:function(t,i,a,o,s,n,r,l){if(localStorage.setItem(this.pageKey.fold,n),"-1"==i){try{if(window._jylog){var d=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","空白模板",i,JSON.parse(d).orderNo])}}catch(e){console.log(e)}return this.queryTempId=i,void this.design()}try{if(window._jylog){d=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","点击预览",i,JSON.parse(d).orderNo])}}catch(e){console.log(e)}var c=this;if("woodcut"==o&&(localStorage.setItem(this.pageKey.motherid,a),localStorage.setItem(this.pageKey.goodsid,r),localStorage.setItem(this.pageKey.productId,productId)),this.changeModelAll){if(document.body.removeEventListener("touchmove",this.bodyScroll,{passive:!1}),this.templateid==i){try{if(window._jylog){d=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","相同模板不能替换"+res,JSON.parse(d).orderNo])}}catch(e){console.log(e)}return void this.$layer.alert("相同模板不能替换！")}layer.confirm("替换模板将重新布局您的设计，是否确认替换？",{btn:["确定","取消"]},function(a){c.templateid==i||localStorage.removeItem(c.pageKey.detailJson);try{if(window._jylog){var o=localStorage.getItem(c.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","模板更换,整套",c.templateid+"->"+i,JSON.parse(o).orderNo])}}catch(e){console.log(e)}c.handleMoreMaxImage();var s=JSON.parse(localStorage.getItem(c.pageKey.pnum)),r=(navigator.userAgent.toLowerCase(),navigator.userAgent),l=!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);l?location.replace("design_new?id="+i+"&p="+s+"&changeModelAll="+c.changeModelAll+(null==c.history||void 0==c.history||""==c.history?"":"&history="+c.history)+(null==c.uid||void 0==c.uid||""==c.uid?"":"&uid="+c.uid)+"&hassort=0&fromAdmin="+c.$route.query.fromAdmin+"&fromAlipyShopCart="+c.$route.query.fromAlipyShopCart):c.$router.replace({name:"design_new",query:{id:i,p:s,changeModelAll:c.changeModelAll,history:c.history,uid:c.uid,hassort:"0",fromAdmin:c.$route.query.fromAdmin,fromAlipyShopCart:c.$route.query.fromAlipyShopCart}}),c.handleGoupload(i,t,n),layer.close(a)},function(){})}else c.handleGoupload(i,t,n)},closeguid:function(){this.isShowguid=!1},handleGoupload:function(e,t,i){var a=localStorage.getItem(this.pageKey.motherid);this.tpnum;localStorage.setItem(this.pageKey.fold,i),this.$router.push({name:"templatepreview",query:{tid:e,sku:t,mid:a,pnum:this.tpnum}})},handleMoreMaxImage:function(){var e=localStorage.getItem(this.pageKey.calenderTemp),t=localStorage.getItem(this.pageKey.maxnum);if(e){var i=JSON.parse(e);if(t&&i.length>t){for(var a=i.slice(0,t),o=i.slice(t),s=0;s<o.length;s++)o[s].title="",o[s].titleAll=0,o[s].isUse=!1;localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(a)),localStorage.setItem(this.pageKey.otherCalenderTemp,JSON.stringify(o))}}},hideImageEditPage:function(){$(".editImage").hide(),$(".mask").hide(),this.previewImageUrlArr=[],this.imageIndex=0,this.prevImage=!1,this.nextImage=!1,this.queryTempId="",document.body.removeEventListener("touchmove",this.bodyScroll,{passive:!1})},findImageByIndex:function(e){var t=this;this.checkReload=!1,t.imageIndex=t.imageIndex+e,0==t.imageIndex?(t.prevImage=!1,t.nextImage=!0):t.imageIndex==t.previewImageUrlArr.length-1?(t.nextImage=!1,t.prevImage=!0):(t.prevImage=!0,t.nextImage=!0),t.previewImageUrl=t.previewImageUrlArr[t.imageIndex]},isWxEnv:function(e){var t=this,i=this,a=layer.load(),o=navigator.userAgent.toLowerCase(),s=localStorage.getItem(this.normalKey.isMiniProgram);"micromessenger"==o.match(/MicroMessenger/i)?wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||s?layer.close(a):(!e&&!t.isTeamBook||t.isTS||layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)}),layer.close(a))}):(!e&&!this.isTeamBook||this.isTS||s&&!this.is_alipay||layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){i.is_alipay?my.navigateBack():window.history.go(-1)}),layer.close(a))},getTemplateList:function(){var t=this,i=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["Q"])(this.wsid,this.shopname).then(function(a){if(1==a.result||"true"==a.result){i.token=a.token;var o={goodsname:name,id:"",memberid:"",num:t.num,orderNo:"",productNo:i.productno,source:"wsid",url:window.location.href};t.$store.dispatch("updateOrderInfo",o),t.templateList(i.productno,i.token),localStorage.setItem(t.pageKey.token,i.token),localStorage.setItem(t.pageKey.source,"wsid"),localStorage.setItem(t.pageKey.wsid,t.wsid),localStorage.setItem(t.pageKey.orderInfo,JSON.stringify(o)),t.getTokenDetail(i.token),t.getCalenderTemp(i.token)}else{try{if(window._jylog){var s=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","获取token失败"+res,JSON.parse(s).orderNo])}}catch(e){console.log(e)}layer.alert("获取token失败！")}})},getTokenDetail:function(e){var t=this,i=localStorage.getItem(this.pageKey.tokenDate);i||localStorage.setItem(this.pageKey.tokenDate,Object(_utils_timeUtil__WEBPACK_IMPORTED_MODULE_17__["a"])("yyyy/MM/dd")),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["L"])(e).then(function(e){e.result&&localStorage.setItem(t.pageKey.tokenDetail,JSON.stringify(e.data))})},goPreviewModel:function(){this.$router.push({name:"previewModel",query:{id:this.queryTempId,sku:this.productno}})},checkUid:function(){var e=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["a"].uid);e&&Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["d"])({uid:e}).then(function(e){e.result&&!e.data||(localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["a"].uid),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["a"].autoSave))})},getDirection:function(e,t,i,a){var o=e-i,s=0;return o>0?s=3:o<0&&(s=4),s},handleScroll:function(e){var t=e.target.scrollHeight,i=e.target.clientHeight,a=e.target.scrollTop;a+i==t&&(console.info("scrollTop+conClientHeight===",a+i),console.info("scrollHeight===",t),""!=this.mobilestyleid&&0!=this.mobilestyleid?this.styleNum>=this.totalStyleNum||(this.styleNum++,this.getMore(this.motherid,this.goodsid,this.tpnum,this.styleNum,this.mobilestyleid,this.sort)):""==this.mobilestyleid&&""!=this.value?(this.styleNum++,this.getMore(this.motherid,this.goodsid,this.tpnum,this.styleNum,this.mobilestyleid,this.sort)):this.decoratePageNum>=this.totalNumberOfPages||(this.decoratePageNum++,this.templateList(this.productno,this.token)))},querybyId:function(e,t){t+=2,this.styleNum=1,this.templates=[],this.loadData(e,t)},checkMobile:function(){var e=navigator.userAgent.toLowerCase(),t=(Object(_utils_testMobileAndBrowser__WEBPACK_IMPORTED_MODULE_16__["a"])(),navigator.userAgent,e.indexOf("android")>-1||e.indexOf("linux")>-1);null!=e.match(/tencenttraveler/)||e.match(/qqbrowser/),e.match(/wechat/i),e.match(/firefox/),e.match(/opera/);console.log("isAndroid:"+t),console.log("sUserAgent:"+e);localStorage.getItem(this.normalKey.isMiniProgram);if(localStorage.getItem(this.pageKey.thirdDatil)){var i=JSON.parse(localStorage.getItem(this.pageKey.thirdDatil));"2"==i.mshopSign&&!0}},getCalenderTemp:function(e){var t=[],i=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_20__["E"])(e).then(function(e){var a=null;if(a="string"==typeof e?JSON.parse(e):e,a.result){var o=null;if(o="string"==typeof a.data?JSON.parse(a.data):a.data,""!=o&&o.length>0)for(var s=0;s<o.length;s++){var n={isUse:!0};n.index=s,n.id=o[s].id,n.name=o[s].name,n.url=o[s].picname,n.src=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__["d"])(o[s].picname)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_19__["e"])(o[s].picname,o[s].imageinfo,i.thumbnailToken);Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["a"])(o[s].imageinfo);if(""!=o[s].imageinfo){var r=JSON.parse(o[s].imageinfo),l="";l=r.primaryImageInfo?r.primaryImageInfo:r,n.dateTime=r.dateTime,n.width=l.width,n.height=l.height,(l.width<requireWidth||l.height<requireHeight)&&(n.pixellow=1)}t.push(n)}t.length>0&&localStorage.setItem(i.pageKey.calenderTemp,JSON.stringify(t))}else localStorage.removeItem(i.pageKey.calenderTemp)})},toDrafts:function toDrafts(){var str=window.location.href.split("?");function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var retuenUrl=url,temp="/(&"+arg+"=)([^&]*)/gi";eval(temp).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temp),"&"+replaceText));var temps="/([?])("+arg+"=)([^&]*)/gi";return eval(temps).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temps),"?"+replaceText)),retuenUrl}return url.indexOf("?")>0?url+"&"+replaceText:url+"?"+replaceText}window.location.href=changeURLArg("drafts?"+str[1],"id",this.templateid)},handleImageLoaded:function(){this.isShowLoading=!1,""==this.previewImageUrl||(this.checkReload?(this.showNum=!0,this.showReload=!1):(this.showNum=!1,this.showReload=!0)),this.previewImageUrl="img/img.png"},reloadPic:function(){this.showNum=!0,this.showReload=!1,this.checkReload=!0,this.previewImageUrl=this.previewImageUrlArr[this.imageIndex]},reloadCom:function(){this.checkReload=!1},changeChoosDate:function(){$(".selectDate").show(),$(".mask").show()},closeDate:function(){this.changeDateShow=!1},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_21__["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){null==i&&(i=this.is_alipay?"支付宝":"网页"),-1==this.wsid?i+="-独立链接":this.source?"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录","模板预览",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}},goBack:function(){0==this.hasDraft||"false"==this.hasDraft?this.is_byte?(this.hasHistoryBack_tt=!0,history.go(-1)):"fxxt"==this.source||"wechat"==this.source||"thrid"==this.source?history.go(-1):history.go(-2):history.go(-1)}}}},"87fc":function(e,t,i){},"89d6":function(t,i,a){"use strict";a.d(i,"a",function(){return K});a("7f7f"),a("c5f6"),a("28a5");var o,s,n,r,l,d,c,h,g,m,p=a("d225"),u=a("b0b4"),f=a("308d"),y=a("6bb5"),_=a("4e2b"),v=a("1db1"),w=a("0a92"),b=(a("2c48"),a("103a")),I=a("5ad2"),S=a("a244"),x=a("66a2"),k=a("cba4"),O=a("324d"),L=a("5841"),T="decrorate_",C="clip_",P=(a("f84b"),a("58d7"),a("fd6f"),"textImg_"),j="dMaskShape_",A="clouthMaskShap_",N="clouthBgMaskShap_",E=a("3523"),J="pixWarn_",D=a("35f8"),B="beyondWarn_",K=function(t){function i(e,t,a,o,s,n,r,l,d,c){var h;return Object(p["a"])(this,i),h=Object(f["a"])(this,Object(y["a"])(i).call(this,t)),h.parent=e,h.objJson=t,h.pageImgJson=a,h.pageIndex=o,h.itemIndex=s,h.isEdit=n,h.click=!1,h.childIndex=c,h.vm=r,h.isTextImg=l,h.isPhotoChange=d,g=800,m=800,h}return Object(_["a"])(i,t),Object(u["a"])(i,[{key:"initClipMask",value:function(e,t){var i,a=this,o="";if(o=void 0!=this.childIndex?C+a.pageIndex+"_"+a.itemIndex+"_"+this.childIndex:C+a.pageIndex+"_"+a.itemIndex,a.isEdit&&a.objJson.cutArea&&a.objJson.cutArea.fromAiCut&&(o="edit"+o),!SVG("#"+o)){i=a.parent.rect(),i.attr({x:a.objJson.location.x,y:a.objJson.location.y,width:a.objJson.location.width,height:a.objJson.location.height}),a.isEdit&&a.objJson.cutArea&&a.objJson.cutArea.fromAiCut&&i.attr({x:0,y:0});var s=a.vm.$store.getters.detailJson;if(0!=a.objJson.location.rotation||0==a.objJson.location.rotation&&void 0!=this.childIndex&&0!=s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation){var n=a.objJson.printLocation.x+a.objJson.printLocation.width/2,r=a.objJson.printLocation.y+a.objJson.printLocation.height/2,l=a.objJson.location.x,d=a.objJson.location.y,c=0-a.objJson.location.rotation;0==a.objJson.location.rotation&&void 0!=this.childIndex&&0!=s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation&&(c=0-s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation);var h=Object(S["b"])(l,d,c,n,r);i.attr({x:h.x,y:h.y})}return i.attr({id:o,isClip:!0,relativeBigX:a.objJson.cutArea.x,relativeBigY:a.objJson.cutArea.y,relativeBigW:a.objJson.cutArea.width,relativeBigH:a.objJson.cutArea.height}),e.clipWith(i),i}!a.isEdit&&a.isPhotoChange&&a.objJson.cutArea&&a.objJson.cutArea.fromAiCut&&e.clipWith(SVG("#"+o))}},{key:"initClouthMask",value:function(){var e,t=this;if(SVG("#"+A+t.pageIndex+"_"+t.itemIndex))return SVG("#"+A+t.pageIndex+"_"+t.itemIndex);e=t.parent.rect();var i=t.vm.$store.getters.detailJson,a=i.pageList[t.pageIndex].content.itemList[0].location.x,o=i.pageList[t.pageIndex].content.itemList[0].location.y,s=i.pageList[t.pageIndex].content.itemList[0].location.width,n=i.pageList[t.pageIndex].content.itemList[0].location.height;return e.attr({id:A+t.pageIndex+"_"+t.itemIndex,x:a,y:o,width:s,height:n,fill:"black"}),e}},{key:"initClouthBgMask",value:function(){var e,t=this;if(SVG("#"+N+t.pageIndex+"_"+t.itemIndex))return SVG("#"+N+t.pageIndex+"_"+t.itemIndex);e=t.parent.rect();var i=t.vm.$store.getters.detailJson,a=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.x,o=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.y,s=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.width,n=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.height;return e.attr({id:N+t.pageIndex+"_"+t.itemIndex,x:a,y:o,width:s,height:n,fill:"white"}),e}},{key:"initMaskShape",value:function(){var e,t=this;if(SVG("#"+j+t.pageIndex+"_"+t.itemIndex))return SVG("#"+j+t.pageIndex+"_"+t.itemIndex);e=t.parent.rect();var i=t.vm.$store.getters.detailJson,a=i.pageList[t.pageIndex].content.itemList[0].location.x,o=i.pageList[t.pageIndex].content.itemList[0].location.y,s=i.pageList[t.pageIndex].content.itemList[0].location.width,n=i.pageList[t.pageIndex].content.itemList[0].location.height;if("photo"==i.diyType){var r=i.pageList[t.pageIndex].diyWorkAreaWidth/i.pageList[t.pageIndex].workAreaWidth,l=i.pageList[t.pageIndex].content.itemList[0].location.x,d=i.pageList[t.pageIndex].content.itemList[0].location.y,c=x["a"].productBleedSpace*r,h=l+x["a"].productBleedSpace*r,g=d+x["a"].productBleedSpace*r;if(2==i.templateInfo.coverper&&i.coverInfo.hascover&&0==t.pageIndex&&i.pageList[0].iscover){c=x["a"].yignkeProductBleedSpace*r,h=l+x["a"].yignkeProductBleedSpace*r,g=d+x["a"].yignkeProductBleedSpace*r;var m=localStorage.getItem(t.vm.pageKey.rk);4==m&&(c=x["a"].rkBleedSpace*r,h=l+x["a"].rkBleedSpace*r,g=d+x["a"].rkBleedSpace*r),i.pageList[t.pageIndex].pageBleed&&(c=i.pageList[t.pageIndex].pageBleed.r*r,h=l+i.pageList[t.pageIndex].pageBleed.r*r,g=d+i.pageList[t.pageIndex].pageBleed.r*r)}a=h,o=g,s=i.pageList[t.pageIndex].content.itemList[0].location.width-2*c,n=i.pageList[t.pageIndex].content.itemList[0].location.height-2*c}return e.attr({id:j+t.pageIndex+"_"+t.itemIndex,x:a,y:o,width:s,height:n}),e}},{key:"initDecorateImg",value:function(){var e,t=this,i=t.objJson,a="";if(a=void 0!=this.childIndex?T+t.pageIndex+"_"+t.itemIndex+"_"+this.childIndex:T+t.pageIndex+"_"+t.itemIndex,1==t.isTextImg&&(a=P+t.pageIndex+"_"+t.itemIndex),t.isEdit&&t.objJson.cutArea&&t.objJson.cutArea.fromAiCut&&(a="edit"+a),SVG("#"+a))if(t.isPhotoChange)if(t.objJson.cutArea&&t.objJson.cutArea.fromAiCut){var o=C+t.pageIndex+"_"+t.itemIndex;t.isEdit&&(o="edit"+o),void 0!=t.childIndex&&(o=o+"_"+t.childIndex),SVG("#"+o).parent().remove(),SVG("#"+a).remove(),e=t.loadSource(t.parent,i,e,t.isPhotoChange)}else e=SVG("#"+a);else e=SVG("#"+a);else e=t.loadSource(t.parent,i,e,t.isPhotoChange);var s=t.vm.$store.getters.detailJson;if(!t.objJson.isDisplay&&(!t.objJson.cutArea||!t.objJson.cutArea.fromAiCut)&&("yes"!=t.objJson.moveable||"calendar"==s.diyType||"year_calendar"==s.diyType||"week_calendar"==s.diyType||"mug_cup"==s.diyType||"template_cloth"==s.diyType)){var n=t.initMaskShape();e.parent().clipWith(n)}if("template_cloth"==s.diyType&&1==t.objJson.isDisplay){var r=t.initClouthBgMask(),l=t.initClouthMask(),d=t.parent.mask();d.add(r),d.add(l),e.parent().maskWith(d)}e.on("error",function(e){if(console.log(this.width()),console.log(t.pageIndex+"_"+t.itemIndex+"装饰下载失败"),t.objJson.isVideo&&layer.alert("视频加载失败,请刷新页面",function(e){window.location.href=window.location.href}),t.pageImgJson&&t.pageImgJson.imgArr.length>0){
//!objJson.moveable &&
var i=t.objJson.media.imgPath;if(-1!=t.objJson.media.imgPath.indexOf("img/nophoto.jpg")&&(i="img/nophoto.jpg"),-1!=i.indexOf(L["a"].thumbnailUrl)){var a=i.split(L["a"].thumbnailUrl),o=a[1].split("?token=");i=t.objJson.cutArea&&t.objJson.cutArea.fromAiCut?-1!=t.objJson.media.imgPath.indexOf("fsferry/")?L["a"].thumbnailUrl+"fsferry/commonUpload/"+o[0]:L["a"].thumbnailUrl+"commonUpload/"+o[0]:L["a"].thumbnailUrl+o[0]}var s=t.pageImgJson.imgArr.indexOf(i);-1!=s&&t.pageImgJson.imgArr.splice(s,1),t.pageImgJson.imgArr.length<=0&&(t.vm.isShowLoading=!1,console.log("页面加载完"),t.vm.everyTimeRender&&t.vm.everyTimeRender())}}),0!=e.width()&&e.attr({width:i.location.width,height:i.location.height});var c,h,g,m,p="";if(p=Object(O["a"])(t.objJson),g=i.printLocation.x+i.printLocation.width/2,m=i.printLocation.y+i.printLocation.height/2,0==i.location.rotation){if(c=i.location.x,h=i.location.y,void 0!=this.childIndex&&0!=s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation){s=t.vm.$store.getters.detailJson;v=0-i.location.rotation-s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation;var u=Object(S["b"])(i.location.x,i.location.y,v,g,m);c=u.x,h=u.y}var f=p;e.attr({transform:f})}else{var y=i.location.x,_=i.location.y,v=0-i.location.rotation;if(void 0!=this.childIndex){s=t.vm.$store.getters.detailJson;v=0-i.location.rotation-s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation}u=Object(S["b"])(y,_,v,g,m);c=u.x,h=u.y;f="rotate(0,"+g+","+m+") "+p;e.attr({transform:f})}i.flipX&&(c=0-c-i.location.width),i.flipY&&(h=0-h-i.location.height);var w="",b="";if(t.vm.isAlbum){var I=[{animatedClass:" wow fadeInUp animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInUp;"},{animatedClass:" wow fadeInLeftBig animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInLeftBig;"},{animatedClass:" wow fadeInDown animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInDown;"},{animatedClass:" wow bounceInDown animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: bounceInDown;"}],x=0,k=I.length-1,j=k-x,A=Math.random(),N=(x+j*A).toFixed(0);w=I[N].animatedClass,b=I[N].animatedStyle;var E=SVG("#group"+t.pageIndex+"_"+t.itemIndex);E.attr({class:w,"data-wow-delay":"0.2s",style:b})}if(e.attr({class:"deimg myimg ",opacity:Number(i.layer.alpha),id:a,ty:i.media.mediaType,x:c,y:h,tagid:i.tagid,preserveAspectRatio:"none"}),t.objJson.isVideo&&e.attr({videoId:"video_"+t.pageIndex}),(i.isDisplay||"no"==i.moveable)&&(i.cutArea&&i.cutArea.fromAiCut||e.attr({style:"pointer-events: none"})),0!=e.width()&&i.cutArea){var J=t.objJson.cutArea.width/e.attr("bigFactWidth"),D=t.objJson.cutArea.height/e.attr("bigFactHeight"),B=t.objJson.location.width/J,K=t.objJson.location.height/D;e.attr({width:B,height:K});var M=B/e.attr("bigFactWidth"),$=0-t.objJson.cutArea.x*M,U=0-t.objJson.cutArea.y*M,W=t.objJson.location.x+$,F=t.objJson.location.y+U;if(0!=t.objJson.location.rotation&&(W=c+$,F=h+U),void 0!=this.childIndex&&0==t.objJson.location.rotation){s=t.vm.$store.getters.detailJson;0!=s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation&&(W=c+$,F=h+U)}e.attr({x:W,y:F}),t.initClipMask(e,M)}f="";if(1==i.topEnable)f="rotate("+i.printLocation.rotation+","+i.printLocation.x+i.printLocation.width/2+","+i.printLocation.y+i.printLocation.height/2+") "+p;else{s=t.vm.$store.getters.detailJson;var R="";R=void 0!=this.childIndex&&s.pageList[this.pageIndex].content.itemList[this.itemIndex].location&&0!=s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation?i.location.rotation+s.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation:i.location.rotation,f="rotate("+R+","+g+","+m+") "+p,i.location.rotation}if(e.attr({transform:f}),0!=e.width()){s=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));t.initPixWarnImg(t,e,s)}t.isEdit&&t.objJson.cutArea&&t.objJson.cutArea.fromAiCut&&t.editImg(e,i)}},{key:"loadSource",value:function(t,i,a,o){if(this.isEdit&&SVG("#edit_group"))for(var s=SVG("#edit_group").children(),n=0;n<s.length;n++)-1!=s[n].id().indexOf("facerect_")&&s[n].remove();var r=this,l="";if(void 0!=this.childIndex&&-1==i.media.imgPath.indexOf(Object(b["d"])(i.media.imgPath))&&(i.media.imgPath=Object(b["d"])(i.media.imgPath)+""+Object(b["a"])(i.media.imgPath,i,this.vm.pageKey)),l=i.media.imgPath,-1!=i.media.imgPath.indexOf(L["a"].thumbnailUrl)&&-1==i.media.imgPath.indexOf("?token=")){var d=localStorage.getItem(r.vm.pageKey.thumbnailToken);if(l=i.media.imgPath+"?token="+d,-1!=l.indexOf("commonUpload/")&&(i.cutArea&&i.cutArea.fromAiCut||"image"==i.media.mediaType))if(-1!=l.indexOf("fsferry/")){var c=l.split("fsferry/commonUpload/");l=c[0]+c[1]}else{c=l.split("commonUpload/");l=c[0]+c[1]}}else try{if(-1!=i.media.imgPath.indexOf(L["a"].thumbnailUrl)&&-1!=i.media.imgPath.indexOf("?token=")&&-1!=l.indexOf("commonUpload/")&&(i.cutArea&&i.cutArea.fromAiCut||"image"==i.media.mediaType))if(-1!=l.indexOf("fsferry/")){c=l.split("fsferry/commonUpload/");l=c[0]+c[1]}else{c=l.split("commonUpload/");l=c[0]+c[1]}if(-1!=i.media.imgPath.indexOf(L["a"].thumbnailUrl)&&-1!=i.media.imgPath.indexOf("commonUpload/")&&window._jylog){var h=localStorage.getItem(r.vm.pageKey.orderInfo);window._jylog.push(["裁切渲染路径记录","设计页面","警告",i.media.imgPath,JSON.parse(h).orderNo])}}catch(e){}try{var g;i.cutArea&&i.cutArea.fromAiCut&&(g=performance.now())}catch(e){}return a=t.image(l,function(e){try{if(i.cutArea&&i.cutArea.fromAiCut){var t=performance.now(),o=(t-g)/1e3;if(console.log(l+"加载时间:"+o),o>3&&window._jylog){var s=localStorage.getItem(r.vm.pageKey.orderInfo);window._jylog.push(["裁切照片加载","渲染","加载时长",r.pageIndex+"_"+r.itemIndex+":"+o,JSON.parse(s).orderNo])}}}catch(e){}if(this.attr({bigFactWidth:this.width(),bigFactHeight:this.height()}),i.cutArea&&i.cutArea.fromAiCut){if(i.cutArea.bigFactWidth=this.width(),i.cutArea.bigFactHeight=this.height(),r.childIndex||0==r.childIndex){var n=JSON.parse(localStorage.getItem(r.vm.pageKey.detailJson));n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.bigFactWidth=this.width(),n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.bigFactHeight=this.height();var d=JSON.stringify(n);localStorage.setItem(r.vm.pageKey.detailJson,d),r.vm.$store.dispatch("updatePages",n)}var c=0,h=0,m=this.width(),p=this.height(),u=i.cutArea.x,f=i.cutArea.y,y=Math.floor(i.cutArea.x+i.cutArea.width),_=Math.floor(i.cutArea.y+i.cutArea.height);if(u>=c&&f>=h&&y<=m&&_<=p);else{n=JSON.parse(localStorage.getItem(r.vm.pageKey.detailJson));if(this.width()>=i.cutArea.width&&this.height()>=i.cutArea.height)0==r.childIndex||r.childIndex?(n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.x=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.y=0):(n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.x=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.y=0);else{var v=i.cutArea.width/i.cutArea.height,w=this.width()/this.height();v>=w?0==r.childIndex||r.childIndex?(n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.x=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.y=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.width=this.width(),n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.height=Math.floor(this.width()/v)):(n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.x=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.y=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.width=this.width(),n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.height=Math.floor(this.width()/v)):0==r.childIndex||r.childIndex?(n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.x=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.y=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.width=Math.floor(this.height()*v),n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex].cutArea.height=this.height()):(n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.x=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.y=0,n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.width=Math.floor(this.height()*v),n.pageList[r.pageIndex].content.itemList[r.itemIndex].cutArea.height=this.height())}d=JSON.stringify(n);localStorage.setItem(r.vm.pageKey.detailJson,d),r.vm.$store.dispatch("updatePages",n),i=0==r.childIndex||r.childIndex?n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement[r.childIndex]:n.pageList[r.pageIndex].content.itemList[r.itemIndex],r.objJson=i,console.log("裁切区域超出照片实际范围！已自适应修复"+r.pageIndex+"-"+r.itemIndex),r.updateFaceArea(a,n,a.width()/i.cutArea.lastWidth)}}n=r.vm.$store.getters.detailJson;if("yes"==i.moveable&&!i.cutArea){i.location.height=i.location.width*this.height()/this.width();var b,k=Object(S["a"])(i.location.x,i.location.y,i.location.width,i.location.height,i.location.rotation);i.printLocation.height=k.height,0!=i.location.rotation&&(i.printLocation.width=k.width,i.printLocation.x=k.x,i.printLocation.y=k.y);var O=n.pageList[r.pageIndex].diyWorkAreaWidth/n.pageList[r.pageIndex].workAreaWidth;if(1934875331!=i.tagid||"calendar"!=n.diyType&&"year_calendar"!=n.diyType&&"wall_calendar"!=n.diyType||0!=i.location.rotation||(T=x["a"].calendarUpbleed,b=x["a"].productBleedSpace,i.location.height>n.pageList[r.pageIndex].content.itemList[0].location.height-T*O-b*O&&(i.location.height=n.pageList[r.pageIndex].content.itemList[0].location.height-T*O-b*O-10,i.location.width=i.location.height*this.width()/this.height(),k=Object(S["a"])(i.location.x,i.location.y,i.location.width,i.location.height,i.location.rotation),i.printLocation.height=k.height,i.printLocation.width=k.width)),1934875331==i.tagid&&("photo"==n.diyType||"woodcut"==n.diyType)&&0==i.location.rotation){var T=x["a"].yignkeProductBleedSpace;i.location.height>n.pageList[r.pageIndex].content.itemList[0].location.height-T*O*2&&(i.location.height=n.pageList[r.pageIndex].content.itemList[0].location.height-T*O*2-10,i.location.width=i.location.height*this.width()/this.height(),k=Object(S["a"])(i.location.x,i.location.y,i.location.width,i.location.height,i.location.rotation),i.printLocation.height=k.height,i.printLocation.width=k.width)}if(1934875331==i.tagid&&"week_calendar"==n.diyType&&0==i.location.rotation){T=x["a"].weekTopSpace;b=x["a"].productBleedSpace,i.location.height>n.pageList[r.pageIndex].content.itemList[0].location.height-T*O-b*O&&(i.location.height=n.pageList[r.pageIndex].content.itemList[0].location.height-T*O-b*O-10,i.location.width=i.location.height*this.width()/this.height(),k=Object(S["a"])(i.location.x,i.location.y,i.location.width,i.location.height,i.location.rotation),i.printLocation.height=k.height,i.printLocation.width=k.width)}if(1934875331==i.tagid&&("mug_cup"==n.diyType||"template_cloth"==n.diyType||"fashion_photo"==n.diyType||"poker"==n.diytype||"other_object"==n.diytype)&&0==i.location.rotation){T=x["a"].productBleedSpace;i.location.height>n.pageList[r.pageIndex].content.itemList[0].location.height-T*O*2&&(i.location.height=n.pageList[r.pageIndex].content.itemList[0].location.height-T*O*2-10,i.location.width=i.location.height*this.width()/this.height(),k=Object(S["a"])(i.location.x,i.location.y,i.location.width,i.location.height,i.location.rotation),i.printLocation.height=k.height,i.printLocation.width=k.width)}"calendar"!=n.diyType&&"year_calendar"!=n.diyType&&"wall_calendar"!=n.diyType&&"mug_cup"!=n.diyType&&"template_cloth"!=n||!i.isDisplay||(i.location.width=n.pageList[r.pageIndex].diyDisplayWidth,i.location.height=n.pageList[r.pageIndex].diyDisplayHeight,i.printLocation.width=n.pageList[r.pageIndex].diyDisplayWidth,i.printLocation.height=n.pageList[r.pageIndex].diyDisplayHeight)}if(i.cutArea){if(i.originalCutArea||(i.originalCutArea=i.cutArea),null==i.cutArea.x||null==i.cutArea.y||0==i.cutArea.width||0==i.cutArea.height){try{if(window._jylog){s=localStorage.getItem(r.vm.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计页面","警告",n.pageList[r.pageIndex].title+"页面图片裁切参数异常！请联系客服",JSON.parse(s).orderNo])}}catch(e){console.log(e)}r.vm.$layer.alert(n.pageList[r.pageIndex].title+"页面图片裁切参数异常！请联系客服")}var C=r.objJson.cutArea.width/this.attr("bigFactWidth"),P=r.objJson.cutArea.height/this.attr("bigFactHeight"),j=r.objJson.location.width/C,A=r.objJson.location.height/P;i.cutArea&&i.cutArea.fromAiCut&&(i.cutArea.lastWidth&&!r.isPhotoChange&&-1==a.id().indexOf("edit")||(i.cutArea.lastWidth=j)),this.attr({width:j,height:A}),this.attr({lastWidth:j});var N=j/a.attr("bigFactWidth"),E=A/a.attr("bigFactHeight"),J=0-r.objJson.cutArea.x*N,D=0-r.objJson.cutArea.y*E,B=r.objJson.location.x+J,K=r.objJson.location.y+D;n=r.vm.$store.getters.detailJson;if(0!=r.objJson.location.rotation||void 0!=r.childIndex&&0==r.objJson.location.rotation&&0!=n.pageList[r.pageIndex].content.itemList[r.itemIndex].location.rotation){var M=r.objJson.printLocation.x+r.objJson.printLocation.width/2,$=r.objJson.printLocation.y+r.objJson.printLocation.height/2,U=r.objJson.location.x,W=r.objJson.location.y,F=0-r.objJson.location.rotation;void 0!=r.childIndex&&0==r.objJson.location.rotation&&0!=n.pageList[r.pageIndex].content.itemList[r.itemIndex].location.rotation&&(F=0-r.objJson.location.rotation-n.pageList[r.pageIndex].content.itemList[r.itemIndex].location.rotation);var R=Object(S["b"])(U,W,F,M,$);B=R.x+J,K=R.y+D}if(r.isEdit&&r.objJson.cutArea&&r.objJson.cutArea.fromAiCut){var q=0-r.objJson.printLocation.x,G=0-r.objJson.printLocation.y;B+=q,K+=G}if(a.attr({x:B,y:K}),r.initClipMask(a,N),r.objJson.isBeyond)if(-1!=a.id().indexOf("edit"))r.vm.isBeyond=!0;else if("album"!=r.vm.$route.name)r.loadWarnBeyond(n);r.objJson.cutArea&&r.objJson.cutArea.fromAiCut&&(-1==a.id().indexOf("edit")&&!r.isPhotoChange||-1!=r.objJson.media.imgPath.indexOf("img.alicdn.com")||(r.vm.faceTestArr=[],r.vm.currentPhotoJson&&(r.vm.loadingShow_faceTest=!0,setTimeout(function(){var e={};e.x=B,e.y=K,e.width=j,e.height=A,r.faceTest(l,r.objJson,r.objJson.cutArea.fromAiCut,e)},10))))}else this.attr({width:i.location.width,height:i.location.height});n=r.vm.$store.getters.detailJson;if(r.initPixWarnImg(r,a,n),void 0!=this.childIndex);else if(n.pageList[r.pageIndex].content.itemList[r.itemIndex].childrenElement);else{n.pageList[r.pageIndex].content.itemList[r.itemIndex]=i;d=JSON.stringify(n);localStorage.setItem(r.vm.pageKey.detailJson,d),r.vm.$store.dispatch("updatePages",n)}if(r.pageImgJson&&r.pageImgJson.imgArr.length>=0){
//!objJson.moveable &&
var z=e.target.src;if(-1!=e.target.src.indexOf("img/nophoto.jpg")&&(z="img/nophoto.jpg"),-1!=z.indexOf(L["a"].thumbnailUrl)){var H=z.split(L["a"].thumbnailUrl),V=H[1].split("?token=");z=i.cutArea&&i.cutArea.fromAiCut?-1!=i.media.imgPath.indexOf("fsferry/")?L["a"].thumbnailUrl+"fsferry/commonUpload/"+V[0]:L["a"].thumbnailUrl+"commonUpload/"+V[0]:L["a"].thumbnailUrl+V[0],-1!=i.media.imgPath.indexOf("commonUpload/")&&(z=-1!=i.media.imgPath.indexOf("fsferry/")?L["a"].thumbnailUrl+"fsferry/commonUpload/"+V[0]:L["a"].thumbnailUrl+"commonUpload/"+V[0])}var Y=r.pageImgJson.imgArr.indexOf(z);if(-1!=Y&&r.pageImgJson.imgArr.splice(Y,1),0==r.pageIndex&&console.log(r.pageIndex),r.pageImgJson.imgArr.length<=0){try{if(r.vm.firstLoadPageStartTime&&-1!=window.location.href.indexOf("design")&&r.pageIndex<1){var X=performance.now(),Q=(X-r.vm.firstLoadPageStartTime)/1e3;if(console.log("loadCostTime:"+Q),window._jylog){s=localStorage.getItem(r.vm.pageKey.orderInfo);window._jylog.push(["页面loading","设计页面","设计页面loading时长",Q,JSON.parse(s).orderNo])}r.vm.firstLoadPageStartTime=null}}catch(e){console.log(e)}r.vm.isShowLoading=!1,console.log("页面加载完"),r.vm.everyTimeRender&&r.vm.everyTimeRender()}}if(r.isEdit)if(i.cutArea&&i.cutArea.fromAiCut);else{var Z={parent:r.parent,pageIndex:r.pageIndex,itemIndex:r.itemIndex,hasScaleBtn:!0,vm:r.vm};r.vm.isecd&&(Z.repalceDelete=!0);var ee=new I["a"](a,r.objJson,Z);ee.editObj(a),a.borderControl=ee}}),Object(O["b"])(a,i),a}},{key:"faceTest",value:function(t,i,a,o){var s=this,n={};if(n.url=t,a&&(n.width=Math.round(o.width),n.height=Math.round(o.height),n.x=o.x,n.y=o.y,n.pageIndex=s.pageIndex,n.itemIndex=s.itemIndex,n.zoom=i.media.zoom),(s.isPhotoChange||-1!=s.parent.id().indexOf("edit_"))&&(s.vm.faceTestArr.push(n),1==s.vm.faceTestArr.length)){try{if(window._jylog){var r=localStorage.getItem(s.vm.pageKey.orderInfo);window._jylog.push(["渲染路径记录处理前","设计页面faceTest人脸识别","警告",n.url,JSON.parse(r).orderNo])}}catch(e){console.log(e)}if(-1!=window.location.href.indexOf("https")&&-1!=n.url.indexOf("http")){var l=n.url.split("http");n.url="https"+l[1]}if(-1!=window.location.href.indexOf("http")&&-1!=n.url.indexOf("https")&&-1==n.url.indexOf(L["a"].thumbnailUrl)){l=n.url.split("https");n.url="http"+l[1],-1!=window.location.href.indexOf("http://ws.jndx.net/jianying")&&(l=n.url.split("jianying"),n.url="http://ws.jndx.net/jianying"+l[1])}try{if(window._jylog){r=localStorage.getItem(s.vm.pageKey.orderInfo);window._jylog.push(["渲染路径记录处理后","设计页面faceTest人脸识别","警告",n.url,JSON.parse(r).orderNo])}}catch(e){console.log(e)}s.vm.faceTestUrl=n.url,s.vm.$set(s.vm.currentPhotoJson,"url",n.url),s.vm.$set(s.vm.currentPhotoJson,"width",n.width),s.vm.$set(s.vm.currentPhotoJson,"height",n.height),s.vm.photoCanvas=document.getElementById("photoCanvas").getContext("2d"),s.vm.$nextTick(function(){s.vm.photoDom=document.getElementById("imgDom"),s.vm.faceTest(s.vm.photoCanvas,s.vm.photoDom,n,a)})}}},{key:"updateFaceArea",value:function(e,t,i){var a=this;if(t.pageList[a.pageIndex].content.itemList[a.itemIndex].photoFacePosition){for(var o=t.pageList[a.pageIndex].content.itemList[a.itemIndex].photoFacePosition,s=!1,n=0;n<o.length;n++){var r={};r.x=e.x()+t.pageList[a.pageIndex].content.itemList[a.itemIndex].photoFacePosition[n].x*i,r.y=e.y()+t.pageList[a.pageIndex].content.itemList[a.itemIndex].photoFacePosition[n].y*i,r.width=t.pageList[a.pageIndex].content.itemList[a.itemIndex].photoFacePosition[n].width*i,r.height=r.width,console.log("zoomNum:"+i);var l=r.x,d=r.y,c=l+r.width,h=d+r.height,g=0,m=0,p=g+t.pageList[a.pageIndex].content.itemList[a.itemIndex].printLocation.width,u=m+t.pageList[a.pageIndex].content.itemList[a.itemIndex].printLocation.height,f=SVG("#facerect_"+a.pageIndex+"_"+a.itemIndex+"_"+n);if(!f&&SVG("#edit_group")){var y=SVG("#edit_group");f=y.rect(),f.attr({id:"facerect_"+a.pageIndex+"_"+a.itemIndex+"_"+n,"stroke-width":3,stroke:"#FF4C88",fill:"none","pointer-events":"none",style:"pointer-events: none;display:none"})}f&&f.attr({x:r.x,y:r.y,width:r.width,height:r.height}),l>=g&&d>=m&&c<=p&&h<=u||(s=!0,a.vm.isBeyond=!0)}a.vm.notTestFace||(s?(t.pageList[a.pageIndex].isBeyond=!0,t.pageList[a.pageIndex].content.itemList[a.itemIndex].isBeyond=!0,t.pageList[a.pageIndex].content.itemList[a.itemIndex].hasWarn=!0):(a.vm.isBeyond=!1,t.pageList[a.pageIndex].isBeyond=!1,t.pageList[a.pageIndex].content.itemList[a.itemIndex].isBeyond=!1)),a.vm.$store.dispatch("updatePages",t);var _=JSON.stringify(t);localStorage.setItem(a.vm.pageKey.detailJson,_)}else if(t.pageList[a.pageIndex].content.itemList[a.itemIndex].characterArea&&t.pageList[a.pageIndex].content.itemList[a.itemIndex].characterArea.areaX){var v=t.pageList[a.pageIndex].content.itemList[a.itemIndex],w=v.characterArea.areaX*v.media.imgWidth+v.media.imgX+v.printLocation.x,b=v.characterArea.areaY*v.media.imgHeight+v.media.imgY+v.printLocation.y,I=v.characterArea.areaW*v.media.imgWidth,S=v.characterArea.areaH*v.media.imgHeight;console.log("objJson.cutArea.width",v.cutArea.width,"objJson.cutArea.bigFactWidth",v.cutArea.bigFactWidth);var x=v.cutArea.width/v.cutArea.bigFactWidth,k=v.cutArea.height/v.cutArea.bigFactHeight,O=v.location.width/x,L=v.location.height/k,T=O/v.cutArea.bigFactWidth,C=0-v.cutArea.x*T,P=0-v.cutArea.y*T,j=v.location.x+C,A=v.location.y+P;v.cutArea.bigFactWidth,v.cutArea.bigFactHeight;w=v.characterArea.areaX*O+j,b=v.characterArea.areaY*L+A,I=v.characterArea.areaW*O,S=v.characterArea.areaH*L;a=this,l=w,d=b,c=l+I,h=d+S,g=v.printLocation.x,m=v.printLocation.y,p=g+v.printLocation.width,u=m+v.printLocation.height;l>=g&&d>=m&&Math.floor(c)<=p&&Math.floor(h)<=u||(s=!0,a.vm.isBeyond=!0),a.vm.notTestFace||(s?(t.pageList[a.pageIndex].isBeyond=!0,t.pageList[a.pageIndex].content.itemList[a.itemIndex].isBeyond=!0,t.pageList[a.pageIndex].content.itemList[a.itemIndex].hasWarn=!0):(a.vm.isBeyond=!1,t.pageList[a.pageIndex].isBeyond=!1,t.pageList[a.pageIndex].content.itemList[a.itemIndex].isBeyond=!1)),a.vm.$store.dispatch("updatePages",t);_=JSON.stringify(t);localStorage.setItem(a.vm.pageKey.detailJson,_)}}},{key:"loadWarnBeyond",value:function(e){var t=575,i=80,a=30,o=i,s=a;if(SVG("#"+T+this.pageIndex+"_"+this.itemIndex)){var n,r=SVG("#"+T+this.pageIndex+"_"+this.itemIndex).attr("transform");n=e.templateInfo.jijian?this.parent.image("",function(){}):this.parent.image(D,function(){});var l,d,c,h,g=this.parent.rect(),m=this;if(c=m.objJson.printLocation.x+m.objJson.printLocation.width/2,h=m.objJson.printLocation.y+m.objJson.printLocation.height/2,0==m.objJson.location.rotation)l=m.objJson.location.x,d=m.objJson.location.y;else{var p=m.objJson.location.x,u=m.objJson.location.y,f=0-m.objJson.location.rotation,y=Object(S["b"])(p,u,f,c,h);l=y.x,d=y.y;var _="rotate(0,"+c+","+h+")";g.attr({transform:_}),n.attr({transform:_})}g.attr({id:"rect"+B+this.pageIndex+"_"+this.itemIndex,x:l,y:d,width:this.objJson.location.width,height:this.objJson.location.height,"stroke-width":2,stroke:"#FF4C88",fill:"none","pointer-events":"none",style:"pointer-events: none"}),0!=m.objJson.location.rotation&&g.attr({transform:r});this.objJson.location.x,this.objJson.location.y;if(this.isEdit);else{var v=e.pageList[this.pageIndex].diyDisplayWidth/t;o=i*v,s=a*v,n.attr({id:B+this.pageIndex+"_"+this.itemIndex})}return n.attr({class:"show-warn",width:o,height:s,x:l,y:d,style:"pointer-events: none"}),0!=m.objJson.location.rotation&&n.attr({transform:r}),n}}},{key:"initPixWarnImg",value:function(e,t,i){if(!e.vm.isAlbum){var a,o="#"+J+e.pageIndex+"_"+e.itemIndex;e.isEdit&&(o="#edit"+J+e.pageIndex+"_"+e.itemIndex),(e.objJson.location.factHeight<m||e.objJson.location.factWidth<g)&&e.objJson.cutArea&&e.objJson.cutArea.fromAiCut?SVG(o)?(a=SVG(o),a.remove(),a=e.loadWarnPix(i),e.vm.isLowPixel=!0):(a=e.loadWarnPix(i),e.vm.isLowPixel=!0):this.factScaleNum(t,e,i)}}},{key:"factScaleNum",value:function(e,t,i){if(!t.vm.isAlbum&&-1==t.objJson.tagid&&!(t.objJson.location.factHeight<m||t.objJson.location.factWidth<g)&&t.objJson.cutArea&&t.objJson.cutArea.fromAiCut){for(var a=25.4,o=300,s=2.5,n=i.pageList[t.pageIndex].workAreaWidth/a*o,r=i.pageList[t.pageIndex].workAreaHeight/a*o,l=(i.pageList[t.pageIndex].diyDisplayWidth,0),d=0,c=i.pageList[t.pageIndex].content.itemList,h=0;h<c.length;h++)if(c[h].isDesignShape&&1==c[h].isDesignShape){l=c[h].location.width,d=c[h].location.height;break}var p=Number(n)/l,u=Number(r)/d,f=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.factWidth/p,y=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.factHeight/u,_=e.width(),v=e.height();if(console.log(_/f+":"+s),_/f>s||v/y>s){var w;console.log("图片放大后模糊！");var b="#"+J+t.pageIndex+"_"+t.itemIndex;t.isEdit&&(b="#edit"+J+t.pageIndex+"_"+t.itemIndex),SVG(b)?(w=SVG(b),w.remove(),w=t.loadWarnPix(i)):w=t.loadWarnPix(i)}else{b="#"+J+t.pageIndex+"_"+t.itemIndex;t.isEdit&&(b="#edit"+J+t.pageIndex+"_"+t.itemIndex),SVG(b)&&SVG(b).remove()}}}},{key:"loadWarnPix",value:function(e){var t=575,i=40,a=i,o=10,s=this.parent.image(E,function(){}),n=this.objJson.location.x,r=this.objJson.location.y,l=e.pageList[this.pageIndex].diyDisplayWidth/t;a=i*l;var d=J+this.pageIndex+"_"+this.itemIndex;return(this.childIndex||0==this.childIndex)&&(d=J+this.pageIndex+"_"+this.itemIndex+"_"+this.childIndex),s.attr({id:d}),s.attr({class:"show-warn",width:a,height:a,x:n+this.objJson.location.width/2-a/2,y:r+this.objJson.location.height/2-a/2}),s}},{key:"editImg",value:function(e,t){var i=this,a=document.getElementById("drawing2"),o=document.getElementById(e.id());i.click=!0,o.addEventListener("touchstart",function(t){M(t,e)}),o.addEventListener("touchmove",function(a){$(a,i,e),q(e,t)},{passive:!1}),o.addEventListener("touchend",function(a){U(a,i,e),q(e,t);var o=JSON.parse(localStorage.getItem(i.vm.pageKey.detailJson)),s=e.width()/e.attr("lastWidth"),n=t.cutArea.width/s,r=t.cutArea.height/s,l=0,d=0,c=e.attr("bigFactWidth"),h=e.attr("bigFactHeight"),g=t.cutArea.x,m=t.cutArea.y,p=t.cutArea.x+t.cutArea.width,u=t.cutArea.y+t.cutArea.height;if(g>=l&&m>=d&&p<=c&&u<=h);else{var f=t.cutArea.width/t.cutArea.height,y=e.attr("bigFactWidth")/e.attr("bigFactHeight");f>=y?(n=e.attr("bigFactWidth")/s,r=e.attr("bigFactWidth")/f/s):(n=e.attr("bigFactHeight")*f/s,r=e.attr("bigFactHeight")/s)}var _=n/e.attr("bigFactWidth"),v=r/e.attr("bigFactHeight"),w=t.location.width/_,b=(t.location.height,w/e.attr("bigFactWidth")),I=(e.x()-0)/b,S=(e.y()-0)/b;0==i.childIndex||i.childIndex?(o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.x=-I,o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.y=-S,o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.width=n,o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.height=r):(o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.x=-I,o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.y=-S,o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.width=n,o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.height=r);var x=JSON.stringify(o);localStorage.setItem(i.vm.pageKey.detailJson,x);var k;s=e.width()/e.attr("lastWidth");t.cutArea&&t.cutArea.fromAiCut&&(k=void 0!=i.childIndex?o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.lastWidth:o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.lastWidth,i.updateFaceArea(e,o,e.width()/k))});var s=document.getElementById(e.id()),n=Object(k["a"])(s,a);n.gesturestart=function(t){W(t,e)},n.gesturemove=function(a){F(a,i,e),G(e,t)},n.gestureend=function(a){G(e,t);var o=JSON.parse(localStorage.getItem(i.vm.pageKey.detailJson)),s=e.width()/e.attr("lastWidth"),n=t.cutArea.width/s,r=t.cutArea.height/s,l=0,d=0,c=e.attr("bigFactWidth"),h=e.attr("bigFactHeight"),g=t.cutArea.x,m=t.cutArea.y,p=t.cutArea.x+t.cutArea.width,u=t.cutArea.y+t.cutArea.height;if(g>=l&&m>=d&&p<=c&&u<=h);else{var f=t.cutArea.width/t.cutArea.height,y=e.attr("bigFactWidth")/e.attr("bigFactHeight");f>=y?(n=e.attr("bigFactWidth")/s,r=e.attr("bigFactWidth")/f/s):(n=e.attr("bigFactHeight")*f/s,r=e.attr("bigFactHeight")/s)}var _=n/e.attr("bigFactWidth"),v=r/e.attr("bigFactHeight"),w=t.location.width/_,b=(t.location.height,w/e.attr("bigFactWidth")),I=(e.x()-0)/b,S=(e.y()-0)/b;0==i.childIndex||i.childIndex?(o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.x=-I,o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.y=-S,o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.width=n,o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.height=r):(o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.x=-I,o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.y=-S,o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.width=n,o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.height=r);var x,k=JSON.stringify(o);(localStorage.setItem(i.vm.pageKey.detailJson,k),t.cutArea&&t.cutArea.fromAiCut)&&(x=void 0!=i.childIndex?o.pageList[i.pageIndex].content.itemList[i.itemIndex].childrenElement[i.childIndex].cutArea.lastWidth:o.pageList[i.pageIndex].content.itemList[i.itemIndex].cutArea.lastWidth,i.updateFaceArea(e,o,e.width()/x))}}}]),i}(v["a"]),M=function(e,t){e.preventDefault(),o=e.targetTouches[0].pageX,s=e.targetTouches[0].pageY,c=t.x(),h=t.y()},$=function(e,t,i){var a=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));n=e.targetTouches[0].pageX,r=e.targetTouches[0].pageY;var l=document.getElementById("svg_"+t.pageIndex).clientWidth,d=document.getElementById("svg_"+t.pageIndex).clientHeight,g=a.pageList[t.pageIndex].diyDisplayWidth,m=a.pageList[t.pageIndex].diyDisplayHeight,p=Math.round((n-o)*g/l),u=Math.round((r-s)*m/d),f=Object(w["a"])(i,p,u);if(p=f.xspace,u=f.yspace,(i.x()!=c+p||i.y()!=h+u)&&(i.attr({x:Math.round(c+p),y:Math.round(h+u)}),t.objJson.isBeyond)){a.pageList[t.pageIndex].content.itemList[t.itemIndex].isBeyond=!1,-1!=i.id().indexOf("edit")&&(t.vm.isBeyond=!1);var y=JSON.stringify(a);localStorage.setItem(t.vm.pageKey.detailJson,y)}},U=function(e,t,i){e.changedTouches[0].pageX,e.changedTouches[0].pageY;var a=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson)),l=document.getElementById("svg_"+t.pageIndex).clientWidth,d=document.getElementById("svg_"+t.pageIndex).clientHeight,g=a.pageList[t.pageIndex].diyDisplayWidth,m=a.pageList[t.pageIndex].diyDisplayHeight,p=Math.round((n-o)*g/l),u=Math.round((r-s)*m/d),f=Object(w["a"])(i,p,u);p=f.xspace,u=f.yspace;var y=Math.round(c+p),_=Math.round(h+u);i.attr({x:y,y:_})},W=function(e,t){l=t.width(),d=t.height(),c=t.x(),h=t.y()},F=function(e,t,i){t.click&&(e.preventDefault(),-1!=e.target.id.indexOf(i.id())&&i.attr({width:l*e.scale,height:d*e.scale}))},R=function(e,t){var i=e.width(),a=e.height(),o=i/a,s=t.printLocation.width,n=t.printLocation.height,r=s/n;o>=r?(a=n,i=o*a,e.attr({height:a,width:i})):(i=s,a=i/o,e.attr({width:i,height:a}))},q=function(e,t){var i=e.x(),a=e.y(),o=0-(e.width()-t.printLocation.width),s=0-(e.height()-t.printLocation.height),n=0,r=0;i>n&&(i=n,e.attr({x:i})),a>r&&(a=r,e.attr({y:a})),i<o&&(i=o,e.attr({x:i})),a<s&&(a=s,e.attr({y:a}))},G=function(e,t){e.width()<=e.height()?e.width()<t.printLocation.width?R(e,t):e.height()<t.printLocation.height&&R(e,t):e.height()<t.printLocation.height?R(e,t):e.width()<t.printLocation.width&&R(e,t)}},"8eca":function(e,t,i){"use strict";function a(e,t,i,a){var o=e/t,s=i/a;return o>=s?(t=a,e=o*t):(e=i,t=e/o),{imgWidth:e,imgHeight:t}}i.d(t,"a",function(){return a})},"8f47":function(e,t,i){e.exports=i.p+"static/img/7.85419da8.png"},"8f67":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("6762"),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("2fdb"),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_4__),D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("bd86"),_utils_testMobileAndBrowser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("23ed"),_baseUrl__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("5841"),_utils_timeUtil__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("054f"),_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("103a"),_api_getJson__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("4cbb"),_storagekey__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("b60d");__webpack_exports__["a"]={name:"loading",data:function(){var e;return e={normalKey:null,history:null,token:null,pageKey:null,iscaiyun:null,source:null,wsid:null,isTS:null,albumid:null,avatarurl:null,nickname:null,ytid:null,price:null,ycoverbacknum:null,uid:null},Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"source",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"templateid",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"oid",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"returnURL",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"num",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"spmc",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"id",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"flagURL",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"productno",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"memberid",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"orderNo",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"orderInfos",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"shopname",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"is_alipay",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"is_byte",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"productId",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"goodsid",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"motherid",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"pnum",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"tpnum",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"minnum",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"maxnum",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"totalNumberOfPages",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"videoupload",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"videonum",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"showLoading",!0),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isGongge",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isNamePaste",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isVideoBook",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"bookVH",null),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isEcdbook",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isTouTiao",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isCopyBook",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"isSignleTempleBook",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(e,"singleTempleId",null),e},created:function(){var t;1!=this.$route.query.fromJianYingDesign&&"1"!=this.$route.query.fromJianYingDesign||(localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["f"].fromAlipyShopPaid),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["f"].fromAlipyShop),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["f"].fromAlipyShopCartEdit));var i=navigator.userAgent.toLowerCase().includes("toutiaomicroapp");i&&(this.isTouTiao=!0),console.log("isTouTiao:"+this.isTouTiao);var a=this,o=localStorage.getItem("isAlipay"),s=(localStorage.getItem("isByte"),navigator.userAgent.toLowerCase());if(("undefined"!=typeof my||"alipayclient"==s.match(/AlipayClient/i)||o)&&(this.is_alipay=!0),"toutiaomicroapp"==s.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0),localStorage.getItem("numIndex")&&localStorage.removeItem("numIndex"),this.normalKey=_storagekey__WEBPACK_IMPORTED_MODULE_11__["f"],this.history=this.$route.query.history,this.token=this.$route.query.token,this.productno=this.$route.query.sku,$.ajax((t={url:_baseUrl__WEBPACK_IMPORTED_MODULE_7__["a"].basicUrl+"/member/checkSkuType.do?sku="+this.productno,type:"POST",data:{sku:this.productno},contentType:"application/json; charset=utf-8"},Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(t,"type","POST"),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(t,"async",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(t,"success",function(e){console.log(e),20==e.data.type?a.isGongge=!0:21==e.data.type?a.isNamePaste=!0:22==e.data.type?a.isEcdbook=!0:23==e.data.type?(a.isVideoBook=!0,a.bookVH=e.data.attr):"lianzitie"==e.data.type?a.isCopyBook=!0:25==e.data.type&&(a.isSignleTempleBook=!0)}),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_5__["a"])(t,"error",function(e){}),t)),this.isSignleTempleBook&&(!this.$route.query.singleTempleId||"null"==this.$route.query.singleTempleId||"undefined"==this.$route.query.singleTempleId))return layer.alert("产品未配置模板，请联系客服"),void(this.showLoading=!1);if(this.singleTempleId=this.$route.query.singleTempleId,this.isGongge?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_11__["d"]:this.isNamePaste?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_11__["e"]:this.isEcdbook?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_11__["b"]:this.history?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_11__["c"]:this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_11__["a"],this.isGongge||this.isNamePaste||this.isEcdbook||this.is_byte)for(var n in this.pageKey)localStorage.removeItem(this.pageKey[n]);this.iscaiyun=this.$route.query.iscaiyun;var r=this.$route.query.source;this.checkUid(),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["a"].isxcx);var l=this;if(this.uid=this.$route.query.uid,"third"==localStorage.getItem(this.pageKey.source)||localStorage.removeItem(this.pageKey.source),this.wsid=this.$route.query.wsid,-1==this.wsid)for(var n in this.pageKey)localStorage.removeItem(this.pageKey[n]);var d=this.$route.query.avatarurl,c=this.$route.query.nickname,h=this.$route.query.albumid,g=this.$route.query.price,m=this.$route.query.tid,p=this.$route.query.coverbacknum;if(this.isTS=this.$route.query.isTS,h&&(this.albumid=h,this.avatarurl=d,this.nickname=c,this.ytid=m,this.price=g,this.ycoverbacknum=p),localStorage.removeItem(l.pageKey.rk),-1!=window.location.href.indexOf("zheliyin.com")&&!r){r="fxxt";try{window._czc&&window._czc.push(["_trackEvent","剪影","分销模板列表页",r])}catch(e){console.log(e)}}if(this.source=r,"fxxt"==r){var u=this.$route.query.redirecType;this.fxOrderNo=this.$route.query.fxOrderNo,localStorage.setItem(this.pageKey.source,r),localStorage.setItem(this.pageKey.redirecType,u)}localStorage.setItem(this.pageKey.orgTime,(new Date).getTime()),this.templateid=this.$route.query.templateid,this.oid=localStorage.getItem(this.pageKey.id),this.returnURL=decodeURI(this.$route.query.returnURL),this.num=this.$route.query.num,this.spmc=decodeURI(this.$route.query.spmc),this.id=this.$route.query.id,this.flagURL=this.$route.query.flagURL,"wechat"==this.flagURL&&(this.source="wechat",localStorage.setItem(this.pageKey.source,this.source),localStorage.setItem(this.pageKey.returnURL,this.returnURL)),"guochao"==r&&(this.source="guochao",localStorage.setItem(this.pageKey.source,this.source)),"wechat"==this.source||this.checkMobile(),null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.memberid=decodeURI(this.$route.query.memberid),this.orderNo=this.$route.query.orderNo;var f=localStorage.getItem(this.pageKey.detailJson);if(f&&(this.orderInfos=JSON.parse(f).oderInfo),null==this.token||void 0==this.token||""==this.token||"undefined"==this.token)this.wsid&&""!=this.wsid?(this.productno=this.$route.query.sku,this.shopname=this.$route.query.shopname,null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.getWeixinToken()):(this.token=localStorage.getItem(this.pageKey.token),this.productno=this.orderInfos.productNo,this.templateList(this.productno,this.token));else{r=localStorage.getItem(this.pageKey.source);if(this.wsid&&""!=this.wsid?(this.productno=this.$route.query.sku,null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.getWeixinToken()):this.templateList(this.productno,this.token),"third"!=r){var y=this.orderNo;localStorage.setItem(this.pageKey.token,this.token),localStorage.setItem(this.normalKey.userToken,this.token);var _={goodsname:this.spmc,id:this.id,memberid:this.memberid,num:this.num,orderNo:y,productNo:this.productno,source:this.source,url:window.location.href};this.$store.dispatch("updateOrderInfo",_),localStorage.setItem(this.pageKey.orderInfo,JSON.stringify(_))}this.getTokenDetail(this.token)}this.browser={versions:function(){var e=navigator.userAgent;navigator.appVersion;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile/i)||!!e.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1||e.indexOf("Mac")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};s=navigator.userAgent.toLowerCase();this.browser.versions.android&&"micromessenger"==s.match(/MicroMessenger/i)&&(this.is_weixn=!0)},methods:{checkUid:function(){var e=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["a"].uid);e&&Object(_api_getJson__WEBPACK_IMPORTED_MODULE_10__["d"])({uid:e}).then(function(e){e.result&&!e.data||(localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["a"].uid),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_11__["a"].autoSave))})},checkMobile:function(){var e=navigator.userAgent.toLowerCase(),t=Object(_utils_testMobileAndBrowser__WEBPACK_IMPORTED_MODULE_6__["a"])(),i=(navigator.userAgent,e.indexOf("android")>-1||e.indexOf("linux")>-1),a=null!=e.match(/tencenttraveler/)||null!=e.match(/qqbrowser/),o=null!=e.match(/wechat/i),s=null!=e.match(/firefox/),n=null!=e.match(/opera/),r=/ubrowser|ucbrowser|ucweb/;console.log("isAndroid:"+i),console.log("sUserAgent:"+e);var l,d=localStorage.getItem(this.normalKey.isMiniProgram)||this.$route.query.isMiniProgram;if(console.log("loading页面 isMiniProgram:"+d),localStorage.getItem(this.pageKey.thirdDatil)){var c=JSON.parse(localStorage.getItem(this.pageKey.thirdDatil));"2"==c.mshopSign&&(l=!0)}d||l||this.is_alipay||(r.exec(e)&&layer.alert("检测到您当前的浏览器对本系统不兼容，请使用QQ浏览器!",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)}),"huawei"==t&&1==i&&0==a&&0==s&&0==o&&0==n&&layer.alert("检测到您当前的浏览器对本系统不兼容，请使用QQ浏览器!!",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)}))},getWeixinToken:function(){var e=this,t=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_10__["Q"])(this.wsid,this.shopname).then(function(i){if(1==i.result||"true"==i.result){t.token=i.token;var a={goodsname:name,id:"",memberid:"",num:e.num,orderNo:"",productNo:t.productno,source:"wsid",url:window.location.href};e.$store.dispatch("updateOrderInfo",a),e.templateList(t.productno,t.token),localStorage.setItem(e.pageKey.token,t.token),localStorage.setItem(e.pageKey.source,"wsid"),localStorage.setItem(e.pageKey.wsid,e.wsid),localStorage.setItem(e.pageKey.orderInfo,JSON.stringify(a)),e.getTokenDetail(t.token),e.getCalenderTemp(t.token)}else layer.alert("获取token失败！")})},isWxEnv:function(e){var t=this,i=this,a=layer.load(),o=navigator.userAgent.toLowerCase(),s=localStorage.getItem(this.normalKey.isMiniProgram);"micromessenger"==o.match(/MicroMessenger/i)?wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||s?layer.close(a):(!e&&!t.isTeamBook||t.isTS||layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)}),layer.close(a))}):(!e&&!this.isTeamBook||this.isTS||s&&!this.is_alipay||layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){i.is_alipay?my.navigateBack():window.history.go(-1)}),layer.close(a))},getTokenDetail:function(e){var t=this,i=localStorage.getItem(this.pageKey.tokenDate);i||localStorage.setItem(this.pageKey.tokenDate,Object(_utils_timeUtil__WEBPACK_IMPORTED_MODULE_8__["a"])("yyyy/MM/dd")),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_10__["L"])(e).then(function(e){e.result&&localStorage.setItem(t.pageKey.tokenDetail,JSON.stringify(e.data))})},goUpload:function(e,t){var i=this.oid;if(null!=i&&""!=i&&void 0!=i&&"undefined"!=i&&"null"!=i){this.orderNo;"fxxt"==this.source&&this.fxOrderNo,localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson),localStorage.removeItem(this.pageKey.id)}else localStorage.removeItem(this.pageKey.id),localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson);if(!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||localStorage.setItem(this.pageKey.uid,this.uid),this.isGongge)this.$router.replace({name:"gongge",query:{id:e,p:t,isfirst:!0,isWeixin:this.is_weixn,isAlipay:this.is_alipay,isByte:this.is_byte}});else if(this.isEcdbook)this.$router.replace({name:"ecdbook",query:{id:e,p:t,isfirst:!0,isWeixin:this.is_weixn,isAlipay:this.is_alipay}});else if(this.isNamePaste){var a="";/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?(a="namepaste",this.$router.replace({name:a,query:{id:e,p:t,isfirst:!0,isWeixin:this.is_weixn,isAlipay:this.is_alipay}})):(a="namepaste_pc",this.$router.replace({name:a,query:{id:e,token:this.token,gid:this.goodsid,mid:this.mid,pid:this.productId,pnum:this.pnum,p:t,isfirst:!0,isWeixin:this.is_weixn,isAlipay:this.is_alipay}}))}else if(1==this.iscaiyun)this.$router.push({name:"upphoto",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}});else{var o=!0;if(this.isSignleTempleBook&&(o=!1),this.is_alipay)this.$router.replace({name:"alipayupload",query:{id:e,p:this.pnum,isTeamBook:this.isTeamBook,isfirst:!0,isSimple:o,isSignleTempleBook:this.isSignleTempleBook}});else if(this.is_weixn)this.$router.replace({name:"fxUpload",query:{id:e,p:this.pnum,isTeamBook:this.isTeamBook,isfirst:!0,isSimple:o,isSignleTempleBook:this.isSignleTempleBook}});else{navigator.userAgent.toLowerCase();var s=navigator.userAgent,n=!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(!this.is_byte||this.is_byte&&n)this.$router.replace({name:"upload",query:{id:e,p:this.pnum,isTeamBook:this.isTeamBook,isfirst:!0,isSimple:o,isSignleTempleBook:this.isSignleTempleBook}});else{var r=!1,l=(t=JSON.parse(localStorage.getItem(this.pageKey.pnum)),localStorage.getItem(this.pageKey.numIndex));tt.miniProgram.navigateTo({url:"/pages/upload-page/upload-page?token="+this.token+"&sku="+this.productno+"&minnum="+this.minnum+"&maxnum="+this.maxnum+"&gid="+localStorage.getItem(this.pageKey.goodsid)+"&pid="+localStorage.getItem(this.pageKey.productId)+"&id="+e+(null==t||void 0==t||""==t?"":"&p="+t)+(null==l||void 0==l||""==l?"":"&numIndex="+l)+(null==r||void 0==r||""==r?"":"&isEditCover="+r)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+"&isContinueDesign=false&history=false&isPart=false&isfirst=true&submit=true&hassort=0&isSimple="+o,success:function(e){},fail:function(e){console.log("navigateTo调用失败")}})}}}},changeURLArg:function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var retuenUrl=url,temp="/(&"+arg+"=)([^&]*)/gi";eval(temp).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temp),"&"+replaceText));var temps="/([?])("+arg+"=)([^&]*)/gi";return eval(temps).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temps),"?"+replaceText)),retuenUrl}return url.indexOf("?")>0?url+"&"+replaceText:url+"?"+replaceText},templateList:function(e,t){var i=this,a=this,o=!0;if(console.log("isGongge:",this.isGongge),(this.isGongge||this.isNamePaste||this.isEcdbook||this.isSignleTempleBook)&&(o=!1),this.isCopyBook){this.showLoading=!1,o=!1;this.$route.query.sku,this.$route.query.token,this.$route.query.orderNo;this.$router.replace({name:"copybook",query:{sku:this.$route.query.sku,token:this.$route.query.token,orderNo:this.$route.query.orderNo,id:id,p:p,isfirst:!0,isWeixin:this.is_weixn,isAlipay:this.is_alipay,lianzitieSingle:this.$route.query.lianzitieSingle}})}else if(this.isVideoBook){this.showLoading=!1,o=!1;var s=this.$route.query.sku,n=this.$route.query.token,r=this.$route.query.orderNo,l=this.bookVH;this.isTouTiao?(console.log("======字节环境====="),tt.miniProgram.navigateTo({url:"/pages/videobook/videobook?sku="+s+"&token="+n+"&orderNo="+r+"&bookVH="+l,success:function(e){console.log(e)},fail:function(e){console.log(e),console.log("navigateTo调用失败")}})):this.is_alipay?(console.log("======支付宝环境======"),loadScript("https://appx/web-view.min.js",function(){my.navigateTo({url:"/pages/videobook/videobook?sku="+s+"&token="+n+"&orderNo="+r+"&bookVH="+l,success:function(e){console.log(e)},fail:function(e){console.log("navigateTo调用失败")}})})):this.$router.replace({name:"videoBook",query:{sku:this.$route.query.sku,token:this.$route.query.token,orderNo:this.$route.query.orderNo,bookVH:this.bookVH,id:id,p:p,isfirst:!0,isWeixin:this.is_weixn,isAlipay:this.is_alipay}})}else Object(_api_getJson__WEBPACK_IMPORTED_MODULE_10__["t"])(e,t,1,"",o,"",this.singleTempleId).then(function(e){if(e.result){if(a.items=e.data.ptList,a.wsid&&""!=a.wsid&&a.items.length>0){var t=JSON.parse(localStorage.getItem(a.pageKey.orderInfo));t.goodsname=e.data.tlist[0].name,a.$store.dispatch("updateOrderInfo",t),localStorage.setItem(i.pageKey.orderInfo,JSON.stringify(t))}if(0==e.data.tlist.length)return i.showLoading=!1,void layer.alert("找不到对应的模板，请联系客服");var o=e.data.tlist[0].id,s="";e.data.doubleface&&(s=e.data.doubleface),"双页模式"==e.data.tlist[0].designmodel&&"year_calendar"==e.data.tlist[0].diytype?1!=s&&(i.doubble=!0,localStorage.setItem(i.pageKey.designmodel,"pair")):localStorage.removeItem(i.pageKey.designmodel),a.productId=e.data.productid,a.goodsid=e.data.goodsids,a.motherid=e.data.motherid,a.pnum=e.data.pnum,a.tpnum=e.data.tpnum,a.minnum=e.data.minnum,a.maxnum=e.data.maxnum,a.totalNumberOfPages=e.data.totalNumberOfPages,a.videoupload=e.data.videoupload,a.videonum=e.data.videonum,localStorage.setItem(a.pageKey.pnum,e.data.pnum),localStorage.setItem(a.pageKey.goodsid,a.goodsid),localStorage.setItem(a.pageKey.motherid,a.motherid),localStorage.setItem(a.pageKey.productId,a.productId),localStorage.setItem(a.pageKey.minnum,a.minnum),localStorage.setItem(a.pageKey.maxnum,a.maxnum),localStorage.setItem(a.pageKey.isVideo,a.videoupload),localStorage.setItem(a.pageKey.videonum,a.videonum),localStorage.setItem(a.pageKey.isTeamBook,e.data.isTeamBook),localStorage.setItem(a.pageKey.isPart,!1),localStorage.setItem(a.pageKey.rk,e.data.producttype),localStorage.setItem(a.pageKey.fold,e.data.tlist[0].mobilestyleid),localStorage.setItem(a.pageKey.diytype,e.data.tlist[0].diytype),a.isTeamBook=e.data.isTeamBook,a.isTeamBook&&(localStorage.setItem(a.pageKey.source,"isTeamBook"),document.title="如琢毕业册"),a.videoupload&&(a.isVideo=a.videoupload),a.isWxEnv(a.isVideo),a.goUpload(o,a.pnum)}else layer.alert(e.msg)})}}}},9621:function(e,t,i){"use strict";function a(e,t){var i=!1,a=e.top,o=e.left,s=e.left+e.width,n=e.top+e.height,r=t.top,l=t.left,d=t.left+t.width,c=t.top+t.height;return n<r||o>d||a>c||s<l||(i=!0),i}function o(e,t,i,a,o,s){var n,r,l=!1,d=e,c=t,h=document.getElementById("svg_"+a).clientWidth,g=document.getElementById("svg_"+a).clientHeight,m=o.pageList[a].diyDisplayWidth,p=o.pageList[a].diyDisplayHeight;n=d-(document.getElementById("drawing").offsetWidth-document.getElementById("div_"+a).offsetWidth)/2,s&&(n=d),r=c-document.getElementById("div_"+a).offsetTop,s&&(r=c);var u=n*m/h,f=r*p/g,y=i.x(),_=i.y(),v=y+i.width(),w=_+i.height();return u>y&&f>_&&u<v&&f<w&&(l=!0),console.log("=====isInObjArea:"+l),l}function s(e,t,i,a,o){var s,r,l=!1,d=e,c=t,h=document.getElementById("svg_"+a).clientWidth,g=document.getElementById("svg_"+a).clientHeight,m=o.pageList[a].diyDisplayWidth,p=o.pageList[a].diyDisplayHeight,u=n(document.getElementById("div_"+a));console.log(u),s=d-u.left,r=c-u.top;var f=s*m/h,y=r*p/g,_=i.x(),v=i.y(),w=_+i.width(),b=v+i.height();return f>_&&y>v&&f<w&&y<b&&(l=!0),l}function n(e){var t=document,i=e.getBoundingClientRect(),a=i.left,o=i.top;return a+=t.documentElement.scrollLeft||t.body.scrollLeft,o+=t.documentElement.scrollTop||t.body.scrollTop,{left:a,top:o}}function r(e,t,i,a){for(var s={},n=a.pageList[i].content.itemList,r=0;r<n.length;r++)if("advancedImageMask"==n[r].media.mediaType||n[r].cutArea&&n[r].cutArea.fromAiCut&&"image"==n[r].media.mediaType){var l,d;"advancedImageMask"==n[r].media.mediaType?(l=SVG("#maskBg_"+i+"_"+r),d=SVG("#bgimg_photo_"+i+"_"+r)):n[r].cutArea.fromAiCut&&(l=SVG("#clip_"+i+"_"+r),d=SVG("#decrorate_"+i+"_"+r));document.documentElement.scrollTop||document.body.scrollTop;var c=o(e,t,l,i,a,!0);if(c){s.maskOrClipObj=l,s.photoObj=d;break}}return s}i.d(t,"b",function(){return a}),i.d(t,"c",function(){return o}),i.d(t,"d",function(){return s}),i.d(t,"a",function(){return r})},"963b":function(e,t,i){e.exports=i.p+"static/img/xiugai.f419cb04.png"},"978b":function(e,t,i){},9800:function(e,t,i){e.exports=i.p+"static/img/ecd_test.389541d6.png"},"999a":function(t,i,a){"use strict";a.d(i,"b",function(){return U}),a.d(i,"c",function(){return F}),a.d(i,"a",function(){return ne});a("c5f6"),a("7f7f"),a("4917"),a("28a5");var o,s,n,r,l,d,c,h,g,m,p,u,f,y,_,v=a("d80f"),w=a("a181"),b=a("a244"),I=a("4ba4"),S=(a("2c48"),a("08b0")),x=a("66a2"),k=a("9621"),O=a("201f"),L=w["a"].decorateNameStr,T=w["a"].rotaNameStr,C=(w["a"].controlNameStr,w["a"].deleteNameStr),P=w["a"].scaleNameStr,j=w["a"].replaceNameStr,A="text_",N="bgimage_",E="bgshape_",J="pixWarn_",D=a("3523"),B=!1,K=!1,M=null;function U(e){u=R.bind(this,e),f=q.bind(this,e),y=G.bind(this,e),_=z.bind(this,e),document.addEventListener("touchstart",u),document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("touchend",y),document.addEventListener("click",_)}function W(e,t,i){var a,o,s;if(e.target.tagName,console.log(K),"image"==e.target.tagName||-1!=e.target.id.indexOf("_touchArea")){if(console.log(K),-1!=e.target.id.indexOf(C)||-1!=e.target.id.indexOf(P)||-1!=e.target.id.indexOf(T)||-1!=e.target.id.indexOf(L)||-1!=e.target.id.indexOf(N)||-1!=e.target.id.indexOf(E)||-1!=e.target.id.indexOf(j)){b=e.target.id.split("_"),a=b[1],o=b[2];var n=t.pageList[a].content.itemList[o];n.media.mediaType==v["a"].IMAGE?"yes"==n.moveable&&(s=SVG("#"+L+a+"_"+o)):n.media.mediaType==v["a"].TEXT?"yes"!=n.moveable&&1!=n.changeMove||(s=SVG("#"+A+a+"_"+o)):(n.media.mediaType,v["a"].ADVANCED_IMAGE_MASK)}}else if("tspan"==e.target.tagName&&-1!=e.target.parentElement.id.indexOf(A)){b=e.target.parentElement.id.split("_"),a=b[1],o=b[2];n=t.pageList[a].content.itemList[o];s=SVG("#"+A+a+"_"+o),"no"==n.moveable&&(s=null)}if("wenziClear"==e.target.id)try{if(i.pageAndIndex&&-1==i.pageAndIndex.indexOf("undefined")&&(b=i.pageAndIndex.split("_"),a=b[0],o=b[1],a&&o)){n=t.pageList[a].content.itemList[o];n.media.mediaType==v["a"].TEXT&&(s=SVG("#"+A+a+"_"+o))}}catch(e){console.log(e)}if(-1!=e.target.id.indexOf("bgimg_photo_")){var r=e.target.id.split("_"),l=SVG("#maskBg_"+r[2]+"_"+r[3]),d=document.documentElement.scrollTop||document.body.scrollTop,c=e.clientY+d,h=Object(k["c"])(e.pageX,c,l,r[2],t);if(e.clientY||(c=e.targetTouches[0].clientY+d,h=Object(k["c"])(e.targetTouches[0].pageX,c,l,r[2],t)),!h)for(var g=t.pageList[r[2]].content.itemList,m=0;m<g.length;m++){var p=g[m];if("yes"==p.moveable&&p.media.mediaType==v["a"].TEXT&&m<r[3]){var u=SVG("#text_"+r[2]+"_"+m);if(!e.targetTouches)break;var f=e.targetTouches[0].clientY+d,y=Object(k["c"])(e.targetTouches[0].pageX,f,u,r[2],t);if(y){s=SVG("#text_"+r[2]+"_"+m),s.isTempleText=!0,i.unSelectAll(),s.borderControl.click=!0,i.pageAndIndex=r[2]+"_"+m,i.documentDelegation(s.borderControl,s);break}if(SVG("#text_"+r[2]+"_"+m).borderControl.click){var _,w,b=i.pageAndIndex.split("_");if(r[2]!=b[0]||m!=b[1])break;e.targetTouches&&(_=e.targetTouches[0].pageX,w=f);b=i.pageAndIndex.split("_");var I=SVG("#delete_"+b[0]+"_"+b[1]),S=Object(k["c"])(_,w,I,b[0],t);if(S){s=SVG("#text_"+b[0]+"_"+b[1]),s.isInTempleTextDeleteBtn=!0;break}var x=SVG("#rota_"+b[0]+"_"+b[1]),O=Object(k["c"])(e.targetTouches[0].pageX,f,x,b[0],t);if(O){s=SVG("#text_"+b[0]+"_"+b[1]),s.isInTempTextRotaBtn=!0;break}SVG("#controlBorder_"+b[0]+"_"+b[1]),y=Object(k["c"])(e.targetTouches[0].pageX,f,u,r[2],t);y&&(s=SVG("#text_"+b[0]+"_"+b[1]),s.isTempleText=!0)}}}}return s}function F(){document.removeEventListener("touchstart",u),document.removeEventListener("touchmove",f,{passive:!1}),document.removeEventListener("touchend",y),document.removeEventListener("click",_)}var R=function(e,t){if(!(t.target.parentElement&&"sjky-txt-name"==t.target.parentElement.className||t.target.parentElement&&t.target.parentElement.parentElement&&"sjky-txt-name"==t.target.parentElement.parentElement.className)&&!("function"==typeof t.target.className.indexOf&&t.target.className.indexOf("layui-layer")>-1)){try{$("#popTemplate2 .sjky-txt-name li").eq(0).addClass("on").siblings().removeClass("on")}catch(o){console.log(o)}try{e.handleSpeLetter()}catch(t){console.log(t)}var i=JSON.parse(localStorage.getItem(e.pageKey.detailJson));if(h=W(t,i,e),"IMG"==t.target.tagName&&1==K&&oe(M,M.borderControl),M=h,h){var a=h.borderControl;-1!=t.target.id.indexOf(L)||t.target.id.indexOf(A),H(t,a,h,e)}}},q=function(e,t){var i=navigator.userAgent;navigator.appVersion,i.indexOf("Android")>-1||i.indexOf("Linux"),i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(h)if(h.borderControl.click){t.preventDefault();var a=h.borderControl;e.documentDelegation(a,h),V(t,a,h)}else window.event.returnValue=!0;else window.event.returnValue=!0},G=function(e,t){try{e.handleSpeLetter()}catch(t){console.log(t)}if(h&&0==B){console.log("eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeend");var i=h.borderControl;Y(t,i,h),h=null}},z=function(e,t){if(!("function"==typeof t.target.className.indexOf&&t.target.className.indexOf("layui-layer")>-1)&&!("function"==typeof t.target.parentElement.className.indexOf&&-1!=t.target.parentElement.className.indexOf("textCon")||"function"==typeof t.target.className.indexOf&&-1!=t.target.className.indexOf("textCon"))&&"file"!=t.target.type){var i=se(t.target,"popup-window");if(!i){var a=JSON.parse(localStorage.getItem(e.pageKey.detailJson));if(h=W(t,a),-1!=t.target.id.indexOf("bgimg_photo"))return $(".close-popup").click(),void(e.myText="");if(!e.isShow)if(e.handleSpeLetter(),-1!=t.target.id.indexOf(L)||-1!=t.target.id.indexOf(A)||"tspan"==t.target.tagName&&t.target.parentElement.id==h.id());else{if(e.pageAndIndex){var o=e.pageAndIndex.split("_"),s=v["a"].TEXT+"_"+o[0]+"_"+o[1],n=SVG("#"+s),r="decrorate_"+o[0]+"_"+o[1],l=SVG("#"+r);n||l?(console.info("点击事件装饰或文字"),l&&!n?"proTit proTitClass"!=t.target.parentElement.className&&"sjky-right-btn"!=t.target.parentElement.className&&"sjky-img-wrap"!=t.target.parentElement.className&&"sjky-btn-blue sjky-site1"!=t.target.parentElement.className&&"sjky-btn-blue sjky-site2"!=t.target.parentElement.className?(console.log(t.target.id),t.target.id.indexOf(j)>-1||(e.unSelectAll(),$(".close-popup").click(),e.pageAndIndex=o[0]+"_undefined",console.info("点击事件装饰或文字111"),e.closeAllPop&&e.closeAllPop())):"proTit proTitClass"==t.target.parentElement.className||"sjky-btn-blue sjky-site2"==t.target.parentElement.className||(e.unSelectAll(),e.pageAndIndex=o[0]+"_undefined",e.closeAllPop&&e.closeAllPop()):!l&&n&&(-1!=t.target.id.indexOf("wenzi")||"sjky-right-btn"==t.target.parentElement.className||"tab-box sjky-pr"==t.target.parentElement.className||"txtLib open-popup"==t.target.parentElement.className||(e.unSelectAll(),e.pageAndIndex=o[0]+"_undefined",e.myText="",console.info("点击事件装饰或文字333"),e.closeAllPop&&e.closeAllPop()),"sjky-btn-blue sjky-site2"==t.target.parentElement.className||-1!=t.target.id.indexOf("wenzi")||"tab-box sjky-pr"==t.target.parentElement.className||"txtLib open-popup"==t.target.parentElement.className||("sjky-right-btn"==t.target.parentElement.className?(e.unSelectAll(),e.pageAndIndex=o[0]+"_undefined",e.closeAllPop&&e.closeAllPop()):$(".close-popup").click())),-1!=t.target.id.indexOf("wenzi")?"wenziClose"==t.target.id&&(e.unSelectAll(),e.pageAndIndex=o[0]+"_undefined",e.myText="",e.closeAllPop&&e.closeAllPop()):e.myText=""):(e.closeAllPop&&e.closeAllPop(),-1!=t.target.id.indexOf("wenzi")&&""==t.target.id?$(".close-popup").click():-1==e.pageAndIndex.indexOf("undefined")&&"sjky-btn-blue sjky-site2"!=t.target.parentElement.className&&$(".close-popup").click(),-1!=t.target.id.indexOf("wenzi")||"tspan"==t.target.tagName&&t.target.parentElement.id==h.id()||(e.unSelectAll(),e.pageAndIndex=o[0]+"_undefined",e.myText=""))}a=JSON.parse(localStorage.getItem(e.pageKey.detailJson));e.isUpdateDom=!1,e.$store.dispatch("updatePages",a),h&&h.borderControl.click&&(h.borderControl.click=!1),document.addEventListener("touchmove",function(e){h||(window.event.returnValue=!0)},{passive:!1}),document.addEventListener("touchend",function(e){h||(window.event.returnValue=!0)},{passive:!1}),document.removeEventListener("touchmove",function(e){},{passive:!1}),document.removeEventListener("touchend",function(e){},{passive:!1})}}}},H=function(e,t,i,a){n=i.x(),r=i.y(),d=i.width(),c=i.height(),o=e.targetTouches[0].pageX;var l=document.documentElement.scrollTop||document.body.scrollTop,u=e.targetTouches[0].clientY+l;s=u;var f=i.cx(),y=i.cy(),_=JSON.parse(localStorage.getItem(a.pageKey.detailJson));g=i.x(),m=i.y(),p=_.pageList[t.pageIndex].content.itemList[t.itemIndex].location.rotation;var v=Q(_,t.pageIndex,o,s);if(-1!=e.target.id.indexOf(T+"_"+t.pageIndex+"_"+t.itemIndex)&&!i.startAngle){if(0!=_.pageList[t.pageIndex].content.itemList[t.itemIndex].location.rotation){var w=v.x,I=v.y,S=0-_.pageList[t.pageIndex].content.itemList[t.itemIndex].location.rotation,x=Object(b["b"])(w,I,S,f,y);v.x=x.x,v.y=x.y}i.startAngle=Math.atan2(y-v.y,f-v.x)}if(-1==e.target.id.indexOf(i.id())&&"tspan"==e.target.tagName&&e.target.parentElement.id==i.id()||i.isTempleText){var k=i.id(),O=document.getElementById(k).getBBox().width,L=document.getElementById(k).getBBox().height;O>i.width()&&i.width(O),L>i.height()&&i.height(L),t.updateBorderAndControl(t,i),Z(t,i);try{var P=_.pageList[t.pageIndex].content.itemList[t.itemIndex];if("text"==P.media.mediaType&&"yes"==P.moveable){var j=i.font("fill"),A=a.textColor;for(var N in A)A[N]==j&&$(".sjky-sel-col li").eq(N).addClass("on").siblings().removeClass("on");var E=i.font("family"),J=a.$store.getters.allFontInfo;for(var D in J)J[D].name==E&&$("#popTemplate2 .sjky-txt-name li").eq(D).addClass("on").siblings().removeClass("on")}}catch(q){console.log(q)}}if(-1!=e.target.id.indexOf(C+"_"+t.pageIndex+"_"+t.itemIndex)||"wenziClear"==e.target.id||i.isInTempleTextDeleteBtn){e.stopPropagation(),B=!0;P=_.pageList[t.pageIndex].content.itemList[t.itemIndex];P.changeMove?t.changeMove=!0:t.changeMove=!1;try{i.id().split("_");var K=i.parent().parent().children(),M=Number(K.indexOf(i.parent()));console.log("删除装饰ddd："+i.parent()),i.parent().remove(),K.splice(M,1),K.splice(0,1),i=null,ie(t,i),t.vm.editObjArr=[];for(N=0;N<=K.length-1;N++){var U=K[N].id();if(U){var W=U.split("_");K[N].id(W[0]+"_"+N);var F=K[N].children();for(D=0;D<F.length;D++){var R=F[D].id().split("_");"bgimg"==R[0]&&"photo"==R[1]?F[D].id(R[0]+"_"+R[1]+"_"+R[2]+"_"+N):"touchArea"==R[3]?F[D].id(R[0]+"_"+R[1]+"_"+N+"_"+R[3]):F[D].id(R[0]+"_"+R[1]+"_"+N),F[D].borderControl&&(F[D].borderControl.itemIndex=N),F[D].itemIndex&&(F[D].itemIndex=N)}}}ae(t),h=null,B=!1}catch(e){h=null,B=!1}}},V=function(e,t,i){var a=e.targetTouches[0].pageX,h=document.documentElement.scrollTop||document.body.scrollTop,g=e.targetTouches[0].clientY+h,m=g,p=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson)),u=p.pageList[t.pageIndex].content.itemList[t.itemIndex];if("text"!=u.media.mediaType||"no"!=u.moveable||u.media.font.textPath||(u.moveable="yes",localStorage.setItem(t.vm.pageKey.detailJson,JSON.stringify(p))),-1!=e.target.id.indexOf(P+"_"+t.pageIndex+"_"+t.itemIndex)){p=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));var f=document.getElementById("svg_"+t.pageIndex).clientWidth,y=document.getElementById("svg_"+t.pageIndex).clientHeight,_=p.pageList[t.pageIndex].diyDisplayWidth,v=p.pageList[t.pageIndex].diyDisplayHeight;q=a-(document.getElementById("drawing").offsetWidth-document.getElementById("div_"+t.pageIndex).offsetWidth)/2,G=m-document.getElementById("div_"+t.pageIndex).offsetTop;var w=q*_/f,b=G*v/y,S=Math.round(1e3*Math.sqrt((w-i.cx())*(w-i.cx())+(b-i.cy())*(b-i.cy())))/1e3,k=Math.round(S/t.regularSpace*1e3)/1e3,L=d*k,C=c*k,j=n-(L-d)/2,A=r-(C-c)/2;if(p.pageList[t.pageIndex].content.itemList[t.itemIndex].isVideo){var N=35,E=x["a"].dpi,J=x["a"].inchmm,D=(p.pageList[t.pageIndex].diyWorkAreaWidth,p.pageList[t.pageIndex].workAreaWidth,p.pageList[t.pageIndex].diyWorkAreaWidth/(p.pageList[t.pageIndex].workAreaWidth/J*E)),B=N/J*E;if(L/B<D){if(!e.target.hasWarn){try{if(window._jylog){var K=localStorage.getItem(t.vm.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计页面","提示","二维码宽高过小！否则无法扫码！",JSON.parse(K).orderNo])}}catch(e){console.log(e)}layer.alert("二维码宽高过小！否则无法扫码！",function(t){e.target.hasWarn=!1,layer.close(t)}),e.target.hasWarn=!0}L=B*D,C=L/(t.objJson.location.width/t.objJson.location.height)}}var M=Object(I["a"])(t.vm,j,A,i.transform("rotate"),i.cx(),i.cy(),i,p,t.pageIndex,!0,L,C);if(M)return;i.attr({width:L,height:C}),i.attr({x:j,y:A}),t.updateBorderAndControl(t,i),Z(t,i)}if(-1!=e.target.id.indexOf(T+"_"+t.pageIndex+"_"+t.itemIndex)||i.isInTempTextRotaBtn){var $=i.cx(),U=i.cy(),W=(p=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson)),Q(p,t.pageIndex,a,m)),F=X($,U,W.x,W.y,i)/Math.PI*180;F>-10&&F<10&&(F=0),F>80&&F<100&&(F=90),F>170&&F<190&&(F=180),F>260&&F<280&&(F=270);M=Object(I["a"])(t.vm,i.x(),i.y(),F,i.cx(),i.cy(),i,p,t.pageIndex);if(M)return;var R="rotate("+F+","+i.cx()+","+i.cy()+")";if("text"!=u.media.mediaType){var q,G;f=document.getElementById("svg_"+t.pageIndex).clientWidth,y=document.getElementById("svg_"+t.pageIndex).clientHeight,_=p.pageList[t.pageIndex].diyDisplayWidth,v=p.pageList[t.pageIndex].diyDisplayHeight;q=a-(document.getElementById("drawing").offsetWidth-document.getElementById("div_"+t.pageIndex).offsetWidth)/2,G=m-document.getElementById("div_"+t.pageIndex).offsetTop;w=q*_/f,b=G*v/y,S=Math.round(1e3*Math.sqrt((w-i.cx())*(w-i.cx())+(b-i.cy())*(b-i.cy())))/1e3,k=Math.round(S/t.regularSpace*1e3)/1e3,L=d*k,C=c*k,j=n-(L-d)/2,A=r-(C-c)/2;if(p.pageList[t.pageIndex].content.itemList[t.itemIndex].isVideo){N=35,E=x["a"].dpi,J=x["a"].inchmm,p.pageList[t.pageIndex].diyWorkAreaWidth,p.pageList[t.pageIndex].workAreaWidth,D=p.pageList[t.pageIndex].diyWorkAreaWidth/(p.pageList[t.pageIndex].workAreaWidth/J*E),B=N/J*E;if(L/B<D){if(!e.target.hasWarn){try{if(window._jylog){K=localStorage.getItem(t.vm.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计页面","提示","二维码宽高过小！否则无法扫码！",JSON.parse(K).orderNo])}}catch(e){console.log(e)}layer.alert("二维码宽高过小！否则无法扫码！",function(t){e.target.hasWarn=!1,layer.close(t)}),e.target.hasWarn=!0}L=B*D,C=L/(t.objJson.location.width/t.objJson.location.height)}}M=Object(I["a"])(t.vm,j,A,i.transform("rotate"),i.cx(),i.cy(),i,p,t.pageIndex,!0,L,C);if(M)return;i.attr({width:L,height:C}),i.attr({x:j,y:A})}if(i.attr({transform:R}),Object(O["a"])(i,p.pageList[t.pageIndex].content.itemList[t.itemIndex]),"text"==u.media.mediaType){var z=SVG("#textStroke_"+t.pageIndex+"_"+t.itemIndex);z&&(z.attr({transform:R}),Object(O["a"])(z,p.pageList[t.pageIndex].content.itemList[t.itemIndex]))}t.updateBorderAndControl(t,i),Z(t,i)}if(-1!=e.target.id.indexOf(i.id())&&"tspan"!=e.target.tagName&&e.target.id==i.id()||-1==e.target.id.indexOf(i.id())&&"tspan"==e.target.tagName&&e.target.parentElement.id==i.id()||i.isInTempleTextArea){p=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson)),f=document.getElementById("svg_"+t.pageIndex).clientWidth,y=document.getElementById("svg_"+t.pageIndex).clientHeight,_=p.pageList[t.pageIndex].diyDisplayWidth,v=p.pageList[t.pageIndex].diyDisplayHeight,Math.abs(i.transform("rotate")-l),Math.PI,j=a,A=m;var H=o,V=s,Y=Math.round((j-H)*_/f),ee=Math.round((A-V)*v/y);if(i.x()==n+Y&&i.y()==r+ee)return;M=Object(I["a"])(t.vm,n+Y,r+ee,i.transform("rotate"),i.cx()+Y,i.cy()+ee,i,p,t.pageIndex);if(M)return;F=i.transform("rotate"),R="rotate(0,"+i.cx()+","+i.cy()+")";if(i.attr({transform:R}),"tspan"==e.target.tagName){i.x(Math.round(n+Y)),i.y(Math.round(r+ee));z=SVG("#textStroke_"+t.pageIndex+"_"+t.itemIndex);z&&(z.x(Math.round(n+Y)),z.y(Math.round(r+ee)))}else{i.attr({x:Math.round(n+Y),y:Math.round(r+ee)});z=SVG("#textStroke_"+t.pageIndex+"_"+t.itemIndex);z&&z.attr({x:Math.round(n+Y),y:Math.round(r+ee)})}R="rotate("+F+","+i.cx()+","+i.cy()+")",i.attr({transform:R}),Object(O["a"])(i,p.pageList[t.pageIndex].content.itemList[t.itemIndex]);z=SVG("#textStroke_"+t.pageIndex+"_"+t.itemIndex);z&&(z.attr({transform:R}),Object(O["a"])(z,p.pageList[t.pageIndex].content.itemList[t.itemIndex])),t.updateBorderAndControl(t,i),Z(t,i)}},Y=function(e,t,i){if(i){i.cx(),i.cy();var a=e.changedTouches[0].pageX,o=document.documentElement.scrollTop||document.body.scrollTop,s=e.changedTouches[0].clientY+o,n=s,r=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));Q(r,t.pageIndex,a,n);if(i.id()){try{var l="",d="",c="";l="image"==r.pageList[t.pageIndex].content.itemList[t.itemIndex].media.mediaType&&"yes"==r.pageList[t.pageIndex].content.itemList[t.itemIndex].moveable?"装饰":"文字";var h=t.pageIndex+","+t.itemIndex+";";if(g==i.x()&&m==i.y()||(d="移动:"+g+"->"+i.x()+","+m+"->"+i.y()),p!=i.transform("rotate")&&(c=p+"旋转"+i.transform("rotate")),window._jylog){var u=localStorage.getItem(t.vm.pageKey.orderInfo);window._jylog.push(["按钮点击","设计",l+"点击",h,JSON.parse(u).orderNo]),""!=d&&window._jylog.push(["按钮点击","设计",l+"移动",h+d,JSON.parse(u).orderNo]),""!=c&&window._jylog.push(["按钮点击","设计",l+"旋转",h+c,JSON.parse(u).orderNo])}}catch(e){console.log(e)}var f=i.id().split("_"),y=(r=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson)),!0);if(Object(I["a"])(t.vm,i.x(),i.y(),i.transform("rotate"),i.cx(),i.cy(),i,r,f[1],null,null,null,null,y),t.regularSpace){var _=SVG("#"+P+"_"+f[1]+"_"+f[2]);i.borderControl.updateRegularSpace(_,i)}if(Z(t,i),t.vm.$store.dispatch("updatePages",r),"yes"==r.pageList[f[1]].content.itemList[f[2]].moveable){var w,b=r.pageList[f[1]].diyWorkAreaWidth/r.pageList[f[1]].workAreaWidth;if(2==r.templateInfo.coverper&&r.coverInfo.hascover&&0==f[1]){w=x["a"].yignkeProductBleedSpace;var S=localStorage.getItem(t.vm.pageKey.rk);4==S&&(w=x["a"].rkBleedSpace)}else w=x["a"].productBleedSpace;var k=w*b,O=r.pageList[f[1]].content.itemList[0].location.x,L=r.pageList[f[1]].content.itemList[0].location.y,T=r.pageList[f[1]].content.itemList[0].location.width,C=r.pageList[f[1]].content.itemList[0].location.height,A=O+k,N=L+k,E=T-2*k,J=C-2*k;"calendar"!=r.diyType&&"year_calendar"!=r.diyType||(A=O,N=L,E=T,J=C);var D=r.pageList[f[1]].content.itemList[f[2]].printLocation.x,B=r.pageList[f[1]].content.itemList[f[2]].printLocation.y,K=r.pageList[f[1]].content.itemList[f[2]].printLocation.width,M=r.pageList[f[1]].content.itemList[f[2]].printLocation.height;(D+K<=A||D>=A+E||B+M<=N||B>=N+J)&&oe(i,t)}}}if(-1!=e.target.id.indexOf(j+"_"+t.pageIndex+"_"+t.itemIndex)||"wenziClear"==e.target.id||i.isInTempleTextDeleteBtn){e.stopPropagation(),e.preventDefault();r=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));var $=r.pageList[t.pageIndex].content.itemList[t.itemIndex];$.media.mediaType==v["a"].TEXT?t.vm.replaceDecrorateOrText():setTimeout(function(){t.vm.replaceDecrorateOrText()},300)}};function X(e,t,i,a,o){var s=o.startAngle||0,n=Math.atan2(t-a,e-i);return n-s}var Q=function(e,t,i,a){var o={},s=document.getElementById("svg_"+t).clientWidth,n=document.getElementById("svg_"+t).clientHeight,r=e.pageList[t].diyDisplayWidth,l=e.pageList[t].diyDisplayHeight,d=i-(document.getElementById("drawing").offsetWidth-document.getElementById("div_"+t).offsetWidth)/2,c=a-document.getElementById("div_"+t).offsetTop,h=d*r/s,g=c*l/n;return o.x=h,o.y=g,o},Z=function(t,i){var a=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));try{if(-1!=i.id().indexOf("text")&&a.pageList[t.pageIndex].content.itemList[t.itemIndex].media.mediaType==v["a"].IMAGE&&1==a.pageList[t.pageIndex].content.itemList[t.itemIndex].isDisplay)return}catch(e){console.log(e)}if(a.pageList[t.pageIndex].content.itemList[t.itemIndex].media.mediaType!=v["a"].IMAGE||1!=a.pageList[t.pageIndex].content.itemList[t.itemIndex].backSign&&1!=a.pageList[t.pageIndex].content.itemList[t.itemIndex].barTypeSign){if(0==i.transform("rotate")){var o=i.x();a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.rotation=i.transform("rotate"),a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.x=o,a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.y=i.y(),a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.width=i.width(),a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.height=i.height(),a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.rotation=i.transform("rotate"),a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.x=o,a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.y=i.y(),a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.width=i.width(),a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.height=i.height()}else{var s=i.x(),n=i.y(),r=(Object(b["a"])(s,n,i.width(),i.height(),i.transform("rotate")),Object(b["b"])(i.x(),i.y(),i.transform("rotate"),i.cx(),i.cy()));a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.rotation=i.transform("rotate"),a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.x=r.x,a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.y=r.y,a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.width=i.width(),a.pageList[t.pageIndex].content.itemList[t.itemIndex].location.height=i.height();var l=Object(b["a"])(r.x,r.y,i.width(),i.height(),i.transform("rotate"));a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.rotation=i.transform("rotate"),a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.x=l.x,a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.y=l.y,a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.width=l.width,a.pageList[t.pageIndex].content.itemList[t.itemIndex].printLocation.height=l.height}"image"==a.pageList[t.pageIndex].content.itemList[t.itemIndex].media.mediaType&&"yes"==a.pageList[t.pageIndex].content.itemList[t.itemIndex].moveable&&-1==a.pageList[t.pageIndex].content.itemList[t.itemIndex].tagid&&ee(i,t,a);var d=JSON.stringify(a);localStorage.setItem(t.vm.pageKey.detailJson,d)}else layer.alert("素材数据有误，请刷新页面重试",function(e){layer.close(e)})},ee=function(e,t,i){var a=i.pageList[t.pageIndex].content.itemList[t.itemIndex];if(!(a.location.maskFactHeight<requireHeight||a.location.maskFactWidth<requireWidth)||-1!=a.media.maskSource.indexOf("img/nophoto.jpg")){for(var o=25.4,s=300,n=2.5,r=i.pageList[t.pageIndex].workAreaWidth/o*s,l=i.pageList[t.pageIndex].workAreaHeight/o*s,d=(i.pageList[t.pageIndex].diyDisplayWidth,0),c=0,h=i.pageList[t.pageIndex].content.itemList,g=0;g<h.length;g++)if(h[g].isDesignShape&&1==h[g].isDesignShape){d=h[g].location.width,c=h[g].location.height;break}var m=Number(r)/d,p=Number(l)/c,u=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.factWidth/m,f=i.pageList[t.pageIndex].content.itemList[t.itemIndex].location.factHeight/p,y=e.width(),_=e.height();if(console.log(y/u+":"+n),y/u>n||_/f>n){var v;console.log("图片放大后模糊！");var w="#"+J+t.pageIndex+"_"+t.itemIndex;SVG(w)?(v=SVG(w),v.remove(),v=te(t,i)):v=te(t,i)}else{w="#"+J+t.pageIndex+"_"+t.itemIndex;SVG(w)&&SVG(w).remove()}}},te=function(e,t){var i=SVG("#group"+e.pageIndex+"_"+e.itemIndex);if(i){var a=i.image(D,function(){}),o=575,s=30,n=s,r=10,l=t.pageList[e.pageIndex].content.itemList[e.itemIndex].location.x,d=t.pageList[e.pageIndex].content.itemList[e.itemIndex].location.y,c=t.pageList[e.pageIndex].diyDisplayWidth/o;n=s*c,r*c,a.attr({id:J+e.pageIndex+"_"+e.itemIndex}),a.attr({class:"show-warn",width:n,height:n,x:l+t.pageList[e.pageIndex].content.itemList[e.itemIndex].location.width/2-n/2,y:d+t.pageList[e.pageIndex].content.itemList[e.itemIndex].location.height/2-n/2})}},ie=function(t,i){var a=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));a.pageList[t.pageIndex].content.itemList[t.itemIndex].isVideo&&(a.pageList[t.pageIndex].videoUuid="");try{if(window._jylog)if("text"==a.pageList[t.pageIndex].content.itemList[t.itemIndex].media.mediaType){var o=localStorage.getItem(t.vm.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","删除文字","",JSON.parse(o).orderNo])}else{o=localStorage.getItem(t.vm.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","删除装饰","",JSON.parse(o).orderNo])}}catch(e){console.log(e)}a.pageList[t.pageIndex].content.itemList.splice(t.itemIndex,1);var s=JSON.stringify(a);localStorage.setItem(t.vm.pageKey.detailJson,s),t.vm.$store.dispatch("updatePages",a),t.vm.pageAndIndex=t.pageIndex+"_undefined"},ae=function(e){var t=JSON.parse(localStorage.getItem(e.vm.pageKey.detailJson)),i="#svg_"+e.pageIndex,a=!1,o={detailJson:t,pageId:i,vm:e.vm,isEdit:a,isPhotoChange:!1,isChangeModel:!0,isRepeat:!0};SVG(i).remove(),Object(S["a"])(e.pageIndex,o),e.vm.isUpdate=!1},oe=function(e,t){e.id().split("_");var i=e.parent().parent().children(),a=Number(i.indexOf(e.parent()));e.parent().remove(),i.splice(a,1),i.splice(0,1),e=null,ie(t,e);for(var o=0;o<=i.length-1;o++){var s=i[o].id();if(s){var n=s.split("_");i[o].id(n[0]+"_"+o);for(var r=i[o].children(),l=0;l<r.length;l++){var d=r[l].id().split("_");"bgimg"==d[0]&&"photo"==d[1]?r[l].id(d[0]+"_"+d[1]+"_"+d[2]+"_"+o):r[l].id(d[0]+"_"+d[1]+"_"+o),r[l].borderControl&&(r[l].borderControl.itemIndex=o),r[l].itemIndex&&(r[l].itemIndex=o)}}}ae(t)},se=function e(t,i){return"function"==typeof t.className.indexOf&&(t.className.indexOf(i)>-1||!!t.parentElement&&e(t.parentElement,i))};function ne(e,t){e.id().split("_");var i=e.parent().parent().children(),a=Number(i.indexOf(e.parent()));console.log("删除装饰ddd："+e.parent()),e.parent().remove(),i.splice(a,1),i.splice(0,1),e=null,ie(t,e);for(var o=0;o<=i.length-1;o++){var s=i[o].id();if(s){var n=s.split("_");i[o].id(n[0]+"_"+o);for(var r=i[o].children(),l=0;l<r.length;l++){var d=r[l].id().split("_");"bgimg"==d[0]&&"photo"==d[1]?r[l].id(d[0]+"_"+d[1]+"_"+d[2]+"_"+o):r[l].id(d[0]+"_"+d[1]+"_"+o),r[l].borderControl&&(r[l].borderControl.itemIndex=o),r[l].itemIndex&&(r[l].itemIndex=o)}}}ae(t)}},"9c7b":function(e,t,i){},"9de0":function(e,t,i){},a053:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var a=function(e){return e.then(function(e){return[null,e]}).catch(function(e){return[e,null]})}},a062:function(e,t,i){},a09a:function(e,t,i){"use strict";i.d(t,"a",function(){return g});i("c5f6"),i("7f7f");var a=i("d225"),o=i("b0b4"),s=i("5ad2"),n=i("a244"),r=i("66a2"),l=i("201f"),d="text_",c="textStroke_",h="dMaskShape_",g=(i("f84b"),i("58d7"),i("fd6f"),function(){function e(t,i,o){Object(a["a"])(this,e),this.parent=t,this.objJson=i,this.pageImgJson=o,this.pageIndex=o.pageIndex,this.itemIndex=o.itemIndex,this.selfindex=o.selfindex,this.isEdit=o.isEdit,this.vm=o.vm}return Object(o["a"])(e,[{key:"initCustomText",value:function(){var e=this,t=e.objJson.media.text;t=new String(t).replaceAll("\r","\n");var i,a=e.objJson.media.font.id,o=e.objJson.media.font.pointSize,r=e.objJson.media.font.fontColor,h="",g="";void 0!=e.selfindex?(h=d+e.pageIndex+"_"+e.itemIndex+"_"+e.selfindex,g=c+e.pageIndex+"_"+e.itemIndex+"_"+e.selfindex):(h=d+e.pageIndex+"_"+e.itemIndex,g=c+e.pageIndex+"_"+e.itemIndex),i=SVG("#"+h)?SVG("#"+h):e.parent.text(t),i.font({size:o,fill:r});var m=e.vm.$store.getters.idNameJson,p=m[a];FontDetect.isFontLoaded(p)?i.font({family:p}):FontDetect.onFontLoaded(p,function(e){console.log(p+"字体下载成功"),i.font({family:p});var t=SVG("#"+g);t&&t.font({family:p})},function(e){console.log(p+"字体下载失败")},{msTimeout:3e4}),i.attr({id:h});var u,f,y,_,v=[];"yes"==e.objJson.moveable&&i.attr({class:"text_style"}),y=e.objJson.printLocation.x+e.objJson.printLocation.width/2,_=e.objJson.printLocation.y+e.objJson.printLocation.height/2;var w="",b="";if(e.vm.isAlbum){var I=[{animatedClass:" wow fadeInUp animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInUp;"},{animatedClass:" wow fadeInLeftBig animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInLeftBig;"},{animatedClass:" wow fadeInDown animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInDown;"},{animatedClass:" wow bounceInDown animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: bounceInDown;"}],S=0,x=I.length-1,k=x-S,O=Math.random(),L=(S+k*O).toFixed(0);w=I[L].animatedClass,b=I[L].animatedStyle;var T=SVG("#group"+e.pageIndex+"_"+e.itemIndex);T.attr({class:w,"data-wow-delay":"0.2s",style:b})}if(0==e.objJson.location.rotation){u=e.objJson.location.x,f=e.objJson.location.y;var C=e.vm.$store.getters.detailJson;if(void 0!=e.selfindex&&0!=C.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation){var P=0-e.objJson.location.rotation-C.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation,j=Object(n["b"])(e.objJson.location.x,e.objJson.location.y,P,y,_);u=j.x,f=j.y;var A="rotate(0,"+y+","+_+")";i.attr({transform:A})}}else{var N=e.objJson.location.x,E=e.objJson.location.y;P=0-e.objJson.location.rotation;if(void 0!=this.selfindex){C=e.vm.$store.getters.detailJson;P=0-e.objJson.location.rotation-C.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation}j=Object(n["b"])(N,E,P,y,_);u=j.x,f=j.y;A="rotate(0,"+y+","+_+")";i.attr({transform:A})}var J={left:{name:"start",x:u},center:{name:"middle",x:u+e.objJson.location.width/2},right:{name:"end",x:u+e.objJson.location.width}};if(e.objJson.media.font.gravity&&(u=J[e.objJson.media.font.gravity].x),-1!=window.location.href.indexOf("preview")&&e.objJson.media.upLeftToBaseLineY&&(f-=e.objJson.media.upLeftToBaseLineY),i.attr({x:u}),i.y(f),i.width(e.objJson.location.width),i.height(e.objJson.location.height),-1!=window.location.href.indexOf("design")||-1!=window.location.href.indexOf("ecdbook")){var D=i.y()-i.attr("y");0==i.y()&&(D=9),e.objJson.media.upLeftToBaseLineY=D,-1!=window.location.href.indexOf("simpledesign")&&setTimeout(function(){if(e.objJson.media.upLeftToBaseLineY){var t=i.y()-i.attr("y");0==i.y()&&(t=9),e.objJson.media.upLeftToBaseLineY=t,f-=e.objJson.media.upLeftToBaseLineY,i.attr({y:f})}},500)}e.objJson.media.font.gravity&&v.push("text-anchor:"+J[e.objJson.media.font.gravity].name),e.objJson.media.charSpace&&v.push("letter-spacing:"+e.objJson.media.charSpace*e.objJson.media.font.pointSize/1e3),e.objJson.media.font.isBold&&v.push("font-weight:bold");C=e.vm.$store.getters.detailJson;var B=e.objJson.location.rotation;void 0!=this.selfindex&&(B=e.objJson.location.rotation+C.pageList[this.pageIndex].content.itemList[this.itemIndex].location.rotation);A="rotate("+B+","+y+","+_+")";i.attr({opacity:Number(e.objJson.layer.alpha),transform:A});C=e.vm.$store.getters.detailJson;if("yes"!=e.objJson.moveable||"calendar"==C.diyType||"year_calendar"==C.diyType||"week_calendar"==C.diyType||"mug_cup"==C.diyType||"template_cloth"==C.diytype){var K=e.initMaskShape();i.parent().clipWith(K)}if(e.isEdit){var M={parent:e.parent,pageIndex:e.pageIndex,itemIndex:e.itemIndex,vm:e.vm};e.vm.isecd&&(M.repalceDelete=!0);var $=new s["a"](i,e.objJson,M);$.editObj(i),i.borderControl=$}v.push("white-space:pre"),i.attr({style:v.join(";")+";"}),Object(l["a"])(i,e.objJson),Object(l["b"])(i,e.objJson,e.pageIndex,e.itemIndex,e.selfindex)}},{key:"initMaskShape",value:function(){var e,t=this;if(SVG("#"+h+t.pageIndex+"_"+t.itemIndex))return SVG("#"+h+t.pageIndex+"_"+t.itemIndex);e=t.parent.rect();var i=t.vm.$store.getters.detailJson,a=i.pageList[t.pageIndex].content.itemList[0].location.x,o=i.pageList[t.pageIndex].content.itemList[0].location.y,s=i.pageList[t.pageIndex].content.itemList[0].location.width,n=i.pageList[t.pageIndex].content.itemList[0].location.height;if("photo"==i.diyType){var l=i.pageList[t.pageIndex].diyWorkAreaWidth/i.pageList[t.pageIndex].workAreaWidth,d=i.pageList[t.pageIndex].content.itemList[0].location.x,c=i.pageList[t.pageIndex].content.itemList[0].location.y,g=r["a"].productBleedSpace*l,m=d+r["a"].productBleedSpace*l,p=c+r["a"].productBleedSpace*l;if(2==i.templateInfo.coverper&&i.coverInfo.hascover&&0==t.pageIndex&&i.pageList[0].iscover){g=r["a"].yignkeProductBleedSpace*l,m=d+r["a"].yignkeProductBleedSpace*l,p=c+r["a"].yignkeProductBleedSpace*l;var u=localStorage.getItem(t.vm.pageKey.rk);4==u&&(g=r["a"].rkBleedSpace*l,m=d+r["a"].rkBleedSpace*l,p=c+r["a"].rkBleedSpace*l)}a=m,o=p,s=i.pageList[t.pageIndex].content.itemList[0].location.width-2*g,n=i.pageList[t.pageIndex].content.itemList[0].location.height-2*g}return e.attr({id:h+t.pageIndex+"_"+t.itemIndex,x:a,y:o,width:s,height:n}),e}}]),e}())},a181:function(e,t,i){"use strict";var a={decorateNameStr:"decrorate_",rotaNameStr:"rota",controlNameStr:"controlBorder",deleteNameStr:"delete",scaleNameStr:"scale",replaceNameStr:"replace",rotaImgUrl:i("f84b"),scaleImgUrl:i("58d7"),deleteImgUrl:i("fd6f"),replaceImgUrl:i("c949"),controlButtonSize:48};t["a"]=a},a244:function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return o});i("55dd");function a(e,t,i,a,o,s){var n,r,l=0,d=0,c=0,h=0;0==o||360==o?o=0:o>180&&(o-=360),o<-180&&(o+=360),o>=0&&o<=90?(n=Math.sin(o*Math.PI/180),l=e-a*n,d=t,0==o?(c=i,h=a):(c=a*n+i*Math.cos(o*Math.PI/180),h=i*n+a*Math.cos(o*Math.PI/180))):o>90&&o<=180?(n=Math.sin((o-90)*Math.PI/180),r=Math.cos((o-90)*Math.PI/180),d=t-a*n,l=e-a*r-i*n,180==o?(c=i,h=a):(c=a*r+i*n,h=i*r+a*n)):o>=-90&&o<=0?(n=Math.sin(-o*Math.PI/180),l=e,d=t-i*n,r=Math.cos(-o*Math.PI/180),c=a*n+i*r,h=i*n+a*r):o>=-180&&o<-90&&(n=Math.sin(-(o+90)*Math.PI/180),r=Math.cos(-(o+90)*Math.PI/180),l=e-i*n,d=t-i*r-a*n,180==o?(c=i,h=a):(c=i*n+a*r,h=i*r+a*n));var g={x:Math.round(l),y:Math.round(d),width:Math.round(c),height:Math.round(h)};return s&&(g={x:l,y:d,width:c,height:h}),g}function o(e,t,i,a,o){var s=i*Math.PI/180,n=(e-a)*Math.cos(s)-(t-o)*Math.sin(s)+a,r=(e-a)*Math.sin(s)+(t-o)*Math.cos(s)+o;return{x:n,y:r}}},a28f:function(e,t,i){"use strict";i.d(t,"a",function(){return o});i("d80f");var a=i("a244");function o(e,t,i,o){var s=Object(a["b"])(e.x(),e.y(),e.transform("rotate"),e.cx(),e.cy());t.location.rotation=e.transform("rotate"),t.location.x=s.x,t.location.y=s.y,t.location.width=e.width(),t.location.height=e.height();var n=Object(a["a"])(s.x,s.y,e.width(),e.height(),e.transform("rotate"));t.printLocation.rotation=e.transform("rotate"),t.printLocation.x=n.x,t.printLocation.y=n.y,t.printLocation.width=n.width,t.printLocation.height=n.height;var r=JSON.stringify(i);localStorage.setItem(o.pageKey.detailJson,r),o.$store.dispatch("updatePages",i)}},a56f:function(e,t,i){"use strict";i.d(t,"a",function(){return o});i("456d"),i("ac6a");var a=i("d80f");function o(e,t,i){var o=e.pageList;if(o.length<=0)return t;for(var n in o){var r=o[n].content.itemList;for(var l in r){var d=r[l];if(null!=d&&(d.media.mediaType==a["a"].TEXT||d.media.mediaType==a["a"].CURVED_TEXT)){var c,h=d.media.font.id,g=0,m=i.$store.getters.idNameJson;if(Object.keys(m).forEach(function(e){e==h&&(g++,c=m[e]),console.log(e,m[e])}),0==g){var p=m[1030156874];d.fontFamily=p,e.pageList[n].content.itemList[l].media.font.id=1030156874}if(!c)continue;t.push(c)}}}return t=s(t),t}var s=function(e){for(var t=[],i=0;i<e.length;i++)-1==t.indexOf(e[i])&&t.push(e[i]);return t}},a628:function(e,t,i){"use strict";var a=i("b180"),o=i.n(a);o.a},a637:function(e,t,i){},a6e9:function(e,t,i){},aa47:function(e,t,i){},aaa1:function(e,t,i){"use strict";var a=i("f27b"),o=i.n(a);o.a},aeea:function(e,t,i){e.exports=i.p+"static/img/sheji.a7491953.png"},b088:function(e,t,i){"use strict";var a=i("430e"),o=i.n(a);o.a},b165:function(e,t,i){"use strict";var a=i("aa47"),o=i.n(a);o.a},b180:function(e,t,i){},b1eb:function(t,i,a){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.edit_photo_guide,expression:"edit_photo_guide==true"}],staticClass:"new-guide"},[i("div",{staticClass:"order-edit-guide2 guide",on:{click:function(t){return e.closeguide(3)}}},[i("img",{staticStyle:{width:"100%"},attrs:{src:a("446c")}}),i("img",{staticStyle:{width:"100%"},attrs:{src:a("8f47")},on:{click:function(t){return e.closeguide(3)}}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[i("img",{style:{width:e.currentPhotoJson.width+"px",height:e.currentPhotoJson.height+"px"},attrs:{crossOrigin:"anonymous",src:e.currentPhotoJson.url,id:"imgDom"}}),i("canvas",{staticClass:"hideCanvas",staticStyle:{border:"1px solid #000000"},attrs:{width:e.currentPhotoJson.width,height:e.currentPhotoJson.height,id:"photoCanvas"}})]),i("div",{staticClass:"sjky-popbox",staticStyle:{display:"block"},on:{click:function(t){return t.stopPropagation(),e.stopEvent(t)},touchmove:e.stopMove}}),i("div",{staticClass:"sjky-img-edit galleryPreview",staticStyle:{display:"block"},on:{touchmove:e.stopMove}},[i("div",{staticClass:"sjk-top"},[e.isCutImg?i("div",{staticStyle:{"margin-left":"15px","font-size":"12px",color:"#C0C0C0"}},[e._v("裁切编辑")]):e._e(),e._e(),i("i",{staticClass:"sjky close-icon",on:{click:function(t){return t.stopPropagation(),e.closeFun(t)}}},[e._v("")])]),i("div",{staticClass:"sjky-design-img",attrs:{id:"drawing2"}},[i("div",{staticClass:"new-xiangsu",style:{display:0==e.isLowPixel&&0==e.isBeyond?"none":""}},[i("img",{style:{display:0==e.isLowPixel?"none":""},attrs:{src:a("3523")}}),i("p",{style:{display:0==e.isLowPixel?"none":""}},[e._v("像素不足印刷模糊")]),i("i",{staticClass:"sjky icon-preview2",style:{display:0==e.isBeyond?"none":""}}),i("p",{style:{display:0==e.isBeyond?"none":""}},[e._v("照片可能有遮挡")])]),i("div",{staticClass:"sjky-img-tips"},[e._v(e._s(e.title))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.loadingShow,expression:"loadingShow"}],staticClass:"loading-design"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v("努力上传中")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.loadingShow_faceTest,expression:"loadingShow_faceTest"}],staticClass:"loading-design"},[i("img",{attrs:{src:a("fa68")}}),i("p",[e._v("检测中")])]),i("ul",{staticClass:"sjky-template sjky-template2"},[i("li",{staticClass:"sjky-imgs"},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.fileChanged()}}},[e._v("图库")]),i("input",{staticClass:"pa",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpg,image/jpeg,image/png,image/webp,image/bmp,image/heic,image/heif,image/avif",id:"filelocation"},on:{change:function(t){return e.changePhotoSingle()}}})]),e._l(e.photolist,function(t,a){return i("li",{key:a,attrs:{"on-finish-render-filters":""}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{staticStyle:{width:"1.6rem",height:"1.75rem"},attrs:{src:t.src},on:{click:function(i){return e.changePhoto(t.url,t.height,t.width)}}})]),1==t.titleAll?i("div",{staticClass:"sjky-img-tips",attrs:{id:"temp.index"}},[e._v(e._s(t.title))]):e._e(),t.titleAll&&1!=t.titleAll&&0!=t.titleAll?i("div",{staticClass:"sjky-img-tips",attrs:{id:"temp.index"}},[e._v("已使用"+e._s(t.titleAll)+"次")]):e._e(),0==t.isUse?i("div",{staticClass:"sjky-img-tips",attrs:{id:"temp.index"}},[e._v("未使用")]):e._e()])})],2)])])},s=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("768b")),r=(a("a481"),a("7f7f"),a("34ef"),a("96cf"),a("3b8d")),l=a("bd86"),d=(a("28a5"),a("2f62")),c=a("f5b3"),h=a("89d6"),g=a("5841"),m=a("103a"),p=(a("a244"),a("4cbb")),u=a("32d1"),f=a("a053"),y=a("d80f");a("ff08");function _(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?_(i,!0).forEach(function(t){Object(l["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var w={name:"editImage",data:function(){return{maxSize:41943040,photolist:[],dgAngle:0,pageList:[],title:"",photo:{},page_index:"",item_index:"",itemIndex:"",itemListObj:{},mask:{},loadingShow:!1,isPhotoChange:!1,currentTitle:"",detailJsonLocal:"",isCutImg:!1,isBeyond:!1,isLowPixel:!1,edit_photo_guide:!0,faceTestUrl:"",faceTestArr:[],photoDom:null,photoCanvas:null,currentPhotoJson:{url:"",width:0,height:0},faceAreaArr:[],loadingShow_faceTest:!1,thumbnailToken:null,thumbnailUrl:g["a"].thumbnailUrl,seflGroupChildIndex:null}},props:["pageAndIndex","pageKey","vm"],created:function(){var t=localStorage.getItem(this.pageKey.edit_photo_guide);t&&(this.edit_photo_guide=!1),this.detailJsonLocal=JSON.parse(localStorage.getItem(this.pageKey.detailJson));var i=this.pageAndIndex.split("_");this.page_index=parseInt(i[0]),this.item_index=parseInt(i[1]),this.itemIndex=parseInt(i[1]),(i[2]||0==i[2])&&(this.seflGroupChildIndex=i[2]),this.resetCalendarTemp(JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp))),this.pageList=JSON.parse(localStorage.getItem(this.pageKey.detailJson)).pageList,this.itemListObj=this.pageList[this.page_index].content.itemList[this.itemIndex],(this.seflGroupChildIndex||0==this.seflGroupChildIndex)&&(this.itemListObj=this.pageList[this.page_index].content.itemList[this.itemIndex].childrenElement[this.seflGroupChildIndex]),this.title=this.pageList[this.page_index].title;var a=this.itemListObj.media.imgX,o=this.itemListObj.media.imgY,s=this.itemListObj.location.width,n=this.itemListObj.location.height,r=this.itemListObj.media.imgWidth,l=this.itemListObj.media.imgHeight,d=this.itemListObj.media.factMaskSource;this.itemListObj.media.maskSource;this.itemListObj.cutArea&&"image"==this.itemListObj.media.mediaType&&this.itemListObj.cutArea.fromAiCut&&(this.isCutImg=!0,s=this.itemListObj.location.width,n=this.itemListObj.location.height,d="",this.itemListObj.media.imgPath),this.currentTitle=this.pageList[this.page_index].title,console.log(this.page_index,this.itemIndex),this.scale=parseInt(this.itemListObj.media.zoom)/10+1,-1==d.indexOf(Object(m["d"])(d))&&(d=Object(m["d"])(d)+Object(m["a"])(d,this.itemListObj,this.pageKey)),this.thumbnailToken=localStorage.getItem(this.pageKey.thumbnailToken),d.indexOf(Object(m["d"])(d))>-1&&d.indexOf("?token=")>-1&&-1==d.indexOf(this.thumbnailToken)&&(d=Object(m["g"])(d,this.thumbnailToken)),this.mask={size:[0,0,s,n],img:d},this.photo={size:[a,o,r,l],img:"img/bg.jpg"};try{if(window._jylog){var c=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击",this.vm.isJijian?"单张上传":"设计","点击图片","",JSON.parse(c).orderNo])}}catch(e){console.log(e)}},mounted:function(){this.initImage("#drawing2",!1)},computed:v({},Object(d["b"])(["detailJson"])),methods:{faceTest:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,i,a,o){var s,n,r,l,d,c,h,g,m,p,u,f,y,_,v,w,b,I,S,x,k,O,L,T,C,P,j,A,N,E,J;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(this.faceAreaArr=[],s=a.width,n=a.height,t.clearRect(0,0,s,n),t.drawImage(i,0,0,s,n),r=t.getImageData(0,0,s,n).data,l={pixels:this.rgba_to_grayscale(r,n,s),nrows:n,ncols:s,ldim:s},d={shiftfactor:.1,minsize:10,maxsize:1e3,scalefactor:1.1},c=pico.run_cascade(l,window.facefinder_classify_region,d),c=pico.cluster_detections(c,.2),h=5,g=!1,m=[],p=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),u=0;u<c.length;++u)Math.round(c[u][3])>=h&&(g=!0,g&&(f=SVG("#edit_group"),y=f.rect(),_=c[u][1]-c[u][2]/2,v=c[u][0]-c[u][2]/2,w=c[u][2],b={},b.x=_,b.y=v,b.width=w,b.height=w,m.push(b),I=_+a.x,S=v+a.y,x=k=w*(1+a.zoom/10),o&&(x=k=w),y.attr({id:"facerect_"+a.pageIndex+"_"+a.itemIndex+"_"+u,x:I,y:S,width:x,height:k,"stroke-width":3,stroke:"#FF4C88",fill:"none","pointer-events":"none",style:"pointer-events: none;display:none"}),O={},O.x=I,O.y=S,O.width=x,O.height=k,this.faceAreaArr.push(O),L=I,T=S,C=L+x,P=T+k,j=0,A=0,N=j+p.pageList[a.pageIndex].content.itemList[a.itemIndex].printLocation.width,E=A+p.pageList[a.pageIndex].content.itemList[a.itemIndex].printLocation.height,L>=j&&T>=A&&C<=N&&P<=E||(p.pageList[a.pageIndex].content.itemList[a.itemIndex].isBeyond=!0,p.pageList[a.pageIndex].isBeyond=!0,this.isBeyond=!0)));1==g&&(p.pageList[a.pageIndex].content.itemList[a.itemIndex].photoFacePosition=m,J=JSON.stringify(p),localStorage.setItem(this.pageKey.detailJson,J)),this.loadingShow_faceTest=!1;case 17:case"end":return e.stop()}},e,this)}));function t(t,i,a,o){return e.apply(this,arguments)}return t}(),rgba_to_grayscale:function(e,t,i){for(var a=new Uint8Array(t*i),o=0;o<t;++o)for(var s=0;s<i;++s)a[o*i+s]=(2*e[4*o*i+4*s+0]+7*e[4*o*i+4*s+1]+1*e[4*o*i+4*s+2])/10;return a},closeguide:function(){this.edit_photo_guide=!1,localStorage.setItem(this.pageKey.edit_photo_guide,!1)},initImage:function(e,t){var i,a=this.pageAndIndex.split("_"),o="#svg_"+a[0],s="#group"+a[0]+"_"+a[1],n=!1;this.detailJsonLocal;SVG("#edit_svg")?i=SVG("#edit_svg"):(i=SVG().addTo(e),i.attr({id:"edit_svg"}));var r;i.defs();SVG("#edit_group")?r=SVG("#edit_group"):(r=i.group(),r.attr({id:"edit_group",style:"overflow:hidden"}));for(var l=this.detailJsonLocal.pageList[this.page_index].content.itemList,d=(l[this.itemIndex].media.imgPath,l[this.itemIndex].media.imgWidth,l[this.itemIndex].media.imgHeight,{loadComplete:!1,imgArr:[]}),g=0;g<l.length;g++){var p=l[g];if((this.seflGroupChildIndex||0==this.seflGroupChildIndex)&&(p=l[this.itemIndex].childrenElement[this.seflGroupChildIndex]),"image"==p.media.mediaType){if(-1==p.media.imgPath.indexOf(Object(m["d"])(p.media.imgPath))&&-1==p.media.imgPath.indexOf("img/nophoto.jpg")&&-1==p.media.imgPath.indexOf("img.alicdn.com")&&(p.media.imgPath=Object(m["d"])(p.media.imgPath)+""+Object(m["a"])(p.media.imgPath,p,this.pageKey)),d.imgArr.push(p.media.imgPath),g!=this.itemIndex)continue;if(p.cutArea&&p.cutArea.fromAiCut){var u={};u.x=p.location.x,u.y=p.location.y,u.w=p.location.width,u.h=p.location.height,i.viewbox(0,0,u.w,u.h)}}else if("advancedImageMask"==p.media.mediaType){if(-1==p.media.maskSource.indexOf(Object(m["d"])(p.media.maskSource))&&-1==p.media.maskSource.indexOf("img.alicdn.com")&&-1==p.media.maskSource.indexOf("img/nophoto.jpg")&&(p.media.maskSource=Object(m["d"])(p.media.maskSource)+Object(m["a"])(p.media.maskSource,p,this.pageKey)),p.media.maskSource.indexOf(Object(m["d"])(p.media.maskSource))>-1&&p.media.maskSource.indexOf("?token=")>-1&&-1==p.media.maskSource.indexOf(this.thumbnailToken)&&-1==p.media.maskSource.indexOf("img.alicdn.com")&&-1==p.media.maskSource.indexOf("img/nophoto.jpg")&&(p.media.maskSource=Object(m["g"])(p.media.maskSource,this.thumbnailToken)),p.media.maskSource.indexOf("?token=")>-1){var f=p.media.maskSource.split("?token=");p.media.maskSource=f[0]}if(d.imgArr.push(p.media.maskSource),g!=this.itemIndex)continue;-1==p.media.factMaskSource.indexOf(Object(m["d"])(p.media.factMaskSource))&&(p.media.factMaskSource=Object(m["d"])(p.media.factMaskSource)+Object(m["a"])(p.media.factMaskSource,p,this.pageKey)),p.media.factMaskSource.indexOf(Object(m["d"])(p.media.factMaskSource))>-1&&p.media.factMaskSource.indexOf("?token=")>-1&&-1==p.media.factMaskSource.indexOf(this.thumbnailToken)&&(p.media.factMaskSource=Object(m["g"])(p.media.factMaskSource,this.thumbnailToken)),p.media.isSimple||d.imgArr.push(p.media.factMaskSource),d.imgArr.push(p.media.bgSource);u={};u.x=p.location.x,u.y=p.location.y,u.w=p.location.width,u.h=p.location.height,i.viewbox(0,0,u.w,u.h)}else"text"==p.media.mediaType&&p.media.font.textPath&&d.imgArr.push(p.media.imgPath);"image"==p.media.mediaType&&"no"==p.moveable&&p.media.isBG}p=l[this.itemIndex];if("advancedImageMask"==p.media.mediaType){t&&(p.media.imgX=0,p.media.imgY=0);var _={pageImgJson:d,page:this.vm,parentIndex:this.page_index,childIndex:this.itemIndex,id:"editbgimg_photo_"+this.page_index+"_"+this.itemIndex,isEdit:!0,isPhotoChange:this.isPhotoChange},v=new c["a"](r,p,_,this);v.initMask()}if(p.cutArea&&"image"==p.media.mediaType&&1==p.visible&&"no"==p.moveable&&0==p.media.isBG&&p.cutArea.fromAiCut){_={pageImgJson:d,parentIndex:this.page_index,childIndex:this.itemIndex,id:"editbgimg_photo_"+this.page_index+"_"+this.itemIndex,isEdit:!0,isPhotoChange:this.isPhotoChange};var w=new h["a"](r,p,d,this.page_index,this.itemIndex,!0,this,null,this.isPhotoChange);w.initDecorateImg()}if(p.media.mediaType==y["a"].SELF_GROUP&&(this.seflGroupChildIndex||0==this.seflGroupChildIndex)){if(p=l[this.itemIndex].childrenElement[this.seflGroupChildIndex],"advancedImageMask"==p.media.mediaType){t&&(p.media.imgX=0,p.media.imgY=0);_={pageImgJson:d,page:this.vm,parentIndex:this.page_index,childIndex:this.itemIndex,svgindex:this.seflGroupChildIndex,id:"editbgimg_photo_"+this.page_index+"_"+this.itemIndex+"_"+this.seflGroupChildIndex,isEdit:!0,isPhotoChange:this.isPhotoChange},v=new c["a"](r,p,_,this);v.initMask()}if(p.cutArea&&"image"==p.media.mediaType&&1==p.visible&&0==p.media.isBG&&p.cutArea.fromAiCut){_={pageImgJson:d,parentIndex:this.page_index,childIndex:this.itemIndex,id:"editbgimg_photo_"+this.page_index+"_"+this.itemIndex+"_"+this.seflGroupChildIndex,isEdit:!0,isPhotoChange:this.isPhotoChange},w=new h["a"](r,p,d,this.page_index,this.itemIndex,!0,this,null,this.isPhotoChange,this.seflGroupChildIndex);w.initDecorateImg()}}},fileChanged:function(){$("#filelocation").click()},closeFun:function(){this.$emit("ClosePanle",this.isPhotoChange)},setRotate:function(){var e=90,t=this.pageAndIndex.split("_"),i=t[0],a=t[1],o=this.detailJsonLocal.pageList[i].content.itemList,s=o[a];s.location.rotation%360==0?this.dgAngle+=90:this.dgAngle=s.location.rotation%360+90;var n=0+s.location.width/2,r=0+s.location.height/2,l="rotate("+this.dgAngle+","+n+","+r+")";SVG("#editbgimg_photo_"+this.pageAndIndex).attr({transform:l}),s.media.isSimple||SVG("#editmaskFact_"+this.pageAndIndex).attr({transform:l});SVG("#editbgimg_photo_"+this.pageAndIndex);s.location.rotation=e+s.location.rotation%360,s.printLocation.rotation=e+s.location.rotation%360;var d=JSON.stringify(this.detailJsonLocal);localStorage.setItem(this.pageKey.detailJson,d)},changePhotoSingle:function(){var t=this;try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","单张上传","替换照片","新上传"+this.pageAndIndex,JSON.parse(i).orderNo])}}catch(e){console.log(e)}$("#filelocation")[0].files.length>0&&(this.loadingShow=!0);var a=localStorage.getItem(this.pageKey.token),o=this;try{if(window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);var s="调用newgetCommonUploadConfig的token===="+a;window._jylog.push(["按钮点击","单张上传","初始化上传",s,JSON.parse(i).orderNo])}}catch(e){console.log(e)}Object(p["n"])(a).then(function(i){if(i.result)if(i.data.commonUpload)$.each($("#filelocation")[0].files,function(t,s){var n=s.name;if(s.size>o.maxSize){try{if(window._jylog){var r=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","提示","照片过大！",JSON.parse(r).orderNo])}}catch(e){console.log(e)}return layer.alert("照片过大！"),void $(".loading-design").hide()}var l=n.toLowerCase();if(-1==l.indexOf("jpg")&&-1==l.indexOf("jpeg")&&-1==l.indexOf("png")&&-1==l.indexOf("webp")&&-1==l.indexOf("bmp")&&-1==l.indexOf("heic")&&-1==l.indexOf("heif")&&-1==l.indexOf("avif")){try{if(window._jylog){r=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","照片格式不正确！",n+"",JSON.parse(r).orderNo])}}catch(e){console.log(e)}return layer.alert("照片格式不正确！"),void $(".loading-design").hide()}var d=new FormData;d.append("token",a),d.append("file",s),d.append("upload",g["a"].commonuploadapi+i.data.uploadUrl),d.append("appKey",i.data.appKey),d.append("appSecret",i.data.appSecret),d.append("serverKey",i.data.serverKey),d.append("unionId",i.data.unionId),d.append("thumbnailToken",i.data.base64Token);var c="";s.starttime||(c=(new Date).getTime(),console.info("上传开始时间111"),console.info(c),s.starttime=c),s.requestid||(s.requestid=(new Date).getTime(),d.append("requestid",s.requestid)),$.ajax({url:g["a"].commonuploadapi+i.data.uploadUrl,type:"POST",data:d,cache:!1,dataType:"json",contentType:!1,processData:!1,success:function(t){if(t.success&&t.data)o.saveinfo(a,t,s);else{$(".loading-design").hide();try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","警告","上传失败！"+JSON.stringify(t)+",requestid="+s.requestid,JSON.parse(i).orderNo])}}catch(e){console.log(e)}try{o.lastTime(s,"上传失败")}catch(e){console.log(e)}layer.alert("上传失败!")}},error:function(e){$(".loading-design").hide();try{if(window._jylog){var t=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","警告","e:上传失败！"+String(e)+",requestid="+s.requestid,JSON.parse(t).orderNo])}}catch(e){console.log(e)}layer.alert("上传失败!!")},complete:function(t,i){if("timeout"==i){$(".loading-design").hide(),layer.alert("上传失败,链接超时!!!");try{if(window._jylog){var a=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","警告","e:上传失败！链接超时"+i+",requestid="+s.requestid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}}}})});else{t.loadingShow=!0;var s=t;$.each($("#filelocation")[0].files,function(t,i){var l=i.name;if(i.size>o.maxSize)return layer.alert("照片过大！"),void $(".loading-design").hide();var d=l.toLowerCase();if(-1==d.indexOf("jpg")&&-1==d.indexOf("jpeg")&&-1==d.indexOf("png"))return layer.alert("照片格式不正确！"),void $(".loading-design").hide();var c=800,h=800,y=new FormData;y.append("token",a),y.append("file",i),y.append("size",i.size);var _="";i.starttime||(_=(new Date).getTime(),console.info("上传开始时间111"),console.info(_),i.starttime=_),$.ajax({url:g["a"].basicUrl+"/upload/photo",type:"POST",data:y,cache:!1,dataType:"json",contentType:!1,processData:!1,success:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(i){var a,o,r,l,d,y,_,v,w,b,I,S,x,k,O,L,T,C,P,j,A,N,E;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("1"!=i.r){t.next=72;break}if(t.prev=1,a=localStorage.getItem(s.vm.pageKey.thumbnailToken),o=localStorage.getItem(s.vm.normalKey.fromAlipyShopPaid),r=localStorage.getItem(s.vm.normalKey.fromAlipyShop),1!=o&&"1"!=o&&1!=r&&"1"!=r){t.next=23;break}return l=Object(m["d"])(i.url)+Object(m["e"])(i.url,x,a),-1!=l.indexOf(g["a"].thumbnailUrl)&&(l=l.replace("commonUpload/",""),-1!=l.indexOf("fsferry")&&(l=l.replace("fsferry/","")),-1==l.indexOf("?token")&&(l=l+"?token="+a)),t.next=10,Object(f["a"])(Object(u["a"])(l));case 10:if(d=t.sent,y=Object(n["a"])(d,2),y[0],_=y[1],!_.data||"REJECTED"!=_.data.resultAction){t.next=23;break}layer.alert("照片内容违规,不可上传!"),$(".loading-design").hide(),s.loadingShow=!1;try{window._jylog&&(v=localStorage.getItem(s.pageKey.orderInfo),window._jylog.push(["弹窗提示","单张上传","保存成功","照片内容违规",JSON.parse(v).orderNo]))}catch(e){console.log(e)}return w={},w.id=i.id,Object(p["e"])(w).then(function(e){console.log("-----------简影删除方法返回----------"),console.log(e)}).catch(function(e){console.log("-----------简影删除方法报错----------"),console.log(e)}),t.abrupt("return");case 23:t.next=28;break;case 25:t.prev=25,t.t0=t["catch"](1),console.log(t.t0);case 28:for(b="",I="",S="",x="",i.imageInfo.primaryImageInfo?(b=i.imageInfo.primaryImageInfo.width,I=i.imageInfo.primaryImageInfo.height,S=i.imageInfo.primaryImageInfo.dateTime,x=i.imageInfo.primaryImageInfo):(b=i.imageInfo.width,I=i.imageInfo.height,S=i.imageInfo.dateTime,x=i.imageInfo),"image"==s.pageList[s.page_index].content.itemList[s.item_index].media.mediaType?(s.pageList[s.page_index].content.itemList[s.item_index].location.factWidth=i.width,s.pageList[s.page_index].content.itemList[s.item_index].location.factHeight=i.height):"advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].media.mediaType?(s.pageList[s.page_index].content.itemList[s.item_index].location.maskFactWidth=i.width,s.pageList[s.page_index].content.itemList[s.item_index].location.maskFactHeight=i.height):"selfGroup"==s.pageList[page_index].content.itemList[itemIndex].media.mediaType&&(0==s.seflGroupChildIndex||s.seflGroupChildIndex)&&("image"==s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.mediaType?(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].location.factWidth=i.width,s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].location.factHeight=i.height):"advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].location.maskFactWidth=i.width,s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].location.maskFactHeight=i.height)),k=parseFloat(1*b/I),O=parseFloat(1*s.mask.size[2]/s.mask.size[3]),L=0,b>=I?(b<c||I<h)&&(L=1):(b<h||I<c)&&(L=1),T=JSON.parse(localStorage.getItem(s.pageKey.uploadCalenderTemp)),C={},C.url=i.url,C.dateTime=S,C.width=b,C.height=I,C.isUse=!0,C.title=s.currentTitle,C.pixellow=L,C.titleAll=1,C.id=i.id,C.src=Object(m["d"])(i.url)+Object(m["e"])(i.url,x,a),T.push(C),k>O?s.pageList[s.page_index].content.itemList[s.item_index].cutArea&&s.pageList[s.page_index].content.itemList[s.item_index].cutArea.fromAiCut||("advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].media.imgX=0,s.pageList[s.page_index].content.itemList[s.item_index].media.imgY=0,s.pageList[s.page_index].content.itemList[s.item_index].media.imgHeight=s.mask.size[3],s.pageList[s.page_index].content.itemList[s.item_index].media.imgHeight=s.mask.size[3],s.pageList[s.page_index].content.itemList[s.item_index].media.imgWidth=k*s.mask.size[3],s.pageList[s.page_index].content.itemList[s.item_index].media.imgHeight=s.mask.size[3]),"selfGroup"==s.pageList[page_index].content.itemList[itemIndex].media.mediaType&&(0==s.seflGroupChildIndex||s.seflGroupChildIndex)&&"advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgX=0,s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgY=0,s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgWidth=k*s.mask.size[3],s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgHeight=s.mask.size[3]),s.photo.size[0]=0,s.photo.size[1]=0,s.photo.size[2]=k*s.mask.size[3],s.photo.size[3]=s.mask.size[3]):s.pageList[s.page_index].content.itemList[s.item_index].cutArea&&s.pageList[s.page_index].content.itemList[s.item_index].cutArea.fromAiCut||("advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].media.imgX=0,s.pageList[s.page_index].content.itemList[s.item_index].media.imgY=0,s.pageList[s.page_index].content.itemList[s.item_index].media.imgWidth=s.mask.size[2],s.pageList[s.page_index].content.itemList[s.item_index].media.imgHeight=s.mask.size[2]/k),"selfGroup"==s.pageList[page_index].content.itemList[itemIndex].media.mediaType&&(0==s.seflGroupChildIndex||s.seflGroupChildIndex)&&"advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgX=0,s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgY=0,s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgWidth=s.mask.size[2],s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgHeight=s.mask.size[2]/k),s.photo.size[0]=0,s.photo.size[1]=0,s.photo.size[2]=s.mask.size[2],s.photo.size[3]=s.mask.size[2]/k),s.scale=1,s.pageList[s.page_index].content.itemList[s.item_index].cutArea&&s.pageList[s.page_index].content.itemList[s.item_index].cutArea.fromAiCut?s.pageList[s.page_index].content.itemList[s.item_index].media.imgPath=C.src:("advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].media.maskSource=C.src),"selfGroup"==s.pageList[page_index].content.itemList[itemIndex].media.mediaType&&(0==s.seflGroupChildIndex||s.seflGroupChildIndex)&&("advancedImageMask"==s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.mediaType&&(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.maskSource=C.src),s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].cutArea&&s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].cutArea.fromAiCut&&(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.imgPath=C.src))),document.getElementById("editbgimg_photo_"+s.pageAndIndex)&&(P=document.getElementById("editbgimg_photo_"+s.pageAndIndex).href.baseVal),document.getElementById("editdecrorate_"+s.pageAndIndex)&&(P=document.getElementById("editdecrorate_"+s.pageAndIndex).href.baseVal),-1!=P.indexOf("img/nophoto.jpg")&&(s.pageList[s.page_index].content.itemList[s.item_index].media.defaultState=!1,"selfGroup"==s.pageList[page_index].content.itemList[itemIndex].media.mediaType&&(0==s.seflGroupChildIndex||s.seflGroupChildIndex)&&(s.pageList[s.page_index].content.itemList[s.item_index].childrenElement[s.seflGroupChildIndex].media.defaultState=!1)),j=0;j<T.length;j++)-1!=P.indexOf(T[j].src)&&T[j].title==s.currentTitle&&(A=T[j].title.split(","),1==A.length?(T[j].isUse=!1,T[j].title=""):A.length>1&&(T[j].title=T[j].title.replace(","+s.currentTitle,""),T[j].titleAll=T[j].titleAll-1)),T[j].url==i.url&&T[j].title==s.currentTitle&&(T[j].isUse=!0,T[j].title=s.currentTitle,T[j].titleAll=1);if(s.resetCalendarTemp(T),document.getElementById("editbgimg_photo_"+s.pageAndIndex)){if(N=C.src,-1!=N.indexOf(g["a"].thumbnailUrl)&&-1==N.indexOf("?token="))a=localStorage.getItem(s.pageKey.thumbnailToken),-1!=N.indexOf("commonUpload/")?(E=N.split("commonUpload/"),-1!=E[0].indexOf("fsferry")&&(E[0]=E[0].replace("fsferry/","")),N=E[0]+E[1]+"?token="+a):N=N+"?token="+a;else try{window._jylog&&(v=localStorage.getItem(s.pageKey.orderInfo),window._jylog.push(["渲染路径记录","单页编辑","警告",N,JSON.parse(v).orderNo]))}catch(e){console.log(e)}document.getElementById("editbgimg_photo_"+s.pageAndIndex).href.baseVal=N}if(document.getElementById("editdecrorate_"+s.pageAndIndex)){if(N=C.src,-1!=N.indexOf(g["a"].thumbnailUrl)&&-1==N.indexOf("?token="))a=localStorage.getItem(s.pageKey.thumbnailToken),-1!=N.indexOf("commonUpload/")?(E=N.split("commonUpload/"),-1!=E[0].indexOf("fsferry")&&(E[0]=E[0].replace("fsferry/","")),N=E[0]+E[1]+"?token="+a):N=N+"?token="+a;else try{window._jylog&&(v=localStorage.getItem(s.pageKey.orderInfo),window._jylog.push(["渲染路径记录","单页编辑","警告",N,JSON.parse(v).orderNo]))}catch(e){console.log(e)}document.getElementById("editdecrorate_"+s.pageAndIndex).href.baseVal=N}localStorage.setItem(s.pageKey.uploadCalenderTemp,JSON.stringify(T)),s.photo.img=C.src,s.detailJsonLocal.pageList=s.pageList,localStorage.setItem(s.pageKey.detailJson,JSON.stringify(s.detailJsonLocal)),s.isPhotoChange=!0,s.initImage("#drawing2"),$("#loadingData").hide(),$(".loading-design").hide(),s.loadingShow=!1,t.next=75;break;case 72:$(".loading-design").hide(),layer.alert("上传失败! "+i.r);try{window._jylog&&(v=localStorage.getItem(s.pageKey.orderInfo),window._jylog.push(["弹窗提示","单张上传","上传失败",i.r+"",JSON.parse(v).orderNo]))}catch(e){console.log(e)}case 75:case"end":return t.stop()}},t,null,[[1,25]])}));function i(e){return t.apply(this,arguments)}return i}(),error:function(e){$(".loading-design").hide();try{if(window._jylog){var t=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","警告","e2:上传失败！"+String(e),JSON.parse(t).orderNo])}}catch(e){console.log(e)}layer.alert("上传失败!!!!")},complete:function(t,i){if("timeout"==i){try{if(window._jylog){var a=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["弹窗提示","单张上传","警告","e4：上传失败！"+i,JSON.parse(a).orderNo])}}catch(e){console.log(e)}$(".loading-design").hide(),layer.alert("上传失败!!!!!")}}})})}console.log(i)}).catch(function(i){$(".loading-design").hide(),console.log(i),layer.alert(i.message);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["提示","单张上传","初始化上传插件失败",""+String(i),JSON.parse(a).orderNo])}}catch(e){console.log(e)}})},stopEvent:function(e){this.$emit("ClosePanle",this.isPhotoChange)},stopMove:function(e){"IMG"!==e.target.tagName&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},changePhoto:function(t,i,a){var o=this.pageAndIndex.split("_");try{var s=localStorage.getItem(this.pageKey.orderInfo);window._czc&&null!=s&&void 0!=s&&window._czc.push(["_trackEvent","剪影","照片编辑页面","替换照片"]),window._jylog&&window._jylog.push(["按钮点击","设计","替换照片","已上传"+this.pageAndIndex+","+t+","+i+","+a,JSON.parse(s).orderNo])}catch(e){console.log(e)}var n,r=o[0],l=o[1],d=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp));if(document.getElementById("editbgimg_photo_"+this.pageAndIndex)&&(n=document.getElementById("editbgimg_photo_"+this.pageAndIndex).href.baseVal),document.getElementById("editdecrorate_"+this.pageAndIndex)&&(n=document.getElementById("editdecrorate_"+this.pageAndIndex).href.baseVal),n=Object(m["f"])(n,this.detailJsonLocal.pageList[r].content.itemList[l]),n){for(var c=0;c<d.length;c++){if(console.log(d[c].title),n&&(-1!=n.indexOf(d[c].url)&&d[c].title==this.currentTitle&&(d[c].isUse=!1,d[c].title=""),-1==n.indexOf(d[c].url)&&-1!=d[c].title.indexOf(this.currentTitle))){d[c].isUse=!0;var h=d[c].title.split(",");h.push(this.currentTitle),d[c].title=h.join(",");var g=h.length;d[c].titleAll=g}if(d[c].url==t&&d[c].title==this.currentTitle)d[c].isUse=!0,d[c].title=d[c].title;else if(d[c].url==t&&d[c].title!=this.currentTitle){if(d[c].isUse=!0,-1==d[c].title.indexOf(this.currentTitle))if(""==d[c].title)d[c].title=this.currentTitle,d[c].titleAll=1;else{d[c].title=d[c].title.concat(",",this.currentTitle);h=d[c].title.split(","),g=h.length;d[c].titleAll=g}}else if(d[c].url!=t&&-1!=d[c].title.indexOf(this.currentTitle)){d[c].title=d[c].title.replace(","+this.currentTitle,"");h=d[c].title.split(","),g=h.length;d[c].titleAll=g}}this.resetCalendarTemp(d);localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(d)),this.detailJsonLocal.pageList[r].content.itemList[l].cutArea&&this.detailJsonLocal.pageList[r].content.itemList[l].cutArea.fromAiCut?(this.detailJsonLocal.pageList[r].content.itemList[l].location.factHeight=i,this.detailJsonLocal.pageList[r].content.itemList[l].location.factWidth=a,this.detailJsonLocal.pageList[r].content.itemList[l].media.imgPath=Object(m["d"])(t)+Object(m["a"])(t,this.detailJsonLocal.pageList[r].content.itemList[l],this.pageKey)):("advancedImageMask"==this.detailJsonLocal.pageList[r].content.itemList[l].media.mediaType&&(this.detailJsonLocal.pageList[r].content.itemList[l].media.defaultState=!1,this.detailJsonLocal.pageList[r].content.itemList[l].location.factHeight=i,this.detailJsonLocal.pageList[r].content.itemList[l].location.factWidth=a,this.detailJsonLocal.pageList[r].content.itemList[l].location.maskFactHeight=i,this.detailJsonLocal.pageList[r].content.itemList[l].location.maskFactWidth=a,this.detailJsonLocal.pageList[r].content.itemList[l].media.maskSource=Object(m["d"])(t)+Object(m["a"])(t,this.detailJsonLocal.pageList[r].content.itemList[l],this.pageKey)),console.log("selfGroup"==this.detailJsonLocal.pageList[r].content.itemList[l].media.mediaType),"selfGroup"==this.detailJsonLocal.pageList[r].content.itemList[l].media.mediaType&&(0==this.seflGroupChildIndex||this.seflGroupChildIndex)&&("advancedImageMask"==this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].media.mediaType?(this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].media.defaultState=!1,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].location.factHeight=i,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].location.factWidth=a,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].location.maskFactHeight=i,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].location.maskFactWidth=a,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].media.maskSource=Object(m["d"])(t)+Object(m["a"])(t,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex],this.pageKey)):this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].cutArea&&this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].cutArea.fromAiCut&&(this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].location.factHeight=i,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].location.factWidth=a,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex].media.imgPath=Object(m["d"])(t)+Object(m["a"])(t,this.detailJsonLocal.pageList[r].content.itemList[l].childrenElement[this.seflGroupChildIndex],this.pageKey)))),this.isPhotoChange=!0,this.initImage("#drawing2");var p=JSON.stringify(this.detailJsonLocal);this.$store.dispatch("updatePages",this.detailJsonLocal),localStorage.setItem(this.pageKey.detailJson,p)}},resetCalendarTemp:function(e){for(var t=[],i=[],a=0;a<e.length;a++){if(-1!=e[a].src.indexOf("token")){var o=e[a].src.split("?token");e[a].src=o[0]}e[a].src.indexOf(g["a"].thumbnailUrl),0==e[a].isUse?t.push(e[a]):i.push(e[a])}return this.handlePhotoList(t.concat(i)),t.concat(i)},saveinfo:function(t,i,a){var o=this,s=(localStorage.getItem(o.pageKey.thumbnailToken),{});s.token=t;var l=i.data;s.filename=l.filePath,s.originalName=l.fileName,l.prefix&&(s.prefix=l.prefix),s.ImageInfo={},s.ImageInfo.width=Number(l.width),s.ImageInfo.height=Number(l.height),s.ImageInfo.fileMd5=l.md5,l.dateTime&&(s.ImageInfo.dateTime=l.dateTime),s.lastModifiedDate=a.lastModifiedDate,s=JSON.stringify(s),$.ajax({type:"POST",url:g["a"].basicUrl+"/upload/savephotoinfo",data:s,dataType:"json",contentType:"application/json",success:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(i){var s,r,l,d,c,h,_,v,w,b,I,S,x,k,O,L,T,C,P,j,A,N,E,J,D;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("1"!=i.r){t.next=82;break}if(s="",r="",l="",i.imageInfo.primaryImageInfo?(s=i.imageInfo.primaryImageInfo.width,r=i.imageInfo.primaryImageInfo.height,l=i.imageInfo.primaryImageInfo.dateTime):(s=i.imageInfo.width,r=i.imageInfo.height,l=i.imageInfo.dateTime),t.prev=5,d=localStorage.getItem(o.vm.normalKey.fromAlipyShopPaid),c=localStorage.getItem(o.vm.normalKey.fromAlipyShop),1!=d&&"1"!=d&&1!=c&&"1"!=c){t.next=27;break}return h=localStorage.getItem(o.vm.pageKey.thumbnailToken),_=JSON.stringify(i.imageInfo),v=Object(m["d"])(i.url)+Object(m["e"])(i.url,_,h),-1!=v.indexOf(g["a"].thumbnailUrl)&&(v=v.replace("commonUpload/",""),-1!=v.indexOf("fsferry")&&(v=v.replace("fsferry/","")),-1==v.indexOf("?token")&&(v=v+"?token="+h)),t.next=15,Object(f["a"])(Object(u["a"])(v));case 15:if(w=t.sent,b=Object(n["a"])(w,2),b[0],I=b[1],!I.data||"REJECTED"!=I.data.resultAction){t.next=27;break}return layer.alert("照片内容违规,不可上传!"),$(".loading-design").hide(),o.loadingShow=!1,S={},S.id=i.id,Object(p["e"])(S).then(function(e){console.log("-----------简影删除方法返回----------"),console.log(e)}).catch(function(e){console.log("-----------简影删除方法报错----------"),console.log(e)}),t.abrupt("return");case 27:t.next=32;break;case 29:t.prev=29,t.t0=t["catch"](5),console.log(t.t0);case 32:"image"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType?(o.pageList[o.page_index].content.itemList[o.item_index].location.factWidth=i.width,o.pageList[o.page_index].content.itemList[o.item_index].location.factHeight=i.height):"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType?(o.pageList[o.page_index].content.itemList[o.item_index].location.maskFactWidth=i.width,o.pageList[o.page_index].content.itemList[o.item_index].location.maskFactHeight=i.height):o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType!=y["a"].SELF_GROUP||!o.seflGroupChildIndex&&0!=o.seflGroupChildIndex||("image"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType?(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].location.factWidth=i.width,o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].location.factHeight=i.height):"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].location.maskFactWidth=i.width,o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].location.maskFactHeight=i.height)),x=parseFloat(1*s/r),k=parseFloat(1*o.mask.size[2]/o.mask.size[3]),O=0,s>=r?(s<requireWidth||r<requireHeight)&&(O=1):(s<requireHeight||r<requireWidth)&&(O=1),L=JSON.parse(localStorage.getItem(o.pageKey.uploadCalenderTemp)),_=JSON.stringify(i.imageInfo),"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType&&(T=document.getElementById("editbgimg_photo_"+o.pageAndIndex).href.baseVal),o.pageList[o.page_index].content.itemList[o.item_index].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].cutArea.fromAiCut&&(T=document.getElementById("editdecrorate_"+o.pageAndIndex).href.baseVal),o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType!=y["a"].SELF_GROUP||!o.seflGroupChildIndex&&0!=o.seflGroupChildIndex||("advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType&&(T=document.getElementById("editbgimg_photo_"+o.pageAndIndex).href.baseVal),o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].cutArea.fromAiCut&&(T=document.getElementById("editdecrorate_"+o.pageAndIndex).href.baseVal)),C={},C.url=i.url,C.id=i.id,C.dateTime=l,C.width=s,C.height=r,C.isUse=!0,C.title=o.currentTitle,C.pixellow=O,C.titleAll=1,C.src=Object(m["d"])(i.url)+Object(m["e"])(i.url,_,h),j=0;case 54:if(!(j<L.length)){t.next=61;break}if(-1==T.indexOf(L[j].src)){t.next=58;break}return P=j,t.abrupt("break",61);case 58:j++,t.next=54;break;case 61:for(L.splice(P,0,C),x>k?o.pageList[o.page_index].content.itemList[o.item_index].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].cutArea.fromAiCut||("advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].media.imgX=0,o.pageList[o.page_index].content.itemList[o.item_index].media.imgY=0,o.pageList[o.page_index].content.itemList[o.item_index].media.imgHeight=o.mask.size[3],o.pageList[o.page_index].content.itemList[o.item_index].media.imgHeight=o.mask.size[3],o.pageList[o.page_index].content.itemList[o.item_index].media.imgWidth=x*o.mask.size[3],o.pageList[o.page_index].content.itemList[o.item_index].media.imgHeight=o.mask.size[3]),o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType!=y["a"].SELF_GROUP||!o.seflGroupChildIndex&&0!=o.seflGroupChildIndex||"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgX=0,o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgY=0,o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgHeight=o.mask.size[3],o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgHeight=o.mask.size[3],o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgWidth=x*o.mask.size[3],o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgHeight=o.mask.size[3]),o.photo.size[0]=0,o.photo.size[1]=0,o.photo.size[2]=x*o.mask.size[3],o.photo.size[3]=o.mask.size[3]):o.pageList[o.page_index].content.itemList[o.item_index].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].cutArea.fromAiCut||("advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].media.imgX=0,o.pageList[o.page_index].content.itemList[o.item_index].media.imgY=0,o.pageList[o.page_index].content.itemList[o.item_index].media.imgWidth=o.mask.size[2],o.pageList[o.page_index].content.itemList[o.item_index].media.imgHeight=o.mask.size[2]/x),o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType!=y["a"].SELF_GROUP||!o.seflGroupChildIndex&&0!=o.seflGroupChildIndex||"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgX=0,o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgY=0,o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgWidth=o.mask.size[2],o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgHeight=o.mask.size[2]/x),o.photo.size[0]=0,o.photo.size[1]=0,o.photo.size[2]=o.mask.size[2],o.photo.size[3]=o.mask.size[2]/x),o.scale=1,o.pageList[o.page_index].content.itemList[o.item_index].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].cutArea.fromAiCut?o.pageList[o.page_index].content.itemList[o.item_index].media.imgPath=C.src:("advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].media.maskSource=C.src),o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType!=y["a"].SELF_GROUP||!o.seflGroupChildIndex&&0!=o.seflGroupChildIndex||(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].cutArea.fromAiCut&&(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.imgPath=C.src),"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.maskSource=C.src))),-1!=T.indexOf("img/nophoto.jpg")&&("advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].media.defaultState=!1),o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType!=y["a"].SELF_GROUP||!o.seflGroupChildIndex&&0!=o.seflGroupChildIndex||"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType&&(o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.defaultState=!1)),A=0;A<L.length;A++)-1!=T.indexOf(L[A].src)&&L[A].title==o.currentTitle&&(N=L[A].title.split(","),1==N.length?(L[A].isUse=!1,L[A].title=""):N.length>1&&(L[A].title=L[A].title.replace(","+o.currentTitle,""),L[A].titleAll=L[A].titleAll-1)),L[A].url==i.url&&L[A].title==o.currentTitle&&(L[A].isUse=!0,L[A].title=o.currentTitle,L[A].titleAll=1);if(o.resetCalendarTemp(L),"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].media.mediaType||(o.seflGroupChildIndex||0==o.seflGroupChildIndex)&&"advancedImageMask"==o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].media.mediaType){if(E=C.src,-1!=E.indexOf(g["a"].thumbnailUrl)&&-1==E.indexOf("?token="))h=localStorage.getItem(o.pageKey.thumbnailToken),-1!=E.indexOf("commonUpload/")?(J=E.split("commonUpload/"),-1!=J[0].indexOf("fsferry")&&(J[0]=J[0].replace("fsferry/","")),E=J[0]+J[1]+"?token="+h):E=E+"?token="+h;else try{window._jylog&&(D=localStorage.getItem(o.pageKey.orderInfo),window._jylog.push(["渲染路径记录","单页编辑","警告",E,JSON.parse(D).orderNo]))}catch(e){console.log(e)}document.getElementById("editbgimg_photo_"+o.pageAndIndex).href.baseVal=E}if(o.pageList[o.page_index].content.itemList[o.item_index].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].cutArea.fromAiCut||(o.seflGroupChildIndex||0==o.seflGroupChildIndex)&&o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].cutArea&&o.pageList[o.page_index].content.itemList[o.item_index].childrenElement[o.seflGroupChildIndex].cutArea.fromAiCut){if(E=C.src,-1!=E.indexOf(g["a"].thumbnailUrl)&&-1==E.indexOf("?token="))h=localStorage.getItem(o.pageKey.thumbnailToken),-1!=E.indexOf("commonUpload/")?(J=E.split("commonUpload/"),-1!=J[0].indexOf("fsferry")&&(J[0]=J[0].replace("fsferry/","")),E=J[0]+J[1]+"?token="+h):E=E+"?token="+h;else try{window._jylog&&(D=localStorage.getItem(o.pageKey.orderInfo),window._jylog.push(["渲染路径记录","单页编辑","警告",E,JSON.parse(D).orderNo]))}catch(e){console.log(e)}document.getElementById("editdecrorate_"+o.pageAndIndex).href.baseVal=E}localStorage.setItem(o.pageKey.uploadCalenderTemp,JSON.stringify(L)),o.photo.img=C.src,o.detailJsonLocal.pageList=o.pageList,localStorage.setItem(o.pageKey.detailJson,JSON.stringify(o.detailJsonLocal)),o.isPhotoChange=!0,o.initImage("#drawing2"),$("#loadingData").hide(),$(".loading-design").hide(),o.loadingShow=!1;try{o.lastTime(a,"单张上传成功")}catch(e){console.log(e)}t.next=86;break;case 82:$("#loadingData").hide(),$(".loading-design").hide();try{window._jylog&&(D=localStorage.getItem(o.pageKey.orderInfo),window._jylog.push(["弹窗提示","设计","照片上传失败",JSON.stringify(i),JSON.parse(D).orderNo]))}catch(e){console.log(e)}layer.alert("照片上传失败！！！"+JSON.stringify(i));case 86:case"end":return t.stop()}},t,null,[[5,29]])}));function i(e){return t.apply(this,arguments)}return i}(),error:function(t){$("#loadingData").hide(),$(".loading-design").hide();try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","照片上传失败","e4：照片上传失败！"+JSON.stringify(t),JSON.parse(i).orderNo])}}catch(e){console.log(e)}try{o.lastTime(a,"单张上传失败")}catch(e){console.log(e)}layer.alert("照片上传失败！！！！"+JSON.stringify(t))}})},resetClaendarTemp:function(e,t){for(var i=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp)),a=0;a<i.length;a++)i[a].isUse=!1;var o=[],s=[];for(a=0;a<e.pageList.length;a++){var n=e.pageList[a];s=[];for(var r=0;r<n.content.itemList.length;r++){var l="",d=n.content.itemList[r];if(""!=d.cutArea&&null!=d.cutArea&&void 0!=d.cutArea&&1==d.cutArea.fromAiCut&&"image"==d.media.mediaType&&1==d.visible){-1==d.media.imgPath.indexOf(Object(m["d"])(d.media.imgPath))?(l=d.media.imgPath,Object(m["d"])(d.media.imgPath)+Object(m["a"])(d.media.imgPath,d,this.pageKey)):(l=Object(m["f"])(d.media.imgPath,d).replace(Object(m["d"])(d.media.imgPath),""),Object(m["d"])(l)+Object(m["a"])(l,d,this.pageKey));for(var c=0;c<i.length;c++)-1!=l.indexOf(i[c].url)&&(i[c].isUse=!0,s.push(i[c]))}if("advancedImageMask"==d.media.mediaType&&-1==d.media.maskSource.indexOf("img/nophoto.jpg")&&1==d.visible){-1==d.media.maskSource.indexOf(Object(m["d"])(d.media.maskSource))?(l=d.media.maskSource,Object(m["d"])(d.media.maskSource)+Object(m["a"])(d.media.maskSource,d,this.pageKey)):(d.media.maskSource,l=Object(m["f"])(d.media.maskSource,d).replace(Object(m["d"])(d.media.maskSource),""));for(c=0;c<i.length;c++)-1!=l.indexOf(i[c].url)&&(i[c].isUse=!0,s.push(i[c]))}}o=o.concat(s)}this.handlePhotoList(o),localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(o))},lastTime:function(e,t){},handlePhotoList:function(e){if(e.length>0){for(var t=JSON.parse(JSON.stringify(e)),i=[],a=0;a<t.length;a++){if(-1!=t[a].src.indexOf(this.thumbnailUrl)&&(-1!=t[a].src.indexOf("fsferry")&&(t[a].src=t[a].src.replace("fsferry/","")),-1!=t[a].src.indexOf("commonUpload")&&(t[a].src=t[a].src.replace("commonUpload/","")),-1==t[a].src.indexOf("token"))){var o=this.thumbnailToken;this.thumbnailToken||(o=localStorage.getItem(this.pageKey.thumbnailToken)),t[a].src=t[a].src+"?token="+o}i.push(t[a])}this.photolist=i}}}},b=w,I=(a("7d38"),a("2877")),S=Object(I["a"])(b,o,s,!1,null,null,null);i["a"]=S.exports},b2a9:function(t,i,a){"use strict";a.d(i,"a",function(){return h});a("ac4d"),a("8a81"),a("ac6a"),a("6b54"),a("a481"),a("7514"),a("96cf");var o=a("3b8d"),s=(a("28a5"),a("d225")),n=a("b0b4"),r=a("f3e0"),l=a("103a"),d=a("5841"),c="svgImg",h=function(){function t(e,i,a,o){Object(s["a"])(this,t),this.parent=e,this.objJson=i,this.i=a.i,this.m=a.m,this.c=a.c,this.index=a.index,this.vm=o,this.pageImgJson=a.pageImgJson}return Object(n["a"])(t,[{key:"initSvgImg",value:function(){var e=this;console.log("svg 加载中.................................");var t="";if(e.parent.childArr||(e.parent.childArr=[]),e.c>=0){if(t=c+"_"+e.i+"_"+e.m+"_"+e.c,-1!=e.parent.childArr.indexOf(t))return;e.parent.childArr.push(t)}else{if(t=c+"_"+e.i+"_"+e.m,-1!=e.parent.childArr.indexOf(t))return;e.parent.childArr.push(t)}e.loadSource()}},{key:"loadSource",value:function(){var t,i=this,a=i.objJson,o=JSON.parse(localStorage.getItem(i.vm.pageKey.detailJson));if(a.svgString){var s=r["a"].createXml(a.svgString);if(1==a.media.svgmodified){var n=s.getElementsByTagName("g")[0].getAttribute("transform");p=a.location.scaleX*Math.cos(a.location.rotation*(Math.PI/180)),y=a.location.scaleY*Math.cos(a.location.rotation*(Math.PI/180)),u=a.location.scaleX*Math.sin(a.location.rotation*(Math.PI/180)),f=-1*a.location.scaleY*Math.sin(a.location.rotation*(Math.PI/180)),_=a.printLocation.x+a.printLocation.width/2,v=a.printLocation.y+a.printLocation.height/2;n="matrix("+p+" "+u+" "+f+" "+y+" "+_+" "+v+")";s.getElementsByTagName("g")[0].setAttribute("transform",n)}t=r["a"].xmlToString(s),a.svgString="",i.c||0==i.c?(o.pageList[i.i].content.itemList[i.m].childrenElement[i.c].svgString="",1==a.media.svgmodified&&(m=String(i.m)+"_"+String(i.c)+"=layerIndex"+t)):(o.pageList[i.i].content.itemList[i.m].svgString="",1==a.media.svgmodified&&(m=String(i.m)+"=layerIndex"+t)),localStorage.setItem(i.vm.pageKey.detailJson,JSON.stringify(o)),i.vm.$store.dispatch("updatePages",o),1==a.media.svgmodified&&i.vm.$store.dispatch("updateSvgxmlArr",{pageIndex:i.i,svgString:m})}else{var c=a.media.imgPath;if(""!=a.media.imgPath&&-1==a.media.imgPath.indexOf(Object(l["d"])(a.media.imgPath))&&(c=Object(l["d"])(a.media.imgPath)+Object(l["a"])(a.media.imgPath,a,i.vm.pageKey)),-1!=c.indexOf(d["a"].thumbnailUrl)&&-1==c.indexOf("?token=")){if(-1!=a.media.imgPath.indexOf("commonUpload/"))if(-1!=c.indexOf("fsferry/")){var h=c.split("fsferry/commonUpload/");c=h[0]+h[1]}else{h=c.split("commonUpload/");c=h[0]+h[1]}var g=localStorage.getItem(i.vm.pageKey.thumbnailToken);c=c+"?token="+g}var m;s=r["a"].loadXML(c);if(1==a.media.svgmodified){var p,u,f,y,_,v;n=s.getElementsByTagName("g")[0].getAttribute("transform");p=a.location.scaleX*Math.cos(a.location.rotation*(Math.PI/180)),y=a.location.scaleY*Math.cos(a.location.rotation*(Math.PI/180)),u=a.location.scaleX*Math.sin(a.location.rotation*(Math.PI/180)),f=-1*a.location.scaleY*Math.sin(a.location.rotation*(Math.PI/180)),_=a.printLocation.x+a.printLocation.width/2,v=a.printLocation.y+a.printLocation.height/2;n="matrix("+p+" "+u+" "+f+" "+y+" "+_+" "+v+")";s.getElementsByTagName("g")[0].setAttribute("transform",n)}t=r["a"].xmlToString(s),a.svgString="",i.c||0==i.c?(o.pageList[i.i].content.itemList[i.m].childrenElement[i.c].svgString="",1==a.media.svgmodified&&(m=String(i.m)+"_"+String(i.c)+"=layerIndex"+t)):(o.pageList[i.i].content.itemList[i.m].svgString="",1==a.media.svgmodified&&(m=String(i.m)+"=layerIndex"+t)),localStorage.setItem(i.vm.pageKey.detailJson,JSON.stringify(o)),i.vm.$store.dispatch("updatePages",o),1==a.media.svgmodified&&i.vm.$store.dispatch("updateSvgxmlArr",{pageIndex:i.i,svgString:m})}var w=i.parent.svg(t);i.handleStrokeWidth(w),setTimeout(function(){try{i.pageImgJson&&i.pageImgJson.imgArr.length<=0&&(i.vm.isShowLoading=!1,console.log("页面加载完"),i.vm.everyTimeRender&&i.vm.everyTimeRender())}catch(e){console.log(e)}},100)}},{key:"handleStrokeWidth",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var i,a,o,s,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:i=this,a=!1;case 2:if(a){e.next=21;break}if(0!=$("#svg_"+i.i).length){e.next=7;break}return e.next=6,i.sleep(1e3);case 6:return e.abrupt("return");case 7:if(o=$("#svg_"+i.i)[0].getBoundingClientRect().width,0==o){e.next=17;break}s=i.parent.parent().viewbox().width,console.log("viewboxWidth:",s),n=o/s,r=i.c?t.find("svg")[i.index]:t.findOne("svg"),i.findAllChildren(r,n),a=!0,e.next=19;break;case 17:return e.next=19,i.sleep(1e3);case 19:e.next=2;break;case 21:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"findAllChildren",value:function(e,t){var i=this,a=e.css("stroke-width"),o=e.attr("stroke-width");a=a.replace("px",""),o=o.toString().replace("px",""),a&&""!=a&&"none"!=a?(e.stroke({width:a}),e.css("stroke-width",a*t)):o&&""!=o&&"none"!=o&&e.css("stroke-width",o*t);var s=e.css("stroke-dasharray"),n=e.attr("stroke-dasharray");if(s&&""!=s&&"none"!=s){var r=s.split(/\s|,/gi),l=[],d=!0,c=!1,h=void 0;try{for(var g,m=r[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var p=g.value;""!=p&&l.push(p*t)}}catch(P){c=!0,h=P}finally{try{d||null==m.return||m.return()}finally{if(c)throw h}}var u=l[0]+","+l[0];e.stroke({dasharray:s}),e.css("stroke-dasharray",u)}else if(n&&""!=n&&"none"!=n){var f=n.split(/\s|,/gi),y=(l=[],!0),_=!1,v=void 0;try{for(var w,b=f[Symbol.iterator]();!(y=(w=b.next()).done);y=!0){var I=w.value;""!=I&&l.push(I*t)}}catch(P){_=!0,v=P}finally{try{y||null==b.return||b.return()}finally{if(_)throw v}}u=l[0]+","+l[0];e.css("stroke-dasharray",u)}var S=e.children();if(0!=S.length){var x=!0,k=!1,O=void 0;try{for(var L,T=S[Symbol.iterator]();!(x=(L=T.next()).done);x=!0){var C=L.value;i.findAllChildren(C,t)}}catch(P){k=!0,O=P}finally{try{x||null==T.return||T.return()}finally{if(k)throw O}}}}},{key:"sleep",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}}]),t}()},b3ec:function(e,t,i){"use strict";var a=i("fdad"),o=i.n(a);o.a},b60d:function(e,t,i){"use strict";i.d(t,"a",function(){return c}),i.d(t,"g",function(){return m}),i.d(t,"c",function(){return h}),i.d(t,"d",function(){return p}),i.d(t,"f",function(){return g}),i.d(t,"e",function(){return u}),i.d(t,"b",function(){return f});var a,o,s,n,r,l,d=i("bd86"),c={},h={},g={},m={},p={},u={},f={};a={readyupload:"readyupload",historyCalenderTemp:"historyCalenderTemp",allTemplateList:"allTemplateList",areadyInsert:"areadyInsert",uploadCalenderTemp:"uploadCalenderTemp",editMoelGuide:"editMoelGuide",editMartGuide:"editMartGuide",editFontGuide:"editFontGuide",editTucengGuide:"editTucengGuide",edit_photo_guide:"edit_photo_guide",otherCalenderTemp:"otherCalenderTemp",isShowguid:"isShowguid",tokenDate:"tokenDate",designmodel:"designmodel",dateStr:"dateStr",caiyunContent:"caiyunContent",s3UploadConfig:"s3UploadConfig",firstModelShow:"firstModelShow",token:"token",isPC:"isPC",tokenDetail:"tokenDetail",rk:"rk",isfirst:"isfirst",isxcx:"isxcx",hassort:"hassort",foldStr:"foldStr",source:"source",sku:"sku",numIndex:"numIndex",returnURL:"returnURL",redirecType:"redirecType",uid:"uid",calenderTemp:"calenderTemp",taobanTemp:"taobanTemp",imageArray:"imageArray",imageList:"imageList",orgTime:"orgTime",wsid:"wsid",id:"id",flagURL:"flagURL",fmNum:"fmNum",teamBookUid:"teamBookUid",calendar_type:"calendar_type",accessToken:"accessToken",videonum:"videonum",serverId:"serverId",orderInfo:"orderInfo",pnum:"pnum",goodsid:"goodsid",motherid:"motherid",minnum:"minnum",maxnum:"maxnum",isVideo:"isVideo",diytype:"diytype",cal_size:"cal_size",previewImage:"previewImage",isTeamBook:"isTeamBook",calendar_hs:"calendar_hs",cal_pageList:"cal_pageList",calendar_designModel:"calendar_designModel",cal_detail:"cal_detail",cal_uploadImgNum:"cal_uploadImgNum",productId:"productId",ableSelect:"ableSelect",olduid:"olduid",detailJson:"detailJson",fold:"fold",templist:"templist",photoSize:"photoSize",mshopSign:"mshopSign",cal_baseBoard:"cal_baseBoard",materials:"materials",thirdDatil:"thirdDatil",cal_dgid:"cal_dgid",autoSave:"autoSave",forceRefresh:"forceRefresh",wxSku:"wxSku",orderSource:"orderSource"},Object(d["a"])(a,"isTeamBook","isTeamBook"),Object(d["a"])(a,"isPart","isPart"),Object(d["a"])(a,"exceptCount","exceptCount"),Object(d["a"])(a,"changxian","changxian"),Object(d["a"])(a,"changxianIdArray","changxianIdArray"),Object(d["a"])(a,"readyupload","readyupload"),Object(d["a"])(a,"thumbnailToken","thumbnailToken"),c=a,o={readyupload:"e_readyupload",historyCalenderTemp:"e_historyCalenderTemp",allTemplateList:"e_allTemplateList",areadyInsert:"e_areadyInsert",uploadCalenderTemp:"e_uploadCalenderTemp",editMoelGuide:"e_editMoelGuide",editFontGuide:"e_editFontGuide",editMartGuide:"e_editMartGuide",editTucengGuide:"e_editTucengGuide",edit_photo_guide:"e_edit_photo_guide",otherCalenderTemp:"e_otherCalenderTemp",isShowguid:"e_isShowguid",tokenDate:"e_tokenDate",designmodel:"e_designmodel",dateStr:"e_dateStr",caiyunContent:"e_caiyunContent",s3UploadConfig:"e_s3UploadConfig",firstModelShow:"e_firstModelShow",token:"e_token",isPC:"e_isPC",tokenDetail:"e_tokenDetail",isfirst:"e_isfirst",rk:"e_rk",isxcx:"e_isxcx",sku:"e_sku",numIndex:"e_numIndex",source:"e_source",returnURL:"e_returnURL",hassort:"e_hassort",foldStr:"e_foldStr",redirecType:"e_redirecType",uid:"e_uid",calenderTemp:"e_calenderTemp",taobanTemp:"e_taobanTemp",imageArray:"e_imageArray",imageList:"e_imageList",orgTime:"e_orgTime",id:"e_id",wsid:"e_wsid",flagURL:"e_flagURL",fmNum:"e_fmNum",teamBookUid:"e_teamBookUid",calendar_type:"e_calendar_type",accessToken:"e_accessToken",videonum:"e_videonum",serverId:"e_serverId",orderInfo:"e_orderInfo",pnum:"e_pnum",motherid:"e_motherid",productId:"e_productId",minnum:"e_minnum",maxnum:"e_maxnum",previewImage:"e_previewImage",isTeamBook:"e_isTeamBook",isVideo:"e_isVideo",diytype:"e_diytype",cal_size:"e_cal_size",calendar_hs:"e_calendar_hs",cal_pageList:"e_cal_pageList",calendar_designModel:"e_calendar_designModel",cal_detail:"e_cal_detail",cal_uploadImgNum:"e_cal_uploadImgNum",goodsid:"e_goodsid",ableSelect:"e_ableSelect",olduid:"e_olduid",detailJson:"e_detailJson",fold:"e_fold",templist:"e_templist",photoSize:"e_photoSize",mshopSign:"e_mshopSign",cal_baseBoard:"e_cal_baseBoard",materials:"e_materials",thirdDatil:"e_thirdDatil",cal_dgid:"e_cal_dgid",autoSave:"e_autoSave",forceRefresh:"e_forceRefresh",wxSku:"e_wxSku",orderSource:"e_orderSource"},Object(d["a"])(o,"isTeamBook","e_isTeamBook"),Object(d["a"])(o,"isPart","e_isPart"),Object(d["a"])(o,"exceptCount","e_exceptCount"),Object(d["a"])(o,"changxian","e_changxian"),Object(d["a"])(o,"changxianIdArray","e_changxianIdArray"),Object(d["a"])(o,"readyupload","e_readyupload"),Object(d["a"])(o,"thumbnailToken","e_thumbnailToken"),h=o,s={editMoelGuide:"g_editMoelGuide",editFontGuide:"g_editFontGuide",editMartGuide:"g_editMartGuide",editTucengGuide:"g_editTucengGuide",edit_photo_guide:"g_edit_photo_guide",otherCalenderTemp:"g_otherCalenderTemp",isShowguid:"g_isShowguid",tokenDate:"g_tokenDate",designmodel:"g_designmodel",dateStr:"g_dateStr",caiyunContent:"g_caiyunContent",s3UploadConfig:"g_s3UploadConfig",firstModelShow:"g_firstModelShow",token:"g_token",isPC:"g_isPC",tokenDetail:"g_tokenDetail",isfirst:"g_isfirst",rk:"g_rk",isxcx:"g_isxcx",sku:"g_sku",numIndex:"g_numIndex",source:"g_source",returnURL:"g_returnURL",hassort:"g_hassort",foldStr:"g_foldStr",redirecType:"g_redirecType",uid:"g_uid",calenderTemp:"g_calenderTemp",taobanTemp:"g_taobanTemp",imageArray:"g_imageArray",imageList:"g_imageList",orgTime:"g_orgTime",id:"g_id",wsid:"g_wsid",flagURL:"g_flagURL",fmNum:"g_fmNum",teamBookUid:"g_teamBookUid",calendar_type:"g_calendar_type",accessToken:"g_accessToken",videonum:"g_videonum",serverId:"g_serverId",orderInfo:"g_orderInfo",pnum:"g_pnum",motherid:"g_motherid",productId:"g_productId",minnum:"g_minnum",maxnum:"g_maxnum",previewImage:"g_previewImage",isTeamBook:"g_isTeamBook",isVideo:"g_isVideo",diytype:"g_diytype",cal_size:"g_cal_size",calendar_hs:"g_calendar_hs",cal_pageList:"g_cal_pageList",calendar_designModel:"g_calendar_designModel",cal_detail:"g_cal_detail",cal_uploadImgNum:"g_cal_uploadImgNum",goodsid:"g_goodsid",ableSelect:"g_ableSelect",olduid:"g_olduid",detailJson:"g_detailJson",fold:"g_fold",templist:"g_templist",photoSize:"g_photoSize",mshopSign:"g_mshopSign",cal_baseBoard:"g_cal_baseBoard",materials:"g_materials",thirdDatil:"g_thirdDatil",cal_dgid:"g_cal_dgid",autoSave:"g_autoSave",forceRefresh:"g_forceRefresh",wxSku:"g_wxSku",orderSource:"g_orderSource"},Object(d["a"])(s,"isTeamBook","g_isTeamBook"),Object(d["a"])(s,"isPart","g_isPart"),Object(d["a"])(s,"exceptCount","g_exceptCount"),Object(d["a"])(s,"changxian","g_changxian"),Object(d["a"])(s,"changxianIdArray","g_changxianIdArray"),Object(d["a"])(s,"thumbnailToken","g_thumbnailToken"),p=s,n={editMoelGuide:"n_editMoelGuide",editFontGuide:"n_editFontGuide",editMartGuide:"n_editMartGuide",editTucengGuide:"n_editTucengGuide",edit_photo_guide:"n_edit_photo_guide",otherCalenderTemp:"n_otherCalenderTemp",isShowguid:"n_isShowguid",tokenDate:"n_tokenDate",designmodel:"n_designmodel",dateStr:"n_dateStr",caiyunContent:"n_caiyunContent",s3UploadConfig:"n_s3UploadConfig",firstModelShow:"n_firstModelShow",token:"n_token",isPC:"n_isPC",tokenDetail:"n_tokenDetail",isfirst:"n_isfirst",rk:"n_rk",isxcx:"n_isxcx",sku:"n_sku",numIndex:"n_numIndex",source:"n_source",returnURL:"n_returnURL",hassort:"n_hassort",foldStr:"n_foldStr",redirecType:"n_redirecType",uid:"n_uid",calenderTemp:"n_calenderTemp",taobanTemp:"n_taobanTemp",imageArray:"n_imageArray",imageList:"n_imageList",orgTime:"n_orgTime",id:"n_id",wsid:"n_wsid",flagURL:"n_flagURL",fmNum:"n_fmNum",teamBookUid:"n_teamBookUid",calendar_type:"n_calendar_type",accessToken:"n_accessToken",videonum:"n_videonum",serverId:"n_serverId",orderInfo:"n_orderInfo",pnum:"n_pnum",motherid:"n_motherid",productId:"n_productId",minnum:"n_minnum",maxnum:"n_maxnum",previewImage:"n_previewImage",isTeamBook:"n_isTeamBook",isVideo:"n_isVideo",diytype:"n_diytype",cal_size:"n_cal_size",calendar_hs:"n_calendar_hs",cal_pageList:"n_cal_pageList",calendar_designModel:"n_calendar_designModel",cal_detail:"n_cal_detail",cal_uploadImgNum:"n_cal_uploadImgNum",goodsid:"n_goodsid",ableSelect:"n_ableSelect",olduid:"n_olduid",detailJson:"n_detailJson",fold:"n_fold",templist:"n_templist",photoSize:"n_photoSize",mshopSign:"n_mshopSign",cal_baseBoard:"n_cal_baseBoard",materials:"n_materials",thirdDatil:"n_thirdDatil",cal_dgid:"n_cal_dgid",autoSave:"n_autoSave",forceRefresh:"n_forceRefresh",wxSku:"n_wxSku",orderSource:"n_orderSource"},Object(d["a"])(n,"isTeamBook","n_isTeamBook"),Object(d["a"])(n,"isPart","n_isPart"),Object(d["a"])(n,"exceptCount","n_exceptCount"),Object(d["a"])(n,"changxian","n_changxian"),Object(d["a"])(n,"changxianIdArray","n_changxianIdArray"),Object(d["a"])(n,"textFontId","n_textFontId"),Object(d["a"])(n,"textFontFamily","n_textFontFamily"),Object(d["a"])(n,"thumbnailToken","n_thumbnailToken"),u=n,r={editMoelGuide:"ecd_editMoelGuide",editFontGuide:"ecd_editFontGuide",editMartGuide:"ecd_editMartGuide",editTucengGuide:"ecd_editTucengGuide",edit_photo_guide:"ecd_edit_photo_guide",otherCalenderTemp:"ecd_otherCalenderTemp",isShowguid:"ecd_isShowguid",tokenDate:"ecd_tokenDate",designmodel:"ecd_designmodel",dateStr:"ecd_dateStr",caiyunContent:"ecd_caiyunContent",s3UploadConfig:"ecd_s3UploadConfig",firstModelShow:"ecd_firstModelShow",token:"ecd_token",isPC:"ecd_isPC",tokenDetail:"ecd_tokenDetail",isfirst:"ecd_isfirst",rk:"ecd_rk",isxcx:"ecd_isxcx",sku:"ecd_sku",numIndex:"ecd_numIndex",source:"ecd_source",returnURL:"ecd_returnURL",hassort:"ecd_hassort",foldStr:"ecd_foldStr",redirecType:"ecd_redirecType",uid:"ecd_uid",calenderTemp:"ecd_calenderTemp",taobanTemp:"ecd_taobanTemp",imageArray:"ecd_imageArray",imageList:"ecd_imageList",orgTime:"ecd_orgTime",id:"ecd_id",wsid:"ecd_wsid",flagURL:"ecd_flagURL",fmNum:"ecd_fmNum",teamBookUid:"ecd_teamBookUid",calendar_type:"ecd_calendar_type",accessToken:"ecd_accessToken",videonum:"ecd_videonum",serverId:"ecd_serverId",orderInfo:"ecd_orderInfo",pnum:"ecd_pnum",motherid:"ecd_motherid",productId:"ecd_productId",minnum:"ecd_minnum",maxnum:"ecd_maxnum",previewImage:"ecd_previewImage",isTeamBook:"ecd_isTeamBook",isVideo:"ecd_isVideo",diytype:"ecd_diytype",cal_size:"ecd_cal_size",calendar_hs:"ecd_calendar_hs",cal_pageList:"ecd_cal_pageList",calendar_designModel:"ecd_calendar_designModel",cal_detail:"ecd_cal_detail",cal_uploadImgNum:"ecd_cal_uploadImgNum",goodsid:"ecd_goodsid",ableSelect:"ecd_ableSelect",olduid:"ecd_olduid",detailJson:"ecd_detailJson",fold:"ecd_fold",templist:"ecd_templist",photoSize:"ecd_photoSize",mshopSign:"ecd_mshopSign",cal_baseBoard:"ecd_cal_baseBoard",materials:"ecd_materials",thirdDatil:"ecd_thirdDatil",cal_dgid:"ecd_cal_dgid",autoSave:"ecd_autoSave",forceRefresh:"ecd_forceRefresh",wxSku:"ecd_wxSku",orderSource:"ecd_orderSource"},Object(d["a"])(r,"isTeamBook","ecd_isTeamBook"),Object(d["a"])(r,"isPart","ecd_isPart"),Object(d["a"])(r,"exceptCount","ecd_exceptCount"),Object(d["a"])(r,"changxian","ecd_changxian"),Object(d["a"])(r,"changxianIdArray","ecd_changxianIdArray"),Object(d["a"])(r,"thumbnailToken","ecd_thumbnailToken"),f=r,l={designmodel:"show_designmodel",dateStr:"show_dateStr",caiyunContent:"show_caiyunContent",s3UploadConfig:"show_s3UploadConfig",firstModelShow:"show_firstModelShow",token:"show_token",isPC:"show_isPC",tokenDetail:"show_tokenDetail",isfirst:"show_isfirst",rk:"show_rk",isxcx:"show_isxcx",sku:"show_sku",numIndex:"show_numIndex",source:"show_source",returnURL:"show_returnURL",hassort:"show_hassort",foldStr:"show_foldStr",redirecType:"show_redirecType",uid:"show_uid",calenderTemp:"show_calenderTemp",taobanTemp:"show_taobanTemp",imageArray:"show_imageArray",imageList:"show_imageList",orgTime:"show_orgTime",id:"show_id",wsid:"show_wsid",flagURL:"show_flagURL",fmNum:"show_fmNum",teamBookUid:"show_teamBookUid",calendar_type:"show_calendar_type",accessToken:"show_accessToken",videonum:"show_videonum",serverId:"show_serverId",orderInfo:"show_orderInfo",pnum:"show_pnum",motherid:"show_motherid",productId:"show_productId",minnum:"show_minnum",maxnum:"show_maxnum",previewImage:"show_previewImage",isTeamBook:"show_isTeamBook",isVideo:"show_isVideo",diytype:"show_diytype",cal_size:"show_cal_size",calendar_hs:"show_calendar_hs",cal_pageList:"show_cal_pageList",calendar_designModel:"show_calendar_designModel",cal_detail:"show_cal_detail",cal_uploadImgNum:"show_cal_uploadImgNum",goodsid:"show_goodsid",ableSelect:"show_ableSelect",olduid:"show_olduid",detailJson:"show_detailJson",fold:"show_fold",templist:"show_templist",photoSize:"show_photoSize",mshopSign:"show_mshopSign",cal_baseBoard:"show_cal_baseBoard",materials:"show_materials",thirdDatil:"show_thirdDatil",cal_dgid:"show_cal_dgid",autoSave:"show_autoSave",forceRefresh:"show_forceRefresh",wxSku:"show_wxSku",orderSource:"show_orderSource"},Object(d["a"])(l,"isTeamBook","show_isTeamBook"),Object(d["a"])(l,"isPart","show_isPart"),Object(d["a"])(l,"exceptCount","show_exceptCount"),Object(d["a"])(l,"changxian","show_changxian"),Object(d["a"])(l,"changxianIdArray","show_changxianIdArray"),Object(d["a"])(l,"thumbnailToken","show_thumbnailToken"),m=l,g={showGuide:"showGuide",userToken:"userToken",isMiniProgram:"isMiniProgram",isShowHelp:"isShowHelp",isShowTips:"isShowTips",mobileUrl:"mobileUrl",gonggeGuide:"gonggeGuide",fromAlipyShopPaid:"fromAlipyShopPaid",fromAlipyShop:"fromAlipyShop",alipyShopGoodsid:"alipyShopGoodsid",alipyShopProductid:"alipyShopProductid",fromAlipyShopCartEdit:"fromAlipyShopCartEdit",fromJianYingDesign:"fromJianYingDesign"}},b775:function(e,t,i){"use strict";var a=i("bc3a"),o=i.n(a),s=i("5841");console.log(s["a"].basicUrl);var n=o.a.create({baseURL:s["a"].basicUrl,timeout:0});n.defaults.headers.retry=4,n.defaults.headers.retryDelay=1e3,n.interceptors.request.use(function(e){return e},function(e){return console.log(e),Promise.reject(e)}),n.interceptors.response.use(function(e){var t=e.data;return t},function(e){console.log("err"+e);var t=e.config;if(!t||!t.headers.retry)return Promise.reject(e);if(t.headers.__retryCount=t.headers.__retryCount||0,t.headers.__retryCount>=t.headers.retry)return Promise.reject(e);t.headers.__retryCount+=1;var i=new Promise(function(e){setTimeout(function(){e()},t.headers.retryDelay||1)});return i.then(function(){return n(t)})}),t["a"]=n},b7ff:function(module,__webpack_exports__,__webpack_require__){"use strict";var D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("7618"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("55dd"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("7514"),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_7__),D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("bd86"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__),weui_min_css__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("3320"),weui_min_css__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(weui_min_css__WEBPACK_IMPORTED_MODULE_10__),jquery_weui_min_css__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("0ddc"),jquery_weui_min_css__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(jquery_weui_min_css__WEBPACK_IMPORTED_MODULE_11__),_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("1180"),_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_12__),mobileResponsive750__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("5031"),tab__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("6b92"),_baseUrl__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("5841"),vuex__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("2f62"),_utils_testMobileAndBrowser__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("23ed"),_utils_timeUtil__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("054f"),_public_img_time_svg__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("6b12"),_public_img_time_svg__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_public_img_time_svg__WEBPACK_IMPORTED_MODULE_19__),_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("103a"),_api_getJson__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("4cbb"),_storagekey__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("b60d"),isError=!1,orderNo="",requireWidth=800,requireHeight=800;$(function(){$(".proTit span").eq(0).addClass("on"),$(".proTit span").on("click",function(){$(this).addClass("on").siblings().removeClass("on")})}),__webpack_exports__["a"]={name:"mtemplate",data:function(){return{newtid:"",isShowguid:!1,errorInfo:"",orderInfos:{},changeSelectDate:!1,changeDateShow:!1,chooseDateNow:"",chooseDateMiddleNow:"",showNum:!0,showReload:!1,checkReload:!1,productno:"",orderNo:"",memberid:"",doubble:!1,pageKey:null,normalKey:null,productId:"",goodsid:"",copyUrl:_baseUrl__WEBPACK_IMPORTED_MODULE_15__["a"].copyUrl,imageArray:[],is_weixn:!1,is_alipay:!1,is_byte:!1,browser:{},templateId:0,dataArr:[],templates:[],templatesAll:[],decoratePageNum:1,totalNumberOfPages:"",startx:"",starty:"",direction:"",checkTop:"",albumid:"",items:[],price:"",history:[],page:{},pageList:[],startDate:"",endDate:"",flagURL:"",id:"",spmc:"",num:"",returnURL:"",oid:"",token:"",maxnum:"",minnum:"",isShowLoading:!1,iscaiyun:"",wenanText:"",previewImageUrl:"",previewImageUrlArr:[],prevImage:!1,nextImage:!1,imageIndex:0,isvideo:!1,pnum:"",tpnum:"",content:"",patternid:"",sort:"new",changeModelAll:!1,isTeamBook:!1,templateid:"",uid:null,source:"",wsid:"",avatarurl:"",totalStyleNum:"",nickname:"",isTS:!1,mobilestyleid:"",styleNum:1,ytid:"",appFlag:"",ycoverbacknum:"",fxOrderNo:null,value:"",shopname:"",firstModelShow:0,draftsNum:0,isPart:!1,isSimple:!1,hasDraft:!1,hasHistoryBack_tt:!1,thumbnailToken:"",firstLoadPageStartTime:null}},created:function(){var t=this;if(this.firstLoadPageStartTime=performance.now(),this.$route.query.lianzitieSingle){var i;$.ajax((i={url:_baseUrl__WEBPACK_IMPORTED_MODULE_15__["a"].basicUrl+"/member/checkSkuType.do?sku="+this.$route.query.sku,type:"POST",data:{sku:this.$route.query.sku},contentType:"application/json; charset=utf-8"},Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__["a"])(i,"type","POST"),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__["a"])(i,"async",!1),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__["a"])(i,"success",function(e){"lianzitie"==e.data.type&&Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["Q"])("-1","").then(function(e){1==e.result||"true"==e.result?t.$router.replace({name:"loading",query:{sku:t.$route.query.sku,token:e.token,lianzitieSingle:t.$route.query.lianzitieSingle}}):layer.alert("获取token失败！")})}),Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_8__["a"])(i,"error",function(e){console.log(e)}),i))}else{console.info("url===========",window.location.href),document.body.style.position="absolute";var a=localStorage.getItem("isAlipay"),o=(localStorage.getItem("isByte"),navigator.userAgent.toLowerCase());("undefined"!=typeof my||"alipayclient"==o.match(/AlipayClient/i)||a)&&(this.is_alipay=!0),"toutiaomicroapp"==o.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0),this.browser={versions:function(){var e=navigator.userAgent;navigator.appVersion;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile/i)||!!e.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1||e.indexOf("Mac")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};o=navigator.userAgent.toLowerCase();this.browser.versions.android&&"micromessenger"==o.match(/MicroMessenger/i)&&(this.is_weixn=!0);o=navigator.userAgent.toLowerCase(),a=localStorage.getItem("isAlipay");this.is_alipay&&loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}}),this.hasDraft=this.$route.query.hasDraft,this.normalKey=_storagekey__WEBPACK_IMPORTED_MODULE_22__["f"],this.history=this.$route.query.history,this.uid=this.$route.query.uid,this.history?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_22__["c"]:this.uid?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_22__["c"]:this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_22__["a"],this.token=this.$route.query.token||localStorage.getItem(this.pageKey.token),this.iscaiyun=this.$route.query.iscaiyun;var s=this.$route.query.source;this.checkUid(),localStorage.removeItem(this.pageKey.numIndex),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["a"].isxcx);var n=this;if(this.changeModelAll=this.$route.query.changeModelAll,this.uid=this.$route.query.uid,this.changeModelAll||(localStorage.setItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["f"].mobileUrl,window.location.href),this.token&&"null"!=this.token&&this.token,"third"==localStorage.getItem(this.pageKey.source)||localStorage.removeItem(this.pageKey.source)),this.wsid=this.$route.query.wsid,-1==this.wsid){for(var r in this.pageKey)localStorage.removeItem(this.pageKey[r]);for(var r in _storagekey__WEBPACK_IMPORTED_MODULE_22__["f"])localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["f"][r])}var l=this.$route.query.avatarurl,d=this.$route.query.nickname,c=this.$route.query.albumid,h=this.$route.query.price,g=this.$route.query.tid,m=this.$route.query.coverbacknum;if(this.isTS=this.$route.query.isTS,c&&(this.albumid=c,this.avatarurl=l,this.nickname=d,this.ytid=g,this.price=h,this.ycoverbacknum=m),localStorage.removeItem(n.pageKey.rk),-1!=window.location.href.indexOf("zheliyin.com")&&!s){s="fxxt";try{window._czc&&window._czc.push(["_trackEvent","剪影","分销模板列表页",s])}catch(e){console.log(e)}}if(this.source=s,"fxxt"==s){var p=this.$route.query.redirecType;this.fxOrderNo=this.$route.query.fxOrderNo,localStorage.setItem(this.pageKey.source,s),localStorage.setItem(this.pageKey.redirecType,p)}localStorage.setItem(this.pageKey.orgTime,(new Date).getTime()),this.templateid=this.$route.query.templateid,this.oid=localStorage.getItem(this.pageKey.id),this.returnURL=decodeURI(this.$route.query.returnURL),this.num=this.$route.query.num,this.spmc=decodeURI(this.$route.query.spmc),this.id=this.$route.query.id,this.flagURL=this.$route.query.flagURL,"wechat"==this.flagURL&&(this.source="wechat",localStorage.setItem(this.pageKey.source,this.source),localStorage.setItem(this.pageKey.returnURL,this.returnURL)),"guochao"==s&&(this.source="guochao",localStorage.setItem(this.pageKey.source,this.source)),"wechat"==this.source||this.checkMobile(),this.productno=this.$route.query.sku||localStorage.getItem(this.pageKey.sku),null!=this.productno&&""!=this.productno&&"string"==typeof this.productno&&(this.productno=this.productno.trim()),this.memberid=decodeURI(this.$route.query.memberid),this.orderNo=this.$route.query.orderNo;var u=localStorage.getItem(this.pageKey.detailJson);if(u&&(this.orderInfos=JSON.parse(u).oderInfo),null==this.token||void 0==this.token||""==this.token||"undefined"==this.token)this.wsid&&""!=this.wsid?(this.shopname=this.$route.query.shopname,null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.getTemplateList()):(this.token=localStorage.getItem(this.pageKey.token)||this.$route.query.token,this.productno=this.orderInfos.productNo,this.templateList(this.productno,this.token));else{s=localStorage.getItem(this.pageKey.source);if(this.wsid&&""!=this.wsid?(this.productno=this.$route.query.sku,null!=this.productno&&""!=this.productno&&(this.productno=this.productno.trim()),this.getTemplateList()):(this.productno||(this.productno=this.orderInfos.productNo),this.templateList(this.productno,this.token)),"third"!=s&&!this.changeModelAll){var f=this.orderNo;localStorage.setItem(this.pageKey.token,this.token),localStorage.setItem(this.normalKey.userToken,this.token);var y={goodsname:this.spmc,id:this.id,memberid:this.memberid,num:this.num,orderNo:f,productNo:this.productno,source:this.source,url:window.location.href};this.$store.dispatch("updateOrderInfo",y),localStorage.setItem(this.pageKey.orderInfo,JSON.stringify(y))}this.getTokenDetail(this.token)}console.log("token===========",this.token)}},mounted:function(){var e=$("#goTop");if(document.getElementById("modelPreviewShow")){var t=document.getElementById("modelPreviewShow");t.addEventListener("touchstart",function(e){this.startx=e.touches[0].pageX,this.starty=e.touches[0].pageY},!1),t.addEventListener("touchmove",function(e){e.changedTouches[0].pageX,e.changedTouches[0].pageY},!1);var i=this;i.imageIndex=0,t.addEventListener("touchend",function(e){var a,o;t.scrollTop,a=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY;var s=i.getDirection(this.startx,this.starty,a,o);if(3==s)if(i.imageIndex>=i.previewImageUrlArr.length-1){try{if(window._jylog){var n=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","已经是最后一页！"+res,JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert("已经是最后一页！"),i.imageIndex=i.previewImageUrlArr.length-1}else i.findImageByIndex(1);if(4==s)if(i.imageIndex<=0){try{if(window._jylog){n=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","当前是第一页！"+res,JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert("当前是第一页！"),i.imageIndex=0}else i.findImageByIndex(-1)},!1)}$(window).scroll(function(){var t=$(window).scrollTop();t>150?e.css({opacity:1,visibility:"visible"}):e.css({opacity:0,visibility:"hidden"})});var a=new Date,o="",s=a.getMonth();s<6&&(o=a.getFullYear()),s>=6&&s<=11&&(o=a.getFullYear()),this.dataArr=[o+"年1月",o+"年2月",o+"年3月",o+"年4月",o+"年5月",o+"年6月",o+"年7月",o+"年8月",o+"年9月",o+"年10月",o+"年11月",o+"年12月",o+1+"年1月"],this.startDate=this.dataArr[0],this.endDate=this.dataArr[this.dataArr.length-1];var n=$("#temp_hist").find(".tab-link"),r=$("#temp_hist_cont").find(".tab-cont");r.hide().eq(0).show(),n.removeClass("active").eq(0).addClass("active"),n.click(function(){if(!$(this).hasClass("active"))if($(this).addClass("active").siblings().removeClass("active"),r.hide().eq($(this).index()).show(),0==$(this).index()){if(this.templates.length>0)return;this.queryTemplate(0)}else{var e=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));this.memberid=e.memberid}})},beforeDestroy:function(){window.removeEventListener("popstate",this.returnBack_tt,!1)},methods:{returnBack_tt:function(){if(this.is_byte){if(this.hasHistoryBack_tt)return;tt.miniProgram.navigateBack({delta:1})}else 0==this.hasDraft||"false"==this.hasDraft?"fxxt"==this.source||"wechat"==this.source||"thrid"==this.source?history.go(-1):this.is_alipay?my.navigateBack({delta:1}):history.go(-2):history.go(-1)},selectAll:function(){if(""==this.value){try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","搜索",this.value,JSON.parse(t).orderNo])}}catch(e){console.log(e)}this.loadData(0,0),$(".proTit").find("span").eq(0).html("最新")}},bodyScroll:function(e){e.preventDefault()},templateList:function(t,i){var a=this,o=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["t"])(t,i,o.decoratePageNum,o.mobilestyleid,!1,o.sort).then(function(t){if(t.result){if(o.items=t.data.ptList,o.thumbnailToken=t.data.base64Token,o.wsid&&""!=o.wsid&&o.items.length>0){var i=JSON.parse(localStorage.getItem(o.pageKey.orderInfo));i.goodsname=t.data.tlist[0].name,o.$store.dispatch("updateOrderInfo",i),localStorage.setItem(a.pageKey.orderInfo,JSON.stringify(i))}for(var s=0;s<t.data.tlist.length;s++)0==s&&""==t.data.tlist[s].previewimage&&(t.data.tlist[s].previewimage="MXYZ-0CCC71D78F0A42A7A65A452A7B0F5A33.png"),"woodcut"==t.data.tlist[s].diytype&&(t.data.tlist[s].name.indexOf("横款")>-1?t.data.tlist[s].name="横款-"+t.data.tlist[s].name:t.data.tlist[s].name="竖款-"+t.data.tlist[s].name);if(1==o.decoratePageNum&&(o.templates=[],o.templatesAll=[]),t.data.tlist.forEach(function(e){o.ytid&&""!=o.ytid?o.ytid==e.id&&(o.templates.push(e),o.templatesAll.push(e)):(o.templates.push(e),o.templatesAll.push(e))}),0==o.templatesAll.length){try{if(window._jylog){var n=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","没有相关模板",JSON.parse(n).orderNo])}}catch(e){console.log(e)}return void layer.alert("没有相关模板！")}try{if(o.firstLoadPageStartTime&&-1!=window.location.href.indexOf("mtemplate")&&o.decoratePageNum<=1){var r=performance.now(),l=(r-o.firstLoadPageStartTime)/1e3;if(console.log("模板列表页loadCostTime:"+l),window._jylog){n=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["加载时长","模板列表页","模板列表页打开时长",l,JSON.parse(n).orderNo])}}}catch(e){console.log(e)}var d="";if(t.data.doubleface&&(d=t.data.doubleface),"双页模式"==t.data.tlist[0].designmodel&&"year_calendar"==t.data.tlist[0].diytype?1!=d&&(a.doubble=!0,localStorage.setItem(a.pageKey.designmodel,"pair")):localStorage.removeItem(a.pageKey.designmodel),o.productId=t.data.productid,o.goodsid=t.data.goodsids,o.motherid=t.data.motherid,o.pnum=t.data.pnum,o.tpnum=t.data.tpnum,o.minnum=t.data.minnum,o.maxnum=t.data.maxnum,o.totalNumberOfPages=t.data.totalNumberOfPages,o.videoupload=t.data.videoupload,o.videonum=t.data.videonum,localStorage.setItem(o.pageKey.pnum,t.data.pnum),localStorage.setItem(o.pageKey.goodsid,o.goodsid),localStorage.setItem(o.pageKey.motherid,o.motherid),localStorage.setItem(o.pageKey.productId,o.productId),localStorage.setItem(o.pageKey.minnum,o.minnum),localStorage.setItem(o.pageKey.maxnum,o.maxnum),localStorage.setItem(o.pageKey.isVideo,o.videoupload),localStorage.setItem(o.pageKey.videonum,o.videonum),localStorage.setItem(o.pageKey.thumbnailToken,o.thumbnailToken),localStorage.setItem(o.pageKey.isTeamBook,t.data.isTeamBook),localStorage.setItem(o.pageKey.isPart,!1),localStorage.setItem(o.pageKey.rk,t.data.producttype),localStorage.setItem(o.pageKey.diytype,o.templates[0].diytype),"year_calendar"==o.templates[0].diytype){var c=new Date,h=(c.getFullYear(),c.getMonth()),g=0;h<6&&(g=12),h>=6&&h<=10&&(g=h,1==o.decoratePageNum&&($(".mask").show(),$(".selectDate").show())),11==h&&(g=12,1==o.decoratePageNum&&($(".mask").show(),$(".selectDate").show()));var m=localStorage.getItem(o.pageKey.numIndex);m||o.selectChange(g)}else localStorage.removeItem(o.pageKey.numIndex);o.isTeamBook=t.data.isTeamBook,o.isTeamBook&&(localStorage.setItem(o.pageKey.source,"isTeamBook"),document.title="如琢毕业册"),o.videoupload&&(o.isVideo=o.videoupload),o.isWxEnv(o.isVideo);for(s=0;s<o.templates.length;s++)if(""!=o.templates[s].previewimage&&-1==o.templates[s].previewimage.indexOf("http")){var p=new Image;p.src=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["d"])(o.templates[s].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["h"])(o.templates[s].previewimage,{},o.pageKey),o.templates[s].previewimage=p.src}}else{try{if(window._jylog){n=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告",t.msg,JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert(t.msg)}o.changeModelAll?o.logFrom("换模板"):o.logFrom("sku")})},getMore:function(t,i,a,o,s,n){var r=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["u"])(this.token,this.productno,a,o,s,this.value,!1,n).then(function(t){if(r.totalStyleNum=t.data.totalNumberOfPages,1==r.styleNum&&(r.templates=[],r.templatesAll=[]),t.data.tlist.forEach(function(e){""==e.previewimage&&(e.previewimage="MXYZ-0CCC71D78F0A42A7A65A452A7B0F5A33.png"),r.ytid?r.ytid==e.id&&(r.templates.push(e),r.templatesAll.push(e)):(r.templates.push(e),r.templatesAll.push(e))}),0!=r.templatesAll.length){for(var i=0;i<r.templates.length;i++)if(""!=r.templates[i].previewimage&&-1==r.templates[i].previewimage.indexOf("http")){var a=new Image;a.src=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["d"])(r.templates[i].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["h"])(r.templates[i].previewimage,{},r.pageKey),r.templates[i].previewimage=a.src}}else{if(r.ytid){try{if(window._jylog){var o=localStorage.getItem(r.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","已选定模板，不可替换！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}return void layer.alert("已选定模板，不可替换！")}try{if(window._jylog){o=localStorage.getItem(r.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","没有相关模板！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}layer.alert("没有相关模板！")}})},getStartDate:function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1;this.startDate=t+"年"+i+"月",i+11>12?(i--,t++):i+=11,this.endDate=t+"年"+i+"月"},setEndDate:function(e){var t=parseInt(e.substr(0,e.indexOf("年"))),i=parseInt(e.substr(parseInt(e.indexOf("年"))+1,e.indexOf("月")));i+11>12?(i--,t++):i+=11,this.endDate=t+"年"+i+"月"},loadData:function(e,t){this.mobilestyleid=0==e?"":e,this.sort=0==t?"new":1==t?"bouthsortnum":"",this.getMore(this.motherid,this.goodsid,this.tpnum,this.styleNum,this.mobilestyleid,this.sort);var i=$(".proTit").find("span").eq(t);i.hasClass("on")||i.addClass("on").siblings().removeClass("on")},design:function(t){var i=this,a=this;document.body.removeEventListener("touchmove",this.bodyScroll,!1),this.isShowLoading=!0,this.wenanText="努力跳转中";this.is_weixn;var o=this.is_byte,s=!1,n=JSON.parse(localStorage.getItem(this.pageKey.pnum)),r=(JSON.parse(localStorage.getItem(this.pageKey.uid)),localStorage.getItem(this.pageKey.numIndex)),l="";try{var d=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));l=d.orderNo}catch(e){}1==this.isTeamBook&&"true"!=this.isPart&&1!=this.isPart&&(s=!0);navigator.userAgent.toLowerCase();var c=navigator.userAgent,h=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(o&&!h)return this.isShowLoading=!1,void tt.miniProgram.navigateTo({url:"/pages/upload-page/upload-page?token="+a.token+"&sku="+this.productno+"&minnum="+this.minnum+"&maxnum="+this.maxnum+"&gid="+localStorage.getItem(this.pageKey.goodsid)+"&pid="+localStorage.getItem(this.pageKey.productId)+"&id="+this.queryTempId+(null==n||void 0==n||""==n?"":"&p="+n)+(null==r||void 0==r||""==r?"":"&numIndex="+r)+(null==s||void 0==s||""==s?"":"&isEditCover="+s)+(null==this.isTeamBook||void 0==this.isTeamBook||""==this.isTeamBook?"":"&isTeamBook="+this.isTeamBook)+"&isContinueDesign=false&history=false&isPart=false&isfirst=true&hassort=0&orderNo="+l,success:function(e){this.isShowLoading=!1},fail:function(e){console.log("navigateTo调用失败"),this.isShowLoading=!0,this.wenanText="系统异常"}});d=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));var g=d.goodsname;-1!=g.indexOf("竹木纹")&&localStorage.setItem(this.pageKey.cal_size,"竹木纹"),this.diytype;a=this;if(!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook)this.is_weixn?this.gofxUpload(this.queryTempId,this.minnum,this.maxnum):this.goUpload(this.queryTempId,this.minnum,this.maxnum);else{var m={};m.tid=this.queryTempId,m.albumid=this.albumid,m.token=this.token,m.gid=localStorage.getItem(this.pageKey.goodsid),m.pid=localStorage.getItem(this.pageKey.productId),m.pnum=localStorage.getItem(this.pageKey.pnum),m.edittype=1,m.mid=localStorage.getItem(this.pageKey.motherid),m.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,m.pageKey=this.pageKey,m.isTeamBook=this.isTeamBook,m.isVideo=this.videoupload,m.price=this.price,!m.isTeamBook||1!=m.isTeamBook&&"true"!=m.isTeamBook||(m.avatarurl=this.avatarurl,m.nickname=this.nickname);a=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["J"])(m).then(function(t){var a=null;if(a="string"==typeof t.data?JSON.parse(t.data):t.data,1==t.result)localStorage.setItem(i.pageKey.uid,a.uid),i.uid=a.uid,a.hasCoverABack?(localStorage.setItem(i.pageKey.minnum,a.coverBackPhotoNum),localStorage.setItem(i.pageKey.maxnum,a.coverBackPhotoNum),i.is_weixn?i.gofxUpload(i.queryTempId,i.minnum,i.maxnum):i.goUpload(i.queryTempId,i.minnum,i.maxnum)):i.goLandingPage(a.uid);else if(null!=a)localStorage.setItem(i.pageKey.uid,a.uid),i.uid=a.uid,a.coverBackPhotoNum&&a.coverBackPhotoNum>0?(localStorage.setItem(i.pageKey.minnum,a.coverBackPhotoNum),localStorage.setItem(i.pageKey.maxnum,a.coverBackPhotoNum),i.is_weixn?i.gofxUpload(i.queryTempId,i.minnum,i.maxnum):i.goUpload(i.queryTempId,i.minnum,i.maxnum)):i.goLandingPage(a.uid);else{try{if(window._jylog){var o=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","相册错误！",JSON.parse(o).orderNo])}}catch(e){console.log(e)}layer.alert("相册错误！")}i.isShowLoading=!1,i.wenanText=""}).catch(function(t){try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","加载出现错误！",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("加载出现错误！"),a.isShowLoading=!1,a.wenanText=""})}},showPartner:function(){document.body.removeEventListener("touchmove",this.bodyScroll,!1);var e="previewModel?id="+this.queryTempId+"&sku="+this.productno,t=encodeURIComponent(this.previewImageUrlArr[0]);wx.miniProgram.navigateTo({url:"/pages/share/share?uid="+encodeURIComponent(e)+"&pages=pages/web/web&image="+t})},copyText:function(e,t){var i=this;this.$copyText(e).then(function(e){console.log(e),$.toast(t,"text")},function(e){i.$toast("复制失败","text")})},getApiSignPost:function(e){function t(t,i,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t,i,a){var o=this,s={};s.url=i,s.source=t,getApiSignPost(s).then(function(t){var i=t.userData;wx.config({debug:!1,appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonceStr,signature:i.signature,jsApiList:["onMenuShareAppMessage","updateAppMessageShareData"]}),wx.error(function(t){console.log(t);try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","获取签名失败",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("获取签名失败！")}),wx.ready(function(){wx.onMenuShareAppMessage({title:"分享模板",desc:"我们的梦想！在飞！在翱翔！",link:window.location.href.split("#")[0],imgUrl:"",success:function(){layer.alert("success!")},cancel:function(){layer.alert("cancel!")}})})}).catch(function(t){console.log("catch data::",t);try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","调用上传方法失败！"+t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert("调用上传方法失败！")})}),serachMeth:function(){try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","搜索",this.value,JSON.parse(t).orderNo])}}catch(e){console.log(e)}this.styleNum=1,this.templates=[],this.loadData(0,-1),$(".proTit").find("span").eq(0).html("查询"),$(".proTit").find("span").eq(0).addClass("on")},cancelData:function(){this.styleNum=1,this.templates=[],this.value="";try{if(window._jylog){var t=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","搜索",this.value,JSON.parse(t).orderNo])}}catch(e){console.log(e)}this.loadData(0,0),$(".proTit").find("span").eq(0).html("最新")},share:function(e){wx.onMenuShareAppMessage({title:"分享模板",desc:"我们的梦想！在飞！在翱翔！",link:e,imgUrl:"",success:function(){alert("success!")},cancel:function(){alert("cancel!")}})},getDiyDetailInfo:function(e,t,i,a,o){var s=this;getDiyDetail(e,t,i,a,o).then(function(t){console.log(t);var i=t,a=t.detail.pageList,o=a[0].diyDisplayWidth,n=a[0].diyDisplayHeight;o<n?localStorage.setItem(s.pageKey.calendar_hs,"s"):localStorage.setItem(s.pageKey.calendar_hs,"h");var r=t.detail.templateInfo.name,l=r.replace(/[^0-9]/gi,"");"0"==l.substring(l.length-1)?localStorage.setItem(s.pageKey.cal_size,l.substring(l.length-2)):"8"==l.substring(l.length-1)?localStorage.setItem(s.pageKey.cal_size,l.substring(l.length-1)):localStorage.setItem("cal_size",6),-1!=r.indexOf("卡片")?localStorage.setItem(s.pageKey.cal_size,"卡片"):-1!=r.indexOf("竹木纹")&&localStorage.setItem(s.pageKey.cal_size,"竹木纹");var d=t.detail.templateInfo.designModel;$(".mask").hide(),localStorage.setItem(s.pageKey.cal_pageList,JSON.stringify(a)),s.goUpload(e,s.minnum,s.maxnum),localStorage.setItem(s.pageKey.calendar_designModel,d),localStorage.setItem(s.pageKey.cal_detail,JSON.stringify(i.detail))})},confirmBtn:function(){var e=document.getElementById("changeDate").value;0==e&&localStorage.setItem(this.pageKey.numIndex,1),this.chooseDateNow=this.chooseDateMiddleNow,$(".mask").hide(),$(".selectDate").hide(),this.changeSelectDate=!0,this.changeDateShow=!0},cancelBtn:function(){$(".selectDate").hide(),$(".mask").hide(),this.changeSelectDate=!0,this.changeDateShow=!0},cancelTemple:function(){$(".showtemple").hide(),$(".mask").hide()},selectChange:function(t){var i="";t&&""!=t?(i=t,document.getElementById("changeDate")&&(document.getElementById("changeDate").value=t)):document.getElementById("changeDate")&&(i=document.getElementById("changeDate").value);var a=parseInt(i)+1;if(this.doubble?(a=2*parseInt(i)+1,localStorage.setItem(this.pageKey.numIndex,a)):localStorage.setItem(this.pageKey.numIndex,a),this.startDate=this.dataArr[i],""!=this.startDate){var o="",s="",n=this.startDate.substring(0,this.startDate.indexOf("年"))+"",r=this.startDate.substring(this.startDate.indexOf("年")+1,this.startDate.indexOf("月"));s=r<10?"0"+r:r,o=n+s,localStorage.setItem(this.pageKey.dateStr,o)}this.setEndDate(this.startDate),this.chooseDateMiddleNow=this.dataArr[i];try{window._jylog&&window._jylog.push(["按钮点击","模板页","台历选择日期","选择日期==>"+o+",起始页==>"+a,this.orderNo])}catch(e){console.log(e)}},goUpload:function(e,t){var i=this.oid;if(null!=i&&""!=i&&void 0!=i&&"undefined"!=i&&"null"!=i){var a=this.orderNo;"fxxt"==this.source&&(a=this.fxOrderNo),e==JSON.parse(i)&&a==this.orderInfos.orderNo&&this.productno==this.orderInfos.productNo||(localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson)),localStorage.removeItem(this.pageKey.id)}else localStorage.removeItem(this.pageKey.id),localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson);!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||localStorage.setItem(this.pageKey.uid,this.uid);var o=localStorage.getItem(this.pageKey.diytype);"gongge"!=o?1==this.iscaiyun?this.$router.push({name:"upphoto",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.is_alipay?this.$router.push({name:"alipayupload",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.$router.push({name:"upload",query:{id:e,p:t,isTeamBook:this.isTeamBook,isfirst:!0}}):this.$router.push({name:"gongge",query:{id:e,p:t,isfirst:!0}})},gofxUpload:function(e,t){var i=this.oid;localStorage.setItem(this.pageKey.flagURL,this.flagURL);var a=this.orderNo;if("fxxt"==this.source&&(a=this.fxOrderNo),null!=i&&""!=i&&void 0!=i&&"undefined"!=i&&"null"!=i){a=this.orderNo;"fxxt"==this.source&&(a=this.fxOrderNo),e==JSON.parse(i)&&a==this.orderInfos.orderNo&&this.productno==this.orderInfos.productNo||(localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson)),localStorage.removeItem(this.pageKey.id)}else localStorage.removeItem(this.pageKey.id),localStorage.removeItem(this.pageKey.autoSave),localStorage.removeItem(this.pageKey.uid),localStorage.removeItem(this.pageKey.detailJson);!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||localStorage.setItem(this.pageKey.uid,this.uid),location.href="fxUpload?id="+e+"&p="+t+"&isTeamBook="+this.isTeamBook+"&isfirst="+!0},goLandingPage:function(e){for(var t in this.pageKey)localStorage.removeItem(this.pageKey[t]);wx.miniProgram.reLaunch({url:"/pages/ground/ground?scene="+e})},showtemple:function(t,i,a,o,s,n,r,l){this.newtid=i,localStorage.setItem(this.pageKey.fold,n);var d=localStorage.getItem(this.pageKey.orderInfo);if(d&&"wechat"==this.source){var c=JSON.parse(d);c.returnURL=this.returnURL,localStorage.setItem(this.pageKey.orderInfo,JSON.stringify(c))}if("-1"==i){try{if(window._jylog){var h=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","空白模板",i,JSON.parse(h).orderNo])}}catch(e){console.log(e)}return this.queryTempId=i,void this.design()}try{if(window._jylog){h=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","点击预览",i,JSON.parse(h).orderNo])}}catch(e){console.log(e)}var g=this;document.body.addEventListener("touchmove",this.bodyScroll,{passive:!1}),"woodcut"==o?(localStorage.setItem(this.pageKey.motherid,a),localStorage.setItem(this.pageKey.goodsid,r),localStorage.setItem(this.pageKey.productId,l)):(localStorage.setItem(this.pageKey.motherid,this.motherid),localStorage.setItem(this.pageKey.goodsid,this.goodsid),localStorage.setItem(this.pageKey.productId,this.productId)),g.handleGoupload(i,t,n)},closeguid:function(){this.isShowguid=!1},handleChangeModel:function(){var t=this;if(this.changeModelAll)if(document.body.removeEventListener("touchmove",this.bodyScroll,{passive:!1}),this.templateid==t.newtid){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","提示","相同模板不能替换",JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.confirm("相同模板不能替换！",{btn:["确定"]},function(e){layer.close(e)})}else layer.confirm("替换模板将重新布局您的设计，是否确认替换？",{btn:["确定","取消"]},function(i){t.templateid==t.newtid||localStorage.removeItem(t.pageKey.detailJson);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","模板预览","模板更换,整套",t.templateid+"->"+t.newtid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}t.handleMoreMaxImage();var o=JSON.parse(localStorage.getItem(t.pageKey.pnum)),s=(navigator.userAgent.toLowerCase(),navigator.userAgent),n=!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);n?location.replace("design?id="+t.newtid+"&p="+o+"&changeModelAll="+t.changeModelAll+(null==t.history||void 0==t.history||""==t.history?"":"&history="+t.history)+(null==t.uid||void 0==t.uid||""==t.uid?"":"&uid="+t.uid)+"&hassort=0&fromAdmin="+t.$route.query.fromAdmin+"&fromAlipyShopCart="+t.$route.query.fromAlipyShopCart+"&photoBecomBook="+t.$route.query.photoBecomBook):t.$router.replace({name:"design",query:{id:t.newtid,p:o,changeModelAll:t.changeModelAll,history:t.history,uid:t.uid,hassort:"0",fromAdmin:t.$route.query.fromAdmin,fromAlipyShopCart:t.$route.query.fromAlipyShopCart,photoBecomBook:t.$route.query.photoBecomBook}}),layer.close(i)},function(){})},handleGoupload:function(e,t,i){var a=this,o=localStorage.getItem(this.pageKey.motherid),s={tid:e,sku:t,mid:o,pnum:this.tpnum};localStorage.setItem(this.pageKey.fold,i),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["F"])(s).then(function(t){for(var i in console.log(),t.data){console.log(t.data[i].previewimage);var o=new Image;o.src=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["d"])(t.data[i].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["h"])(t.data[i].previewimage,{},a.pageKey),a.previewImageUrlArr.push(o.src)}a.previewImageUrl=a.previewImageUrlArr[a.imageIndex],localStorage.setItem(a.pageKey.previewImage,t.data[a.imageIndex].previewimage),null!=t.data&&""!=t.data&&(1==t.data.length||(a.nextImage=!0)),$(".editImage").show(),$(".mask").show(),a.queryTempId=e})},handleMoreMaxImage:function(){var e=localStorage.getItem(this.pageKey.calenderTemp),t=localStorage.getItem(this.pageKey.maxnum);if(e){var i=JSON.parse(e);if(t&&i.length>t){for(var a=i.slice(0,t),o=i.slice(t),s=0;s<o.length;s++)o[s].title="",o[s].titleAll=0,o[s].isUse=!1;localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(a)),localStorage.setItem(this.pageKey.otherCalenderTemp,JSON.stringify(o))}}},hideImageEditPage:function(){$(".editImage").hide(),$(".mask").hide(),this.previewImageUrlArr=[],this.imageIndex=0,this.prevImage=!1,this.nextImage=!1,this.queryTempId="",document.body.removeEventListener("touchmove",this.bodyScroll,{passive:!1})},findImageByIndex:function(e){var t=this;this.checkReload=!1,t.imageIndex=t.imageIndex+e,0==t.imageIndex?(t.prevImage=!1,t.nextImage=!0):t.imageIndex==t.previewImageUrlArr.length-1?(t.nextImage=!1,t.prevImage=!0):(t.prevImage=!0,t.nextImage=!0),t.previewImageUrl=t.previewImageUrlArr[t.imageIndex]},isWxEnv:function(e){var t=this,i=this,a=layer.load(),o=navigator.userAgent.toLowerCase(),s=localStorage.getItem(this.normalKey.isMiniProgram);"micromessenger"==o.match(/MicroMessenger/i)?wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||s?layer.close(a):(!e&&!t.isTeamBook||t.isTS||layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)}),layer.close(a))}):(!e&&!this.isTeamBook||this.isTS||s&&!this.is_alipay||layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){i.is_alipay?my.navigateBack():window.history.go(-1)}),layer.close(a))},getTemplateList:function(){var t=this,i=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["Q"])(this.wsid,this.shopname).then(function(a){if(1==a.result||"true"==a.result){i.token=a.token;var o={goodsname:name,id:"",memberid:"",num:t.num,orderNo:"",productNo:i.productno,source:"wsid",url:window.location.href};t.$store.dispatch("updateOrderInfo",o),t.templateList(i.productno,i.token),localStorage.setItem(t.pageKey.token,i.token),localStorage.setItem(t.pageKey.source,"wsid"),localStorage.setItem(t.pageKey.wsid,t.wsid),localStorage.setItem(t.pageKey.orderInfo,JSON.stringify(o)),t.getTokenDetail(i.token),t.getCalenderTemp(i.token)}else{try{if(window._jylog){var s=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","模板预览","警告","获取token失败"+res,JSON.parse(s).orderNo])}}catch(e){console.log(e)}layer.alert("获取token失败！")}})},getTokenDetail:function(e){var t=this,i=localStorage.getItem(this.pageKey.tokenDate);i||localStorage.setItem(this.pageKey.tokenDate,Object(_utils_timeUtil__WEBPACK_IMPORTED_MODULE_18__["a"])("yyyy/MM/dd")),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["L"])(e).then(function(e){e.result&&localStorage.setItem(t.pageKey.tokenDetail,JSON.stringify(e.data))})},goPreviewModel:function(){this.$router.push({name:"previewModel",query:{id:this.queryTempId,sku:this.productno}})},checkUid:function(){var e=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["a"].uid);e&&Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["d"])({uid:e}).then(function(e){e.result&&!e.data||(localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["a"].uid),localStorage.removeItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["a"].autoSave))})},getDirection:function(e,t,i,a){var o=e-i,s=0;return o>0?s=3:o<0&&(s=4),s},handleScroll:function(e){var t=e.target.scrollHeight,i=e.target.clientHeight,a=e.target.scrollTop;a+i+100>=t&&(""!=this.mobilestyleid&&0!=this.mobilestyleid?this.styleNum>=this.totalStyleNum||(this.styleNum++,this.getMore(this.motherid,this.goodsid,this.tpnum,this.styleNum,this.mobilestyleid,this.sort)):""==this.mobilestyleid&&""!=this.value?(this.styleNum++,this.getMore(this.motherid,this.goodsid,this.tpnum,this.styleNum,this.mobilestyleid,this.sort)):this.decoratePageNum>=this.totalNumberOfPages||(this.decoratePageNum++,this.templateList(this.productno,this.token)))},querybyId:function(e,t){t+=2,this.styleNum=1,this.templates=[],this.loadData(e,t)},checkMobile:function(){var e=navigator.userAgent.toLowerCase(),t=(Object(_utils_testMobileAndBrowser__WEBPACK_IMPORTED_MODULE_17__["a"])(),navigator.userAgent,e.indexOf("android")>-1||e.indexOf("linux")>-1);null!=e.match(/tencenttraveler/)||e.match(/qqbrowser/),e.match(/wechat/i),e.match(/firefox/),e.match(/opera/);console.log("isAndroid:"+t),console.log("sUserAgent:"+e);localStorage.getItem(this.normalKey.isMiniProgram);if(localStorage.getItem(this.pageKey.thirdDatil)){var i=JSON.parse(localStorage.getItem(this.pageKey.thirdDatil));"2"==i.mshopSign&&!0}},getCalenderTemp:function(e){var t=[],i=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_21__["E"])(e).then(function(e){var a=null;if(a="string"==typeof e?JSON.parse(e):e,a.result){var o=null;if(o="string"==typeof a.data?JSON.parse(a.data):a.data,""!=o&&o.length>0)for(var s=0;s<o.length;s++){var n={isUse:!0};n.index=s,n.id=o[s].id,n.name=o[s].name,n.url=o[s].picname,n.src=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["d"])(o[s].picname)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_20__["e"])(o[s].picname,o[s].imageinfo,i.thumbnailToken);Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_0__["a"])(o[s].imageinfo);if(""!=o[s].imageinfo){var r=JSON.parse(o[s].imageinfo),l="";l=r.primaryImageInfo?r.primaryImageInfo:r,n.dateTime=r.dateTime,n.width=l.width,n.height=l.height,(l.width<requireWidth||l.height<requireHeight)&&(n.pixellow=1)}t.push(n)}t.length>0&&localStorage.setItem(i.pageKey.calenderTemp,JSON.stringify(t))}else localStorage.removeItem(i.pageKey.calenderTemp)})},toDrafts:function toDrafts(){var str=window.location.href.split("?");function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var retuenUrl=url,temp="/(&"+arg+"=)([^&]*)/gi";eval(temp).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temp),"&"+replaceText));var temps="/([?])("+arg+"=)([^&]*)/gi";return eval(temps).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temps),"?"+replaceText)),retuenUrl}return url.indexOf("?")>0?url+"&"+replaceText:url+"?"+replaceText}window.location.href=changeURLArg("drafts?"+str[1],"id",this.templateid)},handleImageLoaded:function(){this.isShowLoading=!1,""==this.previewImageUrl||(this.checkReload?(this.showNum=!0,this.showReload=!1):(this.showNum=!1,this.showReload=!0)),this.previewImageUrl="img/img.png"},reloadPic:function(){this.showNum=!0,this.showReload=!1,this.checkReload=!0,this.previewImageUrl=this.previewImageUrlArr[this.imageIndex]},reloadCom:function(){this.checkReload=!1},changeChoosDate:function(){$(".selectDate").show(),$(".mask").show()},closeDate:function(){this.changeDateShow=!1},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_22__["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){null==i&&(i=this.is_alipay?"支付宝":"网页"),-1==this.wsid?i+="-独立链接":this.source?"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录","模板预览",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}},goBack:function(){0==this.hasDraft||"false"==this.hasDraft?this.is_byte?(this.hasHistoryBack_tt=!0,history.go(-1)):"fxxt"==this.source||"wechat"==this.source||"thrid"==this.source?history.go(-1):history.go(-2):history.go(-1)}}}},b870:function(e,t,i){e.exports=i.p+"static/img/wenzi.c34c18e6.png"},b99b:function(e,t,i){},ba75:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAABuCAYAAADGWyb7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAC09JREFUeNrsXU1TG8kZbkkISSBAfHhZbFchknUqm1QFfMjZ4pCz4ZRjxC/A/AKWXxD8CxDHnJY957DinIOHQ8opX5Aru/Haa0AIfSAJQfoZevBYno+enhmphfqtmhIS+uxnnvd93rff7iFEmTJlypQpU6ZMIouoIfBm/9L+s0JvcvQo/nnl95oCbjAAy7K7mwy8JQpeSY2O3MAd0+PvXY+96H6sVxZVkHCzjVB2bXX9C2x70Y/vNDIkAw+3hsFfZrc4DuixwxOn8Bz6HusW/1IxLmSQ7KzM4lSZg3Gv6PHUDDR9PE9vtuljSwo47y4MxzMOkOxsnQ78AcdnfU9vMng++5wsY1yGvr6oXKU7SAaTcgG9teE23WyDAYeYts3i22q/UoKIpCBlGTBBg2RlyMdWVQIuBlK3y8v08CuU+8mcgQBOApAsbWZ6knQ61yQWi+3+dnFhi33XNbhDWQGNhAhSxuTmltltRsZBePxwnkykx+7uUxDLzVYrU69fkla7fQcoA/M5Pd7So9DPqkkkJJDM5SHp7cHsNJmbdT+n2u0rctlskSY94vGRnanJ9MHrN8dIE6AqNSTozKuU3VKMvgBnypWeDRpIVjY2liSLjxeEXw8wb25uSqlkYv/Dr6fLlWptjYJ8FztRGmOpgxYUoBEPIPEktANr3/4u+By60+lo1M1qH0/K+VqjQTpX18U//eE3qyxxx3geIRURATNiIyC27zNIVra0+IgkE6M9+SwaN0uNRjN72WxSlxvfmslMFpjLRczcp0AWPAHHYtWxrCIiTHv49QNCY1bfPr9zfa3HTupiS/R77FAg9aKAHRu7ZwfywwjabZxq9vXzY9EoGUslcfLA4+09WvgKBLKdMuoGbihBMwSGTDY5MZ6hrjvPC5w2rMAhZ5PNojH76VIFnMSsoyfTNBdwrBJQHlbgmhIBh+qNU+iy4qI2vIxrynMStVoZJha5gTscmIpHKkFmpyf0Iz2eJNFoxCdw8jCOxVxbEo0MIuMA0NzMJImPfPr6SJ7TYylyUr7Qa4r3QKAUnLAYSFfZDdpdLkRV2Gxmwhfz6g05wJubzbx0mn34Ajj25JKsoCWTo5agmcHzU7q6vJTDXb5+c/w3R69j87i0rBsdcW+TSYzGB1qgsFibFQHuaJDV4fXNzUCnBCxGH4kAV5QVlAbHwDZb7YFWlhPpMTTqfnevXCXOxnqj6Qia3zglKFBwsi+lxxJQRqt+dMJ5pequrK0eZFMJ0gqUs/MqqVpId4B2StMB3zHGO/AYq3UKmj5m9BYgrot+/unZ+bbbc5wivUYkbkk4r9RItdYgKaoyo5Go7kJF87cABMo+BeuzUiG9r1XrTQCYE3DXRSHGDYpAQUtdtXZJKtV6YKAJCpQpm8czAr8JrN33A1yRDKkJCJQ8Zddn3oneRyuf59YPmocWeVoXoi6ucmjNo0ABs15RsABgjh5QhN8LxbdyJWesx3Myx9oQVmGSAW+9E7X5B7N6h3Ov7e1P71AzdV2i7LYidXhnxBuNvqU7PB3SbsCFNsWDmuLU5LheMJ5Mj+n3BzzOBWIrf/yGq0LeF8ZhHu3rB9NUMif1uuJEOqXfnzT178uQ6KNlrrcquaOxvlZ/wIWx0hLV/ekp6/5FAAgWymK9rlvSvBSiZC0IxgXKOsyT2YH2KXFN6uBKEed6PLHKclFNOuDgIqMRdxeemRj33YbQpwqKP+Curgq8482zBvwoSOB4hQvaEFARGSaBsjA/t/Nk6VFZKsaBQfER/r0CxseT3EoTJ8TC/Ix+8J4csgkUfM7rN8eb3OPp9oSgBIrXdgK4VB6VCXARN/F8HPjbLY7KKFC8fg5v8uSbdSLtBGCPG+vS4ynL1wWVWvRKoLCppLf3AjiYG3tSNkxGahGE23QQKFgGtcQO3+MzMz25Rb3bLu/zeYOOL4EC1ohWRgA40gOryc14fMTxfQ3QnWbMBRlXSI8lNu7yr3oTM96+1hWeliuhuEpfcS7lMy8DAFYAIefjea0f5kE0dM31aWbQbr+HPon60s9v/Hhythk4cH73+vDTLmcIFbSZg2HmOMYLCMDz17LXMocMu12ICn5ODjaBGjjjfLFu1CdwulukqcRXs1N6URp1Ta/KcaYLeC9Wuajit2PjmtXuFgUT60qEb0+wL4HrdPDanbCAE2IdBounWuKFvSLxEt9Bb10XAK9yUQMwu3agmWxf6MSOxw+8pl1eRkBIoKQSctQdfYLH1YJAgQXjSl7f/N37j3meWe+eMm50VK6dFQXBy/BOt4iwrtVuZ7zqCG7gRAVKIoD4Jgl4vIzwLFJoyuF5bL0Gi+Kgg2YGb3rK0ywEr7sseQQPO/Q9DRs4T2eGLPNqTkrVQ473zMNbc7tL7M7nwQ0LA3fkjXFy7xyMlnUPVRVu8cBa0LlO8kqlliUC/ZehMc7rNE4vDJ3PSKbPqbz/cHJOPp5WyPU195KsjEdmvORlnIgS9QScF4Ey2uf4hjVyYNRFtaED9O7DKfnl1zNycnaht60LtqznPDwXqYHrpGgkEimICD8RShR5fkCvhQnYBKDaV1f09irQtQQmW/bgLsvVehPg5Z2e92Tp0YaQuBJ4DVevZdiJN4BCfMKSKzAJh778SpxNrhaLxdBe7mUGwFGk4HtS97sn8l1EGKe5/8Bo4A2uBqOMA/d7HyM7EBFnFDzD85SZYMOYlLC0qjsuOr0fK16/lQa4INykDEDZDTZrwzDCxV0fJANUM8U2x5DSarXLRLAiJbon85nT2SQyBwYx0boDKrQY5dsC3pB0ndU37cY5w7vRaCCs4028ISTuVN/7U7+Kr0eMC67X8ud3H9yS+r0gXaUhUHJO5SQn94dlv2CXhxxKIuCC6/qqXNRyDmzLEod29FAYZ96uAn8bCa+h/NA/MoigwYLq+mIngNM4Io1Yt0v6R8IADq4PlXeZXV5AAkXY4iOxol11hYG1SG7ro0gpCoEwjmdD0vsKmu5FAnCXNCc8tKqYMNB+JLetEkjOs0G6Sq604L5are5/tepP/3u/zS4XYAYtz7TDBlOTZbtqjR/gDocVuCAYx5YMlxlga6YrQpaN/hP2/x2kX90g+wGuOKzABaEs6XsUurwXKjCl7nFl7hRuM28GT7lKUXXpb0NS7GWyYdYMbNM149I43TEPzHtu/p9lwvWPg39mWVAs/XXtLyWHXENtpyFg1Vqj9N+ff9mwasljLhPrCEoMtE0G7pajq6SgAfljhv4xvZ9XrAu2gnJ52XQ62c1dBlCXRxYXjv8cOArSCkP4KWUaWq3RxLLHGOj2IUqg8KrS2z1USg5k2KRsA4HW7baHsrq2jkZB05nEbosO7lAJFAGLRiJbDpvQGEJl2SlX7gYOT1yhDMuYGJhzOTuUebRvnyzuuhQ3cBWrHe5d0BnDDlhs+5H52F07gSL7hqRhmqgwgRplibaTHbj1oXwhTihIkKmIb1g9skrvb6m04JPhOm8AbW52WjjxJi4z4+ZUwc4si8xGjOM0+OO1e4qTMUOtl58W5ufQlZXXV8JGxVJgpkZ9a4MgGh+LLHW4D4bfckg+XUG4ZJFnoVqfhdr795vSdxTA7WQigQv1aawlccWZsbHVIC4K73vhGivDnA0oSIaC00QGkyXIxkWACyxpvsGUD1j5+OH8TqvVfn5122SE3c0Lou14gQPHfsArIvcVjH2D5HE8dDDBSgbuHnO3uOLwgUzA4YvlJQFJM4FUDBukfllQzf1HEoCkhbFN430HrhdndYl9zuGwgRSaq2Tu8iYEkI6M+GTXXzisFuQ6KE1QoCiQ+gzcDxzAlc3uzi5XUtZDV8ncJYqjLxRIypQpU6ZMmTJlypQpU6ZMmTJlypQpUzYc9n8BBgCH5Bk9erBZygAAAABJRU5ErkJggg=="},bb49:function(e,t,i){e.exports=i.p+"static/img/10.296ed721.png"},bd61:function(e,t,i){"use strict";var a=i("5bac"),o=i.n(a);o.a},bd81:function(e,t,i){e.exports=i.p+"static/img/15.e474ab32.png"},bff0:function(e,t,i){},c192:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page",attrs:{id:"calendar-page"}},[i("div",{staticClass:"calWrapper rel mA",class:{bookWrapper:e.isBook},style:e.calWrapperCss},[i("div",{staticClass:"calPages",style:e.calPagesCss,attrs:{id:"drawing"}},e._l(e.pageLists,function(e,t){return i("div",{key:e.index,staticClass:"calPage",class:e.class,style:e.css,attrs:{id:"pg_"+t,sn:t}})}),0)]),e.isShow?i("div",{staticClass:"calTools"},[i("p",{staticClass:"pageNum"},[i("span",{attrs:{id:"currentPage"}},[e._v(e._s(e.currentPage))])])]):e._e()])},o=[],s=(i("7f7f"),i("f559"),i("57b3")),n=(i("5841"),i("103a")),r={data:function(){return{baseUrl:"",calWrapperCss:{},calPagesCss:{},nextAble:!0,prevAble:!0,currentPage:"",viewb:[],prevCss:{},nextCss:{},pageNum:0,diytype:"",n:0,pages:null,isBook:!1,isShow:!0}},props:["detail","pageLists","time","isSubmit","pageKey","vm","isNamePaste"],mounted:function(){this.initCalendar()},destroyed:function(){this.vm.showWaterfall&&this.vm.showWaterfall()},methods:{eltouchmove:function(e){e.preventDefault()},calendartouchtouchstart:function(e){this.startx=e.touches[0].pageX,this.starty=e.touches[0].pageY},calendartouchmove:function(e){e.changedTouches[0].pageX,e.changedTouches[0].pageY},calendartouchend:function(e){var t,i,a=this,o=document.getElementById("calendar-page");o.scrollTop,t=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY;var s=a.getDirection(this.startx,this.starty,t,i);console.log(s),0==a.time?(3==s&&a.onNext(),4==s&&a.onPre()):(1==s&&a.onNext(),2==s&&a.onPre())},initCalendar:function(){var e=this;this.diytype=this.detail.diyType,$("#calendar-page").each(function(t,i){i.addEventListener("touchmove",e.eltouchmove,!1)});var t=document.getElementById("calendar-page");t.removeEventListener("touchstart",this.calendartouchtouchstart),t.removeEventListener("touchmove",this.calendartouchmove),t.removeEventListener("touchend",this.calendartouchend),t.addEventListener("touchstart",this.calendartouchtouchstart,!1),t.addEventListener("touchmove",this.calendartouchmove,!1),t.addEventListener("touchend",this.calendartouchend,!1);var i=0;0==this.time&&1!=this.detail.templateInfo.coverper&&1!=this.detail.pageList.length&&(i=1);for(var a=0;a<this.detail.pageList[i].content.itemList.length;a++)if(this.detail.pageList[i].content.itemList[a].isDisplay&&(this.detail.pageList[i].content.itemList[a].media.imgPath.startsWith("http")?this.baseUrl=this.detail.pageList[i].content.itemList[a].media.imgPath:this.baseUrl=Object(n["d"])(this.detail.pageList[i].content.itemList[a].media.imgPath,this.detail.pageList[i].content.itemList[a])+this.detail.pageList[i].content.itemList[a].media.imgPath),"image"==this.detail.pageList[i].content.itemList[a].media.mediaType&&this.detail.pageList[i].content.itemList[a].media.isBG){var o=this.detail.pageList[i].content.itemList[a].printLocation.x,r=this.detail.pageList[i].content.itemList[a].printLocation.y,l=this.detail.pageList[i].content.itemList[a].printLocation.width,d=this.detail.pageList[i].content.itemList[a].printLocation.height;this.viewb=[o,r,l,d]}this.detail.pageList[i].diyDisplayWidth,this.detail.pageList[i].diyDisplayHeight;this.currentPage=this.detail.pageList[0].title,this.setSize(this.viewb[0],this.viewb[1],this.viewb[2],this.viewb[3],this.detail.pageList[i].diyDisplayWidth),this.pageNum=this.pageLists.length,this.prevCss.disabled=!0,this.pageLists[0].css.zIndex=3,this.pageLists[0].css.display="block",this.pageLists.length>1?(this.pageLists[1].css.zIndex=2,"wall_calendar"==this.diytype&&(this.calPagesCss.zIndex=-1),this.pageLists[1].css.display="block"):this.isShow=!1;for(a=0;a<this.pageLists.length;a++)$("#pg_"+a).empty(),console.log(this.vm),Object(s["b"])("#pg_"+a,this.detail,a,null,this.vm?this.vm:this,!0,!1,!this.isSubmit);if(0==this.time?this.$set(this.calWrapperCss,"backgroundImage","url()"):this.$set(this.calWrapperCss,"backgroundImage","url("+this.baseUrl+")"),0==this.time)for(a=0;a<this.pageLists.length;a++)a!=this.n&&this.$set(this.pageLists[a].css,"display","none"),this.$set(this.pageLists[a].css,"background","transparent"),this.$set(this.pageLists[a].css,"background","transparent"),this.$set(this.pageLists[a].css,"box-shadow","0 0px rgba(0,0,0,.3)"),this.$set(this.pageLists[a].css,"-webkit-box-shadow","0 0px rgba(0,0,0,.3)");this.toFirst()},onNext:function(){var e=this;if(this.nextAble){this.prevCss.disabled=!1,this.nextAble=!1,this.n<this.pageNum-1&&(this.n==this.pageNum-2&&(this.nextCss.disabled=!0),this.n=this.n+1,this.n>1&&(this.pageLists[this.n-2].css.display="none"),this.$set(this.pageLists[this.n-1].css,"display","block"),0!=this.time&&this.$set(this.pageLists[this.n-1].class,"pageUp",!0));setTimeout(function(){e.$set(e.pageLists[e.n-1].class,"pageUp",!1),e.nextAble=!0},this.time),setTimeout(function(){e.$set(e.pageLists[e.n].css,"zIndex",3),e.$set(e.pageLists[e.n].css,"display","block");for(var t=0;t<e.pageLists.length;t++)t!=e.n&&e.$set(e.pageLists[t].css,"zIndex",1);if(e.n!=e.pageLists.length-1&&(e.$set(e.pageLists[e.n+1].css,"zIndex",2),e.$set(e.pageLists[e.n+1].css,"display","block")),0==e.time&&0==e.time)for(t=0;t<e.pageLists.length;t++)t!=e.n&&e.$set(e.pageLists[t].css,"display","none")},this.time/2),this.currentPage=this.detail.pageList[this.n].title}},onPre:function(){var e=this;if(this.prevAble&&(this.nextCss.disabled=!1,this.prevAble=!1,this.n>0&&(1==this.n&&(this.prevCss.disabled=!0),this.n=this.n-1,0!=this.n&&(this.pageLists[this.n-1].css.display="block"),this.pageLists[this.n].css.zIndex=3,0!=this.time&&(this.pageLists[this.n].class.pageDown=!0)),0!=this.time?setTimeout(function(){e.$set(e.pageLists[e.n].class,"pageDown",!1),e.prevAble=!0},this.time):(this.$set(this.pageLists[this.n].class,"pageDown",!1),this.prevAble=!0),this.pageLists[this.n+1].css.zIndex=2,this.pageLists[this.n+1].css.display="block",this.n<this.pageLists.length-2&&(this.pageLists[this.n+2].css.zIndex=1,this.pageLists[this.n+2].css.display="none"),this.currentPage=this.detail.pageList[this.n].title,0==this.time))for(var t=0;t<this.pageLists.length;t++)t!=this.n?this.$set(this.pageLists[t].css,"display","none"):this.$set(this.pageLists[t].css,"display","block")},toFirst:function(){var e=this;if(this.prevAble&&(this.nextCss.disabled=!1,this.prevAble=!1,this.n>0&&(this.prevCss.disabled=!0,this.n=0,0!=this.n&&(this.pageLists[this.n-1].css.display="block"),this.pageLists[this.n].css.zIndex=3,0!=this.time&&(this.pageLists[this.n].class.pageDown=!0)),0!=this.time?setTimeout(function(){e.$set(e.pageLists[e.n].class,"pageDown",!1),e.prevAble=!0},this.time):(this.$set(this.pageLists[this.n].class,"pageDown",!1),this.prevAble=!0),this.pageLists[this.n+1]&&(this.pageLists[this.n+1].css.zIndex=2,this.pageLists[this.n+1].css.display="block"),this.n<this.pageLists.length-2&&(this.pageLists[this.n+2].css.zIndex=1,this.pageLists[this.n+2].css.display="none"),this.currentPage=this.detail.pageList[this.n].title,0==this.time))for(var t=0;t<this.pageLists.length;t++)t!=this.n?this.$set(this.pageLists[t].css,"display","none"):this.$set(this.pageLists[t].css,"display","block")},getDirection:function(e,t,i,a){var o=t-a,s=e-i,n=0;return 0!=this.time?o>50?n=1:o<-50&&(n=2):s>50?n=3:s<-50&&(n=4),n},bodyScroll:function(e){e.preventDefault()},setSize:function(e,t,i,a,o){if(0==this.time){this.isBook=!0;for(var s=0,n=0,r=0;r<this.pageLists.length;r++){for(var l=this.pageLists[r],d=this.detail.pageList[r],c=0;c<d.content.itemList.length;c++)d.content.itemList[c].isDesignShape&&(s=d.content.itemList[c].printLocation.width,n=d.content.itemList[c].printLocation.height);s>=n?(l.css.width="6rem",l.css.left="50%",l.css.transform="translate3d(-50% ,0 ,0)"):(l.css.width=s/n*6+"rem",l.css.left="50%",l.css.transform="translate3d(-50% ,0 ,0)"),this.isNamePaste&&(l.css.width="4rem")}this.calWrapperCss.width="6rem",this.calPagesCss.width="6rem",this.calPagesCss.height="6.5rem",this.calPagesCss.left="0rem",this.calPagesCss.top="0rem"}else{this.isBook=!1,this.calWrapperCss.width="7.5rem",this.calWrapperCss.height="5.6rem";var h=750/o,g=(e=parseInt(e*h),t=parseInt(t*h),"h"),m=this.detail.pageList[0].diyDisplayWidth,p=this.detail.pageList[0].diyDisplayHeight,u=this.detail.pageList[0].workAreaWidth,f=this.detail.pageList[0].workAreaHeight;g=m<p?"s":"h";var y=6,_=this.detail.templateInfo.name;if(155==u&&206==f?(g="s",y=8):203==u&&152==f?(g="h",y=8):203==u&&254==f?(g="s",y=10):254==u&&203==f||u>=240&&u<249&&f>=190&&f<199?(g="h",y=10):104==u&&154==f&&(g="s",y=6),-1!=_.indexOf("卡片")?y="卡片":-1!=_.indexOf("竹木纹")&&(y="竹木纹"),"10"==y&&"s"==g)i=parseInt(i*h)-240,this.calPagesCss.height=0,e=180;else if("10"==y&&"h"==g){var v=i/a;i=parseInt(i*h)-5,this.calPagesCss.height=0,t=18}else"6"==y&&"s"==g?(i=parseInt(i*h)-250,a=parseInt(a*h)-400,this.calWrapperCss.height="6rem",this.calWrapperCss.width="4.52rem",this.prevCss.left="0rem",this.nextCss.right="0rem"):"8"==y&&"s"==g?(i=parseInt(i*h)-142,this.calWrapperCss.width="6.39rem",this.calWrapperCss.height="7.2rem",e=72,t=-10):"竹木纹"==y&&"s"==g?(i=parseInt(i*h)-172,this.calWrapperCss.width="6.39rem",this.calWrapperCss.height="7.2rem",e=95):(i=parseInt(i*h),a=parseInt(a*h));if(this.calPagesCss.width=i/100+"rem",this.calPagesCss.height="initial",this.calPagesCss.left=e/100+"rem",154==u&&204==f&&(this.calPagesCss.left="0.32rem"),this.calPagesCss.top=t/100+"rem","10"==y&&"h"==g){var w=7.5/v+"rem";this.calWrapperCss.width="7.5rem",this.calWrapperCss.height=w,this.$set(this.calWrapperCss,"backgroundSize","7.5rem "+w)}}}}},l=r,d=(i("288a"),i("cd2e"),i("2877")),c=Object(d["a"])(l,a,o,!1,null,"78717008",null);t["a"]=c.exports},c2de:function(e,t,i){"use strict";var a=i("fdc3"),o=i.n(a);o.a},c30c:function(e,t,i){"use strict";var a=i("eec9"),o=i.n(a);o.a},c52e:function(e,t,i){},c5fa:function(e,t,i){"use strict";var a=i("f7b6"),o=i.n(a);o.a},c686:function(e,t,i){},c791:function(e,t,i){"use strict";var a=i("39b5"),o=i.n(a);o.a},c884:function(e,t,i){},c949:function(e,t,i){e.exports=i.p+"static/img/genghuan.648edee6.png"},c97a:function(e,t,i){e.exports=i.p+"static/img/Ays4.db37b5da.jpg"},cabc:function(e,t,i){"use strict";i.d(t,"a",function(){return s});i("a481");var a=i("103a"),o=i("5841");function s(e){var t=o["a"].baseUrl2;if("text"==e.media.mediaType&&""!=e.media.text&&""!=e.media.font.textPath?"yes"==e.moveable&&(e.moveable="yes"):"image"==e.media.mediaType&&0==e.media.isBG&&0==e.isDisplay||"yes"!=e.moveable&&delete e.moveable,"advancedImageMask"==e.media.mediaType){if(-1!=e.media.maskSource.indexOf("img/nophoto.jpg"))return void this.alertMessage("您有照片未填充");e.media.defaultState=!1,-1!=e.media.maskSource.indexOf(Object(a["d"])(e.media.maskSource))&&(e.media.maskSource=Object(a["f"])(e.media.maskSource,e).replace(Object(a["d"])(e.media.maskSource),"")),-1!=e.media.factMaskSource.indexOf(Object(a["d"])(e.media.factMaskSource))&&(e.media.factMaskSource=Object(a["f"])(e.media.factMaskSource,e).replace(Object(a["d"])(e.media.factMaskSource),"")),-1!=e.media.bgSource.indexOf(Object(a["d"])(e.media.bgSource))&&(e.media.bgSource=Object(a["f"])(e.media.bgSource,e).replace(Object(a["d"])(e.media.bgSource),""))}else"image"==e.media.mediaType?(-1!=e.media.imgPath.indexOf(Object(a["d"])(e.media.imgPath))&&(e.media.imgPath=Object(a["f"])(e.media.imgPath,e).replace(Object(a["d"])(e.media.imgPath),"")),-1!=e.media.imgPath.indexOf(t)&&(e.media.imgPath=e.media.imgPath.replace(t,""))):"text"==e.media.mediaType?(console.log(e),null!=e.media.imgPath&&void 0!=e.media.imgPath&&-1!=e.media.imgPath.indexOf(t)&&(e.media.font.textPath=e.media.font.textPath.replace(t,"")),e.media.isImage&&-1!=e.media.font.textPath.indexOf(t)&&(e.media.font.textPath=e.media.font.textPath.replace(t,""))):e.media.mediaType.indexOf("svg")>-1&&-1!=e.media.imgPath.indexOf(Object(a["d"])(e.media.imgPath))&&(e.media.imgPath=Object(a["f"])(e.media.imgPath,e).replace(Object(a["d"])(e.media.imgPath),""))}},cb95:function(e,t,i){},cba4:function(e,t,i){"use strict";i.d(t,"a",function(){return a});i("4917");function a(e,t,i){var a={},n=!1,r=[];return e.addEventListener("touchstart",function(t){t.touches.length>=2&&(n=!0,r=t.touches,a.gesturestart&&a.gesturestart.call(e))},!1),t.addEventListener("touchmove",function(t){if(i||t.preventDefault(),t.touches.length>=2&&n){var l=t.touches,d=o(l[0],l[1])/o(r[0],r[1]),c=(s(l[0],l[1]),s(r[0],r[1]),navigator.userAgent),h=(navigator.appVersion,c.indexOf("Android")>-1||c.indexOf("Linux")>-1),g=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);h&&(console.log("安卓系统"),t.scale=d.toFixed(2)),g&&console.log("IOS系统"),a.gesturemove&&a.gesturemove.call(e,t)}},!1),t.addEventListener("touchend",function(t){n&&(n=!1,a.gestureend&&a.gestureend.call(e))},!1),a}function o(e,t){var i=t.pageX-e.pageX,a=t.pageY-e.pageY;return Math.sqrt(i*i+a*a)}function s(e,t){var i=e.pageX-t.pageX,a=e.pageY-t.pageY;return 180*Math.atan2(a,i)/Math.PI}},cc09:function(e,t,i){e.exports=i.p+"static/img/nogoods.42467bf5.png"},cd2e:function(e,t,i){"use strict";var a=i("2916"),o=i.n(a);o.a},cf12:function(e,t,i){},cff1:function(e,t,i){e.exports=i.p+"static/img/share.5ee7e773.png"},d0ab:function(e,t,i){"use strict";var a=i("cb95"),o=i.n(a);o.a},d1ae:function(e,t,i){e.exports=i.p+"static/img/success.dd2a3ae5.svg"},d284:function(e,t,i){e.exports=i.p+"static/img/success.bb69de5c.png"},d2f0:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("8e6e"),core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("456d"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("c5f6"),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("3b2b"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_7__),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_8__),D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("3b8d"),D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("bd86"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_11__),_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("1180"),_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_assets_css_restructure_css__WEBPACK_IMPORTED_MODULE_12__),mobileResponsive750__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("5031"),nativeshare__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("b354"),nativeshare__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(nativeshare__WEBPACK_IMPORTED_MODULE_14__),vuex__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("2f62"),_api_getJson__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("4cbb"),_js_common_initPages_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("57b3"),_views_js_common_updatePage_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("08b0"),_components_Calendar_vue__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("c192"),_components_AddressForm_vue__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("86cb"),_baseUrl__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("5841"),_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("103a"),_storagekey__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("b60d"),_utils_checkJsonFont_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("a56f"),_components_editImage_vue__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("b1eb"),_utils_domHitest_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("9621"),_utils_SvgUtil__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("d5e8"),_utils_handleImageResult__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("704d"),_canvas_H5Canvas_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("ec06"),_Event_GlobalEvent_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("6614");function ownKeys(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(i,!0).forEach(function(t){Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_10__["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}__webpack_exports__["a"]={name:"preview",components:{editImage:_components_editImage_vue__WEBPACK_IMPORTED_MODULE_25__["a"],Calendar:_components_Calendar_vue__WEBPACK_IMPORTED_MODULE_19__["a"],AddressForm:_components_AddressForm_vue__WEBPACK_IMPORTED_MODULE_20__["a"]},data:function(){return{isJijian:!0,hassort:"",name:"",flag:"",uid:null,isSubmit:!0,items:[],bookWidth:300,bookHeight:380,ss:"",p:null,orderNo:"",memberid:"",editType:1,pageKey:"",time:500,isBook:!1,isCalendar:!0,isSaving:!1,isTeamBook:!1,photoSize:"",isMiniProgram:!1,tbPass:"",vm:this,normalKey:null,showSubmit:!0,fromDesign:null,mshopSign:"",reqData:"",wsid:"",showHelp:!0,iswsid:!1,nativeShare:new nativeshare__WEBPACK_IMPORTED_MODULE_14___default.a,addinfo:{},isOverdueTip:"",isInit:!1,coverPreviewImage:"",decoratePageNum:1,totalStyleNum:0,canGoEdit:!0,decorateList:[{url:"http://10.168.20.51/image/mong/1/MXYZ-9F65C9A5C76545B8B38C2AA2393821AB.png",width:1274,height:1367}],itemsList:[{tagname:"ceshi",id:1},{tagname:"ceshi2",id:2}],mobilestyleid:"",itemIndex:0,decorateIndex:null,isShowPop:!0,jsonFontsArr:[],isShowLoading:!1,wenanText:"",pageAndIndex:null,isShow:!1,hidewarn:!0,history:null,fromOrder:null,savePgaePreive:!1,isSimpleDesign:!0,is_byte:!1,renderPageIndex:0,renderCount:4,everyTimeImgJson:{loadComplete:!1,imgArr:[]}}},created:function(){var e=this,t=navigator.userAgent.toLowerCase();"toutiaomicroapp"==t.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0),closeTuxiaocao();var i=this;this.showLoading("正在生成设计"),this.logFrom("极简设计");this.$route.path;this.$store.dispatch("getFontCss");var a=this.$route.query.editType;this.editType=null!=a&&void 0!=a?a:1,this.hassort=this.$route.query.hassort,this.isSubmit=void 0!=this.$route.query.submit&&this.$route.query.submit,this.id=this.$route.query.id,this.p=this.$route.query.p,this.uid=this.$route.query.uid,this.fromDesign=this.$route.query.fromDesign,this.isTeamBook=this.$route.query.isTeamBook,this.fromOrder=this.$route.query.fromOrder,"true"==this.isTeamBook&&(this.isTeamBook=!0),this.$route.query.coverPreviewImage&&(this.coverPreviewImage=this.$route.query.coverPreviewImage),this.uid?this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_23__["c"]:this.pageKey=_storagekey__WEBPACK_IMPORTED_MODULE_23__["a"],this.normalKey=_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"];var o=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"].isMiniProgram);o&&(i.isMiniProgram=!0);t=navigator.userAgent.toLowerCase();"micromessenger"==t.match(/MicroMessenger/i)&&wx.miniProgram.getEnv(function(e){(e.miniprogram||o)&&(i.isMiniProgram=!0)});var s=localStorage.getItem("isAlipay");("alipayclient"==t.match(/AlipayClient/i)||s)&&loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}}),this.isSubmit||(setTimeout(function(){window._czc&&window._czc.push(["_trackEvent","剪影","极简设计页面","分享打开"])},3e3),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["ab"])({id:this.uid}).then(function(t){e.tbPass=t.data,null==e.tbPass&&(e.showSubmit=!1)}));var n=this.$route.query.history;this.history=n;var r=localStorage.getItem(this.pageKey.uid),l=localStorage.getItem(this.pageKey.olduid);if(null!=this.uid&&void 0!=this.uid&&(n?this.uid!=r:this.uid!=l))for(var d in this.pageKey)localStorage.removeItem(this.pageKey[d]);if(null!=this.uid&&void 0!=this.uid&&(n?this.uid!=r:this.uid!=l))this.editType=2,this.getDesign(this.history);else{if(null==this.uid||void 0==this.uid){var c=c||[];c.push(["_setAccount","1253519982"]),c.push(["_trackEvent","剪影","极简设计","进入极简设计"]),this.id=this.$route.query.id,this.p=this.$route.query.p}else{var h=JSON.parse(localStorage.getItem(this.pageKey.detailJson));this.id=h.templateInfo.id,this.p=h.p,this.editType=1}this.uid=r,this.designCreate()}$(".zzz").click(function(){hideModal()})},mounted:function(){document.getElementById("materialWrap").addEventListener("scroll",this.handleScroll),_Event_GlobalEvent_js__WEBPACK_IMPORTED_MODULE_30__["a"].create("screenShot").listen("toDataURLComplete",this.screenCut),this.screenShotCanvas=new fabric.StaticCanvas("screenShot")},computed:_objectSpread({},Object(vuex__WEBPACK_IMPORTED_MODULE_15__["b"])(["detailJson"])),watch:{detailJson:function(){var e=this;this.isInit||(this.isInit=!0,this.$store.dispatch("getAllFontInfo").then(function(t){e.initPreview(),e.isTeamBook&&localStorage.setItem(e.pageKey.token,localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"].userToken))}))}},deactivated:function(){this.$destroy()},beforeRouteLeave:function(e,t,i){this.$layer.closeAll(),layer.closeAll(),i()},methods:{everyTimeRender:function(){JSON.parse(localStorage.getItem(this.pageKey.detailJson));Object(_js_common_initPages_js__WEBPACK_IMPORTED_MODULE_17__["a"])("#drawing-waterfall",this.detailJson,this,null),$(".page-order span").css("color","#aab2bd")},screenCut:function(e,t,i){this.saveCurrentPagePreview(e,t,i)},saveCurrentPagePreview:function(){var e=Object(D_jianying_node_modules_babel_runtime_corejs2_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__["a"])(regeneratorRuntime.mark(function e(t,i,a){var o,s,n,r,l,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=this,s=this.detailJson.pageList[i].previewImagePath,n={picpath:[[i,"","",!1,t,s]],userFlag:2},e.prev=3,e.next=6,Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["r"])(n);case 6:r=e.sent,l=JSON.parse(localStorage.getItem(o.pageKey.detailJson)),l.pageList[i].productImagePath=r.pics[0].productpics,d=JSON.stringify(l),localStorage.setItem(o.pageKey.detailJson,d),o.savePgaePreive=!0,e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](3),console.log("base64图片转换失败"),console.log(e.t0),o.savePgaePreive=null;case 19:case"end":return e.stop()}},e,this,[[3,14]])}));function t(t,i,a){return e.apply(this,arguments)}return t}(),designCreate:function(t){var i=this,a=this,o=localStorage.getItem(this.pageKey.token),s=this.$route.query.uuid,n={};n.token=o,n.uuid=s,s&&$.ajax({url:_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].basicUrl+"/list/getPicListMobile",type:"POST",async:!1,data:n,cache:!1,dataType:"json",success:function(e){console.log("上传图片数量========",e.data.length),e.result&&(console.log("进入图片处理"),Object(_utils_handleImageResult__WEBPACK_IMPORTED_MODULE_28__["a"])(e.data,a.pageKey.calenderTemp,a.pageKey.uploadCalenderTemp,a.pageKey))},error:function(e){layer.alert("上传失败")}}),this.isTeamBook&&(this.editType=2),this.diytype=localStorage.getItem(this.pageKey.diytype),this.imgs=localStorage.getItem(this.pageKey.calenderTemp),this.token=localStorage.getItem(this.pageKey.token),this.mid=localStorage.getItem(this.pageKey.motherid);var r=localStorage.getItem(this.pageKey.detailJson);if(s||this.templateList(),this.isTeamBook&&this.isPart&&querytoken({uid:this.uid,token:localStorage.getItem(this.pageKey.token)}).then(function(e){console.log(e),i.openid=e.data.openid,i.initWebSocket();var t=i;setInterval(function(){var e={uid:t.uid,openid:t.openid,num:localStorage.getItem(t.pageKey.pnum)};t.sendMessage(JSON.stringify(e))},3e4)}),null!=r&&""!=r&&void 0!=r&&"undefined"!=r){s&&this.templateList();var l=JSON.parse(r);this.isUpdate=!0,this.$store.dispatch("updatePages",l),this.isUpdate=!1,"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"other_object"!=this.diytype&&"mug_cup"!=this.diytype||null!=this.$route.query.uid&&void 0!=this.$route.query.uid||("竹木纹"==localStorage.getItem(this.pageKey.cal_size)||"wall_calendar"==this.diytype||"other_object"==this.diytype||"mug_cup"==this.diytype?(this.has_base_board=!1,localStorage.removeItem(this.pageKey.cal_baseBoard),this.buttonAuthorization.baseplatesign=!1):this.getDoorInfo(),this.hasShunxu=!1),(l.pageList.length<=1||"true"==this.isPart||1==this.isPart||"true"==this.isEditCover||1==this.isEditCover)&&(this.hasShunxu=!1),t&&this.resetClaendarTemp(l),this.hideLoading()}else{var d={};d.tid=this.id,d.imgs=this.imgs,d.token=this.token,d.gid=localStorage.getItem(this.pageKey.goodsid),d.pid=localStorage.getItem(this.pageKey.productId),d.pnum=this.p,d.edittype=1,d.mid=this.mid,d.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,d.pageKey=this.pageKey,d.jijian=!0;var c=localStorage.getItem(this.pageKey.numIndex);c&&null!=c&&(d.startPage=c),1==this.fromOrder&&(d.seconded=!0),d.hassort=!0,this.$store.dispatch("getJsonFun",d).then(function(t){if(s&&i.templateList(),i.hideLoading(),0!=t.result){var a=JSON.parse(t.data);if(1==a.isvideo&&(i.hasVideo=!0,"alipayclient"==ua.match(/AlipayClient/i))){try{if(window._jylog){n=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","视频照片书请到微信小程序设计",JSON.parse(n).orderNo])}}catch(e){console.log(e)}layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){my.navigateBack()})}i.detailJson.isSimple=!0,a.isguali?(i.detailJson.diyType="wall_calendar",i.detailJson.templateInfo.diyType="wall_calendar"):i.diytype=a.diyType,localStorage.setItem(i.pageKey.diytype,i.diytype),localStorage.setItem(i.pageKey.detailJson,t.data),i.isUpdate=!1,i.resetClaendarTemp(i.detailJson),i.jsonFontsArr=Object(_utils_checkJsonFont_js__WEBPACK_IMPORTED_MODULE_24__["a"])(i.detailJson,i.jsonFontsArr,i),i.loadFont(i.jsonFontsArr);var o=JSON.stringify(i.detailJson);localStorage.setItem(i.pageKey.detailJson,o),i.pageAndIndex="0_undefined","calendar"!=i.diytype&&"year_calendar"!=i.diytype&&"wall_calendar"!=i.diytype&&"week_calendar"!=i.diytype&&"other_object"!=i.diytype&&"mug_cup"!=i.diytype||("竹木纹"!=localStorage.getItem(i.pageKey.cal_size)&&"wall_calendar"!=i.diytype&&"week_calendar"!=i.diytype&&"other_object"!=i.diytype&&"mug_cup"!=i.diytype||(i.has_base_board=!1,localStorage.removeItem(i.pageKey.cal_baseBoard),i.buttonAuthorization.baseplatesign=!1,i.buttonAuthorization.baseFormatChange=!1),i.hasShunxu=!1)}else{i.isShowLoading=!1,localStorage.setItem(i.pageKey.ableSelect,!1);try{if(window._jylog){var n=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",t.msg,JSON.parse(n).orderNo])}}catch(e){console.log(e)}i.$layer.alert(t.msg)}}).catch(function(t){console.log(t),i.isShowLoading=!1,localStorage.setItem(i.pageKey.ableSelect,!1);try{if(window._jylog){var a=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",t,JSON.parse(a).orderNo])}}catch(e){console.log(e)}i.$layer.alert(t)})}this.photosArr=JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),this.$store.dispatch("updatePhotos",this.photosArr)},getDesign:function(t){for(var i in this.pageKey)localStorage.removeItem(this.pageKey[i]);var a=this.uid,o=this;t?localStorage.removeItem(this.pageKey.olduid):(localStorage.setItem(this.pageKey.olduid,this.uid),$.ajax({url:_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].basicUrl+"/member/newdesign/"+this.uid,async:!1,dataType:"json",type:"POST",success:function(e){o.uid=e.data},error:function(e){console.log(e),console.log(e.status)}})),localStorage.setItem(this.pageKey.uid,this.uid);var s={uid:this.uid,isTeamBook:this.isTeamBook,edittype:2};1==this.admin&&(s.admin=1);var n=0,r=this;$.ajax({url:_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].basicUrl+"/member/mobileload",async:!1,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",data:JSON.stringify(s),success:function(t){if(t.result){var i=JSON.parse(t.data);if(!i.coverInfo){try{if(window._jylog){var s=localStorage.getItem(r.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",errorr,JSON.parse(s).orderNo])}}catch(e){console.log(e)}return r.isShowLoading=!1,void layer.alert("检测到来自pc端的设计，请继续在pc端制作！")}localStorage.setItem(r.pageKey.thumbnailToken,i.base64Token),$.ajax({url:_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].basicUrl+"/member/checkuid?uid="+a,async:!1,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",success:function(e){if(e.result&&!e.data){r.hasDesignNo=!0;for(var t=i.pageList,a=t.length-1;a>=0;a--)for(var o=t[a].content.itemList,s=o.length-1;s>=0;s--){var n=o[s];(n.flipX||n.flipY)&&o.splice(s,1)}}}}),i.isBanhua&&(i.diyType="woodcut",i.templateInfo.diyType="woodcut"),i.isguali&&(i.diyType="wall_calendar",i.templateInfo.diyType="wall_calendar"),i.iscup&&(i.diyType="mug_cup",i.templateInfo.diyType="mug_cup");for(var l=[],d="",c="",h=0;h<i.pageList.length;h++)for(var g=i.pageList[h],m=0;m<g.content.itemList.length;m++){var u=g.content.itemList[m];if("advancedImageMask"==u.media.mediaType&&-1==u.media.maskSource.indexOf("img/nophoto.jpg")){var f;f=-1==u.media.maskSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.maskSource))&&-1==u.media.maskSource.indexOf("img/nophoto.jpg")?Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.maskSource)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["a"])(u.media.maskSource,u,r.pageKey):u.media.maskSource;var y={height:u.location.maskFactHeight,width:u.location.maskFactWidth,index:n,isUse:!0,title:g.title,titleAll:1,url:u.media.maskSource,src:f};u.media.maskSource=f,l.push(y),n++}if(""!=u.cutArea&&null!=u.cutArea&&void 0!=u.cutArea&&1==u.cutArea.fromAiCut&&"image"==u.media.mediaType){-1==u.media.imgPath.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.imgPath))?(d=u.media.imgPath,c=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.imgPath)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["a"])(u.media.imgPath,u,r.pageKey)):(d=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(u.media.imgPath,u).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.imgPath),""),c=u.media.imgPath);y={height:u.location.factHeight,width:u.location.factWidth,index:n,isUse:!0,title:g.title,titleAll:1,url:d,src:c};l.push(y),n++}}localStorage.setItem(o.pageKey.detailJson,JSON.stringify(i)),o.id=i.templateInfo.id,o.p=i.p,localStorage.setItem(o.pageKey.diytype,i.diyType),localStorage.setItem(o.pageKey.productId,i.productId),localStorage.setItem(o.pageKey.goodsid,i.goodsid),localStorage.setItem(o.pageKey.calenderTemp,JSON.stringify(l)),localStorage.setItem(o.pageKey.token,i.token),localStorage.setItem(o.pageKey.fold,i.fold),localStorage.setItem(o.pageKey.motherid,i.templateInfo.mid),localStorage.setItem(o.pageKey.pnum,p),i.oderInfo&&(localStorage.setItem(o.pageKey.orderInfo,JSON.stringify(i.oderInfo)),localStorage.setItem(o.pageKey.source,i.oderInfo.source)),i.pageList[0].iscover||(r.showInfo=!0,r.showInfoTitle=!1,r.showInfoFoot=!1),localStorage.setItem(o.pageKey.rk,i.rk),localStorage.setItem(o.pageKey.videonum,i.videoNum),localStorage.setItem(o.pageKey.autoSave,1),o.isFromAdminOrModify=!0,o.designCreate(!0)}else{try{if(window._jylog){s=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",t.msg,JSON.parse(s).orderNo])}}catch(e){console.log(e)}layer.alert(t.msg)}}})},initPreview:function(){var t=this;if(this.detailJson.templateInfo.jijian||t.$layer.confirm("此设计已经进行过高级编辑，是否直接跳转到高级标记？",{btn:["跳转高级设计","生成新设计"],closeBtn:0},function(){t.goDesign()},function(){t.templateid=null,t.changeImage(t.decorateList[0],0),t.$layer.closeAll()}),null!=this.detailJson&&void 0!=this.detailJson){this.detailJson.diyType;this.templateid=this.detailJson.templateInfo.id,this.time=0;for(var i=0;i<this.detailJson.pageList.length;i++)this.items.push({css:{},class:{}});this.changeCalendar()}else{try{if(window._jylog){var a=localStorage.getItem(vm.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告","模板加载失败",JSON.parse(a).orderNo])}}catch(e){console.log(e)}this.$layer.alert("模板加载失败")}},changeCalendar:function(){$("#drawing-waterfall").empty(),this.isCalendar=!this.isCalendar},showWaterfall:function(){this.isCalendar||(Object(_js_common_initPages_js__WEBPACK_IMPORTED_MODULE_17__["c"])("#drawing-waterfall",this.detailJson,this,null),$(".page-order span").css("color","#aab2bd"))},goback:function(){navigator.userAgent.toLowerCase();var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);!this.is_byte||this.is_byte&&t?history.go(-1):tt.miniProgram.navigateBack({})},loadFont:function(e){var t=e.length,i=function e(i){FontDetect.onFontLoaded(i,function(e){console.log(i+"字体下载成功"),t--,0==t&&console.log("字体全部下载成功")},function(t){e(i)},{msTimeout:3e3})};for(var a in e)i(e[a])},save:function(){var t=this;setSave();var i=this;if(this.showLoading("正在保存中"),Object(_utils_SvgUtil__WEBPACK_IMPORTED_MODULE_27__["a"])(this.pageKey,this.$store.getters.svgxmlArr,function(e){localStorage.setItem(i.pageKey.detailJson,e),i.$store.dispatch("updatePages",e),i.svgSaveFail=!0},function(){i.svgSaveFail=!1}),0!=this.svgSaveFail){var a=_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].baseUrl2,o=_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].fxBackUrl,s=(_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].wechatBackUrl,_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].xlsBackUrl);this.photoSize=localStorage.getItem(this.pageKey.photoSize),this.mshopSign=localStorage.getItem(this.pageKey.mshopSign),"1"!=this.mshopSign&&"2"!=this.mshopSign||(this.editType=1,"1"==this.mshopSign?this.flag=4:this.flag=10);this.isOverdueTip="";var n=this.detailJson.pageList,r=(JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),JSON.parse(localStorage.getItem(this.pageKey.goodsid))),l=JSON.parse(localStorage.getItem(this.pageKey.productId)),d="",c=JSON.parse(localStorage.getItem(this.pageKey.motherid)),h=this.detailJson;h.datetime=(new Date).getTime(),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(h)),this.$store.dispatch("updatePages",h);var g=localStorage.getItem(this.pageKey.token),m=localStorage.getItem(this.pageKey.returnURL);"calendar"==this.detailJson.diyType||"year_calendar"==this.detailJson.diyType?JSON.parse(localStorage.getItem(this.pageKey.cal_baseBoard)):localStorage.removeItem(this.pageKey.cal_baseBoard),console.log(d);for(var p=!0,u=0;u<n.length;u++){if(!p)return this.isSaving=!1,void this.hideLoading();for(var f=n[u].content.itemList,y=0;y<f.length;y++)if("text"==f[y].media.mediaType&&""!=f[y].media.text&&""!=f[y].media.font.textPath?"yes"==f[y].moveable&&(f[y].moveable="yes"):"image"==f[y].media.mediaType&&0==f[y].media.isBG&&0==f[y].isDisplay||"yes"!=f[y].moveable&&delete f[y].moveable,"advancedImageMask"==f[y].media.mediaType){if(-1!=f[y].media.maskSource.indexOf("img/nophoto.jpg")){try{if(window._jylog){var _=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","您有照片未填充",JSON.parse(_).orderNo])}}catch(e){console.log(e)}return void layer.alert("您有照片未填充")}f[y].media.defaultState=!1,-1!=f[y].media.maskSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.maskSource))&&(f[y].media.maskSource=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(f[y].media.maskSource,f[y]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.maskSource),"")),-1!=f[y].media.factMaskSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.factMaskSource))&&(f[y].media.factMaskSource=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(f[y].media.factMaskSource,f[y]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.factMaskSource),"")),-1!=f[y].media.bgSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.bgSource))&&(f[y].media.bgSource=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(f[y].media.bgSource,f[y]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.bgSource),"")),this.checkDate(n[u],f[y].media.maskSource)}else"image"==f[y].media.mediaType?(-1!=f[y].media.imgPath.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.imgPath))&&(f[y].media.imgPath=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(f[y].media.imgPath,f[y]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.imgPath),"")),-1!=f[y].media.imgPath.indexOf(a)&&(f[y].media.imgPath=f[y].media.imgPath.replace(a,""))):"text"==f[y].media.mediaType?(console.log(f[y]),null!=f[y].media.imgPath&&void 0!=f[y].media.imgPath&&-1!=f[y].media.imgPath.indexOf(a)&&(f[y].media.font.textPath=f[y].media.font.textPath.replace(a,"")),f[y].media.isImage&&-1!=f[y].media.font.textPath.indexOf(a)&&(f[y].media.font.textPath=f[y].media.font.textPath.replace(a,""))):f[y].media.mediaType.indexOf("svg")>-1&&-1!=f[y].media.imgPath.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.imgPath))&&(f[y].media.imgPath=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(f[y].media.imgPath,f[y]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(f[y].media.imgPath),""))}if(this.isSaving){try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","正在保存中，请不要重复点击",JSON.parse(_).orderNo])}}catch(e){console.log(e)}alert("正在保存中，请不要重复点击")}else if(""==this.isOverdueTip){if(this.isSaving=!0,this.detailJson.pageList=n,null==this.detailJson){try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告","您保存的数据异常，请返回检查！",JSON.parse(_).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("您保存的数据异常，请返回检查！"),this.hideLoading(),void(this.isSaving=!1)}for(var v=[],w="",b=0;b<n.length;b++){f=n[b].content.itemList;for(var I=!1,S=[],x=0;x<f.length;x++)"text"!=f[x].media.mediaType||void 0!=f[x].media.text&&null!=f[x].media.text||(I=!0,S=[b,x]);I&&(0==b?w=n[b].title+"、":w+=n[b].title+"、",v.push(S))}if(""==w){var k=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));2==this.editType&&(k={});var O="";O=k&&""!=k?k.source:localStorage.getItem(this.pageKey.source);var L=JSON.parse(localStorage.getItem(this.pageKey.cal_baseBoard)),T="";O&&"wsid"==O&&(this.iswsid=!0),!this.iswsid||1!=this.iswsid&&"true"!=this.iswsid||(this.wsid=localStorage.getItem(this.pageKey.wsid),this.addinfo.wsid=this.wsid,h.addinfo=this.addinfo),null!=L&&""!=L?(l=L.proid,T=L.productno):k&&""!=k&&(T=k.productNo),1==h.templateInfo.coverper&&1==h.templateInfo.backcover&&1==h.templateInfo.innerper&&"photo"==h.diyType&&(h.coverInfo.hascover||1!=h.pageList[0].content.itemList.length||h.pageList.splice(0,1),h.coverInfo.hasbackcover||1!=h.pageList[h.pageList.length-1].content.itemList.length||h.pageList.splice(h.pageList.length-1,1)),"woodcut"==h.diyType&&(h.diyType="photo",h.isBanhua=!0),"woodcut"==h.templateInfo.diyType&&(h.templateInfo.diyType="photo"),"wall_calendar"==h.templateInfo.diyType&&(h.templateInfo.diyType="photo",h.diyType="photo",h.isguali=!0),"mug_cup"==h.templateInfo.diyType&&(h.templateInfo.diyType="photo",h.diyType="photo",h.iscup=!0),"other_object"==h.diyType&&(h.diyType="photo",h.isBanhua=!0),"other_object"==h.templateInfo.diyType&&(h.templateInfo.diyType="photo");var C=localStorage.getItem(this.pageKey.fold);if(""!=C&&void 0!=C&&null!=C&&(h.fold=C),""!=k&&void 0!=k&&null!=k&&(h.oderInfo=k,h.oderInfo.productNo!=h.sku&&h.oderInfo.productNo))return this.alertMessage("同一设计无法对应不同产品，请重新设计"),void(this.isSaving=!1);var P=localStorage.getItem(this.pageKey.autoSave),j=this.editType;P&&(j=2,this.uid||(this.uid=localStorage.getItem(this.pageKey.uid)));var A=localStorage.getItem(this.pageKey.orgTime),N=0;if(void 0!=A&&null!=A&&"undefined"!=A&&"null"!=A){var E=(new Date).getTime(),J=E-A;N=Math.floor(J/6e4);try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","设计时长",N,JSON.parse(_).orderNo])}}catch(e){console.log(e)}}var D={};if(1==j){if(D={userid:-1,name:"",submit:!0,token:g,edittype:1,gid:r,mid:c,pid:l,productno:T,designerDetail:h,orderNo:k.orderNo,tid:this.detailJson.templateInfo.id,pnum:localStorage.getItem(this.pageKey.pnum),membertype:k.shopName,photoSize:this.photoSize,materials:localStorage.getItem(this.pageKey.materials),previewImage:localStorage.getItem(this.pageKey.previewImage),isTeamBook:this.isTeamBook,addinfo:this.addinfo,flag:this.flag},"fashion_photo"==this.detailJson.diyType&&(D.addinfo={num:$("#addinfo").val()},!this.checkNum($("#addinfo").val()))){this.hideLoading();try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","请填写数量",JSON.parse(_).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("请填写数量"),void(this.isSaving=!1)}}else{if(2!=j){try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告","参数错误",JSON.parse(_).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("参数错误"),this.hideLoading(),void(this.isSaving=!1)}if(null==l&&(l=h.productId),D={uid:this.uid,name:"",designerDetail:h,edittype:2,productno:T,gid:r,mid:c,pid:l,photoSize:this.photoSize,materials:localStorage.getItem(this.pageKey.materials),previewImage:localStorage.getItem(this.pageKey.previewImage),pnum:localStorage.getItem(this.pageKey.pnum),submit:!0,tid:this.detailJson.templateInfo.id,isTeamBook:this.isTeamBook,addinfo:this.addinfo},1==this.$route.query.fromAdmin&&(D.token="supervisor"),2!=this.editType||this.$route.query.history||(D.isEdit=!0),"fashion_photo"==this.detailJson.diyType&&1!=this.$route.query.admin&&!this.isTeamBook&&"third"!=O)if("wsid"==O){var B=D.addinfo.num;if(!this.checkNum(B)){this.hideLoading();try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","请填写数量",JSON.parse(_).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("请填写数量"),void(this.isSaving=!1)}}else if(D.addinfo={num:$("#addinfo").val()},!this.checkNum($("#addinfo").val())){this.hideLoading();try{if(window._jylog){_=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","请填写数量",JSON.parse(_).orderNo])}}catch(e){console.log(e)}return this.$layer.alert("请填写数量"),void(this.isSaving=!1)}}this.coverPreviewImage&&(D.previewImage=this.coverPreviewImage),console.log("req.previewImage:"+D.previewImage);var K=this;this.reqData=D,1==this.editType&&(D.addinfo.designlongtime=N),window._czc&&window._czc.push(["_trackEvent","剪影","极简设计页面","提交设计"]),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["cb"])(D).then(function(i){try{if(window._jylog){var a=localStorage.getItem(K.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","提交成功",i.data.uid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}if(t.hideLoading(),K.isSaving=!1,1==i.result){var n=JSON.parse(localStorage.getItem(t.pageKey.thirdDatil)),r=localStorage.getItem(t.pageKey.redirecType);O=localStorage.getItem(t.pageKey.source);var l=T,d="null";""!=l&&null!=l&&void 0!=l&&(k.productNo==T||(d=T)),K.reqData.uid=i.data.uid,K.total(K.reqData),"fxxt"!=O&&-1==window.location.href.indexOf("zheliyin.com")||(l=T,""!=l&&null!=l&&void 0!=l&&(k.productNo==T||(d=T)));localStorage.getItem(t.pageKey.goodsid);for(var c in t.pageKey)localStorage.removeItem(t.pageKey[c]);var h=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"].fromAlipyShop),g=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"].alipyShopGoodsid),p=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"].alipyShopProductid);if("1"==h||1==h)return void my.redirectTo({url:"/pages/preDesign-complete/preDesign-complete?goodsid="+g+"&alipyShopProductid="+p});if("third"==O)return"1"==K.mshopSign||"2"==K.mshopSign?void K.scgjthirdMethod(i,n):void K.thirdMethod(i.data.designno,n);if("fxxt"==O||-1!=window.location.href.indexOf("zheliyin.com")){try{window._czc&&window._czc.push(["_trackEvent","剪影","分销提交页面","提交"+k.orderNo+"-"+o])}catch(e){console.log(e)}return void(window.location.href=o+"/diyRedirect/callbackOrderDetail/"+k.orderNo+"/"+i.data.designno+"/"+r+"/"+d)}if("xls"==O)return void(window.location.href=s+"/mobile/odr/order/sheet/designDIYGoods.do?thirdOrderNo="+i.data.designno+"&odrGoodsCode="+k.orderNo+"&redirecType="+r+"&sku="+d);if("wechat"==O){var u=0;return void(window.location.href=m+"?designId="+i.data.uid+"&member_id="+encodeURI(encodeURI(k.memberid))+"&plseNum="+u)}if("wsid"==O)return void K.goSuccess(i);if(-1!=window.location.href.indexOf("zheliyin.com"))try{window._czc&&window._czc.push(["_trackEvent","剪影","分销提交页面","提交"+k.orderNo+":"+O])}catch(e){console.log(e)}if(1==t.editType||t.$route.query.history&&1!=t.$route.query.admin)if(t.showLoading("保存成功，正在跳转..."),i.data.tburl){try{if(window._jylog){a=localStorage.getItem(K.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","提交成功回传地址",i.data.tburl,JSON.parse(a).orderNo])}}catch(e){console.log(e)}t.goWait(i,k.orderNo)}else t.goSuccess(i);else 2==t.editType&&(t.showLoading("保存成功，正在跳转..."),t.goSuccess(i))}else if(i.data){var f=t;try{if(window._jylog){a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",i.msg,JSON.parse(a).orderNo])}}catch(e){console.log(e)}t.$layer.alert(i.msg,function(){f.copyText(i.data,"成功复制设计单单号,请将设计单单号发送给客服")})}else if("用户信息失效！"==i.msg){f=t;var y={};y.token=localStorage.getItem(f.pageKey.token),y.detail=JSON.parse(localStorage.getItem(f.pageKey.tokenDetail)),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["K"])(y).then(function(e){e.result&&(localStorage.setItem(f.pageKey.token,e.token),f.save())})}else{try{if(window._jylog){a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",i.msg,JSON.parse(a).orderNo])}}catch(e){console.log(e)}t.$layer.alert(i.msg)}}).catch(function(t){try{if(window._jylog){var i=localStorage.getItem(K.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","提交失败",t.meesage,JSON.parse(i).orderNo])}}catch(e){console.log(e)}D=JSON.stringify(D),$.ajax({url:_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].basicUrl+"/member/tempsave",async:!0,type:"POST",data:D,timeout:12e3,headers:{"Content-Type":"application/json"},success:function(i){try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告","保存失败:"+t,JSON.parse(a).orderNo])}}catch(e){console.log(e)}K.$layer.alert("保存失败:"+t)},error:function(t){console.log(t),console.log(t.status),K.uploadError("jianyingstring.txt",D);try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告","保存串失败："+t.responseText,JSON.parse(i).orderNo])}}catch(e){console.log(e)}K.$layer.alert("保存串失败："+t.responseText)}}),K.isSaving=!1})}else{w+="页面文字节点数据异常！",this.hideLoading(),this.isSaving=!1;try{if(window._jylog){var _=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",w,JSON.parse(_).orderNo])}}catch(e){console.log(e)}this.$layer.alert(w)}}else{this.hideLoading(),this.isSaving=!1;try{if(window._jylog){var _=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","您设计的第"+this.isOverdueTip+"    存在过期图片，请修改！",JSON.parse(_).orderNo])}}catch(e){console.log(e)}layer.alert("您设计的第"+this.isOverdueTip+"    存在过期图片，请修改！")}}else this.isSaving=!1},handleScroll:function(){var e=document.getElementById("materialWrap").scrollLeft,t=document.getElementById("materialWrap").scrollWidth,i=document.getElementById("materialWrap").offsetWidth;e+i==t&&(this.decoratePageNum++,console.log(this.decoratePageNum),console.log(this.totalStyleNum),this.decoratePageNum<=this.totalStyleNum&&this.getMore())},getMore:function(){var t=this,i=(this.motherid,this.goodsid,this.tpnum),a=this.itemsList[this.itemIndex].id,o=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,s=this;Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["u"])(this.token,o,i,this.decoratePageNum,a,"",!0).then(function(i){if(s.totalStyleNum=i.data.totalNumberOfPages,i.data.tlist.forEach(function(e){""!=e.previewimage&&-1==e.previewimage.indexOf(_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].baseUrl)&&(e.previewimage=_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].baseUrl+e.previewimage),s.decorateList.push(e)}),0!=s.decorateList.length);else{try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","提示","没有相关模板！",JSON.parse(a).orderNo])}}catch(e){console.log(e)}layer.alert("没有相关模板！")}})},templateList:function(){var t=this,i=this,a=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,o=localStorage.getItem(this.pageKey.token);Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["t"])(a,o,i.decoratePageNum,i.mobilestyleid,!0).then(function(a){if(i.totalStyleNum=a.data.totalNumberOfPages,a.result){i.productId=a.data.productid,i.goodsid=a.data.goodsids,i.motherid=a.data.motherid,i.pnum=a.data.pnum,i.tpnum=a.data.tpnum,i.itemsList=a.data.ptList,i.itemsList.unshift({id:"",name:"推荐"}),i.decorateList=a.data.tlist;for(var o=0;o<i.decorateList.length;o++)""!=i.decorateList[o].previewimage&&-1==i.decorateList[o].previewimage.indexOf(_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].baseUrl)&&(i.decorateList[o].previewimage=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(i.decorateList[o].previewimage)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["h"])(i.decorateList[o].previewimage,{},i.pageKey))}else{try{if(window._jylog){var s=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",a.msg,JSON.parse(s).orderNo])}}catch(e){console.log(e)}layer.alert(a.msg)}})},changeItem:function(e,t){this.itemIndex!=t&&(this.decoratePageNum=0,this.itemIndex=t,this.decorateList=[],this.decoratePageNum=1,this.getMore())},changeImage:function(e,t){console.log(e),this.showLoading("正在替换设计"),this.decorateIndex=t;var i=e.id,a=this;localStorage.setItem(this.pageKey.fold,e.mobilestyleid),a.templateid!=i?(localStorage.removeItem(a.pageKey.detailJson),localStorage.removeItem(a.pageKey.uid),localStorage.removeItem(a.pageKey.autoSave),layer.close(t),a.templateid=i,localStorage.setItem(this.pageKey.id,i),this.changModelMethod(i)):this.hideLoading()},changModelMethod:function(t){var i=this;try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","替换模板",t,JSON.parse(a).orderNo])}}catch(e){console.log(e)}var o=[],s=JSON.parse(localStorage.getItem(this.pageKey.calenderTemp));if(s.length>0)for(var n=0;n<s.length;n++)s[n].title="",s[n].titleAll="","false"==s[n].isUse||0==s[n].isUse||o.push(s[n]);var r={};r.tid=t,r.imgs=o,r.token=localStorage.getItem(this.pageKey.token),r.goodsid=localStorage.getItem(this.pageKey.goodsid),r.productid=localStorage.getItem(this.pageKey.productId),r.pnum=this.p,r.edittype=1,r.mid=localStorage.getItem(this.pageKey.motherid),r.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,r.pageKey=this.pageKey,r.jijian=!0,r.hassort=!0,r.seconded=!0;var l=this;this.$store.dispatch("getJsonFun",r).then(function(e){if(0==e.result)return i.isShowLoading=!1,localStorage.setItem(i.pageKey.ableSelect,!1),i.$layer.alert(e.msg),void i.hideLoading();var t=e.data;""!=e.data&&null!=e.data&&(t=JSON.parse(e.data),l.diytype=t.diyType,localStorage.setItem(l.pageKey.diytype,l.diytype),localStorage.setItem(l.pageKey.id,l.id));var a=JSON.stringify(t);if(localStorage.setItem(l.pageKey.detailJson,a),i.resetClaendarTemp(i.detailJson),l.isUpdate=!1,l.$refs.calendar)l.$refs.calendar.initCalendar();else{for(var o=t.pageList.length,s=0;s<o;s++){var n="#svg_"+s;SVG(n)&&SVG(n).remove()}Object(_js_common_initPages_js__WEBPACK_IMPORTED_MODULE_17__["c"])("#drawing-waterfall",t,i,null)}""==l.mid&&(l.mid=localStorage.getItem(l.pageKey.motherid)),i.hideLoading()})},resetClaendarTemp:function(e){for(var t=JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),i=0,a=[],o=0;o<e.pageList.length;o++)for(var s=e.pageList[o],n=0;n<s.content.itemList.length;n++){var r="",l="",d="",c="",h="",g="",m="",p="",u=s.content.itemList[n];if(""!=u.cutArea&&null!=u.cutArea&&void 0!=u.cutArea&&1==u.cutArea.fromAiCut&&"image"==u.media.mediaType){-1==u.media.imgPath.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.imgPath))?(l=u.media.imgPath,d=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.imgPath)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["a"])(u.media.imgPath,u,this.pageKey)):(l=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(u.media.imgPath,u).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.imgPath),""),d=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(l)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["a"])(l,u,this.pageKey)),u.media.imgPath=d;for(var f=0;f<t.length;f++)if(-1!=l.indexOf(t[f].url)){r=t[f].dateTime,h=t[f].height,g=t[f].width,m=t[f].name,c=t[f].id,p=t[f].pixellow;break}var y={dateTime:r,id:c,name:m,height:h,width:g,index:"l"+i,pixellow:p,isUse:!0,title:s.title,titleAll:1,url:l,src:d};a.push(y),i++}if("advancedImageMask"==u.media.mediaType){-1==u.media.maskSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.maskSource))?(l=u.media.maskSource,d=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.maskSource)+Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["a"])(u.media.maskSource,u,this.pageKey)):(d=u.media.maskSource,l=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(u.media.maskSource,u).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(u.media.maskSource),"")),u.media.maskSource=d;for(f=0;f<t.length;f++)if(-1!=l.indexOf(t[f].url)){r=t[f].dateTime,c=t[f].id,h=t[f].height,g=t[f].width,m=t[f].name,p=t[f].pixellow;break}y={dateTime:r,name:m,height:h,width:g,index:"l"+i,pixellow:p,isUse:!0,title:s.title,titleAll:1,url:l,id:c,src:d};u.media.maskSource=d,a.push(y),i++}}for(o=0;o<t.length;o++)t[o].title="",t[o].titleAll="","false"!=t[o].isUse&&0!=t[o].isUse||a.push(t[o]);localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(a)),localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(a)),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(e)),this.$store.dispatch("updatePages",e)},showSave:function(){var t=this.detailJson.pageList.length,i="div_"+(t-1),a=document.getElementById(i);if(a){var o=this,s=localStorage.getItem(this.pageKey.source);if(!this.isMiniProgram||"third"==s||2==this.editType&&1==this.$route.query.admin)"wsid"==s?this.change():"guochao"==s?layer.open({content:'请输入制作数量:<input id="addinfo" /><p style="margin-top:10px; color:red;font-size:14px">【注：制作数量代表一个作品印刷数量，请结合订单实际购买数量填写】</p>',btn:["确认","取消"],yes:function(e,t){o.save(),layer.close(e)},cancel:function(){o.isSaving=!1,layer.close(index)}}):this.$layer.confirm("请确认您的设计，提交后不可修改",{icon:3,title:"提示"},function(t){try{o.save(),o.$layer.close(t)}catch(e){o.$layer.alert(e),o.isSaving=!1}});else{for(var n=!1,r=0;r<this.detailJson.pageList.length;r++){var l=this.detailJson.pageList[r];if(null!=l.videoUuid&&void 0!=l.videoUuid){n=!0;break}}n||!this.detailJson.isVideo?this.$layer.confirm("请确认您的设计，提交后不可修改",{icon:3,title:"提示"},function(t){try{o.save(),o.$layer.close(t)}catch(e){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",e,JSON.parse(i).orderNo])}}catch(e){console.log(e)}layer.alert(e),o.$layer.alert(e),o.isSaving=!1}}):layer.open({content:"<div>您制作的影音照片书未上传过视频</div>",btn:["继续","返回设计"],yes:function(t,i){layer.confirm("请确认您的设计，提交后不可修改",{icon:3,title:"提示"},function(t){try{o.save(),o.$layer.close(t)}catch(e){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",e,JSON.parse(i).orderNo])}}catch(e){console.log(e)}o.$layer.alert(e),o.isSaving=!1}})},cancel:function(){o.isSaving=!1}})}}else this.$layer.alert("有页面还未加载完，请稍后再提交")},calculateBound:function(e){var t={width:e.width,height:e.height};if(t.width>e.boundWidth||t.height>e.boundHeight){var i=t.width/t.height;e.boundWidth/i>e.boundHeight&&e.boundHeight*i<=e.boundWidth?(t.width=Math.round(e.boundHeight*i),t.height=e.boundHeight):(t.width=e.boundWidth,t.height=Math.round(e.boundWidth/i))}return t},share:function(){window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","分享"]);navigator.userAgent.toLowerCase();if("qq"==this.is_weixn_qq())$("#sharePop").popup();else{var t=window.location.href;if(t=t.replace("preview","album"),this.nativeShare.setShareData({title:"剪影",desc:"我定制了一本照片书，快来看看吧",link:t,icon:"../assets/img/share.png"}),this.isMiniProgram)return void this.copyText("我定制了一本照片书，快来看看吧:"+t,"链接已经复制到剪切板，快去分享给好友吧！");try{this.nativeShare.call()}catch(e){this.copyText("我定制了一本照片书，快来看看吧:"+t,"链接已经复制到剪切板，快去分享给好友吧！")}}},copyText:function(e,t){var i=this;this.$copyText(e).then(function(e){console.log(e),i.$layer.alert(t)},function(e){i.$toast("复制失败")})},checkNum:function(e){return RegExp("^[0-9]*[1-9][0-9]*$").test(e)},changeState:function(){this.showHelp=!1},initMagazine:function(e,t){yepnope({test:Modernizr.csstransforms,yep:["libs/turn.min.js"],nope:["libs/turn.html4.min.js","css/jquery.ui.html4.css"],both:["libs/zoom.min.js","css/jquery.ui.css","libs/magazine.js"],complete:loadApp})},is_weixn_qq:function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)?"weixin":"qq"==e.match(/QQ/i)&&e.match(/QQ/i).length>1&&"qq"},thirdMethod:function(t,i){var a=_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].xlsBackUrl+"thirdreturn/diyOdrOrder/saveDesignNo/"+i.orderNo+"/"+i.thirdGoodsCode+"/"+i.sku+"/"+t+".do";formData.appNo=i.appNo,formData.count=1;var o=this;$.ajax({url:a,type:"get",async:!1,cache:!1,data:formData,success:function(e){"SUCCESS"==e.result&&(window.location.href=i.redirectUrl)},error:function(t){try{if(window._jylog){var i=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","警告",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}return layer.alert("服务器异常!"),!1}})},scgjthirdMethod:function(e,t){var i=this,a={thirdDatil:t,designNo:e.data.designno};Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["gb"])(a).then(function(a){var o=a.result;"fail"==o?i.goSuccess(e):window.location.href=t.content.redirectUrl})},makeSimple:function(){var e=this.tbPass;window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","淘口令复制"]),this.copyText(e,"口令已经复制，快去打开吧!")},total:function(e){Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["eb"])(e).then(function(e){e.result?console.log("保存素材成功！"):console.log("保存素材失败！")})},showTemplate:function(){$("#popTemplate3").popup()},goWait:function(e,t){this.$router.push({name:"wait",query:{redirectUrl:encodeURI(e.data.tburl),code:e.data.designno,uid:e.data.uid,orderNo:t,isSimple:1}})},goSuccess:function(e){this.$router.push({name:"success",query:{code:e.data.designno,uid:e.data.uid}})},addinfo1:function(e){this.addinfo=e,this.save()},change:function(){$(".sjky-mask").show(),$(".weui-popup__modal").show(),$("#addPop").popup()},checkDate:function(e,t){var i="20"+t.substring(3,9),a=new Date;i=i.replace(/^(\d{4})(\d{2})(\d{2})$/,"$1/$2/$3");var o=new Date(i),s=(a.getTime()-o.getTime())/1e3/60/60/24;if(s>75){this.isOverdueTip?this.isOverdueTip+=","+e.title:this.isOverdueTip=e.title;var n=JSON.stringify(this.detailJson);n=n.replace(t,"img/nophoto.jpg"),localStorage.setItem(this.pageKey.detailJson,n),this.$store.dispatch("updatePages",JSON.parse(n))}},closep:function(){$("#addPop").removeClass("weui-popup__container weui-popup__container--visible"),$("#addPop").hide(),$(".sjky-mask").hide(),$(".weui-popup__modal").hide()},uploadError:function(e,t){new Blob([t],{type:"text/plain;charset=utf-8"});var i=new File([t],"error.txt",{type:"text/plain;charset=utf-8"}),a=new FormData;a.append("file",i),a.append("id","2"),$.ajax({url:_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].basicUrl+"/member/tempfilesave",dataType:"json",type:"post",data:a,processData:!1,contentType:!1,error:function(e){alert("保存文件失败")},success:function(e){}})},hidePop:function(){this.isShowPop=!1},toDesign:function(){var t=this;t.$layer.confirm("确定跳转到高级设计吗？（跳转到高级设计后，此设计不再支持极简设计）",{btn:["确定","取消"]},function(){try{if(window._jylog){var i=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","跳转高级设计","",JSON.parse(i).orderNo])}}catch(e){console.log(e)}t.$layer.closeAll(),t.goDesign()},function(){t.$layer.closeAll()})},toPhotoOrder:function(){this.$router.push({name:"photoOrder",query:{id:this.templateid,p:this.p,editType:this.editType,uid:this.$route.query.uid,admin:this.admin,isTeamBook:this.isTeamBook,isPart:this.isPart,history:this.history,fromSimple:!0}})},goDesign:function goDesign(){function changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var retuenUrl=url,temp="/(&"+arg+"=)([^&]*)/gi";eval(temp).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temp),"&"+replaceText));var temps="/([?])("+arg+"=)([^&]*)/gi";return eval(temps).test(retuenUrl)&&(retuenUrl=retuenUrl.replace(eval(temps),"?"+replaceText)),retuenUrl}return url.indexOf("?")>0?url+"&"+replaceText:url+"?"+replaceText}var str=window.location.href.split("?");window.location.href=changeURLArg("design?"+str[1],"id",this.templateid)},showLoading:function(e){this.isShowLoading=!0,this.wenanText=e},hideLoading:function(){this.isShowLoading=!1},goEditor:function(e,t,i){try{this.detailJson.pageList.length;if(this.pageClick=!0,console.log("-------------------------------",t.id),t){var a=!1;if(-1!=t.id.indexOf("decrorate_")){var o=t.id.split("_");if(this.detailJson.pageList[Number(o[1])].content.itemList[Number(o[2])]){var s=this.detailJson.pageList[Number(o[1])].content.itemList[Number(o[2])];s.cutArea&&s.cutArea.fromAiCut&&(a=!0)}}if(-1!=t.id.indexOf("bgimg_photo_")||-1!=t.id.indexOf("decrorate_")&&a){this.isUpdateDom=!0;for(var n=this.detailJson.pageList[e].content.itemList,r=0;r<n.length;r++)if("advancedImageMask"==n[r].media.mediaType||n[r].cutArea&&n[r].cutArea.fromAiCut&&"image"==n[r].media.mediaType){var l;"advancedImageMask"==n[r].media.mediaType?l=SVG("#maskBg_"+e+"_"+r):n[r].cutArea.fromAiCut&&(l=SVG("#clip_"+e+"_"+r));var d=Object(_utils_domHitest_js__WEBPACK_IMPORTED_MODULE_26__["d"])(i.pageX,i.pageY,l,e,this.detailJson);if(d){var c=r;this.pageAndIndex=e+"_"+c,console.log("wRatio",this.detailJson.pageList[e].content.itemList[c].wRatio),console.log("hRatio",this.detailJson.pageList[e].content.itemList[c].hRatio),console.log("crop",this.detailJson.pageList[e].content.itemList[c].crop),this.detailJson.pageList[e].content.itemList[c].crop&&(console.log("crop-height",this.detailJson.pageList[e].content.itemList[c].crop.height),console.log("crop-width",this.detailJson.pageList[e].content.itemList[c].crop.width),console.log("crop-x",this.detailJson.pageList[e].content.itemList[c].crop.x),console.log("crop-y",this.detailJson.pageList[e].content.itemList[c].crop.y));break}}}}}catch(i){console.log(i)}},closePanle:function(e){localStorage.setItem(this.pageKey.ableSelect,!1),setTimeout(this.setFalsePane,50);var t=JSON.parse(localStorage.getItem(this.pageKey.detailJson));this.isUpdate=!0,this.isUpdateDom=!0;var i=this.pageAndIndex.split("_"),a="#svg_"+i[0];this.pageAndIndex=i[0]+"_undefined","fashion_photo"==this.diytype&&(t.pageList[i[0]].ratioDiff=!1,localStorage.setItem(this.pageKey.detailJson,JSON.stringify(t))),this.$store.dispatch("updatePages",t);var o=!1,s={detailJson:t,pageId:a,vm:this,isEdit:o,isPhotoChange:e,isChangeModel:!0};SVG(a).remove(),Object(_views_js_common_updatePage_js__WEBPACK_IMPORTED_MODULE_18__["a"])(i[0],s),this.isUpdate=!1},setFalsePane:function(){this.isShow=!1,localStorage.setItem(this.pageKey.ableSelect,!1)},editShowModel:function(e){var t=this.detailJson.pageList.length;0==e&&1==this.detailJson.pageList[e].iscover&&(this.showModelInfo=0,this.showInfo=!1,this.showInfoTitle=!0,this.showInfoFoot=!1,this.title="封面"),1!=this.detailJson.pageList[e].iscover&&1!=this.detailJson.pageList[e].isbackcover&&(this.showModelInfo=1,this.showInfo=!0,this.showInfoTitle=!1,this.showInfoFoot=!1),e==t-1&&1==this.detailJson.pageList[e].isbackcover&&(this.showModelInfo=2,this.showInfo=!1,this.showInfoTitle=!1,this.showInfoFoot=!0,this.title="封底")},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(_storagekey__WEBPACK_IMPORTED_MODULE_23__["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录","极简设计",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}},saveDesign:function(){var t=this,i=_baseUrl__WEBPACK_IMPORTED_MODULE_21__["a"].baseUrl2,a=localStorage.getItem(this.pageKey.token),o=JSON.parse(localStorage.getItem(this.pageKey.goodsid)),s=JSON.parse(localStorage.getItem(this.pageKey.productId)),n=JSON.parse(localStorage.getItem(this.pageKey.motherid)),r=JSON.parse(localStorage.getItem(this.pageKey.detailJson));r.datetime=(new Date).getTime(),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(r)),this.$store.dispatch("updatePages",this.detailJson);for(var l=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)),d=(JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),r.pageList),c=0;c<d.length;c++)for(var h=d[c].content.itemList,g=0;g<h.length;g++)if("text"==h[g].media.mediaType&&""!=h[g].media.text&&""!=h[g].media.font.textPath?"yes"==h[g].moveable&&(h[g].moveable="yes"):"image"==h[g].media.mediaType&&0==h[g].media.isBG&&0==h[g].isDisplay||"yes"!=h[g].moveable&&delete h[g].moveable,"advancedImageMask"==h[g].media.mediaType){if(-1!=h[g].media.maskSource.indexOf("img/nophoto.jpg")){try{if(window._jylog){var m=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","极简设计","您有照片为填充",e,JSON.parse(m).orderNo])}}catch(e){console.log(e)}return void layer.alert("您有照片未填充")}h[g].media.defaultState=!1,-1!=h[g].media.maskSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.maskSource))&&(h[g].media.maskSource=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(h[g].media.maskSource,h[g]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.maskSource),"")),-1!=h[g].media.factMaskSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.factMaskSource))&&(h[g].media.factMaskSource=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(h[g].media.factMaskSource,h[g]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.factMaskSource),"")),-1!=h[g].media.bgSource.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.bgSource))&&(h[g].media.bgSource=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(h[g].media.bgSource,h[g]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.bgSource),""))}else"image"==h[g].media.mediaType?(-1!=h[g].media.imgPath.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.imgPath))&&(h[g].media.imgPath=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(h[g].media.imgPath,h[g]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.imgPath),"")),-1!=h[g].media.imgPath.indexOf(i)&&(h[g].media.imgPath=h[g].media.imgPath.replace(i,""))):"text"==h[g].media.mediaType?(null!=h[g].media.imgPath&&void 0!=h[g].media.imgPath&&-1!=h[g].media.imgPath.indexOf(i)&&(h[g].media.font.textPath=h[g].media.font.textPath.replace(i,"")),h[g].media.isImage&&-1!=h[g].media.font.textPath.indexOf(i)&&(h[g].media.font.textPath=h[g].media.font.textPath.replace(i,""))):h[g].media.mediaType.indexOf("svg")>-1&&-1!=h[g].media.imgPath.indexOf(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.imgPath))&&(h[g].media.imgPath=Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["f"])(h[g].media.imgPath,h[g]).replace(Object(_utils_getBaseUrl__WEBPACK_IMPORTED_MODULE_22__["d"])(h[g].media.imgPath),""));var p,u=localStorage.getItem(this.pageKey.uid),f=localStorage.getItem(this.pageKey.autoSave),y=localStorage.getItem(this.pageKey.fold);""!=y&&void 0!=y&&null!=y&&(r.fold=y),""!=l&&void 0!=l&&null!=l&&(r.oderInfo=l),p=f||2==this.editType?2:1;var _={};1==p?_={userid:-1,name:"",submit:!1,token:a,edittype:1,gid:o,pid:s,mid:n,designerDetail:r,orderNo:l.orderNo,tid:r.templateInfo.id,pnum:localStorage.getItem(this.pageKey.pnum),membertype:l.shopName,materials:localStorage.getItem(this.pageKey.materials),isTeamBook:this.isTeamBook,addinfo:this.addinfo,previewImage:localStorage.getItem(this.pageKey.previewImage)}:2==p&&(_={uid:u,designerDetail:r,edittype:2,pid:s,previewImage:localStorage.getItem(this.pageKey.previewImage),submit:!1,isTeamBook:this.isTeamBook}),Object(_api_getJson__WEBPACK_IMPORTED_MODULE_16__["cb"])(_).then(function(i){if(i.result){console.log("自动保存成功！"),localStorage.setItem(t.pageKey.autoSave,1),localStorage.setItem(t.pageKey.uid,i.data.uid);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","自动保存",i.data.uid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}}else console.log("自动保存失败")}).catch(function(i){console.log(i);try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","极简设计","自动保存","失败"+i.message,JSON.parse(a).orderNo])}}catch(e){console.log(e)}})}}},window.onload=function(){$("#audioPlay").autoAudio()}},d35f:function(e,t,i){},d509:function(e,t,i){},d5e8:function(t,i,a){"use strict";a.d(i,"a",function(){return s});a("28a5");var o=a("103a");a("4cbb"),a("f3e0");function s(t,i,a,s){var n;n=JSON.parse(localStorage.getItem(t.detailJson));var r=localStorage.getItem(t.token),l=[],d=!1;l=i,l.length>0&&(d=!0),1==d&&$.ajax({url:"api/member/getCommonUploadConfig?token="+r,async:!1,type:"POST",success:function(i){if(i.result){var r="",d="";i.data&&(r=i.data.unionId,d="&unionId="+r),$.ajax({url:"api/upload/svgimage?r="+Math.round(1e4*Math.random())+d,async:!1,cache:!1,type:"POST",contentType:"application/json",dataType:"JSON",data:JSON.stringify(l),success:function(e){for(var i in n=JSON.parse(localStorage.getItem(t.detailJson)),l=[],e){var s=e[i];if(s||""==g){var r=n.pageList[i];for(var d in s){var c,h,g=s[d];g.layerIndex.indexOf("_")?(c=g.layerIndex.split("_")[0],h=g.layerIndex.split("_")[1]):c=g.layerIndex;var m=r.content.itemList[c];m.childrenElement?m.childrenElement[h].media.mediaType.indexOf("svg")>-1&&-1==g.svgPath.indexOf(Object(o["d"])(g.svgPath))&&(m.childrenElement[h].media.imgPath=Object(o["d"])(g.svgPath)+Object(o["a"])(g.svgPath,m.childrenElement[h],t),m.childrenElement[h].media.svgmodified=!1):m.media.mediaType.indexOf("svg")>-1&&-1==g.svgPath.indexOf(Object(o["d"])(g.svgPath))&&(m.media.imgPath=Object(o["d"])(g.svgPath)+Object(o["a"])(g.svgPath,m,t),m.media.svgmodified=!1)}}}a(n)},error:function(t){try{var i;if(window._jylog)localStorage.getItem("orderInfo")&&(i=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(i=localStorage.getItem("e_orderInfo")),window._jylog.push(["保存svgxml方法报错","提交页面","upload/svgimage方法",JSON.stringify(t),JSON.parse(i).orderNo])}catch(e){}s(),console.log(t),layer.open({type:0,title:"温馨提示",content:'<div class="f16">网络错误，svg xml保存失败,请重试。</div>',skin:"layerSkin",area:"650px",closeBtn:0,resize:!1,btn:["确定"],btnAlign:"c",yes:function(e,t){layer.close(e)},cancel:function(e,t){layer.close(e)}})}})}else{try{var c;if(window._jylog)localStorage.getItem("orderInfo")&&(c=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(c=localStorage.getItem("e_orderInfo")),window._jylog.push(["getCommonUploadConfig方法报错","提交页面","success回调方法",JSON.stringify(i),JSON.parse(c).orderNo])}catch(e){}s(),layer.alert("getCommonUploadConfig返回值错误~")}},error:function(t){try{var i;if(window._jylog)localStorage.getItem("orderInfo")&&(i=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(i=localStorage.getItem("e_orderInfo")),window._jylog.push(["getCommonUploadConfig方法报错","提交页面","error回调方法",JSON.stringify(t),JSON.parse(i).orderNo])}catch(e){}s(),console.log(t),layer.alert("getCommonUploadConfig出错了~")}})}},d80f:function(e,t,i){"use strict";var a={IMAGE:"image",TEXT:"text",TEXT_STROKE:"textStroke",ADVANCED_IMAGE_MASK:"advancedImageMask",SVG_TEXT:"svgText",SVG:"svg",SHAPE:"shape",PHOTO_IMAGE_MASK:"photoImageMask",IMAGE_MASK:"imageMask",UNKNOWN:"unknown",SELF_GROUP:"selfGroup"};t["a"]=a},de95:function(e,t,i){"use strict";var a=i("c884"),o=i.n(a);o.a},dfb1:function(e,t,i){e.exports=i.p+"static/img/dingzhichenggong.4b11a78e.png"},e070:function(e,t,i){e.exports=i.p+"static/img/pubuliutu.2e4408bd.svg"},e091:function(e,t,i){"use strict";i.d(t,"a",function(){return g});i("28a5");var a=i("d225"),o=i("b0b4"),s=i("308d"),n=i("6bb5"),r=i("4e2b"),l=i("1db1"),d=i("324d"),c=i("5841"),h="bgimage_",g=function(e){function t(e,i,o,r,l,d){var c;return Object(a["a"])(this,t),c=Object(s["a"])(this,Object(n["a"])(t).call(this,i)),c.parent=e,c.objJson=i,c.pageImgJson=o,c.i=r,c.m=l,c.vm=d,c}return Object(r["a"])(t,e),Object(o["a"])(t,[{key:"initBgImg",value:function(){var e=this,t=e.objJson;if(!SVG("#"+h+"_"+e.i+"_"+e.m)){var i=t.media.imgPath;if(-1!=t.media.imgPath.indexOf(c["a"].thumbnailUrl)&&-1==t.media.imgPath.indexOf("?token=")){var a=localStorage.getItem(e.vm.pageKey.thumbnailToken);i=t.media.imgPath+"?token="+a}var o=e.parent.image(i,function(t){if(e.pageImgJson.imgArr.length>0){var i=t.target.src;if(-1!=i.indexOf(c["a"].thumbnailUrl)){var a=i.split(c["a"].thumbnailUrl),o=a[1].split("?token=");i=c["a"].thumbnailUrl+o[0]}var s=e.pageImgJson.imgArr.indexOf(i);if(-1!=s&&e.pageImgJson.imgArr.splice(s,1),e.pageImgJson.imgArr.length<=0){try{if(e.vm.firstLoadPageStartTime&&-1!=window.location.href.indexOf("design")&&e.i<1){var n=performance.now(),r=(n-e.vm.firstLoadPageStartTime)/1e3;if(console.log("loadCostTime:"+r),window._jylog){var l=localStorage.getItem(e.vm.pageKey.orderInfo);window._jylog.push(["页面loading","设计页面","设计页面loading时长",r,JSON.parse(l).orderNo])}e.vm.firstLoadPageStartTime=null}}catch(t){console.log(t)}e.vm.isShowLoading=!1,console.log("页面加载完"),e.vm.everyTimeRender&&e.vm.everyTimeRender()}}});Object(d["b"])(o,t);var s="";s=Object(d["a"])(t);var n=t.location.x,r=t.location.y;t.flipX&&(n=0-n-t.location.width),t.flipY&&(r=0-r-t.location.height),o.on("error",function(t){if(console.log("背景下载失败"),e.pageImgJson.imgArr.length>0){var i=e.pageImgJson.imgArr.indexOf(e.objJson.media.imgPath);-1!=i&&e.pageImgJson.imgArr.splice(i,1),e.pageImgJson.imgArr.length<=0&&(e.vm.isShowLoading=!1,console.log("页面加载完"),e.vm.everyTimeRender&&e.vm.everyTimeRender())}}),o.attr({class:"deimg myimg",id:h+e.i+"_"+e.m,ty:t.media.mediaType,x:n,y:r,width:t.location.width,height:t.location.height,preserveAspectRatio:"none",style:"pointer-events: none",transform:s})}}}]),t}(l["a"])},e330:function(e,t,i){e.exports=i.p+"static/img/tuceng.9ac1a016.png"},e4b8:function(e,t,i){"use strict";i.d(t,"c",function(){return l}),i.d(t,"b",function(){return d}),i.d(t,"a",function(){return c});var a=i("b775"),o=i("5841"),s=o["a"].fontUrl+"/diy/mfontscss",n="diy/mfont",r="diy/mtextdetect";function l(){WebFont.load({custom:{families:[],urls:[s]},loading:function(){console.log("开始加载")},active:function(){console.log("所有字体已渲染")},inactive:function(){},fontloading:function(e,t){},fontactive:function(e,t){},fontinactive:function(e,t){}})}function d(){return Object(a["a"])({url:n,method:"post"})}function c(e){return Object(a["a"])({url:r,method:"post",data:e})}},e507:function(t,i,a){"use strict";a.r(i);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"body-bg"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[i("canvas",{staticClass:"hideCanvas",staticStyle:{border:"1px solid #000000"},attrs:{id:"screenShot"}})]),i("section",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showTuceng,expression:"showTuceng"}],staticClass:"tc-bg",attrs:{id:"tuceng"}},[i("div",{staticClass:"mask",attrs:{id:"tucengmask"},on:{click:function(t){return e.colseTuCeng(0)}}}),i("div",{staticClass:"tc-wrap",attrs:{id:"popTemplate8"}},[i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner"},[i("a",{staticClass:"picker-button close-popup gray",attrs:{href:"javascript:;"},on:{click:function(t){return e.colseTuCeng(0)}}},[e._v("关闭")]),i("h1",{staticClass:"title sjky-title-site"},[e._v("图层")])])]),i("div",{staticClass:"tc-list",attrs:{id:"tc-list"}},e._l(e.tclist,function(t,a){return i("li",{style:{display:1==t.isDesignShape||1==t.barTypeSign||1==t.backSign||1==t.media.isBG||1==t.isDisplay?"none":""},attrs:{id:"li_"+e.pageindex+"_"+a}},["image"==t.type&&1!=t.barTypeSign&&1!=t.backSign&&1!=t.media.isBG&&1!=t.isDisplay?i("div",[i("div",{staticClass:"piccon",attrs:{id:"tuceng_"+e.pageindex+"_"+a}},[i("img",{style:t.style,attrs:{src:t.src,id:"el_"+e.pageindex+"_"+a}})]),i("div",{staticClass:"eye"},[i("i",{class:t.cla,on:{click:function(t){return e.changetips(a)}}})])]):e._e(),"svg"==t.type?i("div",[i("div",{staticClass:"piccon",attrs:{id:"tuceng_"+e.pageindex+"_"+a}}),i("div",{staticClass:"eye"},[i("i",{class:t.cla,on:{click:function(t){return e.changetips(a)}}})])]):e._e(),"selfGroup"==t.type?i("div",[i("div",{staticClass:"self",attrs:{id:"tuceng_"+e.pageindex+"_"+a}}),i("div",{staticClass:"eye"},[i("i",{class:t.cla,on:{click:function(t){return e.changetips(a)}}})])]):e._e(),"advancedImageMask"==t.type?i("div",[i("div",{staticClass:"piccon",attrs:{id:"tuceng_"+e.pageindex+"_"+a}},[i("img",{style:t.style,attrs:{src:t.src,id:"el_"+e.pageindex+"_"+a}}),1!=t.isSimple?i("img",{style:t.simplestyle,attrs:{src:t.factsrc,id:"frame_"+e.pageindex+"_"+a}}):e._e()]),i("div",{staticClass:"eye"},[i("i",{class:t.cla,on:{click:function(t){return e.changetips(a)}}})])]):e._e(),"text"==t.type?i("div",[i("div",{staticClass:"piccon",attrs:{id:"tuceng_"+e.pageindex+"_"+a}},[i("span",[e._v(e._s(t.text))])]),i("div",{staticClass:"eye"},[i("i",{class:t.cla,on:{click:function(t){return e.changetips(a)}}})])]):e._e()])}),0)])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.is_byte,expression:"is_byte"}],staticClass:"sjky-page-back"},[i("a",{staticStyle:{"font-size":"16px"},on:{click:function(t){return e.askSave()}}},[i("img",{attrs:{src:a("2f02"),alt:""}})])]),i("div",{staticClass:"sjky-design-num"},[i("a",{directives:[{name:"show",rawName:"v-show",value:e.buttonAuthorization.sortsign,expression:"buttonAuthorization.sortsign"}],attrs:{id:"shunxu"},on:{click:e.ajustPageOrder}},[e._v("顺序")]),i("a",{on:{click:e.toShowGuide}},[e._v("帮助")]),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showSaveBtn,expression:"showSaveBtn"}],on:{click:e.saveNowDesign}},[e._v("保存")])]),i("div",{staticClass:"sjky-list-tip sjky-list-tip1",staticStyle:{"font-size":".26rem"},attrs:{id:"warn"}},[e._v("\n\t\t\t\t"+e._s(e.buttonTips)+"\n\t\t\t\t")]),i("div",{staticClass:"sjky-design-area2",style:{"padding-bottom":e.drawingPadingBottom+"rem","padding-top":"1.2rem",overflow:e.drawingOverflow},attrs:{id:"drawing"}},[i("div",{staticClass:"sjky-diy-area"})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showButton,expression:"showButton"}],staticClass:"sjky-right-btn",class:{hide:e.showMoreBtn}},[i("a",{directives:[{name:"show",rawName:"v-show",value:e.hasVideo&&e.showButton,expression:"hasVideo && showButton"}],staticClass:"sjky-btn-blue sjky-site4",attrs:{href:"javascript:void(0);"},on:{click:e.goMiniProgram}},[i("i",{staticClass:"sjky"},[e._v("")]),i("br"),e._v(" \n\t\t\t\t\t视频\n\t\t\t\t")]),i("a",{directives:[{name:"show",rawName:"v-show",value:1==e.buttonAuthorization.baseplatesign&&e.showButton,expression:"buttonAuthorization.baseplatesign==true && showButton"}],staticClass:"sjky-btn-blue sjky-site3",attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"sjky"},[e._v("")]),i("br"),e._v("\n\t\t\t\t\t底板\n\t\t\t\t")]),i("a",{directives:[{name:"show",rawName:"v-show",value:1==e.buttonAuthorization.baseFormatChange&&e.showButton,expression:"buttonAuthorization.baseFormatChange==true && showButton"}],staticClass:"sjky-btn-blue sjky-site6",attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"sjky"},[e._v("")]),i("br"),e._v("\n\t\t\t\t\t版式\n\t\t\t\t")]),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showButton,expression:"showButton"}],staticClass:"sjky-btn-blue sjky-site1",attrs:{href:"javascript:void(0);",id:"wenziBtn"},on:{click:e.openTextPanel}},[i("i",{staticClass:"sjky",attrs:{id:"wenzi_i"}},[e._v("")]),i("br",{attrs:{id:"wenzi"}}),e._v("\n\t\t\t\t\t文字\n\t\t\t\t")]),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showButton,expression:"showButton"}],staticClass:"sjky-btn-blue sjky-site2",attrs:{href:"javascript:void(0);"}},[i("i",{staticClass:"sjky"},[e._v("")]),i("br"),e._v("\n\t\t\t\t\t装饰\n\t\t\t\t")])])]),i("nav",{staticClass:"weui-tabbar",attrs:{id:"bottomBar"}},[i("a",{directives:[{name:"show",rawName:"v-show",value:e.buttonAuthorization.templatesign,expression:"buttonAuthorization.templatesign"}],staticClass:"weui-tabbar__item",staticStyle:{"margin-right":"28%"},attrs:{id:"modelpi"},on:{click:function(t){return t.stopPropagation(),e.showTempModal()}}},[i("div",{staticClass:"weui-tabbar__icon tab-bar-1 sjky"},[e._v("\n\t\t\t\t\t\n\t\t\t\t")]),i("p",{staticClass:"weui-tabbar__label"},[e._v("模板")])]),i("a",{directives:[{name:"show",rawName:"v-show",value:!e.iscomplete,expression:"!iscomplete"}],staticClass:"weui-tabbar__item",staticStyle:{position:"absolute",right:"38%",left:"38%",top:"0",bottom:"0"},attrs:{id:"continue_upload"},on:{click:function(t){return e.uploadpic()}}},[e._m(0),i("p",{staticClass:"weui-tabbar__label"},[e._v("继续上传")])]),i("a",{directives:[{name:"show",rawName:"v-show",value:e.iscomplete,expression:"iscomplete"}],staticClass:"weui-tabbar-item",staticStyle:{position:"absolute",right:"38%",left:"38%",top:"0",bottom:"0"},attrs:{id:"sub_preview"},on:{click:function(t){return e.toShotCanvasLast()}}},[e._m(1),e.isSignleTempleBook?e._e():i("p",{staticClass:"weui-tabbar__label"},[e._v("提交预览")]),e.isSignleTempleBook?i("p",{staticClass:"weui-tabbar__label"},[e._v("提交")]):e._e()]),i("a",{staticClass:"weui-tabbar__item",attrs:{id:"more"},on:{click:function(t){e.showMoreBtn=!e.showMoreBtn}}},[i("div",{staticClass:"weui-tabbar__icon tab-bar-3 sjky",style:{opacity:e.isSignleTempleBook?0:1}},[e._v("\n\t\t\t\t\t\n\t\t\t\t")]),i("p",{staticClass:"weui-tabbar__label",style:{opacity:e.isSignleTempleBook?0:1}},[e._v("更多")])])]),i("template-modal",{ref:"templateModal",attrs:{tempList:e.tempList,tempListTitle:e.tempListTitle,tempListFoot:e.tempListFoot,tempPhoto:e.tempPhoto,pageKey:e.pageKey,hasTempMoreBtn:e.hasTempMoreBtn,showModelInfo:e.showModelInfo,showInfo:e.showInfo,showInfoTitle:e.showInfoTitle,showInfoFoot:e.showInfoFoot,title:e.title,isPageListLoading:e.isPageListLoading,vm:e.vm},on:{checkEnter:e.tempModalCheckEnter,toDeatail:e.tempModalToDeatail,loadData:e.loadData}}),i("div",{staticClass:"weui-popup__container popup-bottom sjky-point-none",attrs:{id:"popTemplate2"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),i("div",{staticClass:"weui-popup__modal temp-out",attrs:{id:"wenziPan"}},[e._m(2),i("div",{staticClass:"modal-content sjky-modal-padding tab-txt",attrs:{id:"tabTxt"}},[e._m(3),i("ul",{staticClass:"tab-cont",attrs:{id:"wenziCont"}},[i("li",{staticClass:"tab-box sjky-pr"},[i("a",{staticClass:"txtLib open-popup",attrs:{href:"javascript:;","data-target":"#popTemplate7"},on:{click:e.showTextPanel}},[i("i",{staticClass:"sjky icon-text"}),e._v("文案库\n\t\t\t\t\t\t\t")]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.myText,expression:"myText"}],ref:"focusTextarea",staticClass:"sjky-textarea-txt",attrs:{id:"wenziTextArea",placeholder:"想说点什么呢？"},domProps:{value:e.myText},on:{click:function(t){return t.stopPropagation(),e.textAreaFocus(t)},input:[function(t){t.target.composing||(e.myText=t.target.value)},e.changeText]}}),i("div",{staticClass:"sjky-txt-right"},[i("div",{},[i("i",{staticClass:"flex-sign sjky add ",staticStyle:{"margin-left":".1rem"},attrs:{id:"wenziAdd"},on:{click:function(t){return t.stopPropagation(),e.enLargeFontSize(t)}}},[e._v("")]),i("i",{staticClass:"flex-sign sjky minus",attrs:{id:"wenziminus"},on:{click:function(t){return t.stopPropagation(),e.narrowFontSize(t)}}},[e._v("")]),i("i",{staticClass:"flex-sign sjky ",on:{click:function(t){return t.stopPropagation(),e.alignText("left")}}},[e._v("")]),i("i",{staticClass:"flex-sign sjky",on:{click:function(t){return t.stopPropagation(),e.alignText("center")}}},[e._v("")]),i("i",{staticClass:"flex-sign sjky",on:{click:function(t){return t.stopPropagation(),e.alignText("right")}}},[e._v("")]),i("i",{staticClass:"flex-sign sjky",attrs:{id:"wenziClear"},on:{click:function(t){return t.stopPropagation(),e.clearText(t)}}},[e._v("")])])])]),i("li",{staticClass:"tab-box"},[i("ul",{staticClass:"sjky-txt-name"},e._l(e.allFontInfo,function(t,o){return i("li",{key:o,on:{click:function(i){return i.stopPropagation(),e.changTextFontFamily(t.name)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.success,expression:"fontItem.success"}],staticStyle:{position:"absolute",right:"1px",bottom:"1px",width:"10px",height:"10px"},attrs:{src:a("d1ae")}}),i("img",{staticClass:"sjky-txt-name-img",attrs:{src:e.fontUrl+t.image}})])}),0)]),i("li",{staticClass:"tab-box"},[i("ul",{staticClass:"sjky-sel-col"},e._l(e.textColor,function(t){return i("li",{key:t,style:{"background-color":t},on:{click:function(i){return i.stopPropagation(),e.changeTextColor(t)}}})}),0)])])])])]),i("div",{staticClass:"weui-popup__container popup-bottom sjky-point-none temp-out temp-out2",attrs:{id:"popTemplate3"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),i("div",{staticClass:"weui-popup__modal"},[i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner"},[i("div",{staticClass:"proTit proTitClass"},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showMyMenu,expression:"showMyMenu"}],on:{click:function(t){return e.queryMmaterialA(-1,-2)}}},[e._v("我的")]),e._l(e.itemsList,function(t,a){return i("span",{key:t.id,class:{on:"0"==a},attrs:{id:t.id},on:{click:function(i){return e.queryMmaterialA(t.id,a)}}},[e._v(e._s(t.tagname))])})],2),i("a",{staticClass:"picker-button close-popup pop-template3-close",attrs:{href:"javascript:;"}},[e._v("确定")])])]),i("div",{staticClass:"modal-content sjky-modal-padding"},[e.isShowMyMaterial?i("div",{staticClass:"sjky-img-wrap upload-button"},[i("i",{staticClass:"vm sjky icon-uploadFace uploader_icon",on:{click:e.fileChanged}}),i("span",{staticStyle:{"font-size":".24rem",color:"#848484"}},[e._v("上传装饰")]),i("input",{staticClass:"pa",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpg,image/jpeg,image/png,image/webp,image/bmp,image/heic,image/heif,image/avif",id:"filelocationDesign"},on:{change:function(t){return e.changePhotoSingleDesign()}}})]):e._e(),i("ul",{staticClass:"sjky-template sjky-template2",attrs:{id:"materialWrap"}},e._l(e.decorateList,function(t,a){return i("li",{key:a,class:{on:0==a},on:{click:function(i){return e.selectDecorate(t,a)}}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:t.src,"ori-width":t.width,"ori-height":t.height}})])])}),0)])])]),i("div",{staticClass:"weui-popup__container popup-bottom sjky-point-none",attrs:{id:"popTemplate5"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),i("div",{staticClass:"weui-popup__modal"},[e._m(4),i("div",{staticClass:"modal-content sjky-modal-padding"},[i("ul",{staticClass:"sjky-template sjky-template2"},e._l(e.baseBoard,function(t,a){return i("li",{key:a,class:{on:a==e.tailibanSelectIndex},on:{click:function(i){return e.changeBase(t.proid,a)}}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:e.modelUrl+t.bigimg}})])])}),0)])])]),i("div",{staticClass:"weui-popup__container popup-bottom sjky-point-none",attrs:{id:"popTemplate6"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),i("div",{staticClass:"weui-popup__modal"},[e._m(5),i("div",{staticClass:"modal-content sjky-modal-padding"},[i("ul",{staticClass:"sjky-template sjky-template2"},e._l(e.datePicList,function(t,a){return i("li",{key:a,class:{on:a==e.banshiSelectIndex},on:{click:function(i){return e.showPanelMother(t.styleid,t.name,a)}}},[i("div",{staticClass:"sjky-img-wrap"},[i("img",{attrs:{src:e.modelUrl+t.name}})])])}),0)])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showText,expression:"showText"}],staticClass:"weui-popup__container popup-bottom sjky-point-none",attrs:{id:"popTemplate7"}},[i("div",{staticClass:"weui-popup__overlay sjky-pop-event"}),e._m(6)]),e.isShow?i("edit-image",{attrs:{pageAndIndex:e.pageAndIndex,vm:e.vm,pageKey:e.pageKey},on:{ClosePanle:e.closePanle}}):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLoading,expression:"isShowLoading"}],staticClass:"loading-design"},[i("div",{staticClass:"con",staticStyle:{"background-color":"#26C6DA"}},[i("img",{attrs:{src:a("f46a")}}),i("p",{staticStyle:{color:"#FFFFFF"}},[e._v(e._s(e.wenanText))])])]),e._m(7),e._m(8),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.showGuide,expression:"showGuide==true"}],staticClass:"new-guide"},[i("div",{staticClass:"page-edit-guide guide",on:{click:function(t){return e.nextstep(1)}}},[i("img",{staticStyle:{width:"5rem"},attrs:{src:a("6910")}}),i("img",{staticStyle:{width:"5rem"},attrs:{src:a("78de")},on:{click:function(t){return e.nextstep(1)}}})]),i("div",{staticClass:"photo-edit-guide guide",staticStyle:{display:"none"}},[i("img",{staticStyle:{width:"5rem"},attrs:{src:a("3441")}}),i("img",{staticStyle:{width:"5rem"},attrs:{src:a("6465")},on:{click:function(t){return e.nextstep(2)}}})]),i("div",{staticClass:"order-edit-guide1 order-edit-guide guide",staticStyle:{display:"none"}},[i("img",{staticStyle:{width:"100%"},attrs:{src:a("3d7d")},on:{click:function(t){return e.nextstep(3)}}})]),i("div",{staticClass:"order-edit-guide2 order-edit-guide guide",staticStyle:{display:"none"}},[i("img",{staticStyle:{width:"100%"},attrs:{src:a("bd81")},on:{click:function(t){return e.nextstep(3)}}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.editMoelGuide,expression:"editMoelGuide==true"}],staticClass:"new-guide"},[i("div",[i("img",{staticStyle:{width:"100%"},attrs:{src:a("bb49")},on:{click:e.closeMoelGuide}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.editMartGuide,expression:"editMartGuide==true"}],staticClass:"new-guide"},[i("div",{on:{click:e.closeMartGuide}},[i("img",{staticStyle:{width:"100%"},attrs:{src:a("5c0d")}}),i("img",{staticStyle:{width:"100%"},attrs:{src:a("8f47")}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.editFontGuide,expression:"editFontGuide==true"}],staticClass:"new-guide"},[i("div",{staticClass:"edit-font-guide"},[i("img",{staticStyle:{width:"100%"},attrs:{src:a("b870")},on:{click:e.closeFontGuide}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:1==e.editTucengGuide,expression:"editTucengGuide==true"}],staticClass:"new-guide"},[i("div",{staticClass:"edit-font-guide"},[i("img",{staticStyle:{width:"100%"},attrs:{src:a("e330")},on:{click:e.closeTucengGuide}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPanel,expression:"showPanel"}]},[i("van-panel",{attrs:{title:"板式名称"}},[i("div",{staticClass:"swiper"},[i("van-swipe",{staticStyle:{width:"6.75rem",height:"5rem"},attrs:{autoplay:5e3,loop:!1,"indicator-color":"#fff"}},e._l(e.picDataList,function(t,a){return i("van-swipe-item",{key:a},[i("img",{staticClass:"dateiamgeImg",attrs:{src:e.modelUrl+t.name}})])}),1)],1),i("div",{attrs:{slot:"footer",align:"center"},slot:"footer"},[i("van-button",{attrs:{size:"small"},on:{click:e.cansel}},[e._v("取消")]),i("van-button",{attrs:{size:"small",type:"primary"},on:{click:e.changeDate}},[e._v("更换")])],1)])],1),i("div",{staticClass:"new-tanchuang",style:{display:0==e.isTestProcess?"none":""}},[i("div",[i("div",{staticClass:"new-jiance"},[i("i"),i("p",[e._v(e._s(e.checkMessage))])]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-xiugai":e.isMaskFill,"new-zhuang":e.nowTestNum<=0}},[i("i"),i("span"),i("div",[i("p",[e._v("相框是否均已填充")]),i("div",{style:{display:0==e.isMaskFill?"none":""}},[e._v(e._s(e.warnArray[0]))])]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>0&&!e.isMaskFill?"block":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-xiugai":e.isHitShuJi,"new-zhuang":e.nowTestNum<=1}},[i("i"),i("span"),i("div",[i("p",[e._v("书脊区域是否正常")]),i("div",{style:{display:0==e.isHitShuJi?"none":""}},[e._v(e._s(e.warnArray[1]))])]),i("h1",{style:{display:1==e.nowTestNum?"":"none"}},[e._m(9)]),i("li",{style:{display:1==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>1&&!e.isHitShuJi?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-xiugai":e.isHitTiaoma,"new-zhuang":e.nowTestNum<=2}},[i("i"),i("span"),i("div",[i("p",[e._v("条码区域是否有遮挡")]),i("div",{style:{display:0==e.isHitTiaoma?"none":""}},[e._v(e._s(e.warnArray[2]))])]),i("h1",{style:{display:2==e.nowTestNum?"":"none"}},[e._m(10)]),i("li",{style:{display:2==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>2&&!e.isHitTiaoma?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top ",class:{"new-xiugai":e.isTextOut,"new-zhuang":e.nowTestNum<=3}},[i("i"),i("span"),i("div",[i("p",[e._v("文字是否超过红色出血线")]),i("div",{style:{display:0==e.isTextOut?"none":""}},[e._v(e._s(e.warnArray[3]))])]),i("h1",{},[i("div",{staticClass:"sk-circle",style:{display:3==e.nowTestNum?"":"none"}},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])]),i("li",{style:{display:3==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>3&&!e.isTextOut?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-jinggao":e.isBeyond,"new-zhuang":e.nowTestNum<=4}},[i("i"),i("span"),i("div",[i("p",[e._v("照片重要部位是否被遮挡")]),i("div",{style:{display:0==e.isBeyond?"none":""}},[e._v(e._s(e.warnArray[4]))])]),i("h1",{},[i("div",{staticClass:"sk-circle",style:{display:4==e.nowTestNum?"":"none"}},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])]),i("li",{style:{display:4==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>4&&!e.isBeyond?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-xiugai":e.isVideoUuidEmpty,"new-zhuang":e.nowTestNum<=5},style:{display:0==e.isVideoBook?"none":""}},[i("i"),i("span"),i("div",[i("p",[e._v("二维码与视频匹配")]),i("div",{style:{display:0==e.isVideoUuidEmpty?"none":""}},[e._v(e._s(e.warnArray[5]))])]),i("h1",{},[i("div",{staticClass:"sk-circle",style:{display:5==e.nowTestNum?"":"none"}},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])]),i("li",{style:{display:5==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>5&&!e.isVideoUuidEmpty?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top ",class:{"new-xiugai":e.isPassMaxVideoNum,"new-zhuang":e.nowTestNum<=6},style:{display:0==e.isVideoBook?"none":""}},[i("i"),i("span"),i("div",[i("p",[e._v("二维码个数是否超过限制")]),i("div",{style:{display:0==e.isPassMaxVideoNum?"none":""}},[e._v(e._s(e.warnArray[6]))])]),i("h1",{},[i("div",{staticClass:"sk-circle",style:{display:6==e.nowTestNum?"":"none"}},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])]),i("li",{style:{display:6==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>6&&!e.isVideoUuidEmpty?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-xiugai":e.isSpecailWord,"new-zhuang":e.nowTestNum<=7}},[i("i"),i("span"),i("div",[i("p",[e._v("是否有特殊表情字符")]),i("div",{style:{display:0==e.isSpecailWord?"none":""}},[e._v(e._s(e.warnArray[7]))])]),i("h1",{},[i("div",{staticClass:"sk-circle",style:{display:7==e.nowTestNum?"":"none"}},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])]),i("li",{style:{display:7==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>7&&!e.isVideoUuidEmpty?"":"none"}})]),i("div",{staticClass:"new-jiancekaishi new-top",class:{"new-jinggao":e.textIsHit,"new-zhuang":e.nowTestNum<=8}},[i("i"),i("div",[i("p",[e._v("文字是否重叠")]),i("div",{style:{display:0==e.textIsHit?"none":""}},[e._v(e._s(e.warnArray[8]))])]),i("h1",{},[i("div",{staticClass:"sk-circle",style:{display:8==e.nowTestNum?"":"none"}},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])]),i("li",{style:{display:8==e.nowTestNum?"":"none"}},[e._v("检测中...")]),i("h1",{staticClass:"icon sjky icon-check",style:{display:e.nowTestNum>8&&!e.textIsHit?"":"none"}})]),i("div",{staticClass:"new-zhanwei"}),i("div",{staticClass:"new-dibuanniuclass",style:{display:0==e.buttonMode?"":"none"},on:{click:function(t){return e.okFun(0)}}},[e._v("好的")]),i("div",{staticClass:"new-dibuanniuclass",style:{display:1==e.buttonMode?"":"none"},on:{click:function(t){return e.toModify(0)}}},[e._v("去修改")]),i("div",{staticClass:"new-dibuanniuclass22",style:{display:2==e.buttonMode?"":"none"}},[i("div",{on:{click:function(t){return e.okFun(1)}}},[e._v("忽略")]),i("div",{on:{click:function(t){return e.toModify(1)}}},[e._v("去修改")])])])])],1)},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-tabbar__icon yulan",staticStyle:{background:"none","margin-bottom":"0"}},[i("img",{attrs:{src:a("1d89")}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-tabbar__icon yulan",staticStyle:{"margin-bottom":"0"}},[i("img",{attrs:{src:a("73b9")}})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner",attrs:{id:"wenziBar"}},[i("a",{staticClass:"picker-button close-popup",attrs:{href:"javascript:;",id:"wenziClose"}},[e._v("确定")]),i("h1",{staticClass:"title sjky-title-site",attrs:{id:"wenziPanTitle"}},[e._v("文字")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",{staticClass:"tab-nav",attrs:{id:"wenziNav"}},[i("li",{staticClass:"tab-item",attrs:{id:"wenziStr"}},[e._v("文本")]),i("li",{staticClass:"tab-item",attrs:{id:"wenziFont"}},[e._v("字体")]),i("li",{staticClass:"tab-item",attrs:{id:"wenziColor"}},[e._v("字色")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner"},[i("a",{staticClass:"picker-button close-popup",attrs:{href:"javascript:;"}},[e._v("确定")]),i("h1",{staticClass:"title sjky-title-site"},[e._v("当前底板")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner"},[i("a",{staticClass:"picker-button close-popup",attrs:{href:"javascript:;"}},[e._v("确定")]),i("h1",{staticClass:"title sjky-title-site"},[e._v("更换板式")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"weui-popup__modal"},[i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar-inner"},[i("a",{staticClass:"picker-button close-popup gray",attrs:{href:"javascript:;"}},[e._v("取消")]),i("a",{staticClass:"picker-button close-popup",attrs:{href:"javascript:;"}},[e._v("确定")]),i("h1",{staticClass:"title sjky-title-site"},[e._v("文案库")])])]),i("div",{staticClass:"modal-content sjky-modal-padding"},[i("div",{staticClass:"sjky-template sjky-template2 textList"})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-size"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("封面封底不能进行替换！")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal modal-out",attrs:{id:"type-model"}},[i("header",{staticClass:"modal-inner"},[i("div",{staticClass:"modal-text"},[e._v("台历暂不支持模板替换！")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sk-circle"},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sk-circle"},[i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"}),i("div",{staticClass:"sk-circle-dot"})])}],n=(a("8e6e"),a("456d"),a("7618")),r=(a("f400"),a("768b")),l=(a("3b2b"),a("75fc")),d=(a("7f7f"),a("6b54"),a("4f7f"),a("5df3"),a("1c4c"),a("55dd"),a("ac4d"),a("8a81"),a("ac6a"),a("c5f6"),a("a481"),a("28a5"),a("7514"),a("96cf"),a("3b8d")),c=(a("4917"),a("bd86")),h=(a("3320"),a("0ddc"),a("5031"),a("1180"),a("2510")),g=a("2f62"),p=a("57b3"),u=a("4cbb"),f=a("054f"),y=a("cabc"),_=a("b1eb"),v=a("08b0"),w=a("a56f"),b=a("d80f"),I=a("5ad2"),S=a("473b"),x=a("611c"),k=a("a09a"),O=a("f5b3"),L=a("999a"),T=a("89d6"),C=a("9621"),P=a("738b"),j=a("1dab"),A=a("a28f"),N=a("e4b8"),E=a("4ba4"),J=a("66a2"),D=a("a244"),B=a("5841"),K=a("103a"),M=a("1503"),U=a("704d"),W=a("3571"),F=a.n(W),R=a("b60d"),q=a("ec06"),G=a("6614"),z=a("cc7d"),H=a.n(z),V=a("c6e1"),Y=a.n(V),X=(a("eb9b"),a("d5e8")),Q=a("201f"),Z=a("23ed"),ee=a("8eca"),te=a("32d1"),ie=a("a053");function ae(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i}function oe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ae(i,!0).forEach(function(t){Object(c["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ae(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var se,ne,re={name:"design",data:function(){var e;return e={editMoelGuide:!1,editMartGuide:!1,editFontGuide:!1,editTucengGuide:!1,buttonTipsBu:!1,insertphoto:!1,buttonTips:"请仔细检查照片和文字位置在红色安全线以内，减少裁切风险;请调整图片至无白边，框内图片有白边会留白生产哦",changeDetailJson:"",touchmoveprevent:"",checkMessage:"设计检测中...",showTuceng:!1,showInfo:!1,showInfoTitle:!0,showInfoFoot:!1,title:"封面",vm:this,page:"",showText:!1,showModelInfo:0,pageListInfo:[],coverpageList:[],backcoverpageList:[],detailTextList:new Array,textObjList:new Array,datePicList:new Array,dateList:new Array,picDataList:new Array,dateUrl:"",styleid:"",showPanel:!1,regularW:800,QrcodeUrl:F.a,hasVideo:!1,isTurnXcx:!0,designsorce:"",uid:null,admin:null,isPageListLoading:!1,hasDesignNo:null,showMoreBtn:!1,isShow:!1,isShowTextPanle:!1,pageAndIndex:null,isUpdate:!1,pageIdArr:[],pageOrderBottomSpace:30,pageClick:!1,baseBoard:[],ableSelect:!1,pageLocationArr:[],changeModelAll:"false",isUpdateDom:!0,jsonFontsArr:[],isTeamBook:!1,isEditCover:!1,myText:"",isload:0,max:0,goodsid:"",pageKey:null,productid:"",textColor:["#000000","#ffffff","#d86457","#ed8f9f","#f29b65","#89b788","#77b5c4","#5995b1"],has_base_board:!1,editObjArr:[],interval:null,iscove:!1,isbackcove:!1,token:"",tempList:[],tempListTitle:[],tempListFoot:[],tempListAll:[],id:"",openid:"",p:-1,editType:1,photosArr:[],productno:"",decrateModel:{},decorate:[],diytype:"",type_id:"",imgs:[],isLoadPagelist:!1,materialsArray:[],fontUrl:B["a"].baseUrl2,modelUrl:B["a"].baseUrl,mid:"",showButton:!0,history:null,decorateList:[],stompClient:null,decoratePageNum:1,hasShunxu:!0,isShowLoading:!0,isInitSvgEvent:!1,isFromAdminOrModify:!1,showGuide:!0,isAdding:!1,isIOS:"",loadCover:!1,is_byte:!1,isPart:!1,issave:!1,normalKey:null,tempPhoto:[],hassort:"",items:[],itemsList:[],showTips:!1,foldStyle:""},Object(c["a"])(e,"styleid",""),Object(c["a"])(e,"showSaveBtn",!0),Object(c["a"])(e,"pageWith",""),Object(c["a"])(e,"editLink",!1),Object(c["a"])(e,"source",null),Object(c["a"])(e,"tipsCount",0),Object(c["a"])(e,"uploadedPicLen",0),Object(c["a"])(e,"newUploadedLen",0),Object(c["a"])(e,"notTestFace",!0),Object(c["a"])(e,"isPC",!1),Object(c["a"])(e,"guides",[{title:"select-page",visible:!0},{title:"edit-photo",visible:!1},{title:"edit-photo-detail",visible:!1},{title:"template",visible:!1},{title:"template-detail",visible:!1},{title:"more",visible:!1},{title:"material",visible:!1},{title:"page-order",visible:!1}]),Object(c["a"])(e,"videosrc",""),Object(c["a"])(e,"guideList",[]),Object(c["a"])(e,"guideVideoList",[]),Object(c["a"])(e,"tailibanSelectIndex",0),Object(c["a"])(e,"banshiSelectIndex",0),Object(c["a"])(e,"hasTempMoreBtn",!0),Object(c["a"])(e,"screenShotCanvas",null),Object(c["a"])(e,"page0_preveiwImg",null),Object(c["a"])(e,"screenShotInterval",null),Object(c["a"])(e,"changScreenImgSuccess",!1),Object(c["a"])(e,"wenanText","努力加载中"),Object(c["a"])(e,"isShowMyMaterial",!1),Object(c["a"])(e,"showMyMenu",!0),Object(c["a"])(e,"buttonAuthorization",{baseplatesign:!1,sortsign:!1,templatesign:!1,baseFormatChange:!1}),Object(c["a"])(e,"isLoadPagelist",!1),Object(c["a"])(e,"isPageListLoading",!1),Object(c["a"])(e,"isCloudTeam",!1),Object(c["a"])(e,"lastEditPageIndex",0),Object(c["a"])(e,"finalClickPageIndex",0),Object(c["a"])(e,"pageindex",0),Object(c["a"])(e,"nowTestNum",-1),Object(c["a"])(e,"isTestProcess",!1),Object(c["a"])(e,"isMaskFill",!1),Object(c["a"])(e,"isHitShuJi",!1),Object(c["a"])(e,"isHitTiaoma",!1),Object(c["a"])(e,"isTextOut",!1),Object(c["a"])(e,"isBeyond",!1),Object(c["a"])(e,"isVideoUuidEmpty",!1),Object(c["a"])(e,"isPassMaxVideoNum",!1),Object(c["a"])(e,"isSpecailWord",!1),Object(c["a"])(e,"textIsHit",!1),Object(c["a"])(e,"isHistoryReapeat",!1),Object(c["a"])(e,"isVideoBook",!1),Object(c["a"])(e,"warnArray",[]),Object(c["a"])(e,"buttonMode",0),Object(c["a"])(e,"seconded",!1),Object(c["a"])(e,"showtucengtips","sjky icon-preview2"),Object(c["a"])(e,"changetipsBleean",!0),Object(c["a"])(e,"tclist",[]),Object(c["a"])(e,"indexArray",new Array),Object(c["a"])(e,"drawingPadingBottom",1.5),Object(c["a"])(e,"drawingOverflow","scroll"),Object(c["a"])(e,"iosScrollTop",0),Object(c["a"])(e,"iscomplete",!1),Object(c["a"])(e,"fromOrder",""),Object(c["a"])(e,"server",{}),Object(c["a"])(e,"savePgaePreive",!1),Object(c["a"])(e,"hasSave",!1),Object(c["a"])(e,"fromPage",""),Object(c["a"])(e,"renderPageIndex",0),Object(c["a"])(e,"renderCount",1),Object(c["a"])(e,"everyTimeImgJson",{loadComplete:!1,imgArr:[]}),Object(c["a"])(e,"timelimited",!1),Object(c["a"])(e,"oldDesign",{}),Object(c["a"])(e,"newdesign",{}),Object(c["a"])(e,"oldDesignfirst",!0),Object(c["a"])(e,"allPageDomComplete",!1),Object(c["a"])(e,"isDesignPage",!0),Object(c["a"])(e,"isMountedComplete",!1),Object(c["a"])(e,"isDesignDataComplete",!1),Object(c["a"])(e,"hasRenderDom",!1),Object(c["a"])(e,"firstLoadPageStartTime",null),Object(c["a"])(e,"isSignleTempleBook",null),Object(c["a"])(e,"addinfo",{}),e},components:{editImage:_["a"],TemplateModal:h["a"]},created:function(){var t=this;1!=this.$route.query.isSignleTempleBook&&"true"!=this.$route.query.isSignleTempleBook||(this.isSignleTempleBook=!0,this.showButton=!1);var i=localStorage.getItem("isAlipay"),a=navigator.userAgent.toLowerCase();if(("undefined"!=typeof my||"alipayclient"==a.match(/AlipayClient/i)||i)&&(this.is_alipay=!0),"alipayclient"!=a.match(/AlipayClient/i)&&!i||1!=this.$route.query.fromRecommend||(this.token=this.$route.query.token,localStorage.setItem("token",this.token)),("alipayclient"==a.match(/AlipayClient/i)||i)&&1==this.$route.query.fromAlipyShopCartEdit){for(var o in R["a"])localStorage.removeItem(R["a"][o]);for(var s in R["c"])localStorage.removeItem(R["c"][s])}this.uid=this.$route.query.uid,console.info("this.uid=============",this.uid),this.hassort=this.$route.query.hassort,this.isTeamBook=this.$route.query.isTeamBook,this.isPart=this.$route.query.isPart,this.isfirst=this.$route.query.isfirst;var n=this.$route.query.history;if(this.page=this.$route.query.p,this.admin=this.$route.query.admin,this.designsorce=this.$route.query.designsorce,this.iscomplete=this.$route.query.iscomplete,this.fromOrder=this.$route.query.fromOrder,this.history=n,"true"==this.isTeamBook||1==this.isTeamBook?("true"==this.isfirst||1==this.isfirst?this.pageKey=R["a"]:(this.pageKey=R["c"],this.editLink=!0),this.isTeamBook=!0):(this.isTeamBook=!1,this.pageKey=R["a"]),"true"==this.iscomplete||1==this.iscomplete?this.iscomplete=!0:this.iscomplete=!1,"toutiaomicroapp"==a.match(/ToutiaoMicroApp/i)&&(this.is_byte=!0,this.sku=this.$route.query.sku||localStorage.getItem(this.pageKey.sku),localStorage.setItem(this.pageKey.sku,this.sku),console.log("设计页面sku======",this.$route.query.sku+"---"+localStorage.getItem(this.pageKey.sku)),localStorage.getItem(this.pageKey.token)&&"undefined"!=localStorage.getItem(this.pageKey.token)||(this.token=this.$route.query.token,localStorage.setItem(this.pageKey.token,this.token),console.info("token===========",this.token),console.info("sku===========",this.sku))),this.getTokenAgin(),this.uid)console.info("history----admin:",!(this.history&&!this.admin)),console.info("history----admin:",this.history+"----"+this.admin),this.pageKey=R["c"],this.editLink=!0,this.history&&!this.admin||1==this.$route.query.fromAlipyShopCartEdit||(this.showSaveBtn=!1);else if(this.token=localStorage.getItem(this.pageKey.token),null==this.token||void 0==this.token||"null"==this.token||"undefined"==this.token)return void this.$router.push({name:"404"});this.getTokenAgin(),localStorage.setItem(this.pageKey.isfirst,1);var r=localStorage.getItem(this.pageKey.source);"wechat"==r&&(console.info("source==========",r),this.showSaveBtn=!0),"wsid"!=r&&"wechat"!=r&&"fxxt"!=r||(this.showMyMenu=!1),this.isEditCover=this.$route.query.isEditCover,"true"!=this.isEditCover&&1!=this.isEditCover||(this.loadCover=!0),this.normalKey=R["f"];var l=localStorage.getItem(R["f"].showGuide);""==l||void 0==l||null==l?localStorage.setItem(R["f"].showGuide,!1):this.showGuide=!1,localStorage.removeItem(this.pageKey.ableSelect),this.$store.dispatch("getFontCss");var d=this,c=navigator.userAgent,h=(navigator.aVersioppn,c.indexOf("Android")>-1||c.indexOf("Linux"),!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/));this.isIOS=h,h&&document.addEventListener("touchmove",function(e){window.event.returnValue=!0,d.ableSelect?d.pageClick=!0:d.pageClick=!1},{passive:!1});a=navigator.userAgent.toLowerCase(),i=localStorage.getItem("isAlipay");("alipayclient"==a.match(/AlipayClient/i)||i)&&loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;console.log("e.data.data",e),"refresh"==t.messageType&&window.location.reload()}}),this.changeModelAll=this.$route.query.changeModelAll,"true"==this.changeModelAll&&(this.changeModelAll=!0,this.hassort="0",this.seconded=!0);var g=localStorage.getItem(this.pageKey.uid),m=localStorage.getItem(this.pageKey.olduid);if(null!=this.uid&&void 0!=this.uid&&(n?this.uid!=g:this.uid!=m))if(this.iscomplete)for(var o in this.pageKey)localStorage.removeItem(this.pageKey[o]);else;("alipayclient"!=a.match(/AlipayClient/i)&&!i||1!=this.$route.query.fromRecommend)&&this.$store.dispatch("getAllFontInfo").then(function(e){if(console.log(window.location.href),console.log(t.pageKey.uid),null!=t.uid&&void 0!=t.uid&&(n?t.uid!=g:t.uid!=m))t.editType=2,t.getDesign(n),t.logFrom("草稿");else{var i=localStorage.getItem(t.pageKey.id),a=!1;if(t.id==i&&(a=!0),null==t.uid||void 0==t.uid||t.changeModelAll){var o=o||[];o.push(["_setAccount","1253519982"]),o.push(["_trackEvent","剪影","设计页面","进入设计"]),t.id=t.$route.query.id,t.p=t.$route.query.p,t.changeModelAll&&!a?t.logFrom("更换模板"):t.logFrom("正常进入")}else{var s=localStorage.getItem(t.pageKey.detailJson);if((null==s||void 0==s)&&!t.changeModelAll){for(var r in t.pageKey)localStorage.removeItem(t.pageKey[r]);return void window.location.reload()}s=JSON.parse(s),t.id=s.templateInfo.id,t.p=s.p,t.editType=2,t.changeModelAll&&!a?t.logFrom("更换模板"):t.logFrom("草稿");var l={uid:g,isTeamBook:t.isTeamBook,edittype:2},d=t;1==t.admin||1==t.changeModelAll||0==t.iscomplete||(console.log("===========新设计 到设计页面==========="),$.ajax({url:B["a"].basicUrl+"/member/mobileload",async:!1,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",data:JSON.stringify(l),success:function(e){if(e.result){var t=JSON.parse(e.data);if(localStorage.setItem(d.pageKey.thumbnailToken,t.base64Token),t.datetime&&t.datetime!=s.datetime)if(d.iscomplete&&0==iscomplete);else{for(var i in d.pageKey)localStorage.removeItem(d.pageKey[i]);console.log("===========design reload==========="),window.location.reload()}}}}))}t.uid=g,t.changeModelAll&&!a?t.changModelMethod():t.designCreate()}}).catch(function(i){try{if(window._jylog){var a=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["字体信息或模板数据加载失败","设计","模板数据加载",JSON.stringify(i),JSON.parse(a).orderNo])}}catch(e){}console.log(i),t.alertMessage("字体信息或模板数据加载失败")})},mounted:function(){var e=this;this.isMountedComplete=!0;var t=localStorage.getItem("isAlipay"),i=navigator.userAgent.toLowerCase();if(("alipayclient"==i.match(/AlipayClient/i)||t)&&1==this.$route.query.fromRecommend){for(var a in R["a"])localStorage.removeItem(R["a"][a]);for(var o in R["c"])localStorage.removeItem(R["c"][o]);this.token=this.$route.query.token,localStorage.setItem(this.pageKey.token,this.token);var s=this;loadScript("https://appx/web-view.min.js",function(){my.onMessage=function(e){console.log(e);var t=e;if("detailJson"==t.messageType){console.log(e);var i=e.data.data,a=JSON.stringify(i);localStorage.setItem(s.pageKey.detailJson,a),s.$store.dispatch("updatePages",i),s.diytype=i.diyType,localStorage.setItem(s.pageKey.diytype,i.diyType);var o={goodsname:"",id:"",memberid:"",orderNo:"",productNo:i.sku,source:"",url:""},n=JSON.stringify(o);localStorage.setItem(s.pageKey.orderInfo,n);var r=e.data.info;console.log(r),localStorage.setItem(s.pageKey.goodsid,r.goodsid),localStorage.setItem(s.pageKey.productId,r.productId),localStorage.setItem(s.pageKey.motherid,r.motherid),localStorage.setItem(s.pageKey.pnum,r.pnum),localStorage.setItem(s.pageKey.uploadCalenderTemp,JSON.stringify(r.uploadCalenderTemp)),s.$store.dispatch("getAllFontInfo").then(function(e){$("#drawing").empty(),s.pageIdArr=Object(p["c"])("#drawing",i,s,null)}).catch(function(t){console.log(t);try{if(window._jylog){var i=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["模板数据加载失败","设计","模板数据加载",JSON.stringify(t),JSON.parse(i).orderNo])}}catch(e){}s.alertMessage("模板数据加载失败")}),s.getSkuSet(),s.resetClaendarTemp(i,0)}};var e=localStorage.getItem(s.pageKey.detailJson);e||my.postMessage({messageType:"want-detailJson"})})}document.body.style.position="relative",window.history&&window.history.pushState&&2!=this.editType&&1!=this.$route.query.fromAlipyShopCart&&!this.$route.query.photoBecomBook&&!this.isSignleTempleBook&&(history.pushState({state:1},null,document.URL),window.addEventListener("popstate",this.askSave,!1));localStorage.getItem(this.pageKey.isPart);this.isPart||"true"!=this.isTeamBook&&1!=this.isTeamBook?(this.isCloudTeam=!1,G["a"].create("screenShot").listen("toDataURLComplete",this.screenCut),this.screenShotCanvas=new fabric.StaticCanvas("screenShot")):(this.isCloudTeam=!0,G["a"].create("screenShot").listen("toDataURLComplete",this.screenShotComplete),this.screenShotCanvas=new fabric.StaticCanvas("screenShot")),""==this.diytype&&(this.diytype=localStorage.getItem(this.pageKey.diytype)),this.timer=setInterval(this.getTipsMessage,1e4),this.isShow&&localStorage.setItem(this.pageKey.ableSelect,!0),this.$store.dispatch("getAllFontInfo").then(function(t){e.designMounte(!0)});var n=function(e){console.log("1111111111111111111111111"),e.stopPropagation(),e.preventDefault()};document.getElementById("tucengmask").addEventListener("touchmove",n,!1)},beforeDestroy:function(){this.screenShotCanvas&&(G["a"].create("screenShot").remove("toDataURLComplete",this.screenShotComplete),G["a"].create("screenShot").remove("toDataURLComplete",this.screenCut)),Object(L["c"])(),clearInterval(this.timer),window.removeEventListener("scroll",this.handleScroll),clearInterval(this.interval),this.pageIdArr.length>1&&document.removeEventListener("scroll",this.setTestPage),window.removeEventListener("popstate",this.askSave,!1),document.removeEventListener("scroll",function(){}),document.removeEventListener("click",function(){}),document.addEventListener("touchmove",function(e){window.event.returnValue=!0},{passive:!1}),document.addEventListener("touchend",function(e){window.event.returnValue=!0},{passive:!1}),document.removeEventListener("touchmove",function(e){},{passive:!1}),document.removeEventListener("touchend",function(e){},{passive:!1})},methods:{everyTimeRender:function(){var e=JSON.parse(localStorage.getItem(this.pageKey.detailJson));Object(p["a"])("#drawing",e,this,null)},resetOldPosition:function(){document.body.style.position="absolute"},saveCurrentPagePreview:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(i,a,o){var s,n,r,l,d,c,h;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=5;break}return console.log("!base64Str"),this.savePgaePreive=null,o&&this.toPreview(),t.abrupt("return");case 5:return s=this,n=this.detailJson.pageList[a].previewImagePath,r={picpath:[[a,i,n,!0,"",""]],userFlag:2},t.prev=8,t.next=11,Object(u["r"])(r);case 11:l=t.sent,d=JSON.parse(localStorage.getItem(s.pageKey.detailJson)),d.pageList[a].previewImagePath=l.pics[0].previewpics,c=JSON.stringify(d),localStorage.setItem(s.pageKey.detailJson,c),s.savePgaePreive=!0,t.next=25;break;case 19:t.prev=19,t.t0=t["catch"](8),console.log("base64图片转换失败"),console.log(t.t0),s.savePgaePreive=null;try{window._jylog&&(h=localStorage.getItem(s.pageKey.orderInfo),window._jylog.push(["保存截图方法报错","设计","保存截图",JSON.stringify(t.t0),JSON.parse(h).orderNo]))}catch(e){}case 25:o&&this.toPreview();case 26:case"end":return t.stop()}},t,this,[[8,19]])}));function i(e,i,a){return t.apply(this,arguments)}return i}(),savePagePreview:function(){var e=Object(d["a"])(regeneratorRuntime.mark(function e(t,i){var a,o,s,n,r,l,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=this,!1,t){e.next=12;break}if(o={detailJson:this.detailJson,pageId:"#svg_0",vm:this,isEdit:!1,isPhotoChange:!1,isChangeModel:!0},q["a"].getInstance().canvasDrawComplete=!1,this.wenanText="相册截图中...请稍等",this.isShowLoading=!0,s=!0,Object(v["a"])(0,o,s),!this.screenShotInterval){e.next=11;break}return e.abrupt("return");case 11:this.screenShotInterval=setInterval(function(){a.changScreenImgSuccess&&(a.isShowLoading=!1,clearInterval(a.screenShotInterval),i?i():(localStorage.setItem(a.pageKey.forceRefresh,!0),a.$router.push({name:"preview",query:{id:a.id,p:a.p,uid:a.uid,editType:a.editType,submit:!0,admin:a.admin,fromDesign:!0,history:a.$route.query.history}})))},200);case 12:if(t){e.next=15;break}e.next=38;break;case 15:return console.log("截图完毕！！"),n=this.detailJson.pageList[0].previewImagePath,o={picpath:[[0,t,n,!1]],userFlag:2},e.prev=18,e.next=21,Object(u["r"])(o);case 21:r=e.sent,console.log(r),a.page0_preveiwImg=r.pics[0].previewpics,l=JSON.parse(localStorage.getItem(a.pageKey.detailJson)),l.previewImage=a.page0_preveiwImg,d=JSON.stringify(l),localStorage.setItem(a.pageKey.detailJson,d),a.$store.dispatch("updatePages",l),!0,a.screenShotInterval&&(a.changScreenImgSuccess=!0),e.next=38;break;case 33:e.prev=33,e.t0=e["catch"](18),console.log("base64图片转换失败"),console.log(e.t0),a.screenShotInterval&&(a.changScreenImgSuccess=!0,a.alertMessage("相册截图转换失败"));case 38:case"end":return e.stop()}},e,this,[[18,33]])}));function t(t,i){return e.apply(this,arguments)}return t}(),queryMmaterialA:function(e,t){e==this.styleid||(this.decorateList=[]),this.styleid=e,t+=1;var i=$(".proTitClass").find("span").eq(t);0==e&&(e=""),i.addClass("on").siblings().removeClass("on"),i.addClass("on"),t<=0?(this.isShowMyMaterial=!0,this.queryMyMaterial()):(this.isShowMyMaterial=!1,this.queryMmaterial(e))},screenCut:function(e,t,i){console.log("screenCut监听"),this.saveCurrentPagePreview(e,t,i)},screenShotComplete:function(e){this.savePagePreview(e)},testPhote:function(e){if(!e){this.detailJson.pageList;for(var t="",i=0;i<this.detailJson.pageList.length;i++)this.detailJson.pageList[i].ratioDiff&&(t=t+(i+1)+",");if(""!=t){var a=this;return layer.confirm(t+"照片比例不合适，请返回修改",{btn:["返回修改","继续提交"]},function(e,t){layer.close(e)},function(e){a.toPreview(!0)}),!0}}return!1},goMiniProgram:function(){var e,t=this;t.isTurnXcx=!0;var i=t.pageAndIndex.split("_");t.setPageVideoUuid(i[0]);var a=JSON.parse(localStorage.getItem(this.pageKey.detailJson));if(a)if(a.pageList[i[0]]){for(var o=0,s=localStorage.getItem(this.pageKey.videonum),n=a.pageList,r=a.pageList[i[0]],l=0;l<n.length;l++)n[l].videoUuid&&""!=n[l].videoUuid&&o++;if(!(o>=s)||r.videoUuid&&""!=r.videoUuid){if(e=a.pageList[i[0]].videoUuid&&""!=a.pageList[i[0]].videoUuid?a.pageList[i[0]].videoUuid:Object(M["a"])(),t.isTurnXcx){setTimeout(function(){layer.confirm("是否已上传完视频？",{btn:["是","否"],mask:!0,shadeClose:!1,cancel:function(e,t){layer.close(e)}},function(o){for(var s=!0,n=a.pageList[i[0]].content.itemList,r=0;r<n.length;r++)n[r].isVideo&&1==n[r].isVideo&&(console.log(n[r]),console.log("arr[0]:",i[0]),console.log(a.pageList[i[0]].content.itemList),s=!1);console.log(s),s&&Object(u["P"])(e).then(function(i){if(0!=i.result)if(""!=e&&e){var a=i.data,o=t.pageAndIndex.split("_"),s=JSON.parse(localStorage.getItem(t.pageKey.detailJson));s.pageList[o[0]].videoUuid=e;var n,r=JSON.stringify(s);localStorage.setItem(t.pageKey.detailJson,r),t.$store.dispatch("updatePages",s);for(var l=SVG("#svg_"+o[0]).children(),d=0;d<l.length;d++)if(l[d].attr("videoGroupId")){var c=l[d].id().split("_");n="decrorate_"+o[0]+"_"+c[1]}SVG("#"+n)&&Object(L["a"])(SVG("#"+n),SVG("#"+n).borderControl),t.addDecorateImg({width:600,height:600,url:B["a"].baseUrl+a,isVideo:!0})}else layer.alert("视频与二维码匹配失败，请重新上传视频");else layer.alert("您未上传视频，请重新添加")}).catch(function(e){console.log(e),layer.alert("未上传视频，请重新添加")}),layer.close(o)},function(e){layer.close(e)})},1e3);var d="plugin://jianying-plugin/video-upload?id="+e+"&openid="+this.openid;window.wx.miniProgram.navigateTo({url:d})}}else t.$layer.alert("视频数量超过最大允许数量，无法添加视频")}else t.$layer.alert("设计数据异常，无法添加视频");else t.$layer.alert("设计数据异常，无法添加视频")},nextstep:function(e){"1"==e&&($(".page-edit-guide").hide(),$(".photo-edit-guide").show()),"2"==e&&($(".photo-edit-guide").hide(),"calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"woodcut"==this.diytype||"wall_calendar"==this.diytype||"other_object"==this.diytype||"mug_cup"==this.diytype?$(".order-edit-guide2").show():$(".order-edit-guide1").show()),"3"==e&&("calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"woodcut"==this.diytype||"wall_calendar"==this.diytype||"other_object"==this.diytype||"mug_cup"==this.diytype?$(".order-edit-guide2").hide():$(".order-edit-guide1").hide(),this.showGuide=!1,$(".page-edit-guide").show()),console.info("555555555555555")},setPageVideoUuid:function(e){if(""!=e&&void 0!=e){var t=parseInt(e);if($("#div_"+e).hasClass("page-face")){if(1!=this.isTeamBook&&"true"!=this.isTeamBook)return this.$layer.alert("封面封底不可添加视频"),void(this.isTurnXcx=!1);if(1==this.loadCover||"true"==this.loadCover)return this.$layer.alert("封面封底不可添加视频"),void(this.isTurnXcx=!1)}if($("#div_"+(t+1)).hasClass("page-face")){if(1!=this.isTeamBook&&"true"!=this.isTeamBook)return this.$layer.alert("内页最后一页不可添加视频"),void(this.isTurnXcx=!1);if(1==this.loadCover||"true"==this.loadCover)return this.$layer.alert("内页最后一页不可添加视频"),void(this.isTurnXcx=!1)}var i=this.detailJson.pageList.length;return 1!=this.isTeamBook&&"true"!=this.isTeamBook&&t+1==i?(this.$layer.alert("内页最后一页不可添加视频"),void(this.isTurnXcx=!1)):void 0}this.$layer.alert("请选择添加视频的页面！")},showNextGuide:function(e){this.guides.length==e+1?this.showGuide=!1:(this.guides[e].visible=!1,this.guides[e+1].visible=!0)},setTestPage:function(){var e=localStorage.getItem(this.pageKey.ableSelect);""!=e&&void 0!=e&&null!=e&&(this.ableSelect=JSON.parse(e));var t=navigator.userAgent,i=(navigator.aVersioppn,t.indexOf("Android")>-1||t.indexOf("Linux")>-1);i&&(this.ableSelect?this.pageClick=!0:this.pageClick=!1);t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Object(Z["a"])();this.showTuceng&&(document.body.scrollTop=document.documentElement.scrollTop=this.iosScrollTop)},getDesign:function(e){if(this.iscomplete&&0==this.iscomplete);else for(var t in this.pageKey)localStorage.removeItem(this.pageKey[t]);var i=this.uid,a=this;e?localStorage.removeItem(this.pageKey.olduid):(localStorage.setItem(this.pageKey.olduid,this.uid),console.log(B["a"].basicUrl+"/member/newdesign/"+this.uid),$.ajax({url:B["a"].basicUrl+"/member/newdesign/"+this.uid,async:!1,dataType:"json",type:"POST",success:function(e){a.uid=e.data},error:function(e){console.log(e),console.log(e.status)}})),localStorage.setItem(this.pageKey.uid,this.uid);var o={uid:this.uid,isTeamBook:this.isTeamBook,edittype:2};1==this.admin&&(o.admin=1),this.firstLoadPageStartTime=performance.now();var s=0,n=this;console.log("============继续设计  到设计页面========"),$.ajax({url:B["a"].basicUrl+"/member/mobileload",async:!1,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",data:JSON.stringify(o),success:function(e){if(e.result){var t=JSON.parse(e.data);if(!t.coverInfo)return n.isShowLoading=!1,void n.showMessage("检测到来自pc端的设计，请继续在pc端制作！");if(n.isDesignDataComplete=!0,localStorage.setItem(a.pageKey.thumbnailToken,t.base64Token),$.ajax({url:B["a"].basicUrl+"/member/checkuid?uid="+i,async:!1,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",success:function(e){if(e.result&&!e.data){n.hasDesignNo=!0;for(var i=t.pageList,a=i.length-1;a>=0;a--)for(var o=i[a].content.itemList,s=o.length-1;s>=0;s--){var r=o[s];(r.flipX||r.flipY)&&o.splice(s,1)}}}}),t.photoBecomBook){n.$route.query.photoBecomBook=1;var o={goodsname:"",id:"",memberid:"",orderNo:"",productNo:t.sku,source:"",url:""},r=JSON.stringify(o);localStorage.setItem(n.pageKey.orderInfo,r)}t.isBanhua&&(t.diyType="woodcut",t.templateInfo.diyType="woodcut"),t.isguali&&(t.diyType="wall_calendar",t.templateInfo.diyType="wall_calendar"),t.iscup&&(t.diyType="mug_cup",t.templateInfo.diyType="mug_cup");for(var l=[],d="",c="",h=0;h<t.pageList.length;h++)for(var g=t.pageList[h],m=0;m<g.content.itemList.length;m++){var p=g.content.itemList[m];if("advancedImageMask"==p.media.mediaType&&""!=p.media.maskSource&&-1==p.media.maskSource.indexOf("img/nophoto.jpg")){var u;u=-1==p.media.maskSource.indexOf(Object(K["d"])(p.media.maskSource))&&-1==p.media.maskSource.indexOf("img/nophoto.jpg")?Object(K["d"])(p.media.maskSource)+Object(K["a"])(p.media.maskSource,p,n.pageKey):p.media.maskSource;var y={height:p.location.maskFactHeight,width:p.location.maskFactWidth,index:s,isUse:!0,title:g.title,titleAll:1,url:p.media.maskSource,src:u};p.media.maskSource=u,l.push(y),s++}if(""!=p.cutArea&&null!=p.cutArea&&void 0!=p.cutArea&&1==p.cutArea.fromAiCut&&"image"==p.media.mediaType&&-1==p.media.imgPath.indexOf("img/nophoto.jpg")){-1==p.media.imgPath.indexOf(Object(K["d"])(p.media.imgPath))?(d=p.media.imgPath,c=Object(K["d"])(p.media.imgPath)+Object(K["a"])(p.media.imgPath,p,n.pageKey),p.media.imgPath=c):(d=Object(K["f"])(p.media.imgPath,p).replace(Object(K["d"])(p.media.imgPath),""),c=p.media.imgPath);y={height:p.location.factHeight,width:p.location.factWidth,index:s,isUse:!0,title:g.title,titleAll:1,url:d,src:c};l.push(y),s++}}t.photoIds&&""!=t.photoIds?a.getPhotoByIds(t.photoIds,l):localStorage.setItem(a.pageKey.uploadCalenderTemp,JSON.stringify(l)),localStorage.setItem(a.pageKey.detailJson,JSON.stringify(t)),a.$store.dispatch("updatePages",t),a.oldDesign=JSON.parse(localStorage.getItem(a.pageKey.detailJson)),a.oldDesignfirst=!1,a.id=t.templateInfo.id,a.p=t.p,localStorage.setItem(a.pageKey.diytype,t.diyType),localStorage.setItem(a.pageKey.productId,t.productId),localStorage.setItem(a.pageKey.goodsid,t.goodsid),localStorage.setItem(a.pageKey.orgTime,t.orgTime),localStorage.setItem(a.pageKey.token,t.token),localStorage.setItem(a.pageKey.fold,t.fold),localStorage.setItem(a.pageKey.motherid,t.templateInfo.mid),localStorage.setItem(a.pageKey.pnum,t.p),localStorage.setItem(a.pageKey.tokenDate,Object(f["a"])("yyyy/MM/dd")),a.getTokenAgin(),t.oderInfo&&(localStorage.setItem(a.pageKey.orderInfo,JSON.stringify(t.oderInfo)),localStorage.setItem(a.pageKey.source,t.oderInfo.source)),t.orderInfo&&(localStorage.setItem(a.pageKey.orderInfo,JSON.stringify(t.orderInfo)),localStorage.setItem(a.pageKey.source,t.orderInfo.source)),t.pageList[0].iscover||(n.showInfo=!0,n.showInfoTitle=!1,n.showInfoFoot=!1),localStorage.setItem(a.pageKey.rk,t.rk),localStorage.setItem(a.pageKey.videonum,t.videoNum),localStorage.setItem(a.pageKey.autoSave,1),a.isFromAdminOrModify=!0,a.designCreate(),a.designMounte(),a.handlephotonum()}else a.alertMessage(e.msg)}})},tuCengScroll:function(){var e=document.getElementById("tc-list").scrollHeight-$("#tc-list").height();document.getElementById("tc-list").scrollTop>=e&&(document.getElementById("tc-list").scrollTop=e-1),document.getElementById("tc-list").scrollTop<=0&&(document.getElementById("tc-list").scrollTop=1)},designMounte:function(e){var t=this;console.log("asd"),"fashion_photo"==this.diytype&&(this.hasShunxu=!1,this.guides=[{title:"select-page",visible:!0},{title:"edit-photo",visible:!1},{title:"edit-photo-detail",visible:!1},{title:"template",visible:!1},{title:"template-detail",visible:!1}]);var i=this,a=localStorage.getItem(this.pageKey.detailJson);if(null!=a&&""!=a&&void 0!=a&&"undefined"!=a){var o,s=JSON.parse(a);if(this.$store.dispatch("updatePages",s),this.isUpdate=!1,this.detailJson.templateInfo.jijian){localStorage.removeItem(R["f"].mobileUrl),this.detailJson.templateInfo.jijian=!1;s=this.detailJson;localStorage.setItem(this.pageKey.detailJson,JSON.stringify(this.detailJson)),this.$store.dispatch("updatePages",this.detailJson)}o=Object(p["c"])("#drawing",s,this,null,null,null,null,e),o&&(this.pageIdArr=o),this.pageLocationArr=[];Number($("#drawing").css("padding-top").replace("px",""));for(var n=0;n<this.pageIdArr.length;n++){var r;document.getElementById(s.pageList[n].title).clientHeight;r=0==n?0:document.getElementById("div_"+n).offsetTop,this.pageLocationArr.push(r)}this.detailJson.coverInfo.hascover||1==this.pageIdArr.length?(SVG("#svg_0").addClass("caledborder"),this.pageAndIndex="0_undefined",$(".tcBtn").hide(),$(".tcBtn_0").show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_0").parent().css("text-align","left"),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"mug_cup"!=this.diytype&&"fashion_photo"!=this.diytype&&"template_cloth"!=this.diytype&&-1==this.detailJson.pageList[0].title.indexOf("封面")&&-1==this.detailJson.pageList[0].title.indexOf("封底")&&this.detailJson.pageList[0].hasWarn&&($(".thBtn_0").show(),this.tipsCount<2&&($(".thp_0").show(),this.tipsCount++))):(SVG("#svg_1").addClass("caledborder"),this.pageAndIndex="1_undefined",$(".tcBtn").hide(),$(".tcBtn_0").show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_0").parent().css("text-align","left"),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"mug_cup"!=this.diytype&&"fashion_photo"!=this.diytype&&"template_cloth"!=this.diytype&&-1==this.detailJson.pageList[0].title.indexOf("封面")&&-1==this.detailJson.pageList[0].title.indexOf("封底")&&this.detailJson.pageList[0].hasWarn&&($(".thBtn_0").show(),this.tipsCount<2&&($(".thp_0").show(),this.tipsCount++)),this.editShowModel(1))}$("#tabTxt").tabNav(),$(".sjky-right-btn").css("bottom","1.2rem"),$("#popTemplate1 .sjky-template li").eq(0).addClass("on"),$("#popTemplate2 .sjky-txt-name li").eq(0).addClass("on"),$(".sjky-sel-col li").eq(0).addClass("on"),$(".sjky-img-edit .sjky-template li").eq(1).addClass("on");$(window).height(),$(".sjky-design-num").height();if(!this.isInitSvgEvent){Object(L["b"])(this),this.isInitSvgEvent=!0;var l=navigator.userAgent.toLowerCase();if("micromessenger"==l.match(/MicroMessenger/i)){var d=localStorage.getItem(R["f"].isMiniProgram);wx.miniProgram.getEnv(function(e){e.miniprogram||d||document.addEventListener("scroll",t.setTestPage)})}else document.addEventListener("scroll",this.setTestPage),document.getElementById("tc-list").addEventListener("scroll",this.tuCengScroll);document.getElementById("materialWrap").addEventListener("scroll",this.handleScroll);var c=this;$(".close-popup").on("click",function(e){$(".sjky-right-btn").css("bottom","1.2rem"),localStorage.setItem(i.pageKey.ableSelect,!1),i.handleSpeLetter(),i.unSelectAll(),c.drawingPadingBottom=1.5}),$(".pop-template3-close").on("click",function(){i.decoratePageNum=1,i.decorateList=[],i.styleid="",i.decoratePageNum=1}),$("#popTemplate1 .sjky-template li").on("click",function(){$(this).addClass("on").siblings().removeClass("on")}),$("#popTemplate2 .sjky-txt-name li").on("click",function(){$(this).addClass("on").siblings().removeClass("on")}),$(".sjky-sel-col li").on("click",function(){$(this).addClass("on").siblings().removeClass("on")}),$(".sjky-img-edit .sjky-template li").on("click",function(){$(this).addClass("on").siblings().removeClass("on")}),$(".tab-bar-1").on("click",function(){if(i.colseTuCeng(0),c.drawingPadingBottom=3.5,i.diytype=localStorage.getItem(i.pageKey.diytype),"calendar"!=i.diytype&&"year_calendar"!=i.diytype&&"week_calendar"!=i.diytype&&"wall_calendar"!=i.diytype&&"other_object"!=i.diytype&&"mug_cup"!=i.diytype||i.detailJson.templateInfo.timelimited&&1==i.detailJson.templateInfo.timelimited&&(i.timelimited=!0),$("#drawing").find(".caledborder").parent().hasClass("page-face"))if(1==i.isTeamBook||"true"==i.isTeamBook){if((1==i.loadCover||"true"==i.loadCover)&&!i.isLoadPagelist){i.isPageListLoading=!0,i.isLoadPagelist=!0;var e={};e.id=i.id,e.mid=i.mid,e.pnum=i.p,e.sku=JSON.parse(localStorage.getItem(i.pageKey.orderInfo)).productNo,i.getTemplateList(e)}}else if(!i.isLoadPagelist){i.isPageListLoading=!0,i.isLoadPagelist=!0;e={};e.id=i.id,e.mid=i.mid,e.pnum=i.p,e.sku=JSON.parse(localStorage.getItem(i.pageKey.orderInfo)).productNo,i.getTemplateList(e)}-1==i.id?i.tempModalToDeatail():$("#popTemplate1").popup(),localStorage.setItem(i.pageKey.ableSelect,!0);var t=$("#popTemplate1").find(".weui-popup__modal").height();if($(".sjky-right-btn").css("bottom",t+10),!i.isLoadPagelist){i.isPageListLoading=!0,i.isLoadPagelist=!0;e={};e.id=i.id,e.mid=i.mid,e.pnum=i.p,e.sku=JSON.parse(localStorage.getItem(i.pageKey.orderInfo)).productNo,i.getTemplateList(e)}var a=localStorage.getItem(i.pageKey.editMoelGuide);a||(i.editMoelGuide=!0)}),$(".tab-bar-3").on("click",function(){if(i.diytype=localStorage.getItem(i.pageKey.diytype),"poker"==i.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加装饰！",{title:!1}),void(i.showMoreBtn=!0)}),$(".sjky-right-btn").on("click",".sjky-site2",function(){c.drawingPadingBottom=3.5,i.isShowMyMaterial=!1;var e=$(".proTitClass").find("span").eq(1);e.addClass("on").siblings().removeClass("on");var t=$(".caledborder").attr("sp");if(("other_object"==i.diytype||"week_calendar"==i.diytype)&&""!=t){var a=parseInt(t);if(a%2!=0)return void layer.alert("背页不允许添加装饰！")}if("poker"==i.diytype&&""!=t){a=parseInt(t);if(0==a)return void layer.alert("背面不允许添加装饰！")}if(!$("#popTemplate3").hasClass("weui-popup__container--visible")){$("#popTemplate3").popup();var o=$("#popTemplate3").find(".weui-popup__modal").height();$(".sjky-right-btn").css("bottom",o+10),localStorage.setItem(i.pageKey.ableSelect,!0),c.queryMmaterial("")}var s=localStorage.getItem(i.pageKey.editMartGuide);s||(i.editMartGuide=!0)}),$(".sjky-right-btn").on("click",".sjky-site3",function(){if(c.drawingPadingBottom=3.5,localStorage.setItem(i.pageKey.ableSelect,!0),!$("#popTemplate5").hasClass("weui-popup__container--visible")){$("#popTemplate5").popup();var e=$("#popTemplate5").find(".weui-popup__modal").height();$(".sjky-right-btn").css("bottom",e+10)}}),$(".sjky-right-btn").on("click",".sjky-site6",function(){if(localStorage.setItem(i.pageKey.ableSelect,!0),!$("#popTemplate6").hasClass("weui-popup__container--visible")){$("#popTemplate6").popup();var e=$("#popTemplate6").find(".weui-popup__modal").height();$(".sjky-right-btn").css("bottom",e+10)}}),$("#sjky-change-img").on("click",function(){$(".sjky-popbox").show(),$(".sjky-img-edit").show(300)}),$(".close-icon").on("click",function(){$(".sjky-popbox").hide(),$(".sjky-img-edit").hide(300)}),$(".sjky-popbox").on("click",function(e){var t=$(e.target).parents().add(e.target);t.hasClass("sjk-top")||($(".sjky-popbox").hide(),$(".sjky-img-edit").hide(300))})}},designCreate:function(){var e=this;this.isTeamBook&&(this.editType=2);var t=this,i=localStorage.getItem(this.pageKey.token),a=this.$route.query.uuid,o={};o.token=i,o.uuid=a,a&&$.ajax({url:B["a"].basicUrl+"/list/getPicListMobile",type:"POST",async:!1,data:o,cache:!1,dataType:"json",success:function(e){console.log("上传图片数量========",e.data.length),e.result&&(console.log("进入图片处理"),Object(U["a"])(e.data,t.pageKey.calenderTemp,t.pageKey.uploadCalenderTemp,t.pageKey))},error:function(e){layer.alert("上传失败")}}),this.diytype=localStorage.getItem(this.pageKey.diytype),this.imgs=localStorage.getItem(this.pageKey.calenderTemp),this.token=localStorage.getItem(this.pageKey.token),this.mid=localStorage.getItem(this.pageKey.motherid);var s=localStorage.getItem(this.pageKey.detailJson);if(this.isTeamBook&&this.isPart&&Object(u["Z"])({uid:this.uid,token:localStorage.getItem(this.pageKey.token)}).then(function(t){console.log(t),e.openid=t.data.openid,e.initWebSocket();var i=e;setInterval(function(){var e={uid:i.uid,openid:i.openid,num:localStorage.getItem(i.pageKey.pnum)};i.sendMessage(JSON.stringify(e))},3e4)}),null!=s&&""!=s&&void 0!=s&&"undefined"!=s){var n=JSON.parse(s);if(!n.coverInfo)return this.isShowLoading=!1,void layer.alert("检测到来自pc端的设计，请继续在pc端制作！");var r=localStorage.getItem(this.pageKey.areadyInsert);this.iscomplete||"1"!=r||this.insertPhotoDetail(n),this.handlephotonum();var l=localStorage.getItem(this.pageKey.calenderTemp);if(this.$store.dispatch("updatePages",n),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"other_object"!=this.diytype&&"mug_cup"!=this.diytype||null!=this.$route.query.uid&&void 0!=this.$route.query.uid||("竹木纹"==localStorage.getItem(this.pageKey.cal_size)||"wall_calendar"==this.diytype||"other_object"==this.diytype||"mug_cup"==this.diytype?(this.has_base_board=!1,localStorage.removeItem(this.pageKey.cal_baseBoard),this.buttonAuthorization.baseplatesign=!1):this.getDoorInfo(),this.hasShunxu=!1),!this.isTeamBook||1!=this.isTeamBook&&"true"!=this.isTeamBook||(this.hasTempMoreBtn=!1),(n.pageList.length<=1||"true"==this.isPart||1==this.isPart||"true"==this.isEditCover||1==this.isEditCover)&&(this.hasShunxu=!1),null!=l&&""!=l&&void 0!=l&&"[]"!=l){var d=JSON.parse(l)[0].title;d?this.resetClaendarTemp(n,1):this.resetClaendarTemp(n,0)}else this.resetClaendarTemp(n,1)}else{var c=localStorage.getItem(this.pageKey.uploadCalenderTemp),h=localStorage.getItem(this.pageKey.minnum);if(c){var g=JSON.parse(c);g.length>h&&(this.iscomplete=!0)}var m={};m.tid=this.id,m.imgs=this.imgs,m.token=this.token,m.pnum=this.p,m.edittype=1,m.mid=this.mid,m.pageKey=this.pageKey;var f=localStorage.getItem(this.pageKey.numIndex);f&&null!=f&&(m.startPage=f);navigator.userAgent.toLowerCase();var y=navigator.userAgent,_=!!y.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(this.is_byte&&!_?(m.uuid=a,console.log("uuid======",a),m.gid=this.$route.query.gid,m.pid=this.$route.query.pid,m.sku=this.$route.query.sku):(m.gid=localStorage.getItem(this.pageKey.goodsid),m.pid=localStorage.getItem(this.pageKey.productId),m.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo),"-1"==this.id&&(m.jijian=!0),"0"==this.hassort?m.hassort=!0:m.hassort=!1,m.seconded=this.seconded,this.isTeamBook&&!this.isPart&&(m.loadCover=this.loadCover),this.isTeamBook&&(1==this.isTeamBook||"true"==this.isTeamBook)&&(m.isTeamBook=!0,m.uid=this.uid,this.isPart&&(1==this.isPart||"true"==this.isPart))){m.isPart=!0;var v=localStorage.getItem(this.pageKey.changxian);1==v&&(m.changxian=JSON.parse(localStorage.getItem(this.pageKey.changxianIdArray)))}this.firstLoadPageStartTime=performance.now(),this.$store.dispatch("getJsonFun",m).then(function(i){if(localStorage.setItem(t.pageKey.areadyInsert,"0"),0==i.result)return e.isShowLoading=!1,localStorage.setItem(e.pageKey.ableSelect,!1),void e.alertMessage(i.msg);var a=JSON.parse(i.data);-1==e.id&&localStorage.setItem(e.pageKey.previewImage,a.pageList[0].previewImagePath),e.isSignleTempleBook&&(e.detailJson.isSignleTempleBook=!0),1==a.isvideo&&(e.hasVideo=!0,"alipayclient"==y.match(/AlipayClient/i)&&layer.alert("视频照片书请到微信小程序设计",{shadeClose:!1,closeBtn:0},function(e){my.navigateBack()})),e.changeShowInfo(),a.isguali?(e.detailJson.diyType="wall_calendar",e.detailJson.templateInfo.diyType="wall_calendar"):e.diytype=a.diyType,localStorage.setItem(e.pageKey.diytype,e.diytype),e.isUpdate=!1,e.changeModelAll&&$("#drawing").empty(),console.info("99999999999999"),console.info(JSON.stringify(e.detailJson)),e.resetClaendarTemp(e.detailJson,0),console.info(JSON.stringify(e.detailJson)),e.pageIdArr=Object(p["c"])("#drawing",e.detailJson,e,null),console.info(JSON.stringify(e.detailJson)),e.pageLocationArr=[];for(var o=0;o<e.pageIdArr.length;o++){var s;s=0==o?0:document.getElementById("div_"+o).offsetTop,e.pageLocationArr.push(s)}e.jsonFontsArr=Object(w["a"])(e.detailJson,e.jsonFontsArr,e),console.log(e.jsonFontsArr),e.loadFont(e.jsonFontsArr);var n=JSON.stringify(e.detailJson);localStorage.setItem(e.pageKey.detailJson,n),e.detailJson.coverInfo.hascover||1==e.pageIdArr.length?(SVG("#svg_0").addClass("caledborder"),e.pageAndIndex="0_undefined",$(".tcBtn").hide(),$(".tcBtn_0").show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_0").parent().css("text-align","left"),"calendar"!=e.diytype&&"year_calendar"!=e.diytype&&"wall_calendar"!=e.diytype&&"week_calendar"!=e.diytype&&"mug_cup"!=e.diytype&&"fashion_photo"!=e.diytype&&"template_cloth"!=e.diytype&&-1==e.detailJson.pageList[0].title.indexOf("封面")&&-1==e.detailJson.pageList[0].title.indexOf("封底")&&e.detailJson.pageList[0].hasWarn&&($(".thBtn_0").show(),e.tipsCount<2&&($(".thp_0").show(),e.tipsCount++))):(SVG("#svg_1").addClass("caledborder"),e.pageAndIndex="1_undefined",$(".tcBtn").hide(),$(".tcBtn_1").show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_1").parent().css("text-align","left"),"calendar"!=e.diytype&&"year_calendar"!=e.diytype&&"wall_calendar"!=e.diytype&&"week_calendar"!=e.diytype&&"mug_cup"!=e.diytype&&"fashion_photo"!=e.diytype&&"template_cloth"!=e.diytype&&-1==e.detailJson.pageList[0].title.indexOf("封面")&&-1==e.detailJson.pageList[0].title.indexOf("封底")&&e.detailJson.pageList[0].hasWarn&&($(".thBtn_1").show(),e.tipsCount<2&&($(".thp_1").show(),e.tipsCount++)),e.editShowModel(1)),"calendar"!=e.diytype&&"year_calendar"!=e.diytype&&"wall_calendar"!=e.diytype&&"week_calendar"!=e.diytype&&"other_object"!=e.diytype&&"mug_cup"!=e.diytype||("竹木纹"==localStorage.getItem(e.pageKey.cal_size)||"wall_calendar"==e.diytype||"week_calendar"==e.diytype||"other_object"==e.diytype||"mug_cup"==e.diytype?(e.has_base_board=!1,localStorage.removeItem(e.pageKey.cal_baseBoard),e.buttonAuthorization.baseplatesign=!1,e.buttonAuthorization.baseFormatChange=!1):e.getDoorInfo(),e.hasShunxu=!1),e.isTeamBook&&(e.hasTempMoreBtn=!1),(e.pageIdArr.length<=1||"true"==e.isPart||1==e.isPart||"true"==e.isEditCover||1==e.isEditCover)&&(e.hasShunxu=!1),e.handlephotonum()}).catch(function(t){console.log(t),e.isShowLoading=!1,localStorage.setItem(e.pageKey.ableSelect,!1),e.alertMessage(t.msg)}),this.designMounte()}this.photosArr=JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),this.$store.dispatch("updatePhotos",this.photosArr),this.getSkuSet(),1==this.admin||this.isfirst?1!=this.hasDesignNo||"calendar"!=this.diytype&&"year_calendar"!=this.diytype||this.getDoorInfo():"calendar"!=this.diytype&&"year_calendar"!=this.diytype||this.getDoorInfo()},changModelMethod:function(){var e=this;this.diytype=localStorage.getItem(this.pageKey.diytype),this.imgs=localStorage.getItem(this.pageKey.uploadCalenderTemp),this.token=localStorage.getItem(this.pageKey.token),this.mid=localStorage.getItem(this.pageKey.motherid),this.$route.query.uid&&(this.editType=2);var t=[],i=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp));if(i.length>0)for(var a=0;a<i.length;a++)i[a].title="",i[a].titleAll="","false"==i[a].isUse||0==i[a].isUse||t.push(i[a]);var o={};o.tid=this.id,o.imgs=t,o.token=localStorage.getItem(this.pageKey.token),o.goodsid=localStorage.getItem(this.pageKey.goodsid),o.productid=localStorage.getItem(this.pageKey.productId),o.pnum=this.p,o.edittype=1,o.mid=localStorage.getItem(this.pageKey.motherid),o.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,o.pageKey=this.pageKey;var s=localStorage.getItem(this.pageKey.numIndex);s&&null!=s&&"photo"!=this.diytype&&(o.startPage=s),"-1"==this.id&&(o.jijian=!0),"0"==this.hassort?o.hassort=!0:o.hassort=!1;var n=this;this.getSkuSet(),this.$store.dispatch("getJsonFun",o).then(function(t){var i=t.data;""!=t.data&&null!=t.data&&(i=JSON.parse(t.data),n.diytype=i.diyType,localStorage.setItem(n.pageKey.diytype,n.diytype),localStorage.setItem(n.pageKey.id,n.id)),n.isSignleTempleBook&&(i.isSignleTempleBook=!0);var a=JSON.stringify(i);localStorage.setItem(n.pageKey.detailJson,a),n.$store.dispatch("updatePages",i),$("#drawing").empty(),n.isUpdate=!1,n.pageIdArr=Object(p["c"])("#drawing",i,n,null),n.pageLocationArr=[];for(var o=0;o<n.pageIdArr.length;o++){var s;s=0==o?0:document.getElementById("div_"+o).offsetTop,n.pageLocationArr.push(s)}""==n.mid&&(n.mid=localStorage.getItem(n.pageKey.motherid)),"calendar"!=n.diytype&&"year_calendar"!=n.diytype&&"week_calendar"!=n.diytype&&"wall_calendar"!=n.diytype&&"other_object"!=e.diytype&&"mug_cup"!=e.diytype||null!=e.$route.query.uid&&void 0!=e.$route.query.uid||("竹木纹"==localStorage.getItem(n.pageKey.cal_size)||"wall_calendar"==n.diytype||"other_object"==e.diytype||"mug_cup"==e.diytype?(n.has_base_board=!1,localStorage.removeItem(e.pageKey.cal_baseBoard),e.buttonAuthorization.baseplatesign=!1):n.getDoorInfo(),n.hasShunxu=!1),n.pageIdArr.length<=1&&(n.hasShunxu=!1),n.detailJson.coverInfo.hascover||1==n.pageIdArr.length?(SVG("#svg_0").addClass("caledborder"),n.pageAndIndex="0_undefined",$(".tcBtn").hide(),$(".tcBtn_0").show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_0").parent().css("text-align","left"),"calendar"!=e.diytype&&"year_calendar"!=e.diytype&&"wall_calendar"!=e.diytype&&"week_calendar"!=e.diytype&&"mug_cup"!=e.diytype&&"fashion_photo"!=e.diytype&&"template_cloth"!=e.diytype&&-1==n.detailJson.pageList[0].title.indexOf("封面")&&-1==n.detailJson.pageList[0].title.indexOf("封底")&&n.detailJson.pageList[0].hasWarn&&($(".thBtn_0").show(),e.tipsCount<2&&($(".thp_0").show(),e.tipsCount++))):(SVG("#svg_1").addClass("caledborder"),n.pageAndIndex="1_undefined",$(".tcBtn").hide(),$(".tcBtn_1").show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_1").parent().css("text-align","left"),"calendar"!=e.diytype&&"year_calendar"!=e.diytype&&"wall_calendar"!=e.diytype&&"week_calendar"!=e.diytype&&"mug_cup"!=e.diytype&&"fashion_photo"!=e.diytype&&"template_cloth"!=e.diytype&&-1==n.detailJson.pageList[0].title.indexOf("封面")&&-1==n.detailJson.pageList[0].title.indexOf("封底")&&n.detailJson.pageList[0].hasWarn&&($(".thBtn_1").show(),e.tipsCount<2&&($(".thp_1").show(),e.tipsCount++)),e.editShowModel(1)),e.resetClaendarTemp(i,1)})},queryMmaterial:function(e,t){if(void 0==e&&(e=""),-1!=e){$("#materialWrap").showLoading();var i=this;i.foldStyle=e,i.decoratePageNum=Math.ceil(i.decorateList.length/24)+1,Object(u["w"])(localStorage.getItem(i.pageKey.fold),e,i.decoratePageNum).then(function(e){$("#materialWrap").hideLoading();var t=[];if(1==i.decoratePageNum&&(i.decorateList=[],i.items=[]),e.data.deatil.forEach(function(e){if(-1==e.picname.indexOf(".svg")){var a=JSON.parse(e.imageinfo),o={location:{},media:{}};o.location.factWidth=a.width,o.location.factHeight=a.height;var s=Object(K["d"])(e.picname)+Object(K["a"])(e.picname,o,i.pageKey);-1!=s.indexOf(B["a"].thumbnailUrl)&&(s=s.replace("fsferry/",""),s=s.replace("commonUpload/","")),-1==s.indexOf("token")&&(s=s+"?token="+localStorage.getItem(i.pageKey.thumbnailToken)),o.media.imgPath=s;var n={url:Object(K["d"])(e.picname)+Object(K["a"])(e.picname,o,i.pageKey),src:s,width:a.width,height:a.height,id:e.id,tagid:e.tagid};i.decorateList.push(n),t.push(e.tagid)}}),0==i.isload){i.isload=1,i.itemsList=[];for(var a=e.data.resultStyle,o=[],s=0;s<a.length;s++)"72999"==a[s].id||"56056"==a[s].id||o.push(a[s]);i.itemsList=o,i.styleid=o[0].id}}).catch(function(e){$("#materialWrap").hideLoading()})}},queryMyMaterial:function(){var e=this;"1"==this.decoratePageNum&&(this.decorateList=[]),$("#materialWrap").showLoading();var t=localStorage.getItem(this.pageKey.token);Object(u["lb"])({token:t,pagenum:this.decoratePageNum}).then(function(t){console.log(t),$("#materialWrap").hideLoading();var i=!0,a=!1,o=void 0;try{for(var s,n=t.data.list[Symbol.iterator]();!(i=(s=n.next()).done);i=!0){var r=s.value,l=JSON.parse(r.imageinfo),d={location:{},media:{}};d.location.factWidth=l.width,d.location.factHeight=l.height,d.media.imgPath=r.picname;var c=Object(K["d"])(r.picname)+Object(K["a"])(r.picname,d,e.pageKey);-1!=c.indexOf(B["a"].thumbnailUrl)&&(c=c.replace("fsferry/",""),c=c.replace("commonUpload/",""),c=c+"?token="+localStorage.getItem(e.pageKey.thumbnailToken)),-1!=c.indexOf("material")&&-1==c.indexOf("token")&&(c=c+"?token="+localStorage.getItem(e.pageKey.thumbnailToken)),d.media.imgPath=c;var h={url:Object(K["d"])(r.picname)+Object(K["a"])(r.picname,d,e.pageKey),src:c,width:l.width,height:l.height,id:r.id,tagid:-1};e.decorateList.push(h)}}catch(g){a=!0,o=g}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}}).catch(function(e){$("#materialWrap").hideLoading()})},handleScroll:function(){var e=document.getElementById("materialWrap").scrollLeft,t=document.getElementById("materialWrap").scrollWidth,i=document.getElementById("materialWrap").offsetWidth;Math.round(e+i)==t&&(this.decoratePageNum++,console.info("屏幕===="),console.info(this.isShowMyMaterial),this.queryMmaterial(this.styleid))},selectDecorate:function(e,t){if(this.pageAndIndex){var i=this;$("#popTemplate3 .sjky-template li").addClass("on").siblings().removeClass("on"),$("#popTemplate3 .sjky-template li").eq(t).addClass("on");var a,o=this.pageAndIndex.split("_"),s=JSON.parse(localStorage.getItem(this.pageKey.detailJson));if(s.pageList[o[0]].content.itemList[o[1]]&&(a=s.pageList[o[0]].content.itemList[o[1]].isVideo),-1!=e.url.indexOf(B["a"].thumbnailUrl)&&-1!=e.url.indexOf("?token=")){var n=e.url.split("?token=");e.url=n[0]}"undefined"==o[1]||a||1934875331==e.tagid?i.addDecorateImg(e):i.replaceDecorateImg(e)}else this.$layer.alert("请先选择页面再更换版式！")},getMaterialDatil:function(){var e=this;Object(u["v"])().then(function(t){e.decorate=t.data,e.type_id=e.decorate[0].typeid})},getTemplateList:function(e,t){var i=this;e.sku||(e.sku=this.detailJson.sku);var a="";e.id==this.detailJson.templateInfo.id?(a="替换板式查询模板id："+e.id+",页面:"+this.pageAndIndex,this.logMothod("替换板式信息",a)):(console.info("模板id不一致"),e.id=this.detailJson.templateInfo.id,a="替换板式查询模板id："+e.id+"设计串模板id："+this.detailJson.templateInfo.id+",页面:"+this.pageAndIndex,this.logMothod("替换板式信息",a)),Object(u["B"])(e).then(function(e){console.log(e),i.tempList=[],i.tempPhoto=[],i.tempListFoot=[],i.tempListTitle=[];var a=[],o=[];i.pageListInfo=e.data.pageList,i.coverpageList=e.data.coverpageList,i.backcoverpageList=e.data.backcoverpageList;for(var s=0;s<e.data.pageList.length;s++)""!=e.data.pageList[s].previewImagePath&&(e.data.pageList[s].previewImagePath=Object(K["d"])(e.data.pageList[s].previewImagePath)+Object(K["h"])(e.data.pageList[s].previewImagePath,{},i.pageKey)),i.tempListAll.push(e.data.pageList[s]),i.tempPhoto.push(e.data.pageList[s].photoNum),1==e.data.pageList[s].photoNum&&i.tempList.push(e.data.pageList[s]);i.tempPhoto=Array.from(new Set(i.tempPhoto)).sort(function(e,t){return e-t}),localStorage.setItem(i.pageKey.templist,JSON.stringify(i.tempListAll));for(s=0;s<e.data.coverpageList.length;s++)""!=e.data.coverpageList[s].previewImagePath&&(e.data.coverpageList[s].previewImagePath=Object(K["d"])(e.data.coverpageList[s].previewImagePath)+Object(K["h"])(e.data.coverpageList[s].previewImagePath,{},i.pageKey)),a.push(e.data.coverpageList[s]);for(s=0;s<e.data.backcoverpageList.length;s++)""!=e.data.backcoverpageList[s].previewImagePath&&(e.data.backcoverpageList[s].previewImagePath=Object(K["d"])(e.data.backcoverpageList[s].previewImagePath)+Object(K["h"])(e.data.backcoverpageList[s].previewImagePath,{},i.pageKey)),o.push(e.data.backcoverpageList[s]);i.tempListTitle=a,i.tempListFoot=o,i.isPageListLoading=!1,t&&t()})},goEditor:function(e,t,i){try{this.detailJson.pageList.length;if(this.pageClick=!0,t){var a=!1;if(-1!=t.id.indexOf("decrorate_")){var o=t.id.split("_");if(this.detailJson.pageList[Number(o[1])].content.itemList[Number(o[2])]){var s=this.detailJson.pageList[Number(o[1])].content.itemList[Number(o[2])];!o[3]&&0!=o[3]||"selfGroup"!=s.media.mediaType||(s=s.childrenElement[o[3]]),s.cutArea&&s.cutArea.fromAiCut&&(a=!0)}}if(-1!=t.id.indexOf("bgimg_photo_")||-1!=t.id.indexOf("decrorate_")&&a){try{this.handleSpeLetter()}catch(i){console.log(i)}var n;this.isUpdateDom=!0;for(var r=this.detailJson.pageList[e].content.itemList,l=0;l<r.length;l++)if("advancedImageMask"==r[l].media.mediaType||r[l].cutArea&&r[l].cutArea.fromAiCut&&"image"==r[l].media.mediaType||"selfGroup"==r[l].media.mediaType){var d;"advancedImageMask"==r[l].media.mediaType?d=SVG("#maskBg_"+e+"_"+l):r[l].cutArea&&r[l].cutArea.fromAiCut&&(d=SVG("#clip_"+e+"_"+l));var c=document.documentElement.scrollTop||document.body.scrollTop,h=i.clientY+c;if(0==c&&0!=e&&(h=i.clientY+(0-$("#drawing").position().top)),console.log("scrollTop:"+c),console.log("position:"+$("#drawing").position().top),d&&(f=Object(C["c"])(i.pageX,h,d,e,this.detailJson)),f){this.isShow=!0,localStorage.setItem(this.pageKey.ableSelect,!0),this.unSelectAll();var g=l;this.pageAndIndex=e+"_"+g,(n||0==n)&&(this.pageAndIndex=e+"_"+g+"_"+n),console.log("wRatio",this.detailJson.pageList[e].content.itemList[g].wRatio),console.log("hRatio",this.detailJson.pageList[e].content.itemList[g].hRatio),console.log("crop",this.detailJson.pageList[e].content.itemList[g].crop),this.detailJson.pageList[e].content.itemList[g].crop&&(console.log("crop-height",this.detailJson.pageList[e].content.itemList[g].crop.height),console.log("crop-width",this.detailJson.pageList[e].content.itemList[g].crop.width),console.log("crop-x",this.detailJson.pageList[e].content.itemList[g].crop.x),console.log("crop-y",this.detailJson.pageList[e].content.itemList[g].crop.y));break}if("selfGroup"==r[l].media.mediaType){for(var m=!1,p=r[l].childrenElement,u=0;u<p.length;u++){"advancedImageMask"==p[u].media.mediaType&&(d=SVG("#maskBg_"+e+"_"+l+"_"+u),n=u),"image"==p[u].media.mediaType&&p[u].cutArea&&p[u].cutArea.fromAiCut&&(d=SVG("#clip_"+e+"_"+l+"_"+u),n=u);var f=Object(C["c"])(i.pageX,h,d,e,this.detailJson);if(f){this.isShow=!0,localStorage.setItem(this.pageKey.ableSelect,!0),this.unSelectAll();g=l;this.pageAndIndex=e+"_"+g,(n||0==n)&&(this.pageAndIndex=e+"_"+g+"_"+n),m=!0;break}}if(m)break}}}else if(this.pageAndIndex&&-1==this.pageAndIndex.indexOf("undefined")){if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),void(that.showMoreBtn=!0);this.handleSpeLetter();var y=this.pageAndIndex.split("_");this.pageAndIndex=e+"_"+y[1];var _=this.detailJson.pageList[e].content.itemList[y[1]];_&&_.media.mediaType==b["a"].TEXT&&(this.myText=_.media.text)}else this.pageAndIndex=e+"_"+void 0;this.removeClassAll("caledborder");var v="svg_"+e;SVG("#"+v).addClass("caledborder")}}catch(i){console.log(i)}this.pageAndIndex.split("_")[0]!=e&&(this.pageAndIndex=e+"_"+void 0),$(".tcBtn").hide(),$(".tcBtn_"+e).show(),$(".thBtn").hide(),$(".thp").hide(),$(".page-order").css("text-align","center"),$(".tcBtn_"+e).parent().css("text-align","left"),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"mug_cup"!=this.diytype&&"fashion_photo"!=this.diytype&&"template_cloth"!=this.diytype&&-1==this.detailJson.pageList[e].title.indexOf("封面")&&-1==this.detailJson.pageList[e].title.indexOf("封底")&&this.detailJson.pageList[e].hasWarn&&($(".thBtn_"+e).show(),this.tipsCount<2&&($(".thp_"+e).show(),this.tipsCount++)),this.editShowModel(e)},clearTuCengSvg:function(e){var t=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),i=t.pageList[e].content.itemList;for(var a in i)"svg"!=i[a].media.mediaType&&i[a].media.mediaType!=b["a"].SELF_GROUP||$("#tuceng_"+e+"_"+a).empty()},showtucengList:function(e){this.stopMove(),""!=this.pageindex.toString()&&this.clearTuCengSvg(this.pageindex);this.pageindex=e;for(var t=[],i=this.detailJson.pageList[e],a=i.content.itemList,o=0;o<a.length;o++){var s={};if(s=a[o],s.pageIndex=e,1==a[o].visible?s.cla="sjky icon-preview":s.cla="sjky icon-preview2",s.itemIndex=o,s.type=a[o].media.mediaType,a[o].media.mediaType==b["a"].SELF_GROUP){var n={};n.pageIndex=e,n.itemIndex=o,n.item=a[o],n.page=i,n.self=!0,this.handleSvgHeight(s,n)}if(a[o].media.mediaType==b["a"].SVG){n={};n.pageIndex=e,n.itemIndex=o,n.item=a[o],n.page=i,n.self=!0,this.handleSvgHeight(s,n)}if(a[o].media.mediaType==b["a"].TEXT&&(s.text=a[o].media.text,s.type=a[o].media.mediaType),a[o].media.mediaType==b["a"].ADVANCED_IMAGE_MASK){-1==a[o].media.maskSource.indexOf("token")?s.src=a[o].media.maskSource+"?token="+localStorage.getItem(this.pageKey.thumbnailToken):s.src=a[o].media.maskSource,-1!=s.src.indexOf(B["a"].thumbnailUrl)&&(s.src=s.src.replace("commonUpload/",""),-1!=s.src.indexOf("fsferry")&&(s.src=s.src.replace("fsferry/",""))),s.isSimple=a[o].media.isSimple,s.left=0-a[o].location.width,s.factsrc=a[o].media.bgSource,s.type=a[o].media.mediaType;n={};n.pageIndex=e,n.itemIndex=o,n.item=a[o];var r=$("#el_"+e+"_"+o).height();if(null!=r){var l=this.calTuCengMask(n);s.style=l.style,s.simplestyle=l.simplestyle}else this.handleSelHeight(s,n)}if(a[o].media.mediaType==b["a"].IMAGE&&1!=a[o].media.isBG&&1!=a[o].isDisplay)if(a[o].barTypeSign&&1==a[o].barTypeSign);else{var d="";if(-1!=a[o].media.imgPath.indexOf("token")){if(d=a[o].media.imgPath,-1!=d.indexOf("commonUpload/"))if(-1!=d.indexOf("fsferry/")){var c=d.split("fsferry/commonUpload/");d=c[0]+c[1]}else{c=d.split("commonUpload/");d=c[0]+c[1]}}else if(d=a[o].media.imgPath+"?token="+localStorage.getItem(this.pageKey.thumbnailToken),-1!=d.indexOf("commonUpload/"))if(-1!=d.indexOf("fsferry/")){c=d.split("fsferry/commonUpload/");d=c[0]+c[1]}else{c=d.split("commonUpload/");d=c[0]+c[1]}if(s.src=d,s.type=a[o].media.mediaType,a[o].cutArea){n={};n.pageIndex=e,n.itemIndex=o,n.item=a[o];r=$("#el_"+e+"_"+o).height();null!=r?s.style=this.calTuCengClip(n):this.handleCutHeight(s,n)}}(!a[o].mediatag||"baoXianName"!=a[o].mediatag&&"baoXianPhone"!=a[o].mediatag)&&t.push(s)}this.tclist=t},getTipsMessage:function(){this.buttonTipsBu?(this.buttonTips="请仔细检查照片和文字位置在红色安全线以内，减少裁切风险;请调整图片至无白边，框内图片有白边会留白生产哦",this.buttonTipsBu=!1):(this.buttonTips="模糊和遮挡提示仅为页面提示，实际不会印刷哦",this.buttonTipsBu=!0)},editShowModel:function(e){var t=this.detailJson.pageList.length;0==e&&1==this.detailJson.pageList[e].iscover&&(this.showModelInfo=0,this.showInfo=!1,this.showInfoTitle=!0,this.showInfoFoot=!1,this.title="封面"),1!=this.detailJson.pageList[e].iscover&&1!=this.detailJson.pageList[e].isbackcover&&(this.showModelInfo=1,this.showInfo=!0,this.showInfoTitle=!1,this.showInfoFoot=!1),e==t-1&&1==this.detailJson.pageList[e].isbackcover&&(this.showModelInfo=2,this.showInfo=!1,this.showInfoTitle=!1,this.showInfoFoot=!0,this.title="封底")},changetips:function(e){var t=!1;if(0==this.indexArray.length)this.indexArray.push(e);else{for(var i=0;i<this.indexArray.length;i++)if(e==this.indexArray[i]){this.indexArray.splice(i,1),t=!0;break}1==t||this.indexArray.push(e)}if(console.info(e),this.changeDetailJson=this.detailJson,"sjky icon-preview"==this.tclist[e].cla){this.tclist[e].cla="sjky icon-preview2",this.changetipsBleean=!1;var a=this.changeDetailJson.pageList[this.tclist[e].pageIndex].title,o=this.changeDetailJson.pageList[this.tclist[e].pageIndex].content.itemList[this.tclist[e].itemIndex];if(o.media.mediaType==b["a"].ADVANCED_IMAGE_MASK&&this.visibleChangePhoto(0,o,a),o.media.mediaType==b["a"].SELF_GROUP&&o.childrenElement&&o.childrenElement.length>0)for(var s=0;s<o.childrenElement.length;s++)o.childrenElement[s].visible=!1,o.childrenElement[s].tuCengVisible=!1;o.visible=!1,o.tuCengVisible=!1;var n="素材隐藏pageIndex:"+this.tclist[e].pageIndex+"itemIndex:"+this.tclist[e].itemIndex;$("#group"+this.tclist[e].pageIndex+"_"+this.tclist[e].itemIndex).css("display","none"),this.logMothod("图层关闭",n)}else{this.tclist[e].cla="sjky icon-preview",this.changetipsBleean=!0;a=this.changeDetailJson.pageList[this.tclist[e].pageIndex].title,o=this.changeDetailJson.pageList[this.tclist[e].pageIndex].content.itemList[this.tclist[e].itemIndex];if(o.media.mediaType==b["a"].ADVANCED_IMAGE_MASK&&this.visibleChangePhoto(1,o,a),o.media.mediaType==b["a"].SELF_GROUP&&o.childrenElement&&o.childrenElement.length>0)for(s=0;s<o.childrenElement.length;s++)o.childrenElement[s].visible=!0,o.childrenElement[s].tuCengVisible=!0;o.visible=!0,o.tuCengVisible=!0;n="素材开启pageIndex:"+this.tclist[e].pageIndex+"itemIndex:"+this.tclist[e].itemIndex;this.logMothod("图层开启",n),$("#group"+this.tclist[e].pageIndex+"_"+this.tclist[e].itemIndex).css("display","block")}this.changeTuCeng(),$(".tcBtn_"+this.tclist[e].pageIndex)[0].click(),this.handlephotonum()},editopen:function(e){alert("图片索引："+e)},changPhotos:function(){this.photos[0].size[0]=0,this.$store.dispatch("updatePhotos",this.photos),SVG("#ph_0").attr({x:this.photos[0].size[0]}),SVG("#ph_0").load(this.photos[1].img,function(){alert("图片替换成功")},function(){alert("图片下载失败")})},closePanle:function(e){localStorage.setItem(this.pageKey.ableSelect,!1),setTimeout(this.setFalsePane,50);var t=JSON.parse(localStorage.getItem(this.pageKey.detailJson));this.isUpdate=!0,this.isUpdateDom=!0;var i=this.pageAndIndex.split("_"),a="#svg_"+i[0];this.pageAndIndex=i[0]+"_undefined","fashion_photo"==this.diytype&&(t.pageList[i[0]].ratioDiff=!1,localStorage.setItem(this.pageKey.detailJson,JSON.stringify(t))),this.$store.dispatch("updatePages",t);var o=!1,s={detailJson:t,pageId:a,isRepeat:!0,vm:this,isEdit:o,isPhotoChange:e,isChangeModel:!0};SVG(a).remove();var n=localStorage.getItem(this.pageKey.thumbnailToken);Object(K["c"])(n);Object(v["a"])(i[0],s),this.isUpdate=!1,SVG(a).addClass("caledborder"),this.handlephotonum()},ShowChild:function(e){alert(e)},setFalsePane:function(){this.isShow=!1,localStorage.setItem(this.pageKey.ableSelect,!1)},removeClassAll:function(e){for(var t=0;t<this.pageIdArr.length;t++){var i=this.pageIdArr[t];SVG("#"+i)&&SVG("#"+i).removeClass(e)}},testPageSelect:function(){if(!this.pageClick){var e=this,t=document.documentElement.scrollTop||document.body.scrollTop;if(t==se){clearInterval(this.interval),this.interval=null;for(var i=document.getElementById("warn").clientHeight,a=0;a<e.pageLocationArr.length;a++)if(t>=e.pageLocationArr[a]&&t<e.pageLocationArr[a+1]){e.removeClassAll("caledborder");var o=e.pageIdArr[a],s=e.testWholePage(t,a,i);if(s&&(o=e.pageIdArr[s]),!SVG("#"+o))continue;if(1==this.detailJson.templateInfo.coverper&&1==this.detailJson.templateInfo.backcover&&1==this.detailJson.templateInfo.innerper&&"photo"==this.detailJson.diyType&&(0==a&&!this.detailJson.coverInfo.hascover||a==this.detailJson.pageList.length-1&&!this.detailJson.coverInfo.hasbackcover))break;if(this.unSelectAll(),this.myText="",SVG("#"+o).addClass("caledborder"),this.pageAndIndex){var n=this.pageAndIndex.split("_");this.pageAndIndex=s+"_"+n[1]}else this.pageAndIndex=s+"_"+void 0;this.editShowModel(s);break}}else se=document.documentElement.scrollTop||document.body.scrollTop}},testWholePage:function(e,t,i){var a,o,s=this,n=t,r=document.getElementById(s.detailJson.pageList[t].title).clientHeight,l=document.getElementById("bottomBar").clientHeight;a=s.pageLocationArr[t+1]-(e+i)-(s.pageOrderBottomSpace+r);var d=document.getElementById(s.pageIdArr[t+1]).clientHeight,c=window.innerHeight;return o=c-(s.pageLocationArr[t+1]-e)-l,n=a+(s.pageOrderBottomSpace+r)+d<c-i-l?t+1:a>=o?t:t+1,n},changeFormat:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(i,a){var o,s,n,r,l,d,c,h,g,m,p,u,f,y,_,w,b,I,S,x,k,O,L,T,C,P,j,A,N,E,J,D,B,M,$,U,W,F,R,q,G,z,H,V,Y;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i=JSON.parse(JSON.stringify(i)),null!=this.pageAndIndex){t.next=4;break}return this.$layer.alert("请先选择页面再更换版式！"),t.abrupt("return");case 4:if(o=this.pageAndIndex.split("_"),s=o[0],s){t.next=9;break}return this.showMessage("请先选择页面再更换版式！"),t.abrupt("return");case 9:if(this.clearTuCengSvg(s),i){t.next=13;break}return this.alertMessage("更换版式失败！"),t.abrupt("return");case 13:if(n=this.detailJson,r=n.pageList[s].content.itemList,l=n.pageList[s].title,d=[],c=[],h=[],g=[],m=i.content.itemList,p=[],u=i.photoNum,f=n.pageList[s].photoNum,y=Number(u)-Number(f),n.photonum=Number(n.photonum)+y,i.title=l,_="",!n.pageList[s].calendarBack){t.next=31;break}return this.alertMessage("台历背面不能更换版式！"),t.abrupt("return");case 31:try{window._czc&&(w=localStorage.getItem(this.pageKey.orderInfo),null!=w&&void 0!=w&&window._czc.push(["_trackEvent","剪影","页面设计","更换模板内页"]),window._jylog&&window._jylog.push(["按钮点击","设计","模板更换","第"+s+"页发生变化,"+n.pageList[s].photoNum+"->"+i.photoNum,JSON.parse(w).orderNo]))}catch(e){console.log(e)}for(b=m.length-1;b>=0;b--)I=m[b],(I.flipX||I.flipY)&&m.splice(b,1);for(!1,S=0;S<m.length;S++)"advancedImageMask"==m[S].media.mediaType&&(-1==m[S].media.factMaskSource.indexOf(Object(K["d"])(m[S].media.factMaskSource))&&(m[S].media.factMaskSource=Object(K["d"])(m[S].media.factMaskSource)+""+Object(K["a"])(m[S].media.factMaskSource,m[S],this.pageKey)),-1==m[S].media.bgSource.indexOf(Object(K["d"])(m[S].media.bgSource))&&(m[S].media.bgSource=Object(K["d"])(m[S].media.bgSource)+""+Object(K["a"])(m[S].media.bgSource,m[S],this.pageKey)),x=JSON.stringify(m[S]),p.push(JSON.parse(x))),"image"==m[S].media.mediaType&&m[S].cutArea&&1==m[S].cutArea.fromAiCut&&(-1==m[S].media.imgPath.indexOf(Object(K["d"])(m[S].media.imgPath))&&(m[S].media.imgPath=Object(K["d"])(m[S].media.imgPath)+""+Object(K["a"])(m[S].media.imgPath,m[S],this.pageKey)),x=JSON.stringify(m[S]),p.push(JSON.parse(x))),"text"==m[S].media.mediaType&&(m[S].moveable="no",m[S].media.font.textPath||(m[S].changeMove=!0));for(b=0;b<r.length;b++)"advancedImageMask"==r[b].media.mediaType&&(k={},k.maskSource=r[b].media.maskSource,k.visible=r[b].visible,c.push(r[b].media.maskSource),d.push(k)),"image"==r[b].media.mediaType&&r[b].cutArea&&1==r[b].cutArea.fromAiCut&&(k={},k.maskSource=r[b].media.imgPath,k.visible=r[b].visible,c.push(r[b].media.imgPath),d.push(k)),"image"==r[b].media.mediaType&&"yes"==r[b].moveable&&(1==m[m.length-1].isDisplay&&"image"==m[m.length-1].media.mediaType?m.splice(m.length-1,0,r[b]):m.push(r[b])),"text"==r[b].media.mediaType&&"yes"==r[b].moveable&&(1==m[m.length-1].isDisplay&&"image"==m[m.length-1].media.mediaType?m.splice(m.length-1,0,r[b]):m.push(r[b])),1==m[m.length-1].isDisplay&&"image"==m[m.length-1].media.mediaType&&r[b].barTypeSign&&m.splice(m.length-1,0,r[b]),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"mug_cup"!=this.diytype||1!=r[b].isDisplay||m.push(r[b]),"calendar"!=this.diytype&&"year_calendar"!=this.diytype&&"week_calendar"!=this.diytype&&"wall_calendar"!=this.diytype&&"mug_cup"!=this.diytype||1!=r[b].backSign||(_=r[b].media.imgPath);for(O=0;O<p.length;O++)O<=d.length-1?(p[O].media.maskSource=d[O].maskSource,p[O].visible=d[O].visible,h.push(d[O]),g.push(p[O].media.maskSource)):(p[O].media.maskSource="img/nophoto.jpg",p[O].media.defaultState=!0);for(L=0;L<m.length;L++)"advancedImageMask"==m[L].media.mediaType&&(m[L].media.maskSource="img/nophoto.jpg"),"image"==m[L].media.mediaType&&m[L].cutArea&&1==m[L].cutArea.fromAiCut&&(m[L].media.imgPath="img/nophoto.jpg");T=0;case 39:if(!(T<d.length)){t.next=56;break}L=0;case 41:if(!(L<m.length)){t.next=53;break}if("advancedImageMask"!=m[L].media.mediaType||"img/nophoto.jpg"!=m[L].media.maskSource){t.next=46;break}return m[L].media.maskSource=d[T].maskSource,m[L].visible=d[T].visible,t.abrupt("break",53);case 46:if("image"!=m[L].media.mediaType||!m[L].cutArea||1!=m[L].cutArea.fromAiCut||"img/nophoto.jpg"!=m[L].media.imgPath){t.next=50;break}return m[L].media.imgPath=d[T].maskSource,m[L].visible=d[T].visible,t.abrupt("break",53);case 50:L++,t.next=41;break;case 53:T++,t.next=39;break;case 56:if(C=c.filter(function(e){return-1==g.indexOf(e)}),P=localStorage.getItem(this.pageKey.uploadCalenderTemp),null!=P&&""!=P){for(j=JSON.parse(P),L=0;L<C.length;L++)for(T=0;T<j.length;T++)-1!=C[L].indexOf(j[T].src)&&(j[T].titleAll-1==0?(j[T].title="",j[T].isUse=!1):(j[T].titleAll=j[T].titleAll-1,j[T].title=j[T].title.replace(l,"")));localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(j))}S=0;case 60:if(!(S<m.length)){t.next=92;break}if(m[S].backSign&&(m[S].media.imgPath=_),"advancedImageMask"==m[S].media.mediaType&&-1!=m[S].media.maskSource.indexOf("img/nophoto.jpg")&&(m[S].media.defaultState=!0),a){t.next=88;break}if("advancedImageMask"!=m[S].media.mediaType){t.next=86;break}for(L=0;L<r.length;L++)m[S].media.maskSource==r[L].media.maskSource&&(m[S].location.factHeight=r[L].location.factHeight,m[S].location.factWidth=r[L].location.factWidth,m[S].location.maskFactHeight=r[L].location.maskFactHeight,m[S].location.maskFactWidth=r[L].location.maskFactWidth,r[L].photoFacePosition&&(m[S].photoFacePosition=r[L].photoFacePosition),r[L].characterArea&&(m[S].characterArea=r[L].characterArea)),m[S].media.maskSource==r[L].media.imgPath&&"image"==r[L].media.mediaType&&r[L].cutArea&&1==r[L].cutArea.fromAiCut&&(m[S].location.maskFactHeight=r[L].location.factHeight,m[S].location.maskFactWidth=r[L].location.factWidth,r[L].photoFacePosition&&(m[S].photoFacePosition=r[L].photoFacePosition),r[L].characterArea&&(m[S].characterArea=r[L].characterArea));if(A=m[S],N=i,E=Object(K["d"])(A.media.maskSource),J=Object(K["f"])(A.media.maskSource,A).replace(E,""),D=A.location.maskFactWidth,B=A.location.maskFactHeight,U=A.location.width,W=A.location.height,F=U/W,R=D/B,R>=F?($=W,M=W*R):(M=U,$=U/R),a){t.next=86;break}return t.prev=78,t.next=81,this.getAndTestFace(J,D,B,M,$,A,N,S);case 81:t.next=86;break;case 83:t.prev=83,t.t0=t["catch"](78),console.log(t.t0);case 86:t.next=89;break;case 88:if("advancedImageMask"==m[S].media.mediaType||"image"==m[S].media.mediaType&&m[S].cutArea&&1==m[S].cutArea.fromAiCut)for(L=0;L<r.length;L++)"advancedImageMask"==m[S].media.mediaType&&"advancedImageMask"==r[L].media.mediaType&&m[S].media.maskSource==r[L].media.maskSource&&(m[S].location.factHeight=r[L].location.factHeight,m[S].location.factWidth=r[L].location.factWidth,m[S].location.maskFactHeight=r[L].location.maskFactHeight,m[S].location.maskFactWidth=r[L].location.maskFactWidth,r[L].photoFacePosition&&(m[S].photoFacePosition=r[L].photoFacePosition),r[L].characterArea&&(m[S].characterArea=r[L].characterArea)),"image"==m[S].media.mediaType&&m[S].cutArea&&1==m[S].cutArea.fromAiCut&&"advancedImageMask"==r[L].media.mediaType&&m[S].media.imgPath==r[L].media.maskSource&&(m[S].location.factHeight=r[L].location.maskFactHeight,m[S].location.factWidth=r[L].location.maskFactWidth,r[L].photoFacePosition&&(m[S].photoFacePosition=r[L].photoFacePosition),r[L].characterArea&&(m[S].characterArea=r[L].characterArea)),"image"==m[S].media.mediaType&&m[S].cutArea&&1==m[S].cutArea.fromAiCut&&"image"==r[L].media.mediaType&&r[L].cutArea&&1==r[L].cutArea.fromAiCut&&m[S].media.imgPath==r[L].media.imgPath&&(m[S].location.factHeight=r[L].location.factHeight,m[S].location.factWidth=r[L].location.factWidth,r[L].photoFacePosition&&(m[S].photoFacePosition=r[L].photoFacePosition),r[L].characterArea&&(m[S].characterArea=r[L].characterArea)),"advancedImageMask"==m[S].media.mediaType&&"image"==r[L].media.mediaType&&r[L].cutArea&&1==r[L].cutArea.fromAiCut&&m[S].media.maskSource==r[L].media.imgPath&&(m[S].location.maskFactHeight=r[L].location.factHeight,m[S].location.maskFactWidth=r[L].location.factWidth,r[L].photoFacePosition&&(m[S].photoFacePosition=r[L].photoFacePosition),r[L].characterArea&&(m[S].characterArea=r[L].characterArea));case 89:S++,t.next=60;break;case 92:i.content.itemList=m,n.pageList[s].isBeyond&&(i.isBeyond=n.pageList[s].isBeyond),n.pageList[s]=i,"fashion_photo"==this.diytype&&(n.pageList[s].ratioDiff=!1),q=JSON.stringify(n),localStorage.setItem(this.pageKey.detailJson,q),this.$store.dispatch("updatePages",n),this.isUpdate=!1,this.isUpdateDom=!0,G="#svg_"+o[0],z=!1,H=!0,V=!0,Y={detailJson:n,pageId:G,vm:this,isEdit:z,isPhotoChange:H,isChangeModel:V},console.log("rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr3333"),SVG(G).remove(),Object(v["a"])(s,Y),this.pageClick=!0,SVG(G).addClass("caledborder"),this.isShowLoading=!1,this.handlephotonum();case 113:case"end":return t.stop()}},t,this,[[78,83]])}));function i(e,i){return t.apply(this,arguments)}return i}(),getAndTestFace:function(){var e=Object(d["a"])(regeneratorRuntime.mark(function e(t,i,a,o,s,n,r,l){var d=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,o){var s=d;if(n.characterArea&&n.characterArea.areaX){var l=n.characterArea.areaX,c=n.characterArea.areaY,h=n.characterArea.areaW,g=n.characterArea.areaH,m={notable:{x:l,y:c,w:h,h:g},factWidth:i,factHeight:a};s.changeFaceArea(m,n,r),console.log("rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr1"),e(!0)}else{var p=[{src:t,factWidth:i,factHeight:a}];Object(u["S"])(p).then(function(t){if(console.log(t),t.result){var l=t.data[0],d=l.split(","),c=(d[1],d[3],d[2],d[4],{});c.areaX=d[1],c.areaY=d[2],c.areaW=d[3],c.areaH=d[4],n.characterArea=c;var h={notable:{x:d[1],y:d[2],w:d[3],h:d[4]},factWidth:i,factHeight:a};s.changeFaceArea(h,n,r),console.log("rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr12"),e(!0)}else o(!1)}).catch(function(e){o(!1)})}}));case 1:case"end":return e.stop()}},e)}));function t(t,i,a,o,s,n,r,l){return e.apply(this,arguments)}return t}(),hitFaceArea:function(e,t,i,a,o,s,n,r){var l=this,d=e,c=t,h=d+i,g=c+a,m=o.printLocation.x,p=o.printLocation.y,u=m+o.printLocation.width,f=p+o.printLocation.height,y=!1;if(d>=m&&c>=p&&h<=u&&g<=f);else{s.isBeyond=!0;var _=l.pageAndIndex.split("_");l.detailJson.pageList[_[0]].isBeyond=!0,-1!=n&&(l.detailJson.pageList[_[0]].content.itemList[n].isBeyond=!0,o.isBeyond=!0);var v=JSON.stringify(l.detailJson);l.$store.dispatch("updatePages",l.detailJson),localStorage.setItem(l.pageKey.detailJson,v),y=!0}return y},changeFaceArea:function(e,t,i,a){var o=this;if(e.notable){i.hasWarn=!1,t.isBeyond=!1,i.isBeyond=!1,o.diytype=localStorage.getItem(o.pageKey.diytype);var s=Number(e.factWidth),n=Number(e.factHeight),r=t.location.width,l=t.location.height,d=Math.max(r/s,l/n),c=s*d,h=n*d,g={x:e.notable.x*c,y:e.notable.y*h,w:e.notable.w*c,h:e.notable.h*h},m=g.w-r,p=g.h-l;if(console.log(t.media.maskSource),console.log(m+":"+p),m>0){var u=m/g.w;u>.05?(t.isBeyond=!0,i.isBeyond=!0,"wall_calendar"!=o.diytype&&"other_object"!=o.diytype&&"mug_cup"!=o.diytype&&-1==i.title.indexOf("封面")&&-1==i.title.indexOf("封底")&&(i.hasWarn=!0)):delete t.isBeyond}if(p>0){var f=p/g.h;f>.05?(t.isBeyond=!0,i.isBeyond=!0,"wall_calendar"!=o.diytype&&"other_object"!=o.diytype&&"mug_cup"!=o.diytype&&-1==i.title.indexOf("封面")&&-1==i.title.indexOf("封底")&&(i.hasWarn=!0)):delete t.isBeyond}var y=g.x,_=g.y;y+r>c&&(y=c-r),_+l>h&&(_=h-l),console.log(y+"::"+_),y<0&&(y=0),_<0&&(_=0);var v=t.media;if(v.imgX=-y,v.imgY=-_,delete v.autoFill,a){w=JSON.stringify(a);this.$store.dispatch("updatePages",a),localStorage.setItem(this.pageKey.detailJson,w)}else{var w=JSON.stringify(this.detailJson);this.$store.dispatch("updatePages",this.detailJson),localStorage.setItem(this.pageKey.detailJson,w)}return g.x=y/c,g.y=_/h,g.w=r/c,g.h=l/h,g}},createNewItem:function(e,t,i,a){var o,s,n={};n.userPhoto=!0,null!=a&&(n.crop=a);var r=t/i,l=600;r>1?(t<l&&(l=t),o=l,s=l/r):(i<l&&(l=i),o=l*r,s=l);var d={};return d.x=a.x*o,d.y=a.y*s,d.width=a.w*o,d.height=a.h*s,d.noCutWidth=-1,d.fromAiCut=!0,d.maskFactWidth=t,d.maskFactHeight=i,n.cutArea=d,n},loadFont:function(e){var t=e.length,i=function e(i){FontDetect.onFontLoaded(i,function(e){console.log(i+"字体下载成功"),t--,0==t&&console.log("字体全部下载成功")},function(t){e(i)},{msTimeout:3e3})};for(var a in e)i(e[a])},openTextPanel:function(){var e=localStorage.getItem(this.pageKey.editFontGuide);e||(this.editFontGuide=!0),this.drawingPadingBottom=3.5;var t=$(".caledborder").attr("sp");if(("other_object"==this.diytype||"week_calendar"==this.diytype)&&""!=t){var i=parseInt(t);if(i%2!=0)return void this.showMessage("背页不允许添加文字！")}if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),void(that.showMoreBtn=!0);if(!$("#popTemplate2").hasClass("weui-popup__container--visible")){$(window).height(),$(".sjky-design-num").height();$("#popTemplate2").popup(),this.drawingPadingBottom=3.5,localStorage.setItem(this.pageKey.ableSelect,!0);var a=$("#popTemplate2").find(".weui-popup__modal").height();$(".sjky-right-btn").css("bottom",a+10)}if(this.pageAndIndex){var o=this.pageAndIndex.split("_"),s=this.detailJson.pageList[o[0]].content.itemList[o[1]];if(s&&s.media.mediaType==b["a"].TEXT){var n=b["a"].TEXT+"_"+o[0]+"_"+o[1],r=SVG("#"+n);r&&(this.myText=r.text())}}else this.myText=""},changTextFontFamily:function(t){if(this.pageAndIndex){var i=this,a=this.pageAndIndex.split("_"),o=this.detailJson.pageList[a[0]].content.itemList[a[1]];if(o){if(o.media.mediaType!=b["a"].TEXT)return;var s=b["a"].TEXT+"_"+a[0]+"_"+a[1],n=SVG("#"+s);if(n){var r=function(t,a,o){var s=document.getElementById(n.id()).getBBox().width,r=document.getElementById(n.id()).getBBox().height;n.width(s),n.height(r),n.borderControl.updateBorderAndControl(n.borderControl,n);var l=i.allFontInfo,d="",c="";for(var h in l)if(l[h].name==t){d=l[h].id,i.$set(i.allFontInfo[h],"success",!0);break}for(var h in l)if(l[h].id==a.media.font.id){c=l[h].name;break}if(""!=d&&d){try{if(window._jylog){var g=c+"--"+t,m=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","改变字体",g,JSON.parse(m).orderNo])}}catch(e){console.log(e)}a.media.font.id=d,Object(A["a"])(n,a,o,i)}else i.$layer.alert("字体ID设置失败！")};FontDetect.isFontLoaded(t)?(n.font({family:t}),r(t,o,this.detailJson),Object(E["a"])(i,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,i.detailJson,a[0],null,null,null,null,!0)):($("#wenziPan").showLoading(),FontDetect.onFontLoaded(t,function(e){$("#wenziPan").hideLoading(),$.toast("字体下载成功，已成功更换字体"),console.log(t+"字体下载成功"),n.font({family:t}),r(t,o,i.detailJson),Object(E["a"])(i,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,i.detailJson,a[0],null,null,null,null,!0)},function(a){$("#wenziPan").hideLoading(),console.log(t+"字体下载失败");try{if(window._czc){var o=localStorage.getItem(i.pageKey.orderInfo);window._jylog&&window._jylog.push(["弹窗提示","设计","警告","字体下载失败，点击确定重新下载",JSON.parse(o).orderNo])}}catch(e){console.log(e)}layer.alert("字体下载失败，点击确定重新下载",{shadeClose:!1},function(e){i.changTextFontFamily(t),layer.close(e)})},{msTimeout:3e3}))}}else $("#wenziPan").showLoading(),FontDetect.onFontLoaded(t,function(e){$("#wenziPan").hideLoading(),console.log(t+"字体下载成功");var a=i.allFontInfo;for(var o in a)if(a[o].name==t){i.$set(i.allFontInfo[o],"success",!0);break}},function(e){$("#wenziPan").hideLoading(),console.log(t+"字体下载失败"),layer.alert("字体下载失败，点击确定重新下载",{shadeClose:!1},function(e){i.changTextFontFamily(t),layer.close(e)})},{msTimeout:3e3})}},changeTextColor:function(e){if(this.pageAndIndex){var t=this.pageAndIndex.split("_"),i=this.detailJson.pageList[t[0]].content.itemList[t[1]];if(i){if(i.media.mediaType!=b["a"].TEXT)return;var a=b["a"].TEXT+"_"+t[0]+"_"+t[1],o=SVG("#"+a);if(o){o.font({fill:e});var s=Object(j["a"])(e);i.media.font.fontColor=s;var n=JSON.stringify(this.detailJson);localStorage.setItem(this.pageKey.detailJson,n),this.$store.dispatch("updatePages",this.detailJson)}}}},enLargeFontSize:function(){if(this.pageAndIndex){var e=this.pageAndIndex.split("_"),t=this.detailJson.pageList[e[0]].content.itemList[e[1]];if(t){if("no"==t.moveable&&(t.moveable="yes"),t.media.mediaType!=b["a"].TEXT)return;var i=b["a"].TEXT+"_"+e[0]+"_"+e[1],a=SVG("#"+i);if(a){var o=a.font("size"),s=a.font("size")+2;a.font({size:s});var n,r=document.getElementById(i).getBBox().width,l=document.getElementById(i).getBBox().height;2==this.detailJson.templateInfo.coverper&&this.detailJson.coverInfo.hascover&&0==e[0]&&(n=!0);var d=Object(E["a"])(this,a.x(),a.y(),a.transform("rotate"),a.cx(),a.cy(),a,this.detailJson,e[0],!0,r,l,n);d&&(this.$layer.alert("即将超出页面不能放大"),a.font({size:o}),s=o,r=document.getElementById(i).getBBox().width,l=document.getElementById(i).getBBox().height),a.width(r),a.height(l);var c={parent:SVG("#group_"+e[0]+"_"+e[1]),pageIndex:e[0],itemIndex:e[1],hasScaleBtn:!1,vm:this},h=new I["a"](a,t,c);if(h.updateBorderAndControl(h,a),-1!=window.location.href.indexOf("design")){var g=a.y()-a.attr("y");t.media.upLeftToBaseLineY=g}t.media.font.pointSize=s,Object(A["a"])(a,t,this.detailJson,this),Object(Q["b"])(a,t,e[0],e[1])}}}},narrowFontSize:function(){if(this.pageAndIndex){var e=this.pageAndIndex.split("_"),t=this.detailJson.pageList[e[0]].content.itemList[e[1]];if(t){if(t.media.mediaType!=b["a"].TEXT)return;"no"==t.moveable&&(t.moveable="yes");var i=b["a"].TEXT+"_"+e[0]+"_"+e[1],a=SVG("#"+i);if(a){var o=a.font("size")-2;o<=8&&(o=8),a.font({size:o});var s=document.getElementById(i).getBBox().width,n=document.getElementById(i).getBBox().height;a.width(s),a.height(n);var r={parent:SVG("#group_"+e[0]+"_"+e[1]),pageIndex:e[0],itemIndex:e[1],hasScaleBtn:!1,vm:this},l=new I["a"](a,t,r);if(l.updateBorderAndControl(l,a),-1!=window.location.href.indexOf("design")){var d=a.y()-a.attr("y");t.media.upLeftToBaseLineY=d}t.media.font.pointSize=o,Object(A["a"])(a,t,this.detailJson,this),Object(Q["b"])(a,t,e[0],e[1])}}}},clearText:function(){this.myText=""},checkTextWidth:function(e,t,i){document.getElementById(t).getBBox().width;var a=SVG("#"+t),o=this.detailJson.pageList[i].diyWorkAreaWidth/this.detailJson.pageList[i].workAreaWidth,s=J["a"].productBleedSpace,n=(J["a"].productBleedSpace,J["a"].yignkeProductBleedSpace),r=J["a"].rkBleedSpace,l=J["a"].bookSpace,d=J["a"].rkBookSpace;if(this.detailJson.pageList[i].pageBleed&&""!=this.detailJson.pageList[i].pageBleed){var c=this.detailJson.pageList[i].pageBleed;s=Number(c.r),Number(c.t)}this.detailJson.templateInfo.spinewidth&&""!=this.detailJson.templateInfo.spinewidth&&(l=this.detailJson.templateInfo.spinewidth,d=this.detailJson.templateInfo.spinewidth);var h=this.detailJson.pageList[i].content.itemList[0].location.x,g=(this.detailJson.pageList[i].content.itemList[0].location.y,h+s*o);"calendar"==this.diytype||"year_calendar"==this.diytype||"wall_calendar"==this.diytype||this.diytype;var m=this.detailJson.pageList[i].diyDisplayWidth-g-a.x();if("calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype){var p=this.detailJson.pageList[i].content.itemList[0].location.width;m=h+p-s*o-a.x()}if(2==this.detailJson.templateInfo.coverper&&this.detailJson.coverInfo.hascover&&0==i){g=h+n*o;var u=localStorage.getItem(this.pageKey.rk);4==u&&(g=h+r*o),m=this.detailJson.pageList[i].diyDisplayWidth-g-a.x();var f=g,y=(this.detailJson.pageList[i].diyDisplayWidth-2*g-l*o)/2;u=localStorage.getItem(this.pageKey.rk);4==u&&(y=(this.detailJson.pageList[i].diyDisplayWidth-2*g-d*o)/2);var _=g+y,v=this.detailJson.pageList[i].diyDisplayWidth-g-y,w=this.detailJson.pageList[i].diyDisplayWidth-g;a.x()>=f&&a.x()<=_&&(m=_-a.x()),a.x()>=v&&a.x()<=w&&(m=w-a.x())}var b=a.font("size"),I=/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]\u2764/g;e.match(I)&&(e=e.replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\u2764/g,""),this.showMessage("内容含有特殊字符，已删除"));for(var S=e.split(/[(\r\n)\r\n]+/),x=S.length-1;x>=0;x--){var k=/[ \f\t\v]+/g;S[x]=S[x].replace(k," ")," "==S[x]&&S.splice(x,1)}for(var O=parseInt(m/b),L=[],T=0;T<S.length;T++){var C=S[T].split("");if(S[T].length>=O){for(var P=parseInt(S[T].length/O),j=1;j<=P;j++)C.splice(O*j-1,0,"\n");L.push(C.join(""))}else T<S.length-1?L.push(S[T]+"\n"):L.push(S[T])}return L.join("")},showTempModal:function(){},tempModalCheckEnter:function(t,i){try{if("-1"==this.id)return void this.showMessage("空白模板不能替换内页！");if(this.detailJson.templateInfo.timelimited&&1==this.detailJson.templateInfo.timelimited||this.timelimited)return void this.showMessage("时间限定模板不能替换内页！");if(null==this.pageAndIndex)return void this.showMessage("请先选择页面再更换版式！");var a=this.pageAndIndex.split("_"),o=a[0];if($("#div_"+o).hasClass("page-face")&&(1==this.isTeamBook||this.isTeamBook),!o)return void this.showMessage("请先选择页面再更换版式！");localStorage.setItem(this.pageKey.ableSelect,!0);var s="",n="";if(0==this.showModelInfo)if(this.detailJson.pageList[0].iscover){if(s=this.tempListTitle[t],n=s.title,-1==n.indexOf("封面"))return void this.showMessage("封面不能替换成内页！")}else s=this.tempList[t],n=s.title;if(1==this.showModelInfo){if(s=this.tempList[t],n=s.title,-1!=n.indexOf("封面"))return void this.showMessage("内页不能替换成封面！");if(-1!=s.title.indexOf("封底"))return void this.showMessage("内页不能替换成封底！")}if(2==this.showModelInfo&&(s=this.tempListFoot[t],n=s.title,-1==n.indexOf("封底")))return void this.showMessage("封底不能替换成封面或者内页！");i&&(s.hasRepeat=!0),this.changeFormat(s)}catch(e){this.isShowLoading=!1}},tempModalToDeatail:function(){navigator.userAgent.toLowerCase();var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);!this.is_byte||t?this.$router.push({name:"mtemplate",query:{changeModelAll:!0,templateid:this.id,history:this.history,uid:this.$route.query.uid,fromAdmin:this.$route.query.fromAdmin,fromAlipyShopCart:this.$route.query.fromAlipyShopCart,photoBecomBook:this.$route.query.photoBecomBook}}):this.$router.push({name:"mtemplate",query:{changeModelAll:!0,templateid:this.id,history:this.history,sku:this.sku,token:this.token,uid:this.$route.query.uid}})},changeVideo:function(e){this.videosrc=this.guideVideoList[e].src},documentClick:function(e,t){},documentDelegation:function(e,t){if(-1==this.editObjArr.indexOf(t)){var i=[];i=[e,t],this.editObjArr.push(i)}if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),e.myText="",void(e.showMoreBtn=!0)},unSelectAll:function(){for(var e in this.editObjArr){var t=this.editObjArr[e][1],i=this.editObjArr[e][0];t.borderControl.borderAndControlHide(i),i.click=!1}},textAreaFocus:function(e){this.pageClick=!0,localStorage.setItem(this.pageKey.ableSelect,!0),console.log("点点")},toShowGuide:function(){this.showGuide=!0;var e=!0,t=!1,i=void 0;try{for(var a,o=this.guides[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var s=a.value;s.visible=!1}}catch(n){t=!0,i=n}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}this.guides[0].visible=!0},changeText:function(e){if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加文字！",{title:!1}),this.myText="",void(this.showMoreBtn=!0);if(this.pageAndIndex&&-1==this.pageAndIndex.indexOf("undefined")){var t=this.pageAndIndex.split("_"),i=Number(t[0]),a=Number(t[1]),o=this.detailJson.pageList[i].content.itemList[a];if(o.media.mediaType!=b["a"].TEXT)return;"no"==o.moveable&&(o.moveable="yes");var s=b["a"].TEXT+"_"+t[0]+"_"+t[1],n=SVG("#"+s);if(n){if(""==this.myText){n=SVG("#"+s);n.parent().remove(),this.pageAndIndex=t[0]+"_undefined",this.detailJson.pageList[i].content.itemList.splice(a,1);var r=JSON.stringify(this.detailJson);return localStorage.setItem(this.pageKey.detailJson,r),void this.$store.dispatch("updatePages",this.detailJson)}n.text(this.myText);var d=this.checkTextWidth(this.myText,s,t[0]);n.text(d),this.myText=d,Object(Q["a"])(n,o),o.media.text=d;var c=!1;for(var h in this.allFontInfo)o.media.font&&this.allFontInfo[h].id==o.media.font.id&&(c=!0);!c&&o.media.font&&(o.media.font.id=this.allFontInfo[0].id);var g=document.getElementById(s).getBBox().width,m=document.getElementById(s).getBBox().height;n.width(g),n.height(m);var p=Object(E["a"])(this,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,this.detailJson,t[0],null,null,null,null,!0);if(p){g=document.getElementById(s).getBBox().width,m=document.getElementById(s).getBBox().height;n.width(g),n.height(m)}n.borderControl.borderAndControlShow(n.borderControl),n.borderControl.updateBorderAndControl(n.borderControl,n),this.documentDelegation(n.borderControl,n),Object(A["a"])(n,o,this.detailJson,this),Object(Q["b"])(n,o,t[0],t[1])}}else{if(window._jylog){var u=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","添加文字","",JSON.parse(u).orderNo])}t=this.pageAndIndex.split("_");var f=this.detailJson.pageList[t[0]].content.itemList.length,y=(this.detailJson.pageList[t[0]].diyDisplayWidth,this.detailJson.pageList[t[0]].diyDisplayWidth/this.regularW),_=JSON.parse(JSON.stringify(S["a"]));_.media.font.pointSize=_.media.font.pointSize*y,e&&"string"==typeof e&&(_.media.font.gravity=e);var v=JSON.parse(localStorage.getItem(this.pageKey.detailJson));if("template_cloth"==v.diyType){var w=!0,I=!1,x=void 0;try{for(var O,L=v.pageList[t[0]].content.itemList[Symbol.iterator]();!(w=(O=L.next()).done);w=!0){var T=O.value;if(T.isDesignShape){var C=v.pageList[t[0]].diyWorkAreaWidth/v.pageList[t[0]].workAreaWidth;_.location.x=T.location.x,_.printLocation.x=T.location.x,_.location.y=T.location.y,_.printLocation.y=T.location.y;break}}}catch(V){I=!0,x=V}finally{try{w||null==L.return||L.return()}finally{if(I)throw x}}}if("week_calendar"==v.diyType){var P=!0,j=!1,N=void 0;try{for(var D,B=v.pageList[t[0]].content.itemList[Symbol.iterator]();!(P=(D=B.next()).done);P=!0){var K=D.value;if(K.isDesignShape){C=v.pageList[t[0]].diyWorkAreaWidth/v.pageList[t[0]].workAreaWidth;_.location.x=K.location.x+J["a"].banhuaBleedSpace*C+10,_.printLocation.x=K.location.x+J["a"].banhuaBleedSpace*C+10,_.location.y=K.location.y+J["a"].weekTopSpace*C+10,_.printLocation.y=K.location.y+J["a"].weekTopSpace*C+10;break}}}catch(V){j=!0,N=V}finally{try{P||null==B.return||B.return()}finally{if(j)throw N}}}var M=/[\f\t\v]+/g;this.myText=this.myText.replace(M," ");var U=/^[\s]+/;this.myText=this.myText.replace(U,""),_.media.text=this.myText,_.media.font.id=this.allFontInfo[0].id;var W=f;if(v.pageList[t[0]].content.itemList.length==f){var F=v.pageList[t[0]].content.itemList;v.pageList[t[0]].content.itemList[f]=_,F.splice.apply(F,[f-1,1].concat(Object(l["a"])(F.splice(f,1,F[f-1]))));r=JSON.stringify(v);localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",v),this.pageAndIndex=t[0]+"_"+(f-1),W=f-1}else layer.alert("添加文字失败，请刷新页面后重新添加",function(e){layer.close(e)});var R,q=this.detailJson.pageList[t[0]].content.itemList.length-1;if("calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype||this.detailJson.pageList.length<=1&&""!=this.detailJson.pageList[t[0]].content.itemList[q].media.imgPath||"photo"==this.detailJson.diyType&&0==t[0]&&this.detailJson.pageList[t[0]].content.itemList[q].isDisplay&&this.detailJson.coverInfo.hascover&&!this.detailJson.coverInfo.hasbackcover&&1==this.detailJson.templateInfo.coverper&&!this.detailJson.pageList[t[0]].pageBleed&&this.detailJson.pageList[t[0]].content.itemList[q].media.imgPath){var G;SVG("#svg_"+t[0]).children();G=document.getElementById("group"+t[0]+"_"+W),SVG("#group"+t[0]+"_"+W)&&SVG("#group"+t[0]+"_"+W).remove(),G?(G.id="group"+t[0]+"_"+(W+1),G.children[0].id="#decrorate_"+t[0]+"_"+(W+1)):G=document.getElementById("group"+t[0]+"_"+(W+1))}SVG("#group_"+t[0]+"_"+W)?R=SVG("#group_"+t[0]+"_"+W):(R=SVG("#svg_"+t[0]).group(),R.attr({id:"group"+t[0]+"_"+W,style:"overflow:hidden"}));var z={pageIndex:t[0],itemIndex:W,isEdit:!0,vm:this},H=new k["a"](R,_,z);H.initCustomText();s=b["a"].TEXT+"_"+t[0]+"_"+W,n=SVG("#"+s);n.addClass("text_style"),n.text(this.myText);d=this.checkTextWidth(this.myText,s,t[0]);n.text(d),this.myText=d,Object(Q["a"])(n,_),_.media.text=d,v.pageList[t[0]].content.itemList[W].media.text=d;r=JSON.stringify(v);localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",v);g=document.getElementById(s).getBBox().width,m=document.getElementById(s).getBBox().height;n.width(g),n.height(m);p=Object(E["a"])(this,n.x(),n.y(),n.transform("rotate"),n.cx(),n.cy(),n,v,t[0],null,null,null,null,!0);if(p){g=document.getElementById(s).getBBox().width,m=document.getElementById(s).getBBox().height;n.width(g),n.height(m)}n.borderControl.borderAndControlShow(n.borderControl),n.borderControl.updateBorderAndControl(n.borderControl,n),this.documentDelegation(n.borderControl,n),Object(A["a"])(n,_,this.detailJson,this),Object(Q["b"])(n,v.pageList[t[0]].content.itemList[W],t[0],W),"calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype||this.detailJson.pageList.length<=1&&""!=this.detailJson.pageList[t[0]].content.itemList[q].media.imgPath||"photo"==this.detailJson.diyType&&0==t[0]&&this.detailJson.pageList[t[0]].content.itemList[q].isDisplay&&this.detailJson.coverInfo.hascover&&!this.detailJson.coverInfo.hasbackcover&&1==this.detailJson.templateInfo.coverper&&!this.detailJson.pageList[t[0]].pageBleed&&this.detailJson.pageList[t[0]].content.itemList[q].media.imgPath?G&&document.getElementById("svg_"+t[0]).appendChild(G):this.updateBleedLine(t[0],f,v)}},measureText:function(e,t){var i=e.split("\n"),a=i[0];for(var o in i)i[o].length>a.length&&(a=i[o]);var s=a.length*t.font("size");return s},testPhotoMask:function(e,t){for(var i="",a=0;a<e;a++){for(var o=SVG("#svg_"+a).children(),s=!1,n=0;n<o.length;n++){if(o[n].attr("ty")==b["a"].ADVANCED_IMAGE_MASK){for(var r=o[n].id(),l=r.split("_"),d=l[2],c=document.getElementById(r).getAttribute("mask"),h=SVG("#svg_"+d).defs().children(),g=0;g<h.length;g++)if("mask"==h[g].type&&-1!=c.indexOf(h[g].id())){s=!0;break}if(s)break}if(o[n].attr("ty")==b["a"].IMAGE&&t.pageList[a].content.itemList[n].cutArea){r=o[n].id(),l=r.split("_"),d=l[2];var m=getAttribute("clip-path");for(h=SVG("#svg_"+d).defs().children(),g=0;g<h.length;g++)if("clipPath"==h[g].type&&-1!=m.indexOf(h[g].id())){s=!0;break}if(s)break}}s||(0==a?i=t.pageList[a].title+"、":i+=t.pageList[a].title+"、")}return i},checkTextOverLap:function(e,t){for(var i=!1,a=0;a<e.length;a++)if(a!=t){if(i)break;if(e[a].media.mediaType==b["a"].TEXT&&""!=e[a].media.text){var o={left:e[t].printLocation.x,top:e[t].printLocation.y,width:e[t].printLocation.width,height:e[t].printLocation.height},s={left:e[a].printLocation.x,top:e[a].printLocation.y,width:e[a].printLocation.width,height:e[a].printLocation.height};if(i=Object(C["b"])(o,s),i)break}}return i},someCheck:function(){this.isVideoBook=!1,this.isMaskFill=!1,this.isHitShuJi=!1,this.isHitTiaoma=!1,this.isTextOut=!1,this.isBeyond=!1,this.isVideoUuidEmpty=!1,this.isPassMaxVideoNum=!1,this.isSpecailWord=!1,this.textIsHit=!1,this.warnArray=[],this.buttonMode=0,ne=[];var e={isPassCheck:!0,hitTextStr:""},t=localStorage.getItem(this.pageKey.detailJson);if(""!=t&&null!=t&&void 0!=t){this.nowTestNum=0;var i=JSON.parse(t).pageList,a=localStorage.getItem(this.pageKey.tokenDetail);if(a&&""!=a&&null!=a&&void 0!=a){var o=JSON.parse(a);if(o.tradenum&&o.tradenum.content&&o.tradenum.content.name&&o.tradenum.content.phone&&""!=o.tradenum.content.name&&""!=o.tradenum.content.phone){for(var s=i[0],n=s.content.itemList,r=0;r<n.length;r++){var l=n[r];if(l.mediatag&&"baoXianName"==l.mediatag)if(-1!=l.media.text.indexOf(o.tradenum.content.name))console.info("包含不替换名称");else{l.media.text.length;l.media.text="姓名："+o.tradenum.content.name}if(l.mediatag&&"baoXianPhone"==l.mediatag)if(-1!=l.media.text.indexOf(o.tradenum.content.phone))console.info("包含不替换电话");else{l.media.text.length;l.media.text="电话："+o.tradenum.content.phone}n[r]=l}i[0].content.itemList=n}}}if(this.nowTestNum=1,2==JSON.parse(t).templateInfo.coverper&&JSON.parse(t).coverInfo.hascover&&"photo"==JSON.parse(t).diyType){var d=JSON.parse(t).pageList[0].diyWorkAreaWidth/JSON.parse(t).pageList[0].workAreaWidth,c=JSON.parse(t).pageList[0].content.itemList[0].location.x,h=(JSON.parse(t).pageList[0].content.itemList[0].location.y,JSON.parse(t).pageList[0].content.itemList[0].location.width),g=(JSON.parse(t).pageList[0].content.itemList[0].location.height,J["a"].bookSpace),m=J["a"].rkBookSpace,p=J["a"].yignkeProductBleedSpace,u=J["a"].rkBleedSpace;if(JSON.parse(t).pageList[0].pageBleed&&""!=JSON.parse(t).pageList[0].pageBleed){var f=JSON.parse(t).pageList[0].pageBleed;p=Number(f.r),u=Number(f.r)}JSON.parse(t).templateInfo.spinewidth&&""!=JSON.parse(t).templateInfo.spinewidth&&(g=JSON.parse(t).templateInfo.spinewidth,m=JSON.parse(t).templateInfo.spinewidth),JSON.parse(t).templateInfo.spinewidth||JSON.parse(t).pageList[0].pageBleed&&JSON.parse(t).pageList[0].pageBleed.m>2&&(g=JSON.parse(t).pageList[0].pageBleed.m,m=JSON.parse(t).pageList[0].pageBleed.m);var y=g*d,_=h-p*d*2,v=localStorage.getItem(this.pageKey.rk);4==v&&(_=h-u*d*2,y=m*d);var w=c+p*d+_/2-y/2;v=localStorage.getItem(this.pageKey.rk);4==v&&(w=c+u*d+_/2-y/2);var I=0,S=y,x=JSON.parse(t).pageList[0].diyDisplayHeight,k={left:w,top:I,width:S,height:x},O=JSON.parse(t).pageList[0].content.itemList,L=!1;for(var T in O){if(1==this.isPart||"true"==this.isPart)break;if((O[T].media.mediaType==b["a"].TEXT||O[T].media.mediaType==b["a"].IMAGE)&&"yes"==O[T].moveable&&1==O[T].visible){var P={left:O[T].printLocation.x,top:O[T].printLocation.y,width:O[T].printLocation.width,height:O[T].printLocation.height};if(L=Object(C["b"])(P,k),L)break}}L&&(this.isHitShuJi=!0,ne[1]="页码为:"+JSON.parse(t).pageList[0].title+"、的正中间的书脊区域不能放文字及装饰物，请修改！",e.isPassCheck=!1)}this.nowTestNum=2;var j,A,N=JSON.parse(t).pageList.slice(-1)[0],B=N.content.itemList,K=!1;for(var M in B)if(B[M].barTypeSign){j=B[M],A={left:j.printLocation.x,top:j.printLocation.y,width:j.printLocation.width,height:j.printLocation.height};break}for(var T in B){if(1==this.isPart||"true"==this.isPart)break;if((B[T].media.mediaType==b["a"].TEXT||B[T].media.mediaType==b["a"].IMAGE)&&"yes"==B[T].moveable&&1==B[T].visible){P={left:B[T].printLocation.x,top:B[T].printLocation.y,width:B[T].printLocation.width,height:B[T].printLocation.height};if(A&&(K=Object(C["b"])(P,A)),K)break}}K&&(this.isHitTiaoma=!0,ne[2]="页码为:"+N.title+"、的页面上文字或装饰素材与条码重叠，请调整!",e.isPassCheck=!1);var U="",W="",F="";this.nowTestNum=6;for(var R=[],q="",G=JSON.parse(t).pageList,z=JSON.parse(t).isVideo,H="",V=new Array,Y=new Array,X="",Q=(M=0,G.length);M<Q;M++){O=G[M].content.itemList;for(var Z=!1,ee=0;ee<O.length;ee++)1==O[ee].isBeyond&&(Z=!0);G[M].isBeyond&&0==Z&&(G[M].isBeyond=!1),G[M].isBeyond&&(0==M?U=G[M].title+"、":U+=G[M].title+"、");for(var te=!1,ie=!1,ae=!1,oe=!1,se=0,re=(T=0,O.length);T<re;T++){if(O[T].media.mediaType==b["a"].TEXT&&"yes"==O[T].moveable&&""!=O[T].media.text&&1==O[T].visible){ae=this.checkTextOverLap(O,T);var le="text_"+M+"_"+T,de=document.getElementById(le).getBBox().width,ce=document.getElementById(le).getBBox().height,he=SVG("#"+le);if(de>O[T].location.width&&he.width(de),ce>O[T].location.height&&he.height(ce),de>O[T].location.width||ce>O[T].location.height)if(0==he.transform("rotate"))O[T].location.width=he.width(),O[T].location.height=he.height(),O[T].printLocation.width=he.width(),O[T].printLocation.height=he.height();else{var ge=Object(D["b"])(he.x(),he.y(),he.transform("rotate"),he.cx(),he.cy());O[T].location.width=he.width(),O[T].location.height=he.height();var me=Object(D["a"])(ge.x,ge.y,he.width(),he.height(),he.transform("rotate"));O[T].printLocation.width=me.width,O[T].printLocation.height=me.height}O[T].media.text,me={x:O[T].printLocation.x,y:O[T].printLocation.y,width:O[T].printLocation.width,height:O[T].printLocation.height};var pe=Object(E["b"])(me,JSON.parse(t),M,null,this);pe&&(R.push(G[M].title),ie=!0)}z&&(this.isVideoBook=!0,"image"!=O[T].media.mediaType||"yes"!=O[T].moveable||!O[T].isVideo||""!=G[M].videoUuid&&G[M].videoUuid||(oe=!0),!oe&&"image"==O[T].media.mediaType&&"yes"==O[T].moveable&&O[T].isVideo&&se++),"advancedImageMask"==O[T].media.mediaType&&(V.push(O[T].media.maskSource),-1!=O[T].media.maskSource.indexOf("img/nophoto.jpg")&&1==O[T].visible&&(te=!0));var ue=O[T].cutArea;if(null!=ue&&void 0!=ue&&""!=ue&&"image"==O[T].media.mediaType&&1==O[T].cutArea.fromAiCut&&V.push(O[T].media.imgPath),"image"==O[T].media.mediaType&&"yes"==O[T].moveable){var fe={id:O[T].media.materialId,num:1,materialype:0,flag:1};Y.push(fe)}}te&&(0==M?X=i[M].title+"、":X+=i[M].title+"、"),ie&&(0==M?q=G[M].title+"、":q+=G[M].title+"、"),ae&&(0==M?H=G[M].title+"、":H+=G[M].title+"、"),oe&&(0==M?W=G[M].title+"、":W+=G[M].title+"、"),se>1&&(!0,0==M?F=G[M].title+"、":F+=G[M].title+"、")}localStorage.setItem(this.pageKey.photoSize,V.length),localStorage.setItem(this.pageKey.materials,JSON.stringify(Y)),""!=X&&(this.isMaskFill=!0,X="页码为:"+X+"的页面上有相框未填充照片! ",1!=this.isPart&&"true"!=this.isPart||(X="页面上有相框未填充照片! "),ne[0]=X,e.isPassCheck=!1),""!=q&&(this.isTextOut=!0,q="页码为:"+q+"的页面上文字超过红色出血线，生产时将被裁切! 请调整",1!=this.isPart&&"true"!=this.isPart||(q="页面上有文字超过红色出血线，生产时将被裁切! 请调整"),ne[3]=q,e.isPassCheck=!1),""!=U&&(this.isBeyond=!0,U="请检查:"+U+"的页面上重要部位被遮挡的照片！以免造成售后!",1==this.isPart||"true"==this.isPart||"true"==this.isEditCover||1==this.isEditCover?U="":ne[4]=U),""!=W&&(this.isVideoUuidEmpty=!0,W="页码为:"+W+"的页面上二维码与视频匹配失败，请重新上传视频",1!=this.isPart&&"true"!=this.isPart||(W="页面上有二维码与视频匹配失败，请重新上传视频"),ne[5]=W,e.isPassCheck=!1),""!=F&&(this.isPassMaxVideoNum=!0,F="页码为:"+F+"的页面上二维码个数超过限制，请修改",1!=this.isPart&&"true"!=this.isPart||(F="页面上二维码个数超过限制，请修改"),ne[6]=F,e.isPassCheck=!1);var ye=this.testPhotoMask(JSON.parse(t).pageList,JSON.parse(t));""!=ye&&(ye="页码为:"+ye+"的页面上相框遮罩效果失效! 请刷新调整",1!=this.isPart&&"true"!=this.isPart||(ye="页面上有相框遮罩效果失效! 请刷新调整"),ne.push(ye),e.isPassCheck=!1),this.nowTestNum=7;var _e=JSON.parse(t),ve=this,we=!0;return $(".text_style").each(function(e,t){var i=t.id,a=i.substring(i.indexOf("_")+1,i.length),o=a.split("_");if(0==_e.pageList[o[0]].content.itemList[o[1]].visible);else{console.log($(this).text);var s=$(this).text(),n=/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\u2764/g;if(s.match(n)){var r=$(this).parent().parent().attr("sp");we=!1,1==this.isPart||"true"==this.isPart?ne.push("页面文字含有特殊表情字符，请您删除;"):(ve.isSpecailWord=!0,ne[7]="页码为:"+_e.pageList[r].title+"——此页文字含有特殊表情字符，请您删除;")}var l=new RegExp("[^a-zA-Z0-9一-龥@!:'\"`/／,.．;“‘；?？.~、－~～：，/。！...）\\%*$#&￥<>《》+=-（()@-_-\r\n ]");if(l.test(s)){r=$(this).parent().parent().attr("sp");we=!1,1==this.isPart||"true"==this.isPart?ne.push("页面文字含有特殊表情字符，请您删除;"):(ve.isSpecailWord=!0,ne[7]="页码为:"+_e.pageList[r].title+"——此页文字含有特殊字符，请您删除;")}}}),""!=H&&(this.textIsHit=!0,ne[8]="页码为:"+H+"的页面上文字可能重叠，可能产生售后，请调整"),we||(e.isPassCheck=!1),this.nowTestNum=8,e.hitTextStr=H,e.warnArray=ne,this.nowTestNum=9,this.warnArray=ne,this.isMaskFill||this.isHitShuJi||this.isHitTiaoma||this.isTextOut||this.isBeyond||this.isVideoUuidEmpty||this.isPassMaxVideoNum||this.isSpecailWord||this.textIsHit||(this.buttonMode=0),(this.isMaskFill||this.isHitShuJi||this.isHitTiaoma||this.isTextOut||this.isVideoUuidEmpty||this.isPassMaxVideoNum||this.isSpecailWord)&&(this.buttonMode=1),this.isMaskFill||this.isHitShuJi||this.isHitTiaoma||this.isTextOut||this.isVideoUuidEmpty||this.isPassMaxVideoNum||this.isSpecailWord||!this.isBeyond&&!this.textIsHit||(this.buttonMode=2),this.checkMessage="检测完成",e},okFun:function(t){try{if(window._jylog){var i="";i=0==t?"提示弹窗，好的":"弱提示弹窗，忽略";var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计",i,"",JSON.parse(a).orderNo])}}catch(e){console.log(e)}this.isTestProcess=!1,this.wenanText="页面跳转中...",this.isShowLoading=!0,this.isSignleTempleBook?this.showSave():this.toPreview()},toModify:function(t){try{if(window._jylog){var i="";i=0==t?"强提示弹窗，返回修改":"弱提示弹窗，返回修改";var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计",i,"",JSON.parse(a).orderNo])}}catch(e){console.log(e)}this.isTestProcess=!1;for(var o=document.getElementById("warn").clientHeight,s=!1,n=0;n<this.warnArray.length;n++)if(4!=n&&8!=n&&this.warnArray[n]&&""!=this.warnArray[n]){s=!0,this.autoToPage(n,o);break}0==s&&(this.warnArray[4]&&""!=this.warnArray[4]&&this.autoToPage(4,o),this.warnArray[8]&&""!=this.warnArray[8]&&this.autoToPage(8,o))},autoToPage:function(e,t){for(var i=this.warnArray[e].split(":"),a=i[1].split("、"),o=a[0],s=this.detailJson.pageList,n=0;n<s.length;n++)if(s[n].title==o){document.documentElement.scrollTop=this.pageLocationArr[n]-t,document.body.scrollTop=this.pageLocationArr[n]-t;break}this.isShowLoading=!1},toShotCanvasLast:function(){var e=this.detailJson.pageList.length,t="div_"+(e-1),i=document.getElementById(t);if(i)if(this.wenanText="页面跳转中...",this.isShowLoading=!0,"fashion_photo"!=this.diytype){this.isTestProcess=!0;var a=this.someCheck(),o=(a.hitTextStr,a.isPassCheck);if(!o)return}else this.okFun(1);else this.$layer.alert("有页面还未加载完，请稍后再提交")},toPreview:function(t){this.resetOldPosition(),document.body.style.overflow="auto",this.isShowLoading=!1;var i=this;if(i.screenShotCanvas&&i.isCloudTeam)i.savePagePreview();else{try{if(window._jylog){var a=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","预览","",JSON.parse(a).orderNo])}}catch(e){console.log(e)}var o;1==this.$route.query.fromAdmin&&(o=1),localStorage.setItem(this.pageKey.forceRefresh,!0),this.$router.push({name:"preview",query:{id:this.id,p:this.p,uid:this.uid,editType:this.editType,submit:!0,fromDesign:!0,admin:this.admin,history:this.$route.query.history,fromAdmin:o,photoBecomBook:this.$route.query.photoBecomBook}})}},handleSpeLetter:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var i,a,o,s,n,l,d,c,h,g,m;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i=this,!i.pageAndIndex||-1!=i.pageAndIndex.indexOf("undefined")){t.next=37;break}if(a=i.pageAndIndex.split("_"),o=a[0],s=a[1],i.detailJson.pageList[o].content.itemList[s]){t.next=7;break}return t.abrupt("return");case 7:if(i.detailJson.pageList[o].content.itemList[s].media.text){t.next=9;break}return t.abrupt("return");case 9:if(n=i.detailJson.pageList[o].content.itemList[s].media.text,i.detailJson.pageList[o].content.itemList[s].media.mediaType!=b["a"].TEXT||"yes"!=i.detailJson.pageList[o].content.itemList[s].moveable){t.next=37;break}if(t.prev=11,l=localStorage.getItem(i.normalKey.fromAlipyShopPaid),d=localStorage.getItem(i.normalKey.fromAlipyShop),1!=l&&"1"!=l&&1!=d&&"1"!=d){t.next=31;break}return t.next=17,Object(ie["a"])(Object(te["a"])(n,"text"));case 17:if(c=t.sent,h=Object(r["a"])(c,2),h[0],g=h[1],!g.data||"REJECTED"!=g.data.resultAction){t.next=31;break}return layer.alert("文字内容违规!已删除!"),i.myText="",SVG("#text_"+o+"_"+s).text(i.myText),i.detailJson.pageList[o].content.itemList[s].media.text=i.myText,m=JSON.stringify(i.detailJson),localStorage.setItem(i.pageKey.detailJson,m),i.$store.dispatch("updatePages",i.detailJson),i.$layer.closeAll(),t.abrupt("return");case 31:t.next=36;break;case 33:t.prev=33,t.t0=t["catch"](11),console.log(t.t0);case 36:i.checkSpeLetter(n,o,s).then(function(t){var a=t.data;if(a){if(n!=a.newText){i.myText=a.newText,SVG("#text_"+o+"_"+s).text(i.myText),i.detailJson.pageList[o].content.itemList[s].media.text=a.newText;var r=JSON.stringify(i.detailJson);localStorage.setItem(i.pageKey.detailJson,r),i.$store.dispatch("updatePages",i.detailJson),i.$layer.closeAll();var l=navigator.userAgent,d=(navigator.aVersioppn,!!l.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/));if(d){var c=i.detailJson.pageList[o].title;i.$layer.alert(c+" 页面，您输入的特殊字符系统不支持!已删除,请检查该页")}else{c=i.detailJson.pageList[o].title;i.$layer.alert(c+" 页面，您输入的以下字符："+a.speText+"系统不支持!已删除,请检查该页")}}}else{i.$layer.closeAll();try{if(window._jylog){var h=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","装饰上传","特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！"+file.type,JSON.parse(h).orderNo])}}catch(e){}i.$layer.alert("特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！")}}).catch(function(t){i.$layer.closeAll();try{if(window._jylog){var a=localStorage.getItem(i.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","装饰上传",'特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！" + error'+file.type,JSON.parse(a).orderNo])}}catch(e){}i.$layer.alert("特殊字符检测失败！请不要输入繁体字或特殊表情符号，以免生产丢失！"+t)});case 37:case"end":return t.stop()}},t,this,[[11,33]])}));function i(){return t.apply(this,arguments)}return i}(),checkSpeLetter:function(e,t,i){var a={};if(a.text=e,this.detailJson.pageList[t].content.itemList[i].media.font)return a.fontid=this.detailJson.pageList[t].content.itemList[i].media.font.id,new Promise(function(e,t){Object(N["a"])(a).then(function(t){e(t)}).catch(function(e){t(e)})})},ajustPageOrder:function(){this.saveNowDesign(!1,!0),this.resetOldPosition(),this.$router.push({name:"photoOrder",query:{id:this.id,p:this.p,editType:this.editType,uid:this.$route.query.uid,admin:this.admin,isTeamBook:this.isTeamBook,isPart:this.isPart,history:this.history,iscomplete:this.iscomplete,fromAdmin:this.$route.query.fromAdmin,fromAlipyShopCart:this.$route.query.fromAlipyShopCart,photoBecomBook:this.$route.query.photoBecomBook}})},replaceDecorateImg:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰替换","",JSON.parse(i).orderNo])}}catch(e){}var a=this.pageAndIndex.split("_"),o=JSON.parse(localStorage.getItem(this.pageKey.detailJson));o.pageList[a[0]].content.itemList[a[1]].media.imgPath=t.url;o.pageList[a[0]].content.itemList[a[1]];o.pageList[a[0]].content.itemList[a[1]].location.factWidth=t.width,o.pageList[a[0]].content.itemList[a[1]].location.factHeight=t.height,o.pageList[a[0]].content.itemList[a[1]].tagid=t.tagid,this.materialsArray.push(t.id);var s=JSON.stringify(o);localStorage.setItem(this.pageKey.detailJson,s),this.$store.dispatch("updatePages",o),this.isUpdate=!1,this.isUpdateDom=!0;var n="#svg_"+a[0],r=!1,l=!0,d=!0,c={detailJson:o,pageId:n,vm:this,isEdit:r,isPhotoChange:l,isChangeModel:d};SVG(n).remove(),Object(v["a"])(a[0],c),this.pageClick=!0,SVG(n).addClass("caledborder"),this.pageAndIndex=a[0]+"_undefined"},addDecorateImg:function(t){if("poker"==this.diytype&&"div_0"==$("#drawing").find(".caledborder").parent().attr("id"))return layer.alert("扑克牌背面不能添加装饰！",{title:!1}),void(this.showMoreBtn=!0);if(!this.isAdding){this.isAdding=!0;try{var i=t.url,a=t.id,o=t.tagid;this.materialsArray.push(a);var s,n=this.pageAndIndex.split("_"),r=this.detailJson.pageList[n[0]].content.itemList.length,d=this.detailJson.pageList[n[0]].diyDisplayWidth,c=d/this.regularW,h=r,g=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),m=JSON.parse(JSON.stringify(x["a"]));m.location.width=m.location.width*c,m.location.height=m.location.height*c,m.printLocation.width=m.printLocation.width*c,m.printLocation.height=m.printLocation.height*c,m.tagid=o,1934875331==o&&m.location.width<48*c*3&&(m.location.width=m.location.width*c*3,m.location.height=m.location.height*c*3,m.printLocation.width=m.printLocation.width*c*3,m.printLocation.height=m.printLocation.height*c*3);try{if(window._czc){var p=localStorage.getItem(this.pageKey.orderInfo);null!=p&&void 0!=p&&window._czc.push(["_trackEvent","剪影","页面设计","添加装饰"])}if(window._jylog){var u="预设装饰";-1==o&&(u="上传装饰");p=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰添加",u,JSON.parse(p).orderNo])}}catch(e){console.log(e)}i&&(m.media.imgPath=i,m.media.materialId=a,m.location.factWidth=t.width,m.location.factHeight=t.height);var f=J["a"].productBleedSpace,y=J["a"].productBleedSpace;if(g.pageList[n[0]].pageBleed&&""!=g.pageList[n[0]].pageBleed&&(f=Number(g.pageList[n[0]].pageBleed.r),y=Number(g.pageList[n[0]].pageBleed.t)),t.isVideo){if(m.isVideo=!0,"photo"==g.diyType&&g.pageList[n[0]].content.itemList[0].isDesignShape&&(0!=n[0]&&!this.isPart||1==this.isPart||"true"==this.isPart)){var _=g.pageList[n[0]].diyWorkAreaWidth/g.pageList[n[0]].workAreaWidth;m.location.y=g.pageList[n[0]].content.itemList[0].location.height-y*_-m.location.width-10,m.printLocation.y=g.pageList[n[0]].content.itemList[0].printLocation.height-m.printLocation.width-10}if(("calendar"==g.diyType||"year_calendar"==g.diyType||"wall_calendar"==g.diyType||"mug_cup"==this.diytype)&&(0!=n[0]&&!this.isPart||1==this.isPart||"true"==this.isPart)){_=g.pageList[n[0]].diyWorkAreaWidth/g.pageList[n[0]].workAreaWidth;m.location.y=g.pageList[n[0]].diyDisplayHeight-y*_-m.location.width-10,m.printLocation.y=g.pageList[n[0]].diyDisplayHeight-y*_-m.printLocation.width-10}}if("template_cloth"==g.diyType||("photo"==g.diyType||"calendar"==g.diyType||"year_calendar"==g.diyType||"wall_calendar"==g.diyType)&&1934875331==m.tagid){var v=!0,w=!1,b=void 0;try{for(var I,S=g.pageList[n[0]].content.itemList[Symbol.iterator]();!(v=(I=S.next()).done);v=!0){var k=I.value;if(k.isDesignShape){_=g.pageList[n[0]].diyWorkAreaWidth/g.pageList[n[0]].workAreaWidth;if(m.location.x=k.location.x,m.printLocation.x=k.location.x,m.location.y=k.location.y,m.printLocation.y=k.location.y,"photo"==g.diyType){if(2==g.templateInfo.coverper&&g.coverInfo.hascover&&0==n[0]&&g.pageList[n[0]].iscover&&!g.pageList[n[0]].pageBleed){f=J["a"].yignkeProductBleedSpace;var O=localStorage.getItem(this.vm.pageKey.rk);4==O&&(f=J["a"].rkBleedSpace),y=f}m.location.x+=f*_+5,m.printLocation.x+=f*_+5,m.location.y+=y*_+5,m.printLocation.y+=y*_+5}"template_cloth"!=g.diyType&&"photo"!=g.diyType&&("calendar"!=g.diyType&&"year_calendar"!=g.diyType&&"wall_calendar"!=g.diyType||(y=J["a"].calendarUpbleed,f=J["a"].productBleedSpace),m.location.x+=f*_+5,m.printLocation.x+=f*_+5,m.location.y+=y*_+5,m.printLocation.y+=y*_+5);break}}}catch(R){w=!0,b=R}finally{try{v||null==S.return||S.return()}finally{if(w)throw b}}}if("week_calendar"==g.diyType){var L=!0,C=!1,P=void 0;try{for(var j,A=g.pageList[n[0]].content.itemList[Symbol.iterator]();!(L=(j=A.next()).done);L=!0){var N=j.value;if(N.isDesignShape){_=g.pageList[n[0]].diyWorkAreaWidth/g.pageList[n[0]].workAreaWidth;m.location.x=N.location.x+J["a"].banhuaBleedSpace*_+10,m.printLocation.x=N.location.x+J["a"].banhuaBleedSpace*_+10,m.location.y=N.location.y+J["a"].weekTopSpace*_+10,m.printLocation.y=N.location.y+J["a"].weekTopSpace*_+10;break}}}catch(R){C=!0,P=R}finally{try{L||null==A.return||A.return()}finally{if(C)throw P}}}if(g.pageList[n[0]].content.itemList.length==r){g.pageList[n[0]].content.itemList.push(m);var E=g.pageList[n[0]].content.itemList;E.splice.apply(E,[r-1,1].concat(Object(l["a"])(E.splice(r,1,E[r-1]))));var D=JSON.stringify(g);localStorage.setItem(this.pageKey.detailJson,D),this.$store.dispatch("updatePages",g),this.pageAndIndex=n[0]+"_"+(r-1),h=r-1}else layer.alert("添加装饰失败，请刷新页面后重新添加",function(e){layer.close(e)});var B=null,K=this.detailJson.pageList[n[0]].content.itemList.length-1;if("calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype||this.detailJson.pageList.length<=1&&""!=this.detailJson.pageList[n[0]].content.itemList[K].media.imgPath||"photo"==this.detailJson.diyType&&0==n[0]&&this.detailJson.pageList[n[0]].content.itemList[K].isDisplay&&this.detailJson.coverInfo.hascover&&!this.detailJson.coverInfo.hasbackcover&&1==this.detailJson.templateInfo.coverper&&!this.detailJson.pageList[n[0]].pageBleed&&this.detailJson.pageList[n[0]].content.itemList[K].media.imgPath){var M=SVG("#svg_"+n[0]).children();M[M.length-1].remove()}s=SVG("#svg_"+n[0]).group(),s.attr({id:"group"+n[0]+"_"+h,style:"overflow:hidden"}),t.isVideo&&s.attr({videoGroupId:"videoGroup_"+n[0]});n[0];var U=new T["a"](s,m,B,n[0],h,!0,this);if(U.initDecorateImg(),"calendar"==this.diytype||"year_calendar"==this.diytype||"week_calendar"==this.diytype||"wall_calendar"==this.diytype||"mug_cup"==this.diytype||this.detailJson.pageList.length<=1&&""!=this.detailJson.pageList[n[0]].content.itemList[K].media.imgPath||"photo"==this.detailJson.diyType&&0==n[0]&&this.detailJson.pageList[n[0]].content.itemList[K].isDisplay&&this.detailJson.coverInfo.hascover&&!this.detailJson.coverInfo.hasbackcover&&1==this.detailJson.templateInfo.coverper&&!this.detailJson.pageList[n[0]].pageBleed&&this.detailJson.pageList[n[0]].content.itemList[K].media.imgPath)if("photo"!=this.detailJson.diyType||"true"!=this.isTeamBook&&1!=this.isTeamBook){var W=h+1,F=SVG("#svg_"+n[0]).group();F.attr({id:"group"+n[0]+"_"+W,style:"overflow:hidden"});U=new T["a"](F,g.pageList[n[0]].content.itemList[g.pageList[n[0]].content.itemList.length-1],null,n[0],W,!1,this);U.initDecorateImg()}else this.updateBleedLine(n[0],r,g);else this.updateBleedLine(n[0],r,g)}catch(e){console.log(e)}this.isAdding=!1}},updateBleedLine:function(e,t,i){for(var a=SVG("#svg_"+e).children(),o=0;o<a.length;o++){var s=a[o].children();s[0]&&(-1!=s[0].id().indexOf("bleedLine_")&&a[o].remove())}var n,r=SVG("#svg_"+e).group();r.attr({id:"group"+e+"_"+(t+1),style:"overflow:hidden"}),2==i.templateInfo.coverper&&i.coverInfo.hascover&&(n=!0);var l=new P["a"](r,null,e,t+1,i,n,this);l.initBleedLine()},getDoorInfo:function(){var e=this,t=localStorage.getItem(this.pageKey.goodsid);Object(u["R"])(t).then(function(t){if(1==t.result){console.log(t.data),e.baseBoard=t.data,e.has_base_board=!0,localStorage.removeItem(e.pageKey.cal_baseBoard);var i=localStorage.getItem(e.pageKey.productId);e.changeBase(i)}else e.has_base_board=!1})},showPanelMother:function(e,t,i){this.banshiSelectIndex=i,this.styleid=e,this.showPanel=!0,this.dateUrl=Object(K["d"])(t)+t,this.picDataList=this.dateList[i].list},cansel:function(){this.showPanel=!1},changeDate:function(){var e=this,t=localStorage.getItem(this.pageKey.dateStr),i=localStorage.getItem(this.pageKey.designmodel),a="";a="pair"==i?"pair":"single",this.showPanel=!1,Object(u["m"])(this.styleid,t,a).then(function(t){if(t.result&&""!=t.data){for(var i=e.detailJson.pageList,a=0;a<i.length;a++)for(var o=i[a].content.itemList,s=0;s<o.length;s++)a>0&&1==o[s].backSign&&"image"==o[s].media.mediaType&&(o[s].media.imgPath=Object(K["d"])(t.data[a-1].name)+t.data[a-1].name);console.log(JSON.stringify(t)),e.detailJson.pageList=i,$("#drawing").empty(),e.isUpdate=!1,e.pageIdArr=Object(p["c"])("#drawing",e.detailJson,e,null),localStorage.setItem(e.pageKey.detailJson,JSON.stringify(e.detailJson))}})},changeBase:function(e){var t=!1,i="",a=JSON.parse(localStorage.getItem(this.pageKey.detailJson)).pageList;$("#base_"+e).attr("class","modeOn"),$("#base_"+e).siblings().attr("class","");for(var o=0;o<this.baseBoard.length;o++)this.baseBoard[o].proid==e&&(t=!0,i=this.baseBoard[o].bigimg,localStorage.setItem(this.pageKey.cal_baseBoard,JSON.stringify(this.baseBoard[o])),localStorage.setItem(this.pageKey.productId,this.baseBoard[o].proid),this.tailibanSelectIndex=o);t||(i=this.baseBoard[0].bigimg,localStorage.setItem(this.pageKey.cal_baseBoard,JSON.stringify(this.baseBoard[0])),localStorage.setItem(this.pageKey.productId,this.baseBoard[0].proid),this.tailibanSelectIndex=0);for(var s=0;s<a.length;s++)for(var n=a[s].content.itemList,r=n.length-1;r>=0;r--)a[s].content.itemList[r].isDisplay&&(a[s].content.itemList[r].media.imgPath=B["a"].baseUrl+""+i);var l=B["a"].baseUrl+""+i;localStorage.setItem(this.pageKey.cal_bigimg,JSON.stringify(l)),localStorage.setItem(this.pageKey.cal_pageList,JSON.stringify(a)),this.detailJson.pageList=a,$("#drawing").empty(),this.isUpdate=!1,this.pageIdArr=Object(p["c"])("#drawing",this.detailJson,this,null),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(this.detailJson))},initModel:function(e,t){var i,a=this.pageAndIndex.split("_"),o="#svg_"+a[0],s="#group"+a[0]+"_"+a[1],n=!1;this.detailJson;SVG("#edit_svg")?i=SVG("#edit_svg"):(i=SVG().addTo(e),i.attr({id:"edit_svg"}));var r;i.defs();SVG("#edit_group")?r=SVG("#edit_group"):(r=i.group(),r.attr({id:"edit_group",style:"overflow:hidden"}));for(var l=this.detailJson.pageList[this.page_index].content.itemList,d=(l[this.itemIndex].media.imgPath,l[this.itemIndex].media.imgWidth,l[this.itemIndex].media.imgHeight,{loadComplete:!1,imgArr:[]}),c=0;c<l.length;c++){var h=l[c];if("image"==h.media.mediaType)d.imgArr.push(h.media.imgPath);else if("advancedImageMask"==h.media.mediaType){if(d.imgArr.push(h.media.maskSource),c!=this.itemIndex)continue;h.media.isSimple||d.imgArr.push(h.media.factMaskSource),d.imgArr.push(h.media.bgSource);var g={};g.x=h.location.x,g.y=h.location.y,g.w=h.location.width,g.h=h.location.height,i.viewbox(0,0,g.w,g.h)}else"text"==h.media.mediaType&&h.media.font.textPath&&d.imgArr.push(h.media.imgPath);"image"==h.media.mediaType&&"no"==h.moveable&&h.media.isBG}h=l[this.itemIndex];if("advancedImageMask"==h.media.mediaType){var m={pageImgJson:d,parentIndex:this.page_index,childIndex:this.itemIndex,id:"editbgimg_photo_"+this.page_index+"_"+this.itemIndex,isEdit:!0,isPhotoChange:this.isPhotoChange},p=new O["a"](r,h,m,this);p.initMask()}},saveEdit:function(){window._czc&&window._czc.push(["_trackEvent","剪影","页面设计","手动保存设计"]);var e=this.someCheck(),t=e.hitTextStr,i=e.isPassCheck;if(i){var a=this;if(""!=t)t+="的页面上文字有重叠，可能产生售后，请调整",1!=this.isPart&&"true"!=this.isPart||(t="页面上添加的文字有重叠，可能产生售后，请调整"),this.$layer.confirm(t,{btn:["继续提交","返回修改"],cancel:function(e,t){}},function(e){if(a.screenShotCanvas&&a.isCloudTeam)return a.savePagePreview(null,a.savePartPage),void a.$layer.close(e);a.savePartPage(),a.$layer.close(e)},function(e){a.$layer.close(e)});else{if(a.screenShotCanvas&&a.isCloudTeam)return void a.savePagePreview(null,a.savePartPage);a.savePartPage()}}},savePartPage:function(){var e=this;if(this.issave)layer.alert("正在上传，请勿重复提交！");else{0==this.issave&&(this.issave=!0);for(var t=B["a"].baseUrl2,i=localStorage.getItem(this.pageKey.orderInfo),a=(localStorage.getItem(this.pageKey.teamBookUid),localStorage.getItem(this.pageKey.token)),o=localStorage.getItem(this.pageKey.productId),s=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),n=s.pageList,r=0;r<n.length;r++)for(var l=n[r].content.itemList,d=0;d<l.length;d++)if("text"==l[d].media.mediaType&&""!=l[d].media.text&&""!=l[d].media.font.textPath?"yes"==l[d].moveable&&(l[d].moveable="yes"):"image"==l[d].media.mediaType&&0==l[d].media.isBG&&0==l[d].isDisplay||"yes"!=l[d].moveable&&delete l[d].moveable,"advancedImageMask"==l[d].media.mediaType)-1!=l[d].media.maskSource.indexOf(Object(K["d"])(l[d].media.maskSource))&&(l[d].media.maskSource=Object(K["f"])(l[d].media.maskSource,l[d]).replace(Object(K["d"])(l[d].media.maskSource),"")),-1!=l[d].media.factMaskSource.indexOf(Object(K["d"])(l[d].media.factMaskSource))&&(l[d].media.factMaskSource=Object(K["f"])(l[d].media.factMaskSource,l[d]).replace(Object(K["d"])(l[d].media.factMaskSource),"")),-1!=l[d].media.bgSource.indexOf(Object(K["d"])(l[d].media.bgSource))&&(l[d].media.bgSource=Object(K["f"])(l[d].media.bgSource,l[d]).replace(Object(K["d"])(l[d].media.bgSource),"")),-1!=l[d].media.maskSource.indexOf("img/nophoto.jpg")?(console.log("包含nophoto,defaultState=true"),l[d].media.defaultState=!0):(console.log("不包含nophoto,defaultState=false"),l[d].media.defaultState=!1);else if("image"==l[d].media.mediaType)-1!=l[d].media.imgPath.indexOf(Object(K["d"])(l[d].media.imgPath,l[d]))&&(l[d].media.imgPath=l[d].media.imgPath.replace(Object(K["d"])(l[d].media.imgPath,l[d]),"")),-1!=l[d].media.imgPath.indexOf(t)&&(l[d].media.imgPath=l[d].media.imgPath.replace(t,""));else if("text"==l[d].media.mediaType)null!=l[d].media.imgPath&&void 0!=l[d].media.imgPath&&-1!=l[d].media.imgPath.indexOf(t)&&(l[d].media.font.textPath=l[d].media.font.textPath.replace(t,"")),l[d].media.isImage&&-1!=l[d].media.font.textPath.indexOf(t)&&(l[d].media.font.textPath=l[d].media.font.textPath.replace(t,""));else if(l[d].media.mediaType.indexOf("svg")>-1)-1!=l[d].media.imgPath.indexOf(Object(K["d"])(l[d].media.imgPath))&&(l[d].media.imgPath=Object(K["f"])(l[d].media.imgPath,l[d]).replace(Object(K["d"])(l[d].media.imgPath),""));else if(l[d].media.mediaType.indexOf(b["a"].SELF_GROUP)>-1){var c=!0,h=!1,g=void 0;try{for(var m,p=l[d].childrenElement[Symbol.iterator]();!(c=(m=p.next()).done);c=!0){var f=m.value;Object(y["a"])(f)}}catch(w){h=!0,g=w}finally{try{c||null==p.return||p.return()}finally{if(h)throw g}}}var _=localStorage.getItem(R["a"].fold);""!=_&&void 0!=_&&null!=_&&(s.fold=_),""!=i&&void 0!=i&&null!=i&&(s.oderInfo=i);var v={uid:this.uid,designerDetail:s,edittype:2,pid:o,submit:!1,token:a,isPart:this.isPart,loadCover:this.loadCover,isTeamBook:this.isTeamBook};s.previewImage&&(v.previewImage=s.previewImage),console.log("req.previewImage:"+v.previewImage),Object(u["cb"])(v).then(function(t){if(t.result){if(e.iscomplete&&0==e.iscomplete);else for(var i in e.pageKey)localStorage.removeItem(e.pageKey[i]);console.log("云协作保存成功！"),wx.miniProgram.reLaunch({url:"/pages/ground/ground?scene="+e.uid})}else layer.alert("云协作保存失败"),e.issave=!1}).catch(function(t){console.log(t),layer.alert(t),e.issave=!1})}},fileChanged:function(){$("#filelocationDesign").click()},changePhotoSingleDesign:function(){var t=this;try{window._czc&&window._czc.push(["_trackEvent","剪影","页面设计","上传素材照片"])}catch(e){console.log(e)}$("#filelocationDesign")[0].files.length>0&&(this.isShowLoading=!0);var i=localStorage.getItem(this.pageKey.token),a=this;this.warnStr="上传中";try{if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo),s="调用newgetCommonUploadConfig的token===="+i;window._jylog.push(["按钮点击",(getQueryVariable("isSimple"),"老版设计"),"newgetCommonUploadConfig老版设计",s,JSON.parse(o).orderNo])}}catch(e){}Object(u["n"])(i).then(function(o){if(s=t,o.result)if(o.data?localStorage.setItem(s.pageKey.thumbnailToken,o.data.base64Token):layer.alert("getCommonUploadConfig获取base64Token异常,请稍后重试"),o.data.commonUpload)$.each($("#filelocationDesign")[0].files,function(t,n){var r=n.name;if(n.size>41943040)return layer.alert("照片过大！"),void(a.isShowLoading=!1);if(-1==r.indexOf("jpg")&&-1==r.indexOf("jpeg")&&-1==r.indexOf("png")){try{if(window._jylog){var l=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败，格式不正确"+n.type,JSON.parse(l).orderNo])}}catch(e){}return layer.alert("照片格式不正确！"),void(a.isShowLoading=!1)}var d=new FormData;d.append("token",i),d.append("file",n),d.append("upload",B["a"].commonuploadapi+o.data.uploadUrl),d.append("appKey",o.data.appKey),d.append("appSecret",o.data.appSecret),d.append("serverKey",o.data.serverKey),d.append("unionId",o.data.unionId),$.ajax({url:B["a"].commonuploadapi+o.data.uploadUrl,type:"POST",data:d,cache:!1,dataType:"json",contentType:!1,processData:!1,success:function(t){if(t.success&&t.data)s.saveinfoDesign(i,t,n);else{s.alertMessage("上传失败！"),s.isShowLoading=!1;try{if(window._jylog){var a=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败"+n.type,JSON.parse(a).orderNo])}}catch(e){}}},error:function(e){s.alertMessage("上传失败！"),s.isShowLoading=!1;try{if(window._jylog){var t=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败"+n.type,JSON.parse(t).orderNo])}}catch(e){}}})});else{var s=t;$.each($("#filelocationDesign")[0].files,function(t,a){var o=a.name;if(-1==o.indexOf("jpg")&&-1==o.indexOf("jpeg")&&-1==o.indexOf("png")){try{if(window._jylog){var n=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败"+a.type,JSON.parse(n).orderNo])}}catch(e){}return s.alertMessage("照片格式不正确！"),void(s.isShowLoading=!1)}var r=new FormData;r.append("token",i),r.append("file",a),r.append("materialType","ma_u"),$.ajax({url:B["a"].basicUrl+"/upload/photo",type:"POST",data:r,cache:!1,dataType:"json",contentType:!1,processData:!1,success:function(t){var i;s.isShowLoading=!1;var o=t.imageInfo,n={location:{},media:{}};n.location.factWidth=o.width,n.location.factHeight=o.height,n.media.imgPath=t.picname;var r=Object(K["d"])(t.url)+Object(K["a"])(t.url,n,s.pageKey);-1!=r.indexOf(B["a"].thumbnailUrl)&&(r=r.replace("fsferry/",""),r=r.replace("commonUpload/",""));var l=(i={url:Object(K["d"])(t.url)+Object(K["a"])(t.url,n,s.pageKey),src:r},Object(c["a"])(i,"src",t.url),Object(c["a"])(i,"width",o.width),Object(c["a"])(i,"height",o.height),Object(c["a"])(i,"id",t.id),Object(c["a"])(i,"tagid",-1),i);s.decorateList.splice(0,0,l);try{if(window._jylog){var d=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","成功"+a.type,JSON.parse(d).orderNo])}}catch(e){}},error:function(e){layer.alert("上传失败"),s.isShowLoading=!1;try{if(window._jylog){var t=localStorage.getItem(s.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败"+ +a.type,JSON.parse(t).orderNo])}}catch(e){}s.alertMessage("上传失败！")}})})}console.log(o)})},saveinfoDesign:function(t,i,a){var o=this,s={};s.token=t;var n=i.data;s.filename=n.filePath,s.originalName=n.fileName,n.prefix&&(s.prefix=n.prefix),s.ImageInfo={},s.ImageInfo.width=Number(n.width),s.ImageInfo.height=Number(n.height),s.ImageInfo.fileMd5=n.md5,n.dateTime&&(s.ImageInfo.dateTime=n.dateTime),s.lastModifiedDate=a.lastModifiedDate,s.materialType="ma_u",s=JSON.stringify(s),console.log(a),$.ajax({type:"POST",url:B["a"].basicUrl+"/upload/savephotoinfo",data:s,dataType:"json",contentType:"application/json",success:function(t){if("1"==t.r){o.isShowLoading=!1;var i=t.imageInfo,s={location:{},media:{}};s.location.factWidth=i.width,s.location.factHeight=i.height,s.media.imgPath=t.picname;var n=Object(K["d"])(t.url)+Object(K["a"])(t.url,s,o.pageKey);-1!=n.indexOf(B["a"].thumbnailUrl)&&-1==n.indexOf("token")&&(n=n.replace("fsferry/",""),n=n.replace("commonUpload/",""),n=n+"?token="+localStorage.getItem(o.pageKey.thumbnailToken));var r={url:Object(K["d"])(t.url)+Object(K["a"])(t.url,s,o.pageKey),src:n,width:i.width,height:i.height,id:t.id,tagid:-1};o.decorateList.splice(0,0,r);try{if(window._jylog){var l=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","成功，"+a.type,JSON.parse(l).orderNo])}}catch(e){}}else if(o.alertMessage("照片上传失败！"),window._jylog){l=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败，"+a.type,JSON.parse(l).orderNo])}},error:function(e){if(o.alertMessage("照片上传失败！"),window._jylog){var t=localStorage.getItem(o.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","装饰上传","失败，"+a.type,JSON.parse(t).orderNo])}}})},changeModelF:function(e,t){$(e).remove();var i,a=this.pageAndIndex.split("_"),o=a[0],s="#svg_"+a[0],n="#group"+a[0]+"_"+a[1],r=!1;this.detailJson;SVG("#edit_svg")?i=SVG("#edit_svg"):(i=SVG().addTo(e),i.attr({id:"edit_svg"}));var l;i.defs();SVG("#edit_group")?l=SVG("#edit_group"):(l=i.group(),l.attr({id:"edit_group",style:"overflow:hidden"}));for(var d=this.detailJson.pageList[o].content.itemList,c=(d[this.itemIndex].media.imgPath,d[this.itemIndex].media.imgWidth,d[this.itemIndex].media.imgHeight,{loadComplete:!1,imgArr:[]}),h=0;h<d.length;h++){var g=d[h];if(d[m].barTypeSign,"image"==g.media.mediaType)c.imgArr.push(g.media.imgPath);else if("advancedImageMask"==g.media.mediaType){if(c.imgArr.push(g.media.maskSource),h!=this.itemIndex)continue;g.media.isSimple||c.imgArr.push(g.media.factMaskSource),c.imgArr.push(g.media.bgSource);var p={};p.x=g.location.x,p.y=g.location.y,p.w=g.location.width,p.h=g.location.height,i.viewbox(0,0,p.w,p.h)}else"text"==g.media.mediaType&&g.media.font.textPath&&c.imgArr.push(g.media.imgPath);"image"==g.media.mediaType&&"no"==g.moveable&&g.media.isBG}g=d[this.itemIndex];if("advancedImageMask"==g.media.mediaType){var u={pageImgJson:c,parentIndex:this.page_index,childIndex:this.itemIndex,id:"editbgimg_photo_"+this.page_index+"_"+this.itemIndex,isEdit:!0,isPhotoChange:this.isPhotoChange},f=new O["a"](l,g,u,this);f.initMask()}},loadData:function(e){for(var t=[],i=0;i<=this.tempListAll.length-1;i++)this.tempListAll[i].photoNum==e&&t.push(this.tempListAll[i]);this.tempList=t},hideModal:function(){hideConfirm(".modal"),$(".ddel").unbind("click"),setTimeout("$('.modal').css('display','none')",300)},showModal:function(e){$(".modal").css("display","block"),setTimeout("showConfirm('"+e+"')",300)},filteremoji:function(e){var t=["\ud83c[\udf00-\udfff]","\ud83d[\udc00-\ude4f]","\ud83d[\ude80-\udeff]"];return e=e.replace(new RegExp(t.join("|"),"g"),""),e},resetClaendarTemp:function(e,t){console.log("==============flag===============:"+t);var i=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp)),a=[],o=(navigator.userAgent.toLowerCase(),navigator.userAgent),s=!!o.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(this.is_byte&&!s){var n=JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),r=localStorage.getItem(this.pageKey.areadyInsert);!i&&n?i=n:r&&"0"!=r&&(i=i.concat(n))}this.changeModelAll&&(t=0),this.fromOrder&&"1"==this.fromOrder&&(t=1),i||(i=[],console.info("cal======空")),console.log("!!!!!!!!!!"),console.log(i);for(var l=0,d=[],c=0;c<e.pageList.length;c++)for(var h=e.pageList[c],g=0;g<h.content.itemList.length;g++){var m="",p="",u="",f="",y="",_="",v="",w="",b=!0,I="",S="",x=h.content.itemList[g];if(""!=x.cutArea&&null!=x.cutArea&&void 0!=x.cutArea&&1==x.cutArea.fromAiCut&&"image"==x.media.mediaType){-1==x.media.imgPath.indexOf(Object(K["d"])(x.media.imgPath))?(p=x.media.imgPath,u=Object(K["d"])(x.media.imgPath)+Object(K["a"])(x.media.imgPath,x,this.pageKey)):(p=Object(K["f"])(x.media.imgPath,x).replace(Object(K["d"])(x.media.imgPath),""),u=Object(K["d"])(p)+Object(K["a"])(p,x,this.pageKey));for(var k=0;k<i.length;k++)if(-1!=p.indexOf(i[k].url))if(m=i[k].dateTime,y=i[k].height,_=i[k].width,v=i[k].name,f=i[k].id,w=i[k].pixellow,"0"==t)I=h.title,i[k].title=h.title,S=1,i[k].titleAll=1,i[k].isUse=!0;else if("2"==t)if(""!=i[k].title)if(-1!=i[k].title.indexOf(h.title)){for(var O="",L=i[k].title.split(","),T=0;T<L.length;T++)L[T]==h.title||(0==T?O=h.title:O+=","+h.title);I=O,i[k].titleStr,S=L.length-1,i[k].titleAll=L.length-1,i[k].isUse=!0}else{I=i[k].title+","+h.title,i[k].title=i[k].title+","+h.title;L=i[k].title.split(",");S=L.length,i[k].titleAll=L.length,i[k].isUse=!0}else I=h.title,i[k].title=h.title,S=1,i[k].titleAll=1,i[k].isUse=!0;var C={dateTime:m,id:f,name:v,height:y,width:_,index:"l"+l,pixellow:w,isUse:b,title:I,titleAll:S,url:p,src:u};1==x.cutArea.fromAiCut&&"image"==x.media.mediaType&&-1==x.media.imgPath.indexOf("img/nophoto.jpg")&&(""==C.url||(d.push(C),l++))}if("advancedImageMask"==x.media.mediaType&&-1==x.media.maskSource.indexOf("img/nophoto.jpg")){-1==x.media.maskSource.indexOf(Object(K["d"])(x.media.maskSource))?(p=x.media.maskSource,u=Object(K["d"])(x.media.maskSource)+Object(K["a"])(x.media.maskSource,x,this.pageKey)):(u=x.media.maskSource,p=Object(K["f"])(x.media.maskSource,x).replace(Object(K["d"])(x.media.maskSource),""));for(k=0;k<i.length;k++)if(-1!=p.indexOf(i[k].url))if(m=i[k].dateTime,f=i[k].id,y=i[k].height,_=i[k].width,v=i[k].name,w=i[k].pixellow,"0"==t)I=h.title,i[k].title=h.title,S=1,i[k].titleAll=1,i[k].isUse=!0;else if("2"==t)if(""!=i[k].title)if(-1!=i[k].title.indexOf(h.title)){L=i[k].title.split(",");I=h.title,i[k].title=h.title,S=L.length,i[k].titleAll=L.length,i[k].isUse=!0}else{I=i[k].title;L=i[k].title.split(",");S=L.length,i[k].titleAll=L.length,i[k].isUse=!0}else I=h.title,i[k].title=h.title,S=1,i[k].titleAll=1,i[k].isUse=!0;C={dateTime:m,name:v,height:y,width:_,index:"l"+l,pixellow:w,isUse:b,title:I,titleAll:S,url:p,id:f,src:u};""==x.media.maskSource?(x.media.maskSource="img/nophoto.jpg",x.media.imgWidth=x.printLocation.width,x.media.imgHeight=x.printLocation.height):x.media.maskSource=u,"advancedImageMask"==x.media.mediaType&&-1==x.media.maskSource.indexOf("img/nophoto.jpg")&&(""==C.url||(d.push(C),l++))}}for(var P=0;P<i.length;P++)""==i[P].title&&a.push(i[P]);if("0"==t){new Map;var j=localStorage.getItem(this.pageKey.otherCalenderTemp);if(j){var A=JSON.parse(j);d=d.concat(A),localStorage.removeItem(this.pageKey.otherCalenderTemp)}a.length>0&&(d=d.concat(a)),localStorage.setItem(this.pageKey.uploadCalenderTemp,JSON.stringify(d))}this.changeModelAll&&this.handlephotonum()},changeIOS:function(){var e,t;navigator.userAgent;this.isIOS&&(document.body.addEventListener("focusin",function(){e=!0,clearTimeout(t)}),document.body.addEventListener("focusout",function(){e=!1,e||(t=setTimeout(function(){window.scrollTo({top:0,left:0,behavior:"smooth"})},200))}))},sendMessage:function(e){this.stompClient.send("/app/macro",e)},initWebSocket:function(){this.connection()},connection:function(){var e=new H.a("api/stomp");this.stompClient=Y.a.over(e)},connectCallback:function(){var e={uid:this.uid,openid:this.openid,num:localStorage.getItem(this.pageKey.pnum)};this.sendMessage(JSON.stringify(e))},errorCallback:function(e){console.log(e)},getSkuSet:function(){var e=this,t=this,i=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo;i||this.detailJson&&(i=this.detailJson.sku),console.log("sku:"+i),i&&Object(u["l"])({sku:i}).then(function(i){if(console.log(i),i.result){var a=i.data.split(",");t.buttonAuthorization={};var o=!0,s=!1,n=void 0;try{for(var r,l=a[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var d=r.value;t.buttonAuthorization[d]=!0,"竹木纹"==localStorage.getItem(t.pageKey.cal_size)&&(t.buttonAuthorization.baseplatesign=!1),"woodcut"==e.diytype||"other_object"==e.diytype||"mug_cup"==e.diytype||"zaojiao"==e.diytype||"namepaste"==e.diytype||"template_cloth"==e.diytype||"fashion_photo"==e.diytype||e.isSignleTempleBook?(t.buttonAuthorization.templatesign=!1,document.getElementById("more").style.cssText="margin-left:86%;"):document.getElementById("more").style.cssText="margin-left:0;"}}catch(c){s=!0,n=c}finally{try{o||null==l.return||l.return()}finally{if(s)throw n}}console.log(t.buttonAuthorization)}})},copyText:function(e,t){var i=this;this.$copyText(e).then(function(e){console.log(e),$.toast(t,"text")},function(e){i.$toast("复制失败","text")})},addFavorite:function(e,t){document.all?window.external.addFavorite(t,e):window.sidebar?window.sidebar.addPanel(e,t,""):this.copyText(t,"添加收藏失败,已复制到剪切板")},saveNowDesign:function(t,i){var a=this;try{if(this.oldDesignfirst&&localStorage.getItem(this.pageKey.detailJson))this.oldDesign=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),this.oldDesignfirst=!1,console.info("design页面第一次，进入自动保存设计"),console.info("this.oldDesignfirst======"),console.info(this.oldDesignfirst);else if(localStorage.getItem(this.pageKey.detailJson)){if(this.newDesign=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),this.oldDesign=JSON.parse(JSON.stringify(this.oldDesign)),this.oldDesign.datetime="",this.newDesign.datetime="",this.oldDesign.pageList[0].previewImagePath="",this.newDesign.pageList[0].previewImagePath="",delete this.oldDesign.orgTime,delete this.newDesign.orgTime,JSON.stringify(this.oldDesign)==JSON.stringify(this.newDesign))return console.info("design页面设计没有改变，不保存"),this.getTokenAgin(),t.target?void this.alertMessage("已保存"):new Promise(function(e,t){t("notNeedSave")});if(this.uid&&!this.allPageDomComplete){for(var o=!0,s=this.newDesign.pageList,n=this.oldDesign.pageList,r=0;r<s.length;r++)for(var l=s[r].content.itemList,d=n[r].content.itemList,c=0;c<l.length;c++)"image"==l[c].media.mediaType&&-1==l[c].media.imgPath.indexOf(d[c].media.imgPath)&&(o=!1),"advancedImageMask"==l[c].media.mediaType&&-1==l[c].media.maskSource.indexOf(d[c].media.maskSource)&&(o=!1),"svg"==l[c].media.mediaType&&-1==l[c].media.imgPath.indexOf(d[c].media.imgPath)&&(o=!1);if(o)return t.target?void this.alertMessage("已保存"):new Promise(function(e,t){t("notNeedSave")})}console.info("design页面设计有改变，保存"),this.oldDesign=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),console.info("this.oldDesignfirst======"),console.info(this.oldDesignfirst)}}catch(e){console.log(e)}this.wenanText="正在保存...请稍等",this.isShowLoading=!0;var h=localStorage.getItem(this.pageKey.isTeamBook),g=localStorage.getItem(R["f"].fromAlipyShop),m=localStorage.getItem(R["f"].fromAlipyShopPaid);if(1!=h&&"true"!=h){document.title=1==g||1==m?"":"简影";var p=this,f=B["a"].baseUrl2,_=localStorage.getItem(this.pageKey.token),v=JSON.parse(localStorage.getItem(this.pageKey.goodsid)),w=JSON.parse(localStorage.getItem(this.pageKey.productId)),I=JSON.parse(localStorage.getItem(this.pageKey.motherid)),S=JSON.parse(localStorage.getItem(this.pageKey.detailJson));if(!S.orgTime){var x=localStorage.getItem(this.pageKey.orgTime);S.orgTime=x}S.datetime=(new Date).getTime(),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(S));h=localStorage.getItem(this.pageKey.isTeamBook);for(var k=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)),O=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp)),L="",T=0;T<O.length;T++)O[T].id&&(""==L?L=O[T].id.toString():L+=","+O[T].id);S.photoIds=L;var C=S.pageList;console.info("cal_pageList.length=======",C.length);for(var P=0;P<C.length;P++)for(var j=C[P].content.itemList,A=0;A<j.length;A++)if("text"==j[A].media.mediaType&&""!=j[A].media.text&&""!=j[A].media.font.textPath?"yes"==j[A].moveable&&(j[A].moveable="yes"):"image"==j[A].media.mediaType&&0==j[A].media.isBG&&0==j[A].isDisplay||"yes"!=j[A].moveable&&delete j[A].moveable,"advancedImageMask"==j[A].media.mediaType)-1!=j[A].media.maskSource.indexOf(Object(K["d"])(j[A].media.maskSource))&&(j[A].media.maskSource=Object(K["f"])(j[A].media.maskSource,j[A]).replace(Object(K["d"])(j[A].media.maskSource),"")),-1!=j[A].media.factMaskSource.indexOf(Object(K["d"])(j[A].media.factMaskSource))&&(j[A].media.factMaskSource=Object(K["f"])(j[A].media.factMaskSource,j[A]).replace(Object(K["d"])(j[A].media.factMaskSource),"")),-1!=j[A].media.bgSource.indexOf(Object(K["d"])(j[A].media.bgSource))&&(j[A].media.bgSource=Object(K["f"])(j[A].media.bgSource,j[A]).replace(Object(K["d"])(j[A].media.bgSource),"")),-1!=j[A].media.maskSource.indexOf("img/nophoto.jpg")?(console.log("包含nophoto,defaultState=true"),j[A].media.defaultState=!0):(console.log("不包含nophoto,defaultState=false"),j[A].media.defaultState=!1);else if("image"==j[A].media.mediaType)-1!=j[A].media.imgPath.indexOf(Object(K["d"])(j[A].media.imgPath))&&(j[A].media.imgPath=Object(K["f"])(j[A].media.imgPath,j[A]).replace(Object(K["d"])(j[A].media.imgPath),"")),-1!=j[A].media.imgPath.indexOf(f)&&(j[A].media.imgPath=j[A].media.imgPath.replace(f,""));else if("text"==j[A].media.mediaType)null!=j[A].media.imgPath&&void 0!=j[A].media.imgPath&&-1!=j[A].media.imgPath.indexOf(f)&&(j[A].media.font.textPath=j[A].media.font.textPath.replace(f,"")),j[A].media.isImage&&-1!=j[A].media.font.textPath.indexOf(f)&&(j[A].media.font.textPath=j[A].media.font.textPath.replace(f,""));else if(j[A].media.mediaType.indexOf("svg")>-1)-1!=j[A].media.imgPath.indexOf(Object(K["d"])(j[A].media.imgPath))&&(j[A].media.imgPath=Object(K["f"])(j[A].media.imgPath,j[A]).replace(Object(K["d"])(j[A].media.imgPath),""));else if(j[A].media.mediaType.indexOf(b["a"].SELF_GROUP)>-1){var N=!0,E=!1,J=void 0;try{for(var D,M=j[A].childrenElement[Symbol.iterator]();!(N=(D=M.next()).done);N=!0){var U=D.value;Object(y["a"])(U)}}catch(V){E=!0,J=V}finally{try{N||null==M.return||M.return()}finally{if(E)throw J}}}var W,F=localStorage.getItem(this.pageKey.uid),q=localStorage.getItem(this.pageKey.autoSave),G=localStorage.getItem(this.pageKey.fold);""!=G&&void 0!=G&&null!=G&&(S.fold=G),""!=k&&void 0!=k&&null!=k&&(S.oderInfo=k,S.sku=k.productNo),W=q?2:1,console.log("保存 sku==========",k.productNo);var z={};1==W?z={userid:-1,name:"",submit:!1,token:_,edittype:1,gid:v,pid:w,mid:I,designerDetail:S,orderNo:k.orderNo,sku:k.productNo,tid:S.templateInfo.id,pnum:localStorage.getItem(this.pageKey.pnum),photoSize:0,membertype:k.shopName,isTeamBook:h,flag:4}:2==W&&(z={uid:F,designerDetail:S,edittype:2,pid:w,sku:k.productNo,submit:!1,isTeamBook:h});var H=S.pageList[0].previewImagePath;z.previewImage=H,1==this.$route.query.fromAdmin&&(z.token="supervisor");p=this;return new Promise(function(o,s){Object(u["cb"])(z).then(function(n){if(a.isShowLoading=!1,n.result){if(p.hasSave=!0,o("success"),i)return localStorage.setItem(a.pageKey.autoSave,1),void localStorage.setItem(a.pageKey.uid,n.data.uid);var r=localStorage.getItem(a.pageKey.source),l=B["a"].copyUrl+"/design?uid="+n.data.uid+"&history=true";"wsid"==r||"wechat"==r?layer.confirm("保存成功，链接为:"+l,{btn:["取消","复制链接"]},function(e){layer.close(e)},function(e,t){p.copyText(l,"已复制到剪切板")}):($.toast("保存成功"),1==t&&a.editLink&&window.history.go(-1));try{if(window._jylog){var d=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","手动保存",n.data.uid,JSON.parse(d).orderNo])}}catch(e){console.log(e)}localStorage.setItem(a.pageKey.autoSave,1),localStorage.setItem(a.pageKey.uid,n.data.uid)}else{s("fail"),$.toast(n.msg),p.oldDesign=null,p.oldDesignfirst=!0,p.hasSave=null;try{if(window._jylog){d=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","手动保存失败",JSON.stringify(n),JSON.parse(d).orderNo])}}catch(e){console.log(e)}}}).catch(function(t){p.hasSave=null,s("fail"),console.log("saveDiythirdGoods catch error:"+t);try{if(window._jylog){var i=localStorage.getItem(a.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","手动保存",JSON.stringify(t),JSON.parse(i).orderNo])}}catch(e){console.log(e)}console.log(JSON.stringify(t)),t.message?$.toast(t.message):$.toast(":"+JSON.stringify(t))})})}document.title="如琢毕业册"},getDatebarLayoutStylesPicMothed:function(){var e=this,t=localStorage.getItem(this.pageKey.motherid),i=localStorage.getItem(this.pageKey.dateStr);Object(u["p"])(t,i).then(function(t){if(t.result){e.dateList=t.data;for(var i=0;i<e.dateList.length;i++){var a={};a.name=e.dateList[i].list[0].name,a.styleid=e.dateList[i].list[0].styleid,e.datePicList.push(a)}}})},getDetailTextMethod:function(){var e=this;Object(u["s"])(localStorage.getItem(e.pageKey.fold)).then(function(t){if(t.result){if(t.data.length>0){var i=$(".textList")[0];e.detailTextList=t.data;for(var a=i.childNodes,o=a.length-1;o>=0;o--)i.removeChild(a[o]);for(o=0;o<t.data.length;o++){var s=document.createElement("div"),n="textCon textCon_"+o;s.setAttribute("class",n),s.setAttribute("data-tagid",t.data[o].tagid),s.setAttribute("id",t.data[o].id),s.onclick=e.textConClick,s.innerHTML=t.data[o].imageinfo,i.appendChild(s),console.info("9999999====")}}console.info(t.data)}})},changeCurrentPage:function(){var t=this;try{console.log("now changePage"),this.wenanText="正在更换内页...请稍等",this.isShowLoading=!0;var i=this.pageAndIndex.split("_"),a=this.detailJson.pageList[i[0]];try{if(window._jylog){var o=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","改变模板",a.title+":"+i[0],JSON.parse(o).orderNo])}}catch(e){console.log(e)}var s=a.id,n=[],r=!1,l=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp)),d=!0,c=!1,h=void 0;try{for(var g,m=a.content.itemList[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var p=g.value;if("advancedImageMask"==p.media.mediaType){var f=!0,y=!1,_=void 0;try{for(var v,w=l[Symbol.iterator]();!(f=(v=w.next()).done);f=!0){var b=v.value;b.src==p.media.maskSource&&n.push(b)}}catch(N){y=!0,_=N}finally{try{f||null==w.return||w.return()}finally{if(y)throw _}}}else if(p.cutArea&&p.cutArea.fromAiCut&&"image"==p.media.mediaType){var I=!0,S=!1,x=void 0;try{for(var k,O=l[Symbol.iterator]();!(I=(k=O.next()).done);I=!0){var L=k.value;L.src==p.media.imgPath&&n.push(L)}}catch(N){S=!0,x=N}finally{try{I||null==O.return||O.return()}finally{if(S)throw x}}}else p.barTypeSign&&(r=!0)}}catch(N){c=!0,h=N}finally{try{d||null==m.return||m.return()}finally{if(c)throw h}}if(a.hasRepeat&&-1!=this.id){var T=this,C=function(){T.loadData(n.length);for(var e=0,t=0;t<T.tempList.length;t++){var i=T.tempList[t];if(console.log(a.id),console.log(i.id),e++,a.id==i.id)break}console.log(e),T.tempList.length==e&&(e=0),T.tempModalCheckEnter(e,!0)};if(this.isLoadPagelist)C();else{this.isPageListLoading=!0,this.isLoadPagelist=!0;var P={};P.id=this.id,P.mid=this.mid,P.pnum=this.p,P.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,this.getTemplateList(P,C)}return}var j={};j.tid=this.id,j.imgs=n,j.token=this.token,j.gid=localStorage.getItem(this.pageKey.goodsid),j.pid=localStorage.getItem(this.pageKey.productId),j.pnum=this.p,j.edittype=1,j.mid=this.mid,j.sku=JSON.parse(localStorage.getItem(this.pageKey.orderInfo)).productNo,j.pageKey=this.pageKey;var A=localStorage.getItem(this.pageKey.numIndex);A&&null!=A&&(j.startPage=A),"-1"==this.id&&(j.jijian=!0),"0"==this.hassort?j.hassort=!0:j.hassort=!1,j.seconded=this.seconded,this.isTeamBook&&!this.isPart&&(j.loadCover=this.loadCover),Object(u["hb"])(j).then(function(e){console.log(e);var i=JSON.parse(e.data);if(!r){for(var a=-1,o=0;o<i.content.itemList.length;o++){var n=i.content.itemList[o];if(n.barTypeSign){a=o;break}}-1!=a&&i.content.itemList.splice(a,1)}for(o=0;o<i.content.itemList.length;o++){n=i.content.itemList[o];if(void 0==n.moveable&&(n.moveable="no"),"image"==n.media.mediaType){if(""!=n.media.imgPath){if(n.cutArea&&n.cutArea.fromAiCut&&(n.flipX||n.flipY)){layer.alert("数据异常，请更换模板！错误码flip.fromAiCut",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)});break}n.isVideo,-1==n.media.imgPath.indexOf(Object(K["d"])(n.media.imgPath))&&(n.media.imgPath=Object(K["d"])(n.media.imgPath)+""+Object(K["a"])(n.media.imgPath,n,t.pageKey))}}else if("advancedImageMask"==n.media.mediaType){if(n.flipX||n.flipY){layer.alert("模板相框不兼容，错误码flip",{shadeClose:!1,closeBtn:0},function(e){window.history.go(-1)});break}n.media.defaultState=!1,-1==n.media.maskSource.indexOf(Object(K["d"])(n.media.maskSource))&&(n.media.maskSource=Object(K["d"])(n.media.maskSource)+Object(K["a"])(n.media.maskSource,n,t.pageKey)),-1==n.media.factMaskSource.indexOf(Object(K["d"])(n.media.factMaskSource))&&(n.media.factMaskSource=Object(K["d"])(n.media.factMaskSource)+""+Object(K["a"])(n.media.factMaskSource,n,t.pageKey)),-1==n.media.bgSource.indexOf(Object(K["d"])(n.media.bgSource))&&(n.media.bgSource=Object(K["d"])(n.media.bgSource)+""+Object(K["a"])(n.media.bgSource,n,t.pageKey)),-1!=n.media.maskSource.indexOf("img/nophoto.jpg")&&(n.media.maskSource="img/nophoto.jpg",n.media.defaultState=!0)}else"text"==n.media.mediaType?n.media.font.textPath?(-1==n.media.imgPath.indexOf(Object(K["d"])(n.media.imgPath))&&(n.media.font.textPath=B["a"].baseUrl2+""+n.media.font.textPath),n.media.font.textPath&&pageImgJson.imgArr.push(n.media.imgPath)):(n.media.text=n.media.text.replace(/\r\n/g,"\n"),n.media.text=n.media.text.replace(/\r/g,"\n")):n.media.mediaType.indexOf("svg")>-1&&""!=n.media.imgPath&&-1==n.media.imgPath.indexOf(Object(K["d"])(n.media.imgPath))&&(n.media.imgPath=Object(K["d"])(n.media.imgPath)+Object(K["a"])(n.media.imgPath,n,t.pageKey));if(n.media.isBG)n.location.x,n.location.y,n.location.width,n.location.height}null!=i?(i.id==s&&(i.hasRepeat=!0),t.changeFormat(i,!0),t.isShowLoading=!1):(t.alertMessage("生成页面失败"),t.isShowLoading=!1)}).catch(function(e){t.isShowLoading=!1,t.alertMessage("生成页面失败..")})}catch(e){this.isShowLoading=!1}},closeMoelGuide:function(){this.editMoelGuide=!1,localStorage.setItem(this.pageKey.editMoelGuide,!1)},closeMartGuide:function(){this.editMartGuide=!1,localStorage.setItem(this.pageKey.editMartGuide,!1)},closeFontGuide:function(){this.editFontGuide=!1,localStorage.setItem(this.pageKey.editFontGuide,!1)},closeTucengGuide:function(){this.editTucengGuide=!1,localStorage.setItem(this.pageKey.editTucengGuide,!1)},showTextPanel:function(){this.getDetailTextMethod()},textConClick:function(e){console.log(e.currentTarget.getAttribute("data-tagid"));try{if(window._jylog){var t=e.currentTarget.getAttribute("data-tagid"),i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","使用文案库",t,JSON.parse(i).orderNo])}var a=e.currentTarget.getAttribute("id");Object(u["a"])(a).then(function(e){}),window._czc&&window._czc.push(["_trackEvent","剪影","页面设计","使用文案库"])}catch(e){console.log(e)}if(this.myText=e.currentTarget.outerText,console.log(this.pageAndIndex),console.info(e.currentTarget.outerText),$(".close-popup").click(),!$("#popTemplate2").hasClass("weui-popup__container--visible")){$(window).height(),$(".sjky-design-num").height();$("#popTemplate2").popup(),localStorage.setItem(this.pageKey.ableSelect,!0);var o=$("#popTemplate2").find(".weui-popup__modal").height();$(".sjky-right-btn").css("bottom",o+10)}this.textAreaFocus();var s=null;try{s=e.currentTarget.firstElementChild.style.textAlign}catch(e){}this.changeText(s)},alignText:function(e){if(this.pageAndIndex){var t=this.pageAndIndex.split("_"),i=this.detailJson.pageList[t[0]].content.itemList[t[1]];if(i){if(i.media.mediaType!=b["a"].TEXT)return;var a=b["a"].TEXT+"_"+t[0]+"_"+t[1],o=SVG("#"+a);if(o){var s,n,r;if(n=i.printLocation.x+i.printLocation.width/2,r=i.printLocation.y+i.printLocation.height/2,0==i.location.rotation)s=i.location.x,i.location.y;else{var l=i.location.x,d=i.location.y,c=0-i.location.rotation,h=Object(D["b"])(l,d,c,n,r);s=h.x,h.y}var g={left:{name:"start",x:s},center:{name:"middle",x:s+i.location.width/2},right:{name:"end",x:s+i.location.width}};o.attr({style:"text-anchor:"+g[e].name+";",x:g[e].x}),Object(Q["b"])(o,i,t[0],t[1]),i.media.font.gravity=e;var m=JSON.stringify(this.detailJson);localStorage.setItem(this.pageKey.detailJson,m),this.$store.dispatch("updatePages",this.detailJson)}}}},changeShowInfo:function(){this.detailJson.pageList[0].iscover||(this.showInfo=!0,this.showInfoTitle=!1,this.showInfoFoot=!1)},visibleChangePhoto:function(e,t,i){for(var a=JSON.parse(localStorage.getItem(this.pageKey.uploadCalenderTemp)),o=0;o<a.length;o++)if(t.media.maskSource==a[o].src)if(0==e){for(var s="",n=a[o].title.split(","),r=0;r<n.length;r++)n[r]==i||(0==r?s=n[r]:s+=","+n[r]);if(a[o].title=s,""==s)a[o].isUse=!1,a[o].titleAll=0;else{var l=s.split(",");a[o].isUse=!0,a[o].titleAll=l.length}}else""==a[o].title?(a[o].title=i,a[o].isUse=!0,a[o].titleAll=1):(a[o].title=a[o].title+","+i,a[o].isUse=!0,a[o].titleAll=a[o].titleAll+1);localStorage.setItem(this.pageKey.calenderTemp,JSON.stringify(a))},getTokenAgin:function(){var e=this,t=this,i=localStorage.getItem(this.pageKey.tokenDate),a=localStorage.getItem(this.pageKey.token),o=new Date;if(i){var s=o.getTime()-new Date(i),n=Math.floor(s/864e5);if(n>=5){console.log("token大于5天了==="+n);var r={};r.token=a,r.detail=JSON.parse(localStorage.getItem(this.pageKey.tokenDetail)),Object(u["K"])(r).then(function(i){i.result&&(localStorage.setItem(e.pageKey.token,i.token),localStorage.setItem(e.pageKey.tokenDate,Object(f["a"])("yyyy/MM/dd")),Object(u["n"])(i.token).then(function(e){e.result?e.data?localStorage.setItem(t.pageKey.thumbnailToken,e.data.base64Token):layer.alert("getCommonUploadConfig获取base64Token异常,请稍后重试"):layer.alert("getCommonUploadConfig获取base64Token异常")}))})}else{if(a)Object(u["n"])(a).then(function(e){e.result?e.data?localStorage.setItem(t.pageKey.thumbnailToken,e.data.base64Token):layer.alert("getCommonUploadConfig获取base64Token异常,请稍后重试"):layer.alert("getCommonUploadConfig获取base64Token异常")});else{r={};r.token=a,r.detail=JSON.parse(localStorage.getItem(this.pageKey.tokenDetail)),Object(u["K"])(r).then(function(i){i.result&&(localStorage.setItem(e.pageKey.token,i.token),localStorage.setItem(e.pageKey.tokenDate,Object(f["a"])("yyyy/MM/dd")),Object(u["n"])(i.token).then(function(e){e.result?e.data?localStorage.setItem(t.pageKey.thumbnailToken,e.data.base64Token):layer.alert("getCommonUploadConfig获取base64Token异常,请稍后重试"):layer.alert("getCommonUploadConfig获取base64Token异常")}))})}console.log("token小于5天了==="+n)}}},askSave:function(){var e=Object(d["a"])(regeneratorRuntime.mark(function e(t){var i,a,o,s,n,l,d,c,h,g,m,p,u,f,y,_,v,w,b,I,S,x;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=this,console.log(t),console.log("===================================================================================="),document.body.style.position="absolute",this.$layer.closeAll(),this.isShowLoading=!0,{detailJson:this.detailJson,pageId:"#svg_0",vm:this,isEdit:!1,isPhotoChange:!1,isChangeModel:!0},this.isShowLoading=!0,a.isShowLoading=!1,clearInterval(a.screenShotInterval),a.screenShotInterval=null,console.log("----------clearInterval(that.screenShotInterval)--------------"),e.next=14,Object(ie["a"])(a.saveNowDesign(!0));case 14:if(o=e.sent,s=Object(r["a"])(o,2),n=s[0],s[1],"notNeedSave"==n?(i=n,console.log(n)):i=1,!a.source||"wsid"!=a.source){e.next=22;break}return console.info("独立链接，回退到本页面"),e.abrupt("return");case 22:l="",a.detailJson.oderInfo&&(l=-1!=a.detailJson.oderInfo.url.indexOf("mtemplate")?a.detailJson.oderInfo.url.replace("mtemplate","drafts"):a.detailJson.oderInfo.url.replace("loading","drafts"),d=a.getUrlKey(l,"token"),c="token="+d,h="token="+a.token+"&fromDesign="+!0,console.info("aaaaaaaaaaaaaaaaaaaaaaaa==============="+d),l=l.replace(c,h),-1!=window.location.href.indexOf("https")&&-1!=l.indexOf("http://")&&-1==l.indexOf("http://sjky")&&(g=l.split("http"),2==g.length?l="https"+g[1]:3==g.length&&(l="https"+g[1]+"https"+g[2])),-1!=window.location.href.indexOf("https")&&-1!=l.indexOf("http://sjky")&&(g=l.split("http://sjky"),l="https://tt"+g[1]),"/drafts"==a.fromPage&&a.is_alipay&&i&&"notNeedSave"!=i||(localStorage.getItem(R["f"].isMiniProgram),("is_alipay"==a.designsorce||"is_byte"==a.designsorce&&!a.uid||!a.uid||"notNeedSave"===i&&a.uid)&&(m=a.getUrlKey(l,"sku"),p=a.getUrlKey(l,"flagURL"),u=a.getUrlKey(l,"orderNo"),f=a.getUrlKey(l,"memberid"),y=a.getUrlKey(l,"returnURL"),_=a.getUrlKey(l,"id"),v=a.getUrlKey(l,"num"),w=a.getUrlKey(l,"spmc"),b=a.getUrlKey(l,"token"),I="fromDesign",S=a.getUrlKey(l,"hasDraft"),x=a.getUrlKey(l,"source"),a.$router.push({name:"drafts",query:{sku:m,flagURL:p,orderNo:u,memberid:f,returnURL:y,id:_,num:v,spmc:w,token:b,fromDesign:I,hasDraft:S,source:x}})),"is_byte"==a.designsorce&&a.uid&&(location.href=l))),console.log("创建this.screenShotInterval="+this.screenShotInterval);case 25:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),colseTuCeng:function(e){this.openMove(),0==e?(this.showTuceng=!1,this.logMothod("图层取消修改",this.pageAndIndex)):(this.showTuceng=!1,this.logMothod("确定图层修改",this.pageAndIndex))},changeTuCeng:function(){this.indexArray.length<=0?(console.info("图层确认修改"),this.showTuceng=!1,this.logMothod("图层确认修改",this.pageAndIndex)):this.handleDisplay(0)},handleDisplay:function(e){var t=JSON.stringify(this.changeDetailJson);localStorage.setItem(this.pageKey.detailJson,t),localStorage.setItem(this.pageKey.ableSelect,!1),setTimeout(this.setFalsePane,50),this.isUpdate=!0,this.isUpdateDom=!0;var i=this.pageAndIndex.split("_");i[0];this.pageAndIndex=i[0]+"_undefined","fashion_photo"==this.diytype&&(this.changeDetailJson.pageList[i[0]].ratioDiff=!1,localStorage.setItem(this.pageKey.detailJson,JSON.stringify(this.changeDetailJson))),this.$store.dispatch("updatePages",this.changeDetailJson),this.showTuceng=!1,this.logMothod("图层确认修改",this.pageAndIndex),this.indexArray=[]},logMothod:function(t,i){try{if(window._czc){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog&&window._jylog.push(["按钮点击","设计",t,i,JSON.parse(a).orderNo])}}catch(e){console.log(e)}},logFrom:function(e){var t=this,i=navigator.userAgent.toLowerCase();if("micromessenger"==i.match(/MicroMessenger/i)){var a=localStorage.getItem(R["f"].isMiniProgram);wx.miniProgram.getEnv(function(i){console.log(i),i.miniprogram||a?t.commonLog(e,"微信小程序"):t.commonLog(e,"微信")})}else this.commonLog(e)},commonLog:function(t,i){this.source=localStorage.getItem(this.pageKey.source),null==i&&(i=this.is_alipay?"支付宝":"网页"),this.source?"wsid"==this.source?i+="-独立链接":"fxxt"==this.source?i+="-分销系统":"wechat"==this.source?i+="-微商城":"thrid"==this.source?i+="-三方":"guochao"==this.source?i+="-国潮":i=i+"-"+this.source:i+="-淘宝订单";try{if(window._jylog){var a=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["页面记录","设计",t,i,JSON.parse(a).orderNo]),startUploadLog()}}catch(e){console.log(e)}},displayEle:function(e,t){if(console.info("图层删除"),this.showTuceng=!1,this.logMothod("图层删除",this.pageAndIndex),this.changeDetailJson=this.detailJson,this.changeDetailJson.pageList[e].content.itemList.splice(t,1),this.handleDisplay(1),this.pageindex!=e){var i=this.detailJson.pageList[this.pageindex].content.itemList;for(var a in i)"svg"!=i[a].media.mediaType&&i[a].media.mediaType!=b["a"].SELF_GROUP||$("#tuceng_"+this.pageindex+"_"+a).empty()}$(".tcBtn_"+e)[0].click()},elementFlash:function(e){var t=this.detailJson.pageList[e];console.log(this.detailJson.pageList[e]);for(var i=0;i<t.content.itemList.length;i++){var a=!1,o=t.content.itemList[i];if(o.media.mediaType==b["a"].IMAGE?("yes"==o.moveable&&(a=!0),o.cutArea&&o.cutArea.fromAiCut&&(a=!0)):o.media.mediaType==b["a"].TEXT?"yes"!=o.moveable&&1!=o.changeMove||(a=!0):o.media.mediaType==b["a"].ADVANCED_IMAGE_MASK&&(a=!0),a){var s=SVG("#group"+e+"_"+i);SVG("#group"+e+"_"+i).addClass("flash-element"),function(e){setTimeout(function(){e.removeClass("flash-element")},500)}(s)}}},calTuCengClip:function(e){var t="",i=e.item,a=e.pageIndex,o=e.itemIndex,s=SVG("#decrorate_"+a+"_"+o).attr("bigFactWidth"),n=SVG("#decrorate_"+a+"_"+o).attr("bigFactHeight");if(s&&n){var r=i.cutArea.width/s,l=i.cutArea.height/n,d=i.location.width/r,c=i.location.height/l,h=d/s,g=c/n,m=(i.location.width,i.location.height,$("#el_"+a+"_"+o).height());if(null!=m){var p=m/c,u=i.cutArea.x*h*p,f=i.cutArea.y*g*p,y=d*p-u-i.cutArea.width*h*p,_=c*p-f-i.cutArea.height*g*p;t="-webkit-clip-path: inset("+f+"px "+y+"px "+_+"px "+u+"px );"}return t}},handleCutHeight:function(){var e=Object(d["a"])(regeneratorRuntime.mark(function e(t,i){var a,o,s,n,r,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a="",o=this,i.item,s=i.pageIndex,n=i.itemIndex,r=!1;case 6:if(r){e.next=18;break}if(l=$("#el_"+s+"_"+n).height(),null==l){e.next=14;break}a=o.calTuCengClip(i),o.$set(o.tclist[n],"style",a),r=!0,e.next=16;break;case 14:return e.next=16,o.sleep(1e3);case 16:e.next=6;break;case 18:case"end":return e.stop()}},e,this)}));function t(t,i){return e.apply(this,arguments)}return t}(),insertPhotoDetail:function(e){var t=localStorage.getItem(this.pageKey.calenderTemp),i=e.photonum,a=this;if(null!=t&&""!=t&&void 0!=t){var o=JSON.parse(t);if(o.length>0){for(var s,n=[],r=0;r<o.length;r++){a.insertphoto=!1;for(var l=e.pageList,d=0;d<l.length;d++){for(var h=l[d],g=l[d].content.itemList,m=0;m<g.length;m++)if("advancedImageMask"==g[m].media.mediaType&&"img/nophoto.jpg"==g[m].media.maskSource&&1==g[m].visible){g[m].location.maskFactWidth=o[r].width,g[m].location.maskFactHeight=o[r].height;var u=o[r].width,f=o[r].height;g[m].media.maskSource=o[r].url;var y=Object(ee["a"])(u,f,g[m].location.width,g[m].location.height);y.imgWidth&&(g[m].media.imgWidth=y.imgWidth,g[m].media.imgHeight=y.imgHeight),n.push({src:o[r].url,factWidth:u,factHeight:f,pageIndex:d,itemIndex:m,calenderTempIndex:r}),a.insertphoto=!0;break}if(a.insertphoto)break}}console.log(n),$.ajax((s={url:B["a"].basicUrl+"/member/getextract",type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"},Object(c["a"])(s,"type","POST"),Object(c["a"])(s,"async",!1),Object(c["a"])(s,"success",function(t){if(t.result){if(console.info("=====res======"),console.log(t),t.result)for(var o=0;o<t.data.length;o++){var s=t.data[o],r=s.split(","),l=(r[1],r[3],r[2],r[4],{});l.areaX=r[1],l.areaY=r[2],l.areaW=r[3],l.areaH=r[4];var d=n[o].pageIndex,c=n[o].itemIndex;e.pageList[d].content.itemList[c].characterArea=l;var g=n[o].factWidth,m=n[o].factHeight,p={notable:{x:r[1],y:r[2],w:r[3],h:r[4]},factWidth:g,factHeight:m};a.changeFaceArea(p,e.pageList[d].content.itemList[c],h,e)}var u=localStorage.getItem(a.pageKey.uploadCalenderTemp);if(u){var f=JSON.parse(u);f.length>=i&&(a.iscomplete=!0)}}}),Object(c["a"])(s,"error",function(t){if(a.iscomplete&&0==a.iscomplete)for(var i=0;i<n.length;i++){var s=n[i].pageIndex,r=n[i].itemIndex,l=n[i].calenderTempIndex;e.pageList[s].content.itemList[r].media.imgHeight=o[l].height,e.pageList[s].content.itemList[r].media.imgWidth=o[l].width,e.pageList[s].content.itemList[r].media.originalImgHeight=o[l].height,e.pageList[s].content.itemList[r].media.originalImgWidth=o[l].width}}),s))}}a.$store.dispatch("updatePages",e),a.isUpdate=!0,localStorage.setItem(a.pageKey.detailJson,JSON.stringify(e)),localStorage.setItem(a.pageKey.areadyInsert,"0"),$("#drawing").empty(),this.isUpdate=!1,a.pageIdArr=Object(p["c"])("#drawing",e,a,null),a.handlephotonum()},calTuCengMask:function(e){var t=e.item,i=e.pageIndex,a=e.itemIndex,o=(t.media.imgWidth,t.media.zoom,t.media.imgHeight*(1+t.media.zoom/10)),s=t.media.imgX,n=t.media.imgY,r=t.location.width,l=t.location.height,d=$("#el_"+i+"_"+a).height();if(null!=d){var c=d/o,h=r*c,g=l*c,m=-s*c,p=-n*c,u="";u=-1!=t.media.factMaskSource.indexOf("tokien")?t.media.factMaskSource:t.media.factMaskSource+"?token="+localStorage.getItem(this.pageKey.thumbnailToken);var f="-webkit-mask-image: url("+u+");-webkit-mask-size: "+h+"px "+g+"px; -webkit-mask-position:"+m+"px "+p+"px;-webkit-mask-repeat:no-repeat;",y="position: absolute;z-index:-1;left:"+m+"px;width:"+h+"px;height:"+g+"px;top:"+p+"px;"}return{style:f,simplestyle:y}},handleSelHeight:function(){var e=Object(d["a"])(regeneratorRuntime.mark(function e(t,i){var a,o,s,n,r,l,d,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,i.item,o=i.pageIndex,s=i.itemIndex,n=!1;case 5:if(n){e.next=20;break}if(r=$("#el_"+o+"_"+s).height(),null==r){e.next=16;break}l=a.calTuCengMask(i),d=l.style,c=l.simplestyle,a.$set(a.tclist[s],"style",d),a.$set(a.tclist[s],"simplestyle",c),n=!0,e.next=18;break;case 16:return e.next=18,a.sleep(1e3);case 18:e.next=5;break;case 20:case"end":return e.stop()}},e,this)}));function t(t,i){return e.apply(this,arguments)}return t}(),handleSvgHeight:function(){var e=Object(d["a"])(regeneratorRuntime.mark(function e(t,i){var a,o,s,n,r,l,d,c,h,g,m,p,u,f,y,_,v,w,b,I,S,x,k,O;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,i.item,o=i.pageIndex,s=i.itemIndex,n=i.page,i.gHeight,i.gWidth,i.self,r=!1;case 9:if(r){e.next=29;break}if(l=$("#tuceng_"+o+"_"+s).height(),d=$("#tuceng_"+o+"_"+s).width(),null==l||"none"==$(".tc-bg").css("display")){e.next=25;break}if(c=[],SVG("#tugroup"+o+"_"+s))c[0]=SVG("#tugroup"+o+"_"+s);else for(h=SVG("#group"+o+"_"+s).svg(),g=SVG().addTo("#tuceng_"+o+"_"+s),m=g.svg(h),m.viewbox(0,0,n.diyDisplayWidth,n.diyDisplayHeight),c=m.children(),p=0;p<c.length;p++)if(u=c[p].attr("id"),u&&-1!=u.indexOf("group")&&(c[p].attr({id:"tugroup"+o+"_"+s}),c[p].css("display","block"),c[p].children()))for(f=c[p].children(),y=0;y<f.length;y++)_=f[y].attr("id"),_&&(-1!=_.indexOf("decrorate_")&&f[y].attr({id:"tudecrorate_"+o+"_"+s}),-1!=_.indexOf("bgimg_photo_")&&f[y].attr({id:"tubgimg_photo_"+o+"_"+s}),-1!=_.indexOf("text_")&&f[y].attr({id:"tutext_"+o+"_"+s}),-1!=_.indexOf("bgshape_")&&f[y].attr({id:"tubgshape_"+o+"_"+s}),-1!=_.indexOf("bgimage_")&&f[y].attr({id:"tubgimage_"+o+"_"+s}));v=$("#tuceng_"+o+"_"+s).width()/n.diyDisplayWidth,w=c[0].width()/c[0].height(),b=d/l,w>=b?(I=SVG("#tugroup"+o+"_"+s).width(),S=d/(I*v)):(x=SVG("#tugroup"+o+"_"+s).height(),S=l/(x*v)),k=0-n.content.itemList[s].printLocation.x,O=0-n.content.itemList[s].printLocation.y,c[0].attr({transform:"scale("+S+") translate("+k+","+O+")"}),r=!0,e.next=27;break;case 25:return e.next=27,a.sleep(1e3);case 27:e.next=9;break;case 29:case"end":return e.stop()}},e,this)}));function t(t,i){return e.apply(this,arguments)}return t}(),alertMessage:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","警告",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.$layer.alert(t)},showMessage:function(t){try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计","提示",t,JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.$layer.alert(t)},sleep:function(e){return new Promise(function(t){return setTimeout(t,e)})},sortBy:function(e,t){return t=void 0==t?1:t?1:-1,function(i,a){return i=i[e],a=a[e],i<a?-1*t:i>a?1*t:0}},uploadpic:function(){navigator.userAgent.toLowerCase();var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);this.handlephotonum(),localStorage.removeItem(this.pageKey.calenderTemp);var i=this.$route.query.uid,a={id:this.id,p:this.page,isTeamBook:!1,isfirst:!1,uploadcomplete:!1};(this.history||!this.history&&i)&&(!this.history&&i?a.history=!0:a.history=this.history,a.uid=this.uid),"iscaiyun"==this.designsorce?(a.designsorce="iscaiyun",this.$router.push({name:"upphoto",query:a})):"is_alipay"==this.designsorce?(a.designsorce="is_alipay",this.$router.push({name:"alipayupload",query:a})):"isweixin"==this.designsorce?location.href="fxUpload?id="+this.id+"&p="+this.page+"&isTeamBook=false&isfirst=false&designsorce=isweixin&uploadcomplete=false,":this.is_byte&&!t?null==this.$route.query.uid&&void 0==this.$route.query.uid&&""==this.$route.query.uid||tt.miniProgram.redirectTo({url:"/pages/upload-page/upload-page?token="+this.$route.query.token+"&sku="+this.$route.query.sku+"&minnum="+this.$route.query.minnum+"&maxnum="+this.$route.query.maxnum+"&gid="+this.$route.query.gid+"&pid="+this.$route.query.pid+"&id="+this.$route.query.id+"&max="+this.max+(null==this.$route.query.uuid||void 0==this.$route.query.uuid||""==this.$route.query.uuid?"":"&uuid="+this.$route.query.uuid)+(null==this.$route.query.uid||void 0==this.$route.query.uid||""==this.$route.query.uid?"":"&uid="+this.$route.query.uid)+(null==this.$route.query.uid||void 0==this.$route.query.uid||""==this.$route.query.uid?"&history=false":"&history=true")+(null==this.$route.query.numIndex||void 0==this.$route.query.numIndex||""==this.$route.query.numIndex?"":"&numIndex="+this.$route.query.numIndex)+(null==this.$route.query.p||void 0==this.$route.query.p||""==this.$route.query.p?"":"&p="+this.$route.query.p)+(null==this.$route.query.isEditCover||void 0==this.$route.query.isEditCover||""==this.$route.query.isEditCover?"":"&isEditCover="+this.$route.query.isEditCover)+(null==this.$route.query.isTeamBook||void 0==this.$route.query.isTeamBook||""==this.$route.query.isTeamBook?"":"&isTeamBook="+this.$route.query.isTeamBook)+"&isPart=false&uploadcomplete=false&isContinueDesign=true&isfirst=true&hassort=0",success:function(e){},fail:function(e){console.log("navigateTo调用失败")}}):(a.designsorce="upload",this.$router.push({name:"upload",query:a})),console.info("uerwej")},getPhotoByIds:function(e,t){var i=this,a={};a.ids=e;var o=t.length;Object(u["C"])(a).then(function(e){if(e.result&&e.data)for(var a=0;a<e.data.length;a++){for(var s=!1,n=0;n<t.length;n++)if(-1!=t[n].url.indexOf(e.data[a].picname)){t[n].id=e.data[a].id,s=!0;break}if(!s){o++;var r=JSON.parse(e.data[a].imageinfo),l=localStorage.getItem(i.pageKey.thumbnailToken),d={id:e.data[a].id,height:r.height,width:r.width,index:o,isUse:!1,title:"",titleAll:1,url:e.data[a].picname,src:Object(K["d"])(e.data[a].picname)+Object(K["e"])(e.data[a].picname,e.data[a].imageinfo,l)};t.push(d)}}localStorage.setItem(i.pageKey.uploadCalenderTemp,JSON.stringify(t))})},getUrlKey:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null},handlephotonum:function(){navigator.userAgent.toLowerCase();var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(-1==this.id||this.is_byte&&!t)return this.iscomplete=!0,void localStorage.setItem(this.pageKey.readyupload,!0);for(var i=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),a=0,o=0,s=i.pageList,n=0;n<s.length;n++)for(var r=s[n].content.itemList,l=0;l<r.length;l++)"advancedImageMask"==r[l].media.mediaType&&1==r[l].visible&&a++,r[l].cutArea&&1==r[l].cutArea.fromAiCut&&"image"==r[l].media.mediaType&&1==r[l].visible&&a++,"advancedImageMask"==r[l].media.mediaType&&-1==r[l].media.maskSource.indexOf("img/nophoto.jpg")&&1==r[l].visible&&o++,r[l].cutArea&&1==r[l].cutArea.fromAiCut&&"image"==r[l].media.mediaType&&-1==r[l].media.imgPath.indexOf("img/nophoto.jpg")&&1==r[l].visible&&o++;var d=parseInt(a)-parseInt(o);this.iscomplete=0==d,this.isSignleTempleBook||(localStorage.setItem(this.pageKey.minnum,d),localStorage.setItem(this.pageKey.maxnum,d),localStorage.setItem(this.pageKey.readyupload,this.iscomplete)),this.max=d},stopMove:function(){document.body.style.overflow="hidden"},openMove:function(){document.body.style.overflow="auto"},stopTouch:function(e){},showSave:function(){var t=this,i=localStorage.getItem(this.pageKey.source);if(!this.isMiniProgram||"third"==i||2==this.editType&&1==this.$route.query.admin)if("wsid"==i)try{t.save()}catch(e){t.alertMessage(e),t.isSaving=!1}else if("guochao"==i)t.save();else try{t.save()}catch(e){t.alertMessage(e),t.isSaving=!1}else{for(var a=!1,o=0;o<this.detailJson.pageList.length;o++){var s=this.detailJson.pageList[o];if(null!=s.videoUuid&&void 0!=s.videoUuid){a=!0;break}}if(a||!this.detailJson.isVideo)try{t.save()}catch(e){t.alertMessage(e),t.isSaving=!1;try{if(window._jylog){var n=localStorage.getItem(t.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交格式失败","未知错误",JSON.parse(n).orderNo])}}catch(e){console.log(e)}var r={};localStorage.getItem(t.pageKey.detailJson)&&(r={designerDetail:localStorage.getItem(t.pageKey.detailJson)},r=JSON.stringify(r),$.ajax({url:B["a"].basicUrl+"/member/tempsave",async:!0,type:"POST",data:r,timeout:12e3,headers:{"Content-Type":"application/json"},success:function(e){t.alertMessage("保存失败:"+error)},error:function(e){console.log(e),console.log(e.status),t.uploadError("jianyingstring.txt",r),t.alertMessage("保存串失败："+e.responseText)}}))}}},save:function(){var t=this;try{if(window._jylog){var i=localStorage.getItem(this.pageKey.orderInfo);if(this.detailJson){var a=Object(n["a"])(this.detailJson);window._jylog.push(["检测this.detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测this.detailJson","预览页面","save方法",String(this.detailJson),JSON.parse(i).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){var o=localStorage.getItem(this.pageKey.detailJson);if(o){a=Object(n["a"])(o);window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",String(o),JSON.parse(i).orderNo])}}catch(e){console.log(e)}setSave();var s=B["a"].baseUrl2,r=B["a"].fxBackUrl,l=(B["a"].wechatBackUrl,B["a"].xlsBackUrl);this.photoSize=localStorage.getItem(this.pageKey.photoSize),this.mshopSign=localStorage.getItem(this.pageKey.mshopSign),"1"!=this.mshopSign&&"2"!=this.mshopSign||(this.editType=1,"1"==this.mshopSign?this.flag=4:this.flag=10);var d=this;if(Object(X["a"])(this.pageKey,this.$store.getters.svgxmlArr,function(e){localStorage.setItem(d.pageKey.detailJson,JSON.stringify(e)),d.$store.dispatch("updatePages",e),d.svgSaveFail=!0},function(){d.svgSaveFail=!1}),0!=this.svgSaveFail){this.isOverdueTip="";var c,h=this.detailJson.pageList,g=(JSON.parse(localStorage.getItem(this.pageKey.calenderTemp)),JSON.parse(localStorage.getItem(this.pageKey.goodsid))),m=JSON.parse(localStorage.getItem(this.pageKey.productId)),p="",f=JSON.parse(localStorage.getItem(this.pageKey.motherid)),_=this.detailJson;try{if(this.startSavetime=(new Date).getTime(),window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);if(this.detailJson){a=Object(n["a"])(this.detailJson);window._jylog.push(["检测this.detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测this.detailJson","预览页面","save方法",String(this.detailJson),JSON.parse(i).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){o=localStorage.getItem(this.pageKey.detailJson);if(o){a=Object(n["a"])(o);window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",a,JSON.parse(i).orderNo])}else window._jylog.push(["检测localStorage中detailJson","预览页面","save方法",String(o),JSON.parse(i).orderNo])}}catch(e){console.log(e)}this.detailJson?(h=this.detailJson.pageList,c=this.detailJson):(c=JSON.parse(localStorage.getItem(this.pageKey.detailJson)),h=c.pageList),_.datetime=(new Date).getTime(),localStorage.setItem(this.pageKey.detailJson,JSON.stringify(_)),this.$store.dispatch("updatePages",_);var v=localStorage.getItem(this.pageKey.token),w=localStorage.getItem(this.pageKey.returnURL);"calendar"==c.diyType||"year_calendar"==c.diyType?JSON.parse(localStorage.getItem(this.pageKey.cal_baseBoard)):localStorage.removeItem(this.pageKey.cal_baseBoard),console.log(p);for(var b=!1,I=!0,S=0;S<h.length;S++){if(!I)return void(this.isSaving=!1);for(var x=h[S].content.itemList,k=0;k<x.length;k++)if("text"==x[k].media.mediaType&&""!=x[k].media.text&&""!=x[k].media.font.textPath?"yes"==x[k].moveable&&(x[k].moveable="yes"):"image"==x[k].media.mediaType&&0==x[k].media.isBG&&0==x[k].isDisplay||"yes"!=x[k].moveable&&delete x[k].moveable,"advancedImageMask"==x[k].media.mediaType&&1==x[k].visible){if(-1!=x[k].media.maskSource.indexOf("img/nophoto.jpg")&&1==x[k].visible)return void this.showMessage("您有照片未填充");x[k].media.defaultState=!1,-1!=x[k].media.maskSource.indexOf(Object(K["d"])(x[k].media.maskSource))&&(x[k].media.maskSource=Object(K["f"])(x[k].media.maskSource,x[k]).replace(Object(K["d"])(x[k].media.maskSource),"")),-1!=x[k].media.factMaskSource.indexOf(Object(K["d"])(x[k].media.factMaskSource))&&(x[k].media.factMaskSource=Object(K["f"])(x[k].media.factMaskSource,x[k]).replace(Object(K["d"])(x[k].media.factMaskSource),"")),-1!=x[k].media.bgSource.indexOf(Object(K["d"])(x[k].media.bgSource))&&(x[k].media.bgSource=Object(K["f"])(x[k].media.bgSource,x[k]).replace(Object(K["d"])(x[k].media.bgSource),"")),this.checkDate(h[S],x[k].media.maskSource)}else if("image"==x[k].media.mediaType)-1!=x[k].media.imgPath.indexOf(Object(K["d"])(x[k].media.imgPath))&&(x[k].media.imgPath=Object(K["f"])(x[k].media.imgPath,x[k]).replace(Object(K["d"])(x[k].media.imgPath),"")),-1!=x[k].media.imgPath.indexOf(s)&&(x[k].media.imgPath=x[k].media.imgPath.replace(s,""));else if("text"==x[k].media.mediaType)console.log(x[k]),null!=x[k].media.imgPath&&void 0!=x[k].media.imgPath&&-1!=x[k].media.imgPath.indexOf(s)&&(x[k].media.font.textPath=x[k].media.font.textPath.replace(s,"")),x[k].media.isImage&&-1!=x[k].media.font.textPath.indexOf(s)&&(x[k].media.font.textPath=x[k].media.font.textPath.replace(s,""));else if(x[k].media.mediaType.indexOf("svg")>-1){if(-1!=x[k].media.imgPath.indexOf(Object(K["d"])(x[k].media.imgPath))&&(x[k].media.imgPath=Object(K["f"])(x[k].media.imgPath,x[k]).replace(Object(K["d"])(x[k].media.imgPath),"")),1==x[k].media.svgmodified&&-1!=x[k].media.imgPath.indexOf("MXYZ-")){b=!0;break}}else if(x[k].media.mediaType.indexOf("selfGroup")>-1){var O=!0,L=!1,T=void 0;try{for(var C,P=x[k].childrenElement[Symbol.iterator]();!(O=(C=P.next()).done);O=!0){var j=C.value;if(Object(y["a"])(j),1==j.media.svgmodified&&-1!=j.media.imgPath.indexOf("MXYZ-")){b=!0;break}}}catch(ae){L=!0,T=ae}finally{try{O||null==P.return||P.return()}finally{if(L)throw T}}if(b)break}if(b)break}if(b)return this.alertMessage("svgxml保存异常，请返回设计页面重新提交"),void(this.isSaving=!1);if(""==this.isOverdueTip)if(this.isSaving)this.showMessage("正在保存中，请不要重复点击");else{if(this.isSaving=!0,this.detailJson.pageList=h,null==this.detailJson)return this.alertMessage("您保存的数据异常，请返回检查！"),void(this.isSaving=!1);for(var A=[],N="",E=0;E<h.length;E++){x=h[E].content.itemList;for(var J=!1,D=[],M=0;M<x.length;M++)"text"!=x[M].media.mediaType||void 0!=x[M].media.text&&null!=x[M].media.text||(J=!0,D=[E,M]);J&&(0==E?N=h[E].title+"、":N+=h[E].title+"、",A.push(D))}if(""!=N)return N+="页面文字节点数据异常！",this.isSaving=!1,void this.alertMessage(N);var U=JSON.parse(localStorage.getItem(this.pageKey.orderInfo));null!=U&&void 0!=U||(U=_.oderInfo?_.oderInfo:{});var W="";W=U&&""!=U&&U!={}?U.source:localStorage.getItem(this.pageKey.source);var F=JSON.parse(localStorage.getItem(this.pageKey.cal_baseBoard)),q="";W&&"wsid"==W&&(this.iswsid=!0),!this.iswsid||1!=this.iswsid&&"true"!=this.iswsid||(this.wsid=localStorage.getItem(this.pageKey.wsid),this.addinfo.wsid=this.wsid,_.addinfo=this.addinfo),null!=F&&""!=F?(m=F.proid,q=F.productno):U&&""!=U&&U!={}&&(q=U.productNo),1==_.templateInfo.coverper&&1==_.templateInfo.backcover&&1==_.templateInfo.innerper&&"photo"==_.diyType&&(_.coverInfo.hascover||1!=_.pageList[0].content.itemList.length||_.pageList.splice(0,1),_.coverInfo.hasbackcover||1!=_.pageList[_.pageList.length-1].content.itemList.length||_.pageList.splice(_.pageList.length-1,1)),"woodcut"==_.diyType&&(_.diyType="photo",_.isBanhua=!0),"woodcut"==_.templateInfo.diyType&&(_.templateInfo.diyType="photo"),"wall_calendar"==_.templateInfo.diyType&&(_.templateInfo.diyType="photo",_.diyType="photo",_.isguali=!0),"mug_cup"==_.templateInfo.diyType&&(_.templateInfo.diyType="photo",_.diyType="photo",_.iscup=!0),"other_object"==_.diyType&&(_.diyType="photo",_.isBanhua=!0),"other_object"==_.templateInfo.diyType&&(_.templateInfo.diyType="photo");var G=localStorage.getItem(this.pageKey.fold);if(""!=G&&void 0!=G&&null!=G&&(_.fold=G),""!=U&&void 0!=U&&null!=U&&(_.oderInfo=U),_.oderInfo.productNo!=_.sku&&_.sku&&_.oderInfo.productNo){try{if(window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","问题提示",_.oderInfo.productNo+":"+_.sku,JSON.parse(i).orderNo])}}catch(e){console.log(e)}return this.alertMessage("同一设计无法对应不同产品，请重新设计"),void(this.isSaving=!1)}var z=localStorage.getItem(this.pageKey.autoSave),H=this.editType;z&&(H=2,this.uid||(this.uid=localStorage.getItem(this.pageKey.uid)));var V=localStorage.getItem(this.pageKey.orgTime),Y=0;if(void 0!=V&&null!=V&&"undefined"!=V&&"null"!=V){var Q=(new Date).getTime(),Z=Q-V;Y=Math.floor(Z/6e4);try{if(window._jylog){i=localStorage.getItem(this.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","设计时长",Y,JSON.parse(i).orderNo])}}catch(e){console.log(e)}}var ee={};if(1==H){if(ee={userid:-1,name:"",submit:!0,token:v,edittype:1,gid:g,mid:f,pid:m,productno:q,designerDetail:_,orderNo:U.orderNo,tid:this.detailJson.templateInfo.id,pnum:localStorage.getItem(this.pageKey.pnum),membertype:U.shopName,photoSize:this.photoSize,materials:localStorage.getItem(this.pageKey.materials),previewImage:localStorage.getItem(this.pageKey.previewImage),isTeamBook:this.isTeamBook,addinfo:this.addinfo,flag:this.flag},"fashion_photo"==this.detailJson.diyType&&(ee.addinfo={num:$("#addinfo").val()},!this.checkNum($("#addinfo").val())))return this.showMessage("请填写数量"),void(this.isSaving=!1)}else{if(2!=H)return this.alertMessage("参数错误"),void(this.isSaving=!1);if(null==m&&(m=_.productId),ee={uid:this.uid,name:"",designerDetail:_,edittype:2,productno:q,gid:g,mid:f,pid:m,photoSize:this.photoSize,materials:localStorage.getItem(this.pageKey.materials),previewImage:localStorage.getItem(this.pageKey.previewImage),pnum:localStorage.getItem(this.pageKey.pnum),submit:!0,tid:this.detailJson.templateInfo.id,isTeamBook:this.isTeamBook,addinfo:this.addinfo},1==this.$route.query.fromAdmin&&(ee.token="supervisor"),2!=this.editType||this.$route.query.history||(ee.isEdit=!0),"fashion_photo"==this.detailJson.diyType&&1!=this.$route.query.admin&&!this.isTeamBook&&"third"!=W)if("wsid"==W){var te=ee.addinfo.num;if(!this.checkNum(te))return this.showMessage("请填写数量"),void(this.isSaving=!1)}else if(ee.addinfo={num:$("#addinfo").val()},!this.checkNum($("#addinfo").val()))return this.showMessage("请填写数量"),void(this.isSaving=!1)}this.coverPreviewImage&&(ee.previewImage=this.coverPreviewImage),console.log("req.previewImage:"+ee.previewImage);var ie=this;this.reqData=ee,1==this.editType&&(ee.addinfo.designlongtime=Y),window._czc&&window._czc.push(["_trackEvent","剪影","预览页面","提交设计"]),ee.addinfo?ee.addinfo.telno="newjianying":ee.addinfo={telno:"newjianying"},Object(u["cb"])(ee).then(function(i){try{if(window._jylog){var a=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交成功",i.data.uid,JSON.parse(a).orderNo])}}catch(e){console.log(e)}try{if(window._jylog){var o="",s=(new Date).getTime();ie.startSavetime&&(o=(s-ie.startSavetime)/1e3);a=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","保存相应时长",o,JSON.parse(a).orderNo])}}catch(e){console.log(e)}if(ie.isSaving=!1,1==i.result){var n=JSON.parse(localStorage.getItem(t.pageKey.thirdDatil)),d=localStorage.getItem(t.pageKey.redirecType);W=localStorage.getItem(t.pageKey.source);var c=q,h="null";""!=c&&null!=c&&void 0!=c&&(U.productNo==q||(h=q)),ie.reqData.uid=i.data.uid,"fxxt"!=W&&-1==window.location.href.indexOf("zheliyin.com")||(c=q,""!=c&&null!=c&&void 0!=c&&(U.productNo==q||(h=q)));localStorage.getItem(t.pageKey.goodsid);for(var g in t.pageKey)localStorage.removeItem(t.pageKey[g]);var m=localStorage.getItem(R["f"].fromAlipyShopCartEdit);if("1"==m||1==m)return void my.navigateBack();var p=localStorage.getItem(R["f"].fromAlipyShop),f=localStorage.getItem(R["f"].alipyShopGoodsid),y=localStorage.getItem(R["f"].alipyShopProductid);if("1"==p||1==p)return void my.redirectTo({url:"/pages/preDesign-complete/preDesign-complete?goodsid="+f+"&alipyShopProductid="+y});if("third"==W)return"1"==ie.mshopSign||"2"==ie.mshopSign?void ie.scgjthirdMethod(i,n):void ie.thirdMethod(i,n);if("fxxt"==W||-1!=window.location.href.indexOf("zheliyin.com")){try{window._czc&&window._czc.push(["_trackEvent","剪影","分销提交页面","提交"+U.orderNo+"-"+r])}catch(e){console.log(e)}return void(window.location.href=r+"/diyRedirect/callbackOrderDetail/"+U.orderNo+"/"+i.data.designno+"/"+d+"/"+h)}if("xls"==W)return void(window.location.href=l+"/mobile/odr/order/sheet/designDIYGoods.do?thirdOrderNo="+i.data.designno+"&odrGoodsCode="+U.orderNo+"&redirecType="+d+"&sku="+h);if("wechat"==W){var _=0;return void(window.location.href=w+"?designId="+i.data.uid+"&member_id="+encodeURI(encodeURI(U.memberid))+"&plseNum="+_)}if("wsid"==W)return void ie.goSuccess(i);if(-1!=window.location.href.indexOf("zheliyin.com"))try{window._czc&&window._czc.push(["_trackEvent","剪影","分销提交页面","提交"+U.orderNo+":"+W])}catch(e){console.log(e)}if(1==t.editType||t.$route.query.history&&1!=t.$route.query.admin)if(i.data.tburl){try{if(window._jylog){a=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交成功回传地址",i.data.tburl,JSON.parse(a).orderNo])}}catch(e){console.log(e)}t.goHebinglianjie(i,U.orderNo)}else t.goSuccess(i);else 2==t.editType&&t.goSuccess(i)}else if(i.data){var v=t;t.$layer.alert(i.msg,function(){v.copyText(i.data,"成功复制设计单单号,请将设计单单号发送给客服")})}else if("用户信息失效！"==i.msg){v=t;var b={};b.token=localStorage.getItem(v.pageKey.token),b.detail=JSON.parse(localStorage.getItem(v.pageKey.tokenDetail)),Object(u["K"])(b).then(function(e){e.result&&(localStorage.setItem(v.pageKey.token,e.token),v.save())})}else t.alertMessage(i.msg)}).catch(function(t){try{if(window._jylog){var i=localStorage.getItem(ie.pageKey.orderInfo);window._jylog.push(["按钮点击","预览","提交失败",JSON.stringify(t),JSON.parse(i).orderNo])}}catch(e){console.log(e)}ee=JSON.stringify(ee),$.ajax({url:B["a"].basicUrl+"/member/tempsave",async:!0,type:"POST",data:ee,timeout:12e3,headers:{"Content-Type":"application/json"},success:function(e){ie.alertMessage("保存失败:"+t)},error:function(e){console.log(e),console.log(e.status),ie.uploadError("jianyingstring.txt",ee),ie.alertMessage("保存串失败："+JSON.stringify(e))}}),ie.isSaving=!1})}else this.alertMessage("您设计的第"+this.isOverdueTip+"    存在过期图片，请修改！")}else this.isSaving=!1},checkDate:function(e,t){var i="20"+t.substring(3,9),a=new Date;i=i.replace(/^(\d{4})(\d{2})(\d{2})$/,"$1/$2/$3");var o=new Date(i),s=(a.getTime()-o.getTime())/1e3/60/60/24,n=75;if(this.savedays&&(n=this.savedays),s>n){this.isOverdueTip?this.isOverdueTip+=","+e.title:this.isOverdueTip=e.title;var r=JSON.stringify(this.detailJson);r=r.replace(t,"img/nophoto.jpg"),localStorage.setItem(this.pageKey.detailJson,r),this.$store.dispatch("updatePages",JSON.parse(r))}},goWait:function(e,t,i){this.$router.push({name:"wait",query:{redirectUrl:encodeURI(e.data.tburl),code:e.data.designno,uid:e.data.uid,orderNo:t,isSimple:0,source:i}})},goSuccess:function(e){this.$router.push({name:"success",query:{code:e.data.designno,uid:e.data.uid,photoBecomBook:this.$route.query.photoBecomBook}})},goHebinglianjie:function(e,t,i){var a=e.data.tburl;if(-1!=window.location.href.indexOf("https")&&-1==a.indexOf("https")&&-1==a.indexOf("sjky.")){var o=a.split("http");a="https"+o[1]}window.location.href=a}},beforeRouteEnter:function(e,t,i){i(function(e){e.fromPage=t.path})},beforeRouteLeave:function(e,t,i){console.log("清除askSave"),window.removeEventListener("popstate",this.askSave,!1),this.screenShotCanvas&&G["a"].create("screenShot").remove("toDataURLComplete",this.screenCut),this.$layer.closeAll(),layer.closeAll(),i()},computed:oe({},Object(g["b"])(["detailJson","photos","allFontInfo"])),watch:{photos:function(e){},detailJson:function(){this.isUpdateDom&&this.isUpdate}}},le=re,de=(a("7550"),a("a628"),a("2877")),ce=Object(de["a"])(le,o,s,!1,null,"52a6ce55",null);i["default"]=ce.exports},e578:function(e,t,i){},e8bf:function(e,t,i){"use strict";var a=i("d35f"),o=i.n(a);o.a},eb9b:function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s});var a=i("ec06");function o(e,t,i){var o=1;a["a"].getInstance().clearCanvasAndLayer(),a["a"].getInstance().currentCanvasNum=e.lastEditPageIndex,a["a"].getInstance().hasLoadErrorNum=0;var n=JSON.parse(localStorage.getItem(e.pageKey.detailJson));e.lastEditPageIndex;console.log("canvasToProductObjArr:",a["a"].getInstance().canvasToProductObjArr.length);var r=n.pageList[e.lastEditPageIndex].content.itemList;if("calendar"!=n.diyType&&"year_calendar"!=n.diyType&&"week_calendar"!=n.diyType&&"week_calendar"!=n.diyType&&"wall_calendar"!=n.diyType&&"mug_cup"!=n.diyType&&"fashion_photo"!=n.diyType){var l={};l.x=0,l.y=0,l.w=n.pageList[e.lastEditPageIndex].diyDisplayWidth,l.h=n.pageList[e.lastEditPageIndex].diyDisplayHeight;var d=s(l.w,l.h);g=d.width,m=d.height,o=d.canvasScaleNum,a["a"].getInstance().canvas=e.screenShotCanvas,a["a"].getInstance().initCanvas(g,m,n,o)}for(var c=0;c<r.length;c++){var h=r[c];if("image"==h.media.mediaType&&"no"==h.moveable&&1==h.media.isBG&&("calendar"==n.diyType||"year_calendar"==n.diyType||"week_calendar"==n.diyType||"wall_calendar"==n.diyType||"mug_cup"==n.diyType||"fashion_photo"==n.diyType)){var g,m;l={};i||"fashion_photo"==n.diyType?(l.x=h.location.x,l.y=h.location.y,l.w=h.location.width,l.h=h.location.height):(l.x=0,l.y=0,l.w=n.pageList[e.lastEditPageIndex].diyDisplayWidth,l.h=n.pageList[e.lastEditPageIndex].diyDisplayHeight);d=s(l.w,l.h);g=d.width,m=d.height,o=d.canvasScaleNum,a["a"].getInstance().canvas=e.screenShotCanvas,a["a"].getInstance().initCanvas(g,m,n,o)}}a["a"].getInstance().isFinalClick=t;for(var p=0;p<r.length;p++){h=r[p];var u=JSON.parse(JSON.stringify(h));e.screenShotCanvas&&("image"==h.media.mediaType?a["a"].getInstance().drawImg(h,p):"advancedImageMask"==h.media.mediaType?(u.location.width*=o,u.location.height*=o,a["a"].getInstance().drawContainer(u,p)):"shape"==h.media.mediaType?a["a"].getInstance().drawShape(h,p):"text"==h.media.mediaType&&(h.media.font.textPath?a["a"].getInstance().drawImg(h,p):a["a"].getInstance().drawText(h,p,e)))}}function s(e,t){var i,a,o=1,s=e/t;return e>=t?(o=400/e,i=400,a=i/s):(o=400/t,a=400,i=a*s),{width:i,height:a,canvasScaleNum:o}}},ec06:function(t,i,a){"use strict";a("c5f6"),a("28a5");var o=a("d225"),s=a("b0b4"),n=a("d80f"),r=a("1dab");function l(e,t,i,a){if(i,t.media.mediaType==n["a"].IMAGE){if(e.mediaIsBG=t.media.isBG,e.flipX=void 0!=t.flipX&&t.flipX,e.flipY=void 0!=t.flipY&&t.flipY,e.mediaImgPath=t.media.imgPath,e.mediaMediaType=t.media.mediaType,e.isqrcode=t.media.isqrcode,t.cValue){e.cValue=t.cValue;t.location.width,t.location.height;e.clipTo=clipTo.clipTo}t.cutArea&&""!=t.cutArea.width&&(e.cutAreaX=t.cutArea.x,e.cutAreaY=t.cutArea.y,e.cutAreaWidth=t.cutArea.width,e.cutAreaHeight=t.cutArea.height),void 0==t.noCutWidth||null==t.noCutWidth||(e.noCutWidth=t.noCutWidth)}else if(t.media.mediaType==n["a"].SHAPE){if(e.mediaIsBG=t.media.isBG,e.mediaColor=t.media.color,e.mediaScopeType=t.media.scopeType,e.mediaIsFill=t.media.isFill,e.mediaIsPrimary=t.media.isPrimary,e.mediaMediaType=t.media.mediaType,"rect"==e.mediaScopeType&&1==e.mediaIsBG){var o=Object(r["b"])(e.mediaColor);e.setFill(o),e.setCoords()}}else if(t.media.mediaType==n["a"].TEXT){e.mediaIsBG=t.media.isBG,e.mediaImgPath=t.media.imgPath,e.mediafontPointSize=t.media.font.pointSize,e.mediafontColor=t.media.font.fontColor,e.mediafontIsHorizontal=t.media.font.isHorizontal,e.mediafontGravity=t.media.font.gravity,e.mediafontId=t.media.font.id,e.mediaIsItalic=t.media.font.isItalic,e.mediaTextDecoration=t.media.font.textDecoration,e.mediaIsBold=t.media.font.isBold,e.mediaText=t.media.text,e.mediaMediaType=t.media.mediaType,e.mediaWordSpace=t.media.charSpace,e.mediaLineSpace=t.media.lineSpace,e.mediaMediaType=t.media.mediaType,e.setFontSize(e.mediafontPointSize),e.setColor(e.mediafontColor),e.setTextAlign(e.mediafontGravity),e.setText(e.mediaText);var s=t.media.font.id,l=a.$store.getters.idNameJson,d=l[s];FontDetect.isFontLoaded(d)?(e.setFontFamily(d),console.log(d+"字体设置成功canvas")):FontDetect.onFontLoaded(d,function(t){console.log(d+"字体下载成功canvas"),e.setFontFamily(d),i.renderAll()},function(e){console.log(e+"字体下载失败canvas")},{msTimeout:3e3}),e.setCoords()}else t.media.mediaType==n["a"].ADVANCED_IMAGE_MASK||t.media.mediaType==n["a"].IMAGE_MASK?(e.mediaIsBG=t.media.isBG,t.flipX&&(e.flipX=t.flipX,e.flipY=t.flipY),e.mediaDefaultState=t.media.defaultState,e.mediaIsSimple=t.media.isSimple,e.mediaBgSource=t.media.bgSource,e.mediaFactMaskSource=t.media.factMaskSource,e.mediaZoom=t.media.zoom,e.mediaMaskSource=t.media.maskSource,e.mediaMediaType=t.media.mediaType,e.locationMaskFactWidth=Number(t.location.maskFactWidth),e.locationMaskFactHeight=Number(t.location.maskFactHeight)):t.media.mediaType==n["a"].SVG&&(e.mediaIsBG=t.media.isBG,1==t.media.isBG&&(e.selectable=!1,e.selectEnabled=!1,e.svgPath=t.media.svgPath),e.flipX=void 0!=t.flipX&&t.flipX,e.flipY=void 0!=t.flipY&&t.flipY,e.mediaImgPath=t.media.imgPath,e.mediaMediaType=t.media.mediaType);e.barTypeSign=t.barTypeSign,e.isDesignShape=t.isDesignShape,e.layerAlpha=Number(t.layer.alpha),e.isEdit=t.isEdit,e.resourceType=t.resourceType,e.maskEnable=t.maskEnable,e.isDisplay=t.isDisplay,e.printLocationX=t.printLocation.x,e.printLocationY=t.printLocation.y,e.printLocationWidth=t.printLocation.width,e.printLocationHeight=t.printLocation.height,e.printLocationRotation=t.printLocation.rotation,e.lowPixelFlag=t.lowPixelFlag,e.protoVisible=t.visible,e.deleteState=t.deleteState,e.locationX=t.location.x,e.locationY=t.location.y,e.locationWidth=t.location.width,e.locationHeight=t.location.height,e.locationFactWidth=t.location.factWidth,e.locationFactHeight=t.location.factHeight,e.locationRotation=t.location.rotation,e.protoVisible||(e.visible=!1),e.setOpacity(e.layerAlpha),t.media.mediaType!=n["a"].ADVANCED_IMAGE_MASK&&t.media.mediaType!=n["a"].IMAGE_MASK&&e.setAngle(e.locationRotation),e.setLeft(e.locationX),e.setTop(e.locationY),"group"==e.type?(console.log(m.getInstance().canvasScaleNum),e.scaleToWidth(e.locationWidth),e.scaleToHeight(e.locationHeight)):(e.setWidth(e.locationWidth),e.setHeight(e.locationHeight)),i.renderAll(),e.setCoords()}var d=a("5841");function c(e,t,i,a){var o=i,s=t.pageList[e].content.itemList;for(var r in o){var l=o[r];if("textbox"==l.type){if(null==s[r]||void 0==s[r])continue;if(s[r].media.mediaType!=n["a"].TEXT)continue;s[r].location.height;var d=s[r].media.text.split("\n");h(l,d,a)}}a.renderAll()}function h(e,t,i){var a=e.getLeft(),o=e.getTop(),s=e.width,n=[],r=i.contextContainer,l=(e.getFontSize(),e.getFontFamily());for(var d in r.font=e.getFontWeight()+" "+e.getFontSize()+"px  "+l,t){var c=t[d],h=r.measureText(c).width+1+e.charSpacing*(c.length-1)/1e3*e.getFontSize();0==n.length?n.push(h):n[0]<h&&(n[0]=h)}if(n.length>0){var g=Math.ceil(n[0]);if((window.ActiveXObject||"ActiveXObject"in window)&&(g=n[0]+5),e.setWidth(g),"center"==e.getTextAlign()){var m=e.getAngle()*Math.PI/180,p=(s-e.width)/2;e.setLeft(a+p*Math.cos(m)),e.setTop(o+p*Math.sin(m))}else if("right"==e.getTextAlign()){m=e.getAngle()*Math.PI/180,p=s-e.width;e.setLeft(a+p*Math.cos(m)),e.setTop(o+p*Math.sin(m))}e.setCoords()}}var g=a("6614");a("103a");a.d(i,"a",function(){return m});var m=function(){function t(){Object(o["a"])(this,t),console.log("参数:"+arguments[1]),this.canvas=null,this.canvasToProductObjArr=[],this.canvasDrawComplete=!1,this.canvasWidth=null,this.canvasHeight=null,this.detailJson=null,this.currentCanvasNum=0,this.cutImgNum=0,this.drawCutImgCompleteNum=0,this.cutImgsLayerArr=[],this.cutImgsArr=[],this.isCuting=!1,this.base64Str=null,this.isFinalClick=!1,this.canvasScaleNum=1,this.hasLoadErrorNum=0}return Object(s["a"])(t,[{key:"initCanvas",value:function(e,t,i,a){document.getElementById("screenShot");this.detailJson=i,this.clearCanvasAndLayer(),this.canvas.setBackgroundColor("white",this.canvas.renderAll.bind(this.canvas)),this.setCanvasSize(e,t,a),this.canvasScaleNum=a}},{key:"setCanvasSize",value:function(e,t,i){e&&(this.canvas.setWidth(e),this.canvasWidth=e),t&&(this.canvas.setHeight(t),this.canvasHeight=t),this.canvas.setZoom(i),this.canvas.setBackgroundColor("white",this.canvas.renderAll.bind(this.canvas))}},{key:"drawImg",value:function(t,i){var a,o=this;if(""==t.media.imgPath)return o.canvasToProductObjArr.push(new fabric.Object),void o.checkObjsInProductJson(t);a=-1!=location.href.indexOf("uid")?localStorage.getItem("e_thumbnailToken"):localStorage.getItem("thumbnailToken");var s=t.media.imgPath.split("/image/"),n=d["a"].base+"/image/"+s[1];if(-1!=t.media.imgPath.indexOf(d["a"].thumbnailUrl)&&-1==t.media.imgPath.indexOf("?token="))if(-1!=t.media.imgPath.indexOf("commonUpload/"))if(-1!=t.media.imgPath.indexOf("fsferry/")){s=t.media.imgPath.split("fsferry/commonUpload/");n=s[0]+s[1]+"?token="+a}else{s=t.media.imgPath.split("commonUpload/");n=s[0]+s[1]+"?token="+a}else n=t.media.imgPath+"?token="+a;else{if(-1!=t.media.imgPath.indexOf(d["a"].thumbnailUrl)&&-1!=t.media.imgPath.indexOf("?token=")&&-1!=t.media.imgPath.indexOf("commonUpload/"))if(-1!=t.media.imgPath.indexOf("fsferry/")){s=t.media.imgPath.split("fsferry/commonUpload/");n=s[0]+s[1]}else{s=t.media.imgPath.split("commonUpload/");n=s[0]+s[1]}try{var r;if(-1!=t.media.imgPath.indexOf(d["a"].thumbnailUrl)&&-1!=t.media.imgPath.indexOf("commonUpload/"))if(window._jylog)localStorage.getItem("orderInfo")&&(r=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(r=localStorage.getItem("e_orderInfo")),window._jylog.push(["drawImg","canvas渲染","警告",t.media.imgPath,JSON.parse(r).orderNo])}catch(e){}}fabric.Image.fromURL(n,function(a){if(a.getWidth()<=0){o.hasLoadErrorNum++,o.checkObjsInProductJson(t);try{var s;if(window._jylog)localStorage.getItem("orderInfo")&&(s=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(s=localStorage.getItem("e_orderInfo")),window._jylog.push(["fabric加载图片失败","设计","fabric加载imgUrl",a.getWidth()+"-"+n,JSON.parse(s).orderNo])}catch(e){}}else a.bigPicWidth=a.getWidth(),a.layerNum=i,l(a,t,o.canvas),a.mediaImgPath=n,o.canvas.add(a).renderAll(),a.setCoords(),o.canvasToProductObjArr.push(a),a.layerHighestB=!1,o.checkObjsInProductJson(t)})}},{key:"drawContainer",value:function(t,i){var a,o,s,r=this,c=t.media.factMaskSource.split("/image/"),h=d["a"].base+"/image/"+c[1],g=t.media.maskSource.split("/image/"),m=d["a"].base+"/image/"+g[1];-1!=t.media.factMaskSource.indexOf(d["a"].thumbnailUrl)&&-1==t.media.factMaskSource.indexOf("?token=")&&(s=-1!=location.href.indexOf("uid")?localStorage.getItem("e_thumbnailToken"):localStorage.getItem("thumbnailToken"),h=t.media.factMaskSource+"?token="+s);if(s=-1!=location.href.indexOf("uid")?localStorage.getItem("e_thumbnailToken"):localStorage.getItem("thumbnailToken"),-1!=t.media.maskSource.indexOf(d["a"].thumbnailUrl)&&-1==t.media.maskSource.indexOf("?token="))if(-1!=t.media.maskSource.indexOf("commonUpload/"))if(-1!=t.media.maskSource.indexOf("fsferry/")){c=t.media.maskSource.split("fsferry/commonUpload/");m=c[0]+c[1]+"?token="+s}else{c=t.media.maskSource.split("commonUpload/");m=c[0]+c[1]+"?token="+s}else m=t.media.maskSource+"?token="+s;else try{if(-1!=t.media.maskSource.indexOf(d["a"].thumbnailUrl)&&-1!=t.media.maskSource.indexOf("?token=")&&-1!=t.media.maskSource.indexOf("commonUpload/"))if(-1!=t.media.maskSource.indexOf("fsferry/")){c=t.media.maskSource.split("fsferry/commonUpload/");m=c[0]+c[1]}else{c=t.media.maskSource.split("commonUpload/");m=c[0]+c[1]}var p;if(window._jylog)localStorage.getItem("orderInfo")&&(p=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(p=localStorage.getItem("e_orderInfo")),window._jylog.push(["drawContainer","canvas渲染","警告",t.media.maskSource,JSON.parse(p).orderNo])}catch(e){}fabric.Image.fromURL(h,function(s){if(s.getWidth()<=0){r.hasLoadErrorNum++,r.checkObjsInProductJson(t);try{var c;if(window._jylog)localStorage.getItem("orderInfo")&&(c=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(c=localStorage.getItem("e_orderInfo")),window._jylog.push(["fabric加载图片失败","设计","fabric加载maskImgUrl",s.getWidth()+"-"+h,JSON.parse(c).orderNo])}catch(e){}}else if(a=s,a=s,void 0!=t)if(t.media.isSimple&&(o=new fabric.Group([a]),o.setOriginX("left"),o.setOriginY("top"),r.canvas.add(o).renderAll(),a.setCoords(),o.setCoords(),o.editorB=!1,o.layerNum=i,l(o,t,r.canvas)),""!=t.media.maskSource)if(t.media.isSimple)fabric.Image.fromURL(m,function(i){if(i.getWidth()<=0){r.hasLoadErrorNum++,r.checkObjsInProductJson(t);try{var a;if(window._jylog)localStorage.getItem("orderInfo")&&(a=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(a=localStorage.getItem("e_orderInfo")),window._jylog.push(["fabric加载图片失败","设计","fabric加载url",i.getWidth()+"-"+m,JSON.parse(a).orderNo])}catch(e){}}else{i.set({originX:"left",originY:"top"}),i.isEdit=!0,i.mediaIsBG=!1,i.mediaImgPath=m,i.mediaMediaType=n["a"].IMAGE,i.protoVisible=i.getVisible();var s=t.media.imgX,l=t.media.imgY,d=t.media.imgWidth*(1+t.media.zoom/10),c=t.media.imgHeight*(1+t.media.zoom/10);i.setLeft(s),i.setTop(l),i.setWidth(d),i.setHeight(c),i.mediaImgX=t.media.imgX,i.mediaImgY=t.media.imgY,i.mediaImgWidth=t.media.imgWidth,i.mediaImgHeight=t.media.imgHeight,i.locationFactWidth=Number(t.location.maskFactWidth),i.locationFactHeight=Number(t.location.maskFactHeight),o.mediaMaskSource=m,r.setImgMask(i,o,!0),r.canvas.renderAll(),r.canvasToProductObjArr.push(o),r.checkObjsInProductJson(t)}});else{var g,p=t.media.bgSource.split("/image/"),u=d["a"].base+"/image/"+p[1];if(-1!=t.media.bgSource.indexOf(d["a"].thumbnailUrl)&&-1==t.media.bgSource.indexOf("?token="))g=-1!=location.href.indexOf("uid")?localStorage.getItem("e_thumbnailToken"):localStorage.getItem("thumbnailToken"),u=t.media.bgSource+"?token="+g;fabric.Image.fromURL(u,function(s){if(s.getWidth()<=0){r.hasLoadErrorNum++,r.checkObjsInProductJson(t);try{var d;if(window._jylog)localStorage.getItem("orderInfo")&&(d=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(d=localStorage.getItem("e_orderInfo")),window._jylog.push(["fabric加载图片失败","设计","fabric加载frameImgUrl",s.getWidth()+"-"+u,JSON.parse(d).orderNo])}catch(e){}}else{var c=s;o=new fabric.Group([a,c]),o.layerNum=i,o.setOriginX("left"),o.setOriginY("top"),r.canvas.add(o).renderAll(),c.setCoords(),a.setCoords(),o.setCoords(),o.editorB=!1,l(o,t,r.canvas),fabric.Image.fromURL(m,function(i){if(i.getWidth()<=0){r.hasLoadErrorNum++,r.checkObjsInProductJson(t);try{var a;if(window._jylog)localStorage.getItem("orderInfo")&&(a=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(a=localStorage.getItem("e_orderInfo")),window._jylog.push(["fabric加载图片失败","设计","fabric加载url",i.getWidth()+"-"+m,JSON.parse(a).orderNo])}catch(e){}}else{i.set({originX:"left",originY:"top"}),i.bigPicWidth=i.getWidth(),i.layerAlpha=i.getOpacity().toFixed(2),i.isEdit=!0,i.mediaIsBG=!1,i.mediaImgPath=m,i.mediaMediaType=n["a"].IMAGE,i.protoVisible=i.getVisible();var s=t.media.imgX,l=t.media.imgY,d=t.media.imgWidth*(1+t.media.zoom/10),c=t.media.imgHeight*(1+t.media.zoom/10);i.setLeft(s),i.setTop(l),i.setWidth(d),i.setHeight(c),i.mediaImgX=t.media.imgX,i.mediaImgY=t.media.imgY,i.mediaImgWidth=t.media.imgWidth,i.mediaImgHeight=t.media.imgHeight,i.locationFactWidth=Number(t.location.maskFactWidth),i.locationFactHeight=Number(t.location.maskFactHeight),o.mediaMaskSource=m,r.setAdvanceImgMask(i,o,!0),r.canvas.renderAll(),r.canvasToProductObjArr.push(o),r.checkObjsInProductJson(t)}})}})}else o.setAngle(o.locationRotation)})}},{key:"setImgMask",value:function(e,t,i){var a=t.getObjects()[1];a?(t.removeWithUpdate(a),a=null):t.removeWithUpdate(null);var o=this,s=t.getObjects()[0],n=s.getAngle();e.set("angle",n);e.getWidth(),e.getHeight();t.addWithUpdate(e),0!=n&&(t.setAngle(-n),t.removeWithUpdate(null),t.setAngle(n));var r=o.canvasToProductObjArr.indexOf(e);-1!=r&&o.canvasToProductObjArr.splice(r,1);t.getObjects()[0].getHeight(),t.getObjects()[0].getWidth();e.setLeft(s.getLeft()),e.setTop(s.getTop()),e.globalCompositeOperation="source-in";var l=t.getObjectScaling();t.scaleX=l.scaleX+.1,t.scaleY=l.scaleY+.1,o.canvas.renderAll(),t.scaleX=l.scaleX,t.scaleY=l.scaleY,o.canvas.renderAll(),e.setCoords(),"undefined"!=typeof t.lastOpacity?t.setOpacity(t.lastOpacity):(t.setOpacity(Number(t.layerAlpha)),t.lastOpacity=Number(t.layerAlpha)),t.setCoords(),t.editorB=!1,t.mediaMaskSource=e.mediaImgPath,t.defaultState=!1,t.locationMaskFactWidth=e.locationFactWidth,t.locationMaskFactHeight=e.locationFactHeight;var d=e.mediaImgX,c=e.mediaImgY;if(""!=t.mediaMaskSource&&""!==d&&void 0!=d){var h=t.getObjects()[0];e.setLeft(h.getLeft()+d),e.setTop(h.getTop()+c),1==i&&(t.locationRotation&&t.setAngle(t.locationRotation),t.oldAngle&&t.setAngle(t.oldAngle))}t.setLeft(t.locationX),t.setTop(t.locationY)}},{key:"setAdvanceImgMask",value:function(e,t,i){var a=t.getObjects(),o=a.length;if(3==o){var s=a[1];s&&(a[1]=e,t.removeWithUpdate(s),s=null)}else{s=a[1];t.removeWithUpdate(s),t.addWithUpdate(e),t.addWithUpdate(s)}var n=a[0].getAngle();e.set("angle",n),0!=n&&(t.setAngle(-n),t.removeWithUpdate(null),t.setAngle(n));var r=this.canvasToProductObjArr.indexOf(e);-1!=r&&this.canvasToProductObjArr.splice(r,1);var l=this;e.getWidth(),e.getHeight(),t.getObjects()[0].getHeight(),t.getObjects()[0].getWidth();void 0==i&&CheckMaskImg.automaticMaskGroupSize(e,t),e.setLeft(a[0].getLeft()),e.setTop(a[0].getTop()),e.globalCompositeOperation="source-in";var d=t.getObjectScaling();t.scaleX=d.scaleX+.1,t.scaleY=d.scaleY+.1,l.canvas.renderAll(),t.scaleX=d.scaleX,t.scaleY=d.scaleY,l.canvas.renderAll(),e.setCoords(),"undefined"!=typeof t.lastOpacity?t.setOpacity(t.lastOpacity):(t.setOpacity(Number(t.layerAlpha)),t.lastOpacity=Number(t.layerAlpha)),t.setCoords(),t.editorB=!1,t.mediaMaskSource=e.mediaImgPath,t.defaultState=!1,t.isSimple=!1,t.locationMaskFactWidth=e.locationFactWidth,t.locationMaskFactHeight=e.locationFactHeight;var c=e.mediaImgX,h=e.mediaImgY;if(""!=t.mediaMaskSource&&""!==c&&void 0!=c){var g=t.getObjects()[0];e.setLeft(g.getLeft()+c),e.setTop(g.getTop()+h),1==i&&(t.locationRotation&&t.setAngle(t.locationRotation),t.oldAngle&&t.setAngle(t.oldAngle))}t.setLeft(t.locationX),t.setTop(t.locationY)}},{key:"drawShape",value:function(e,t){var i=this,a=new fabric.Rect;a.setStroke("white"),a.layerNum=t,void 0!=e&&l(a,e,this.canvas),a.selectable=!1,a.objType="bgShpae",a.evented=!1,i.canvas.add(a).renderAll(),i.canvas.renderAll(),i.canvasToProductObjArr.push(a),i.checkObjsInProductJson(e)}},{key:"drawText",value:function(e,t,i){var a=this,o=e.media.text,s=new fabric.Textbox(o,{width:380});s.strokeLineJoin="round",e&&(s.layerNum=t,l(s,e,this.canvas,i)),this.canvas.add(s).renderAll(),s.setCoords(),this.canvas.renderAll(),this.canvasToProductObjArr.push(s),a.checkObjsInProductJson(e)}},{key:"drawSVGFromString",value:function(e,t,i,a){var o=this;fabric.loadSVGFromString(e,function(e,s){var n=fabric.util.groupSVGElements(e,s);n.layerNum=i,l(n,t,o.canvas);var r=Math.round(1e3*Math.cos(n.getAngle()*Math.PI/180))/1e3,d=r,c=(n.getLeft(),n.getTop(),n.paths);void 0!=c&&null!=c&&$.each(c,function(e){var t,i,o=n.paths[e],s=o.transformMatrix;null!=s&&void 0!=s&&"[]"!=JSON.stringify(s)&&(0!=r?(t=Math.abs(s[0]/r),i=Math.abs(s[3]/d)):(t=Math.abs(s[1]/1),i=Math.abs(s[2]/1)),s[0]=1*t,s[3]=1*i,s[1]=0,s[2]=0,void 0==a?(s[4]=0,s[5]=0):(s[4]=a.childX*t,s[5]=a.childY*i,n.setLeft(a.parentX),n.setTop(a.parentY)))}),t.location.svgFactWidth&&(n.svgFactWidth=t.location.svgFactWidth,n.svgFactHeight=t.location.svgFactHeight,n.setLeft(n.locationX),n.setTop(n.locationY)),n.objType="svg",o.canvasToProductObjArr.push(n),o.canvas.add(n).renderAll(),n.setCoords(),void 0!=t.format?o.checkObjsInProductJson(t):o.checkObjsInProductJson(!0)})}},{key:"checkObjsInProductJson",value:function(t){try{if(!t)return;for(var i=this,a=this.canvasToProductObjArr.length,o=this.currentCanvasNum,s=this.detailJson.pageList[o].content.itemList.length,r=this.detailJson.pageList[o].content.itemList,l=0;l<r.length;l++){var d=r[l];"svg"!=d.media.mediaType&&"selfGroup"!=d.media.mediaType||s--}var h=!1,m=!1;if(a==s||a+this.hasLoadErrorNum>=s){var p=this.canvasToProductObjArr;for(var u in p){for(var f in p){var y=p[f];if(0==f){if(y.mediaIsBG);else if(y.layerNum==u){var _=this.canvasToProductObjArr[Number(u)];this.canvasToProductObjArr[Number(u)]=y,this.canvasToProductObjArr[Number(f)]=_}}else if(y.layerNum==u){var v=this.canvasToProductObjArr[Number(u)];this.canvasToProductObjArr[Number(u)]=y,this.canvasToProductObjArr[Number(f)]=v}y&&this.canvas.remove(y)}Number(u)==p.length-1&&(h=!0)}if(0==h)return;for(var w in p){var b=i.canvasToProductObjArr[Number(w)];if(i.canvas.add(b),b.mediaMediaType==n["a"].ADVANCED_IMAGE_MASK||b.mediaMediaType==n["a"].IMAGE_MASK){var I=b.getObjectScaling();b.scaleX=I.scaleX+.1,b.scaleY=I.scaleY+.1,i.canvas.renderAll(),b.scaleX=I.scaleX,b.scaleY=I.scaleY}if(b.cutAreaWidth&&""!=b.cutAreaWidth&&!i.isCuting&&(m=!0,i.cutImgNum++,i.cutImgsArr.push(b)),w==p.length-1){var S=6,x=[],k=[],O=[],L=[],T=[],C=[];for(u=0;u<i.cutImgsArr.length;u++){var P=u%S;switch(P){case 1:x.push(i.cutImgsArr[u]);break;case 2:k.push(i.cutImgsArr[u]);break;case 3:O.push(i.cutImgsArr[u]);break;case 4:L.push(i.cutImgsArr[u]);break;case 5:T.push(i.cutImgsArr[u]);break;case 0:C.push(i.cutImgsArr[u]);break}}i.cutImgsArr=[],m&&!i.isCuting&&(i.reCutImg(x,!1,!0),i.reCutImg(k,!1,!0),i.reCutImg(O,!1,!0),i.reCutImg(L,!1,!0),i.reCutImg(T,!1,!0),i.reCutImg(C,!1,!0),i.isCuting=!0);o=i.currentCanvasNum;c(o,i.detailJson,i.canvasToProductObjArr,i.canvas),0!=m||i.isCuting||(i.canvasDrawComplete=!0),i.canvasDrawComplete&&(console.log("当前页面全部渲染完成！"),console.log("this.currentCanvasNum:"+this.currentCanvasNum),i.setCanvasURL(),g["a"].create("screenShot").trigger("toDataURLComplete",this.base64Str,this.currentCanvasNum,this.isFinalClick))}}}}catch(A){console.log(JSON.stringify(A));try{var j;if(window._jylog)localStorage.getItem("orderInfo")&&(j=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(j=localStorage.getItem("e_orderInfo")),window._jylog.push(["checkObjsInProductJson方法报错","设计","checkObjsInProductJson方法",JSON.stringify(A),JSON.parse(j).orderNo])}catch(e){}g["a"].create("screenShot").trigger("toDataURLComplete",this.base64Str,this.currentCanvasNum,this.isFinalClick)}}},{key:"clearCanvasAndLayer",value:function(){this.canvas.clear(),this.canvasToProductObjArr=[],this.cutImgNum=0,this.drawCutImgCompleteNum=0,this.cutImgsLayerArr=[],this.cutImgsArr=[],this.isCuting=!1,this.canvasDrawComplete=!1,this.isFinalClick=!1}},{key:"reCutImg",value:function(e,t,i){for(var a=this,o=0;o<e.length;o++){var s=e[o],n=(s.mediaImgPath,s.width/s.height),r=(s.noCutWidth,"canvas-imgCut");0==$("#"+r).length?($("body").append('<canvas style="display:none"; id='+r+" ></canvas>"),$("#"+r)[0].width=s.cutAreaWidth,$("#"+r)[0].height=s.cutAreaHeight):($("#"+r)[0].width=s.cutAreaWidth,$("#"+r)[0].height=s.cutAreaHeight);var l={x:s.cutAreaX,y:s.cutAreaY,width:s.cutAreaWidth,height:s.cutAreaHeight,cValue:"undefined"==typeof s.cValue?0:s.cValue},d=s.bigPicWidth;void 0!=s.noCutWidth&&""!=s.noCutWidth||(s.noCutWidth=s.getWidth());var c=Number(s.noCutWidth)/d,h=s.getLeft(),g=s.getTop(),m=document.getElementById(r),p=m.getContext("2d");p.drawImage(s._element,l.x,l.y,l.width,l.height,0,0,l.width,l.height);var u=m.toDataURL();$("#"+r).remove();var f=c,y=(a.canvas.getObjects().indexOf(s),a.canvasToProductObjArr.indexOf(s),s.locationFactWidth),_=s.locationFactHeight,v={x:h,y:g,factWidth:y,factHeight:_},w=s.warnPixObj;a.canvasToProductObjArr.length;if(void 0==i||null==i)var b=s.getScaleX(),I=s.getScaleY();var S=a.canvas.getObjects().indexOf(s),x=a.canvasToProductObjArr.indexOf(s),k=s,O={base64Str:u,x:h,y:g,rotaNum:s.getAngle(),scaleNum:f,bigPicWidth:s.bigPicWidth,noCutWidth:s.noCutWidth,mediaImgPath:s.mediaImgPath,cutData:l,imgJson:v,warnPixObj:w,scaleXNum:b,scaleYnum:I,layerNum:S,arrNum:x,oldImg:k,isUndo:t,isProduct:i};a.drawCutImg(O)}}},{key:"drawCutImg",value:function(t){var i=this;fabric.Image;fabric.Image.fromURL(t.base64Str,function(a){if(a.getWidth()<=0&&1==t.isProduct){i.hasLoadErrorNum++,i.checkObjsInProductJson(productJsonObj);try{var o;if(window._jylog)localStorage.getItem("orderInfo")&&(o=localStorage.getItem("orderInfo")),localStorage.getItem("e_orderInfo")&&(o=localStorage.getItem("e_orderInfo")),window._jylog.push(["fabric加载base64Str失败","设计","fabric加载base64Str",a.getWidth(),JSON.parse(o).orderNo])}catch(e){}}else{a.set({originX:"left",originY:"top"}),a.bigPicWidth=t.bigPicWidth,a.noCutWidth=Number(t.noCutWidth),null!=t.rotaNum&&void 0!=t.rotaNum&&a.setAngle(t.rotaNum),null!=t.x&&void 0!=t.x&&a.setLeft(t.x),null!=t.y&&void 0!=t.y&&a.setTop(t.y),null!=t.imgJson&&void 0!=t.imgJson&&(a.locationFactWidth=t.imgJson.factWidth,a.locationFactHeight=t.imgJson.factHeight),a.layerAlpha=a.getOpacity().toFixed(2),a.isEdit=!0,a.mediaIsBG=!1,a.mediaImgPath=t.mediaImgPath,a.mediaMediaType=n["a"].IMAGE,a.isqrcode=t.isqrcode,a.cutAreaX=t.cutData.x,a.cutAreaY=t.cutData.y,a.cutAreaWidth=t.cutData.width,a.cutAreaHeight=t.cutData.height,a.cValue=t.cutData.cValue,a.markuuid=null!=t.oldImg?t.oldImg.markuuid:t.cutImg.markuuid,a.flipX=null!=t.oldImg?t.oldImg.flipX:t.cutImg.flipX,a.flipY=null!=t.oldImg?t.oldImg.flipY:t.cutImg.flipY,a.setOpacity(null!=t.oldImg?t.oldImg.opacity:t.cutImg.opacity);var s=void 0==t.cutImg?t.oldImg:t.cutImg;if(void 0!=s&&(a.filters=s.filters,a.colorMatrixVals=s.colorMatrixVals,a.applyFilters(),void 0!=s.shadow&&i.drawObjShadow(s,a)),a.protoVisible=a.getVisible(),i.canvas.add(a).renderAll(),a.setCoords(),a.layerHighestB=!1,t.oldImg&&(a.setScaleX(1),a.setScaleY(1),a.setWidth(t.oldImg.getWidth()),a.setHeight(t.oldImg.getHeight())),null!=t.layerNum&&void 0!=t.layerNum&&a.moveTo(t.layerNum),null!=t.arrNum&&void 0!=t.arrNum?i.canvasToProductObjArr.splice(t.arrNum,0,a):i.canvasToProductObjArr.push(a),a.setCoords(),i.canvas.renderAll(),null!=t.oldImg&&void 0!=t.oldImg){a.isEdit=t.oldImg.isEdit,a.layerAlpha=t.oldImg.layerAlpha,0==a.isEdit&&(a.lockMovementX=!0,a.lockMovementY=!0,a.lockRotation=!0,a.lockScalingX=!0,a.lockScalingY=!0),i.canvas.remove(t.oldImg);var r=i.canvasToProductObjArr.indexOf(t.oldImg);-1!=r&&i.canvasToProductObjArr.splice(r,1),i.drawCutImgCompleteNum++,i.drawCutImgCompleteNum>=i.cutImgNum&&(i.canvasDrawComplete=!0)}1==t.isProduct&&i.checkObjsInProductJson(t.isProduct),i.cutImgsArr.length}})}},{key:"setCanvasURL",value:function(){var e,t,i=this,a=(i.canvasToProductObjArr,i.canvasToProductObjArr.slice(-1)[0]);a.isDisplay&&(a.visible=!1);for(var o=0;o<i.canvasToProductObjArr.length;o++)i.canvasToProductObjArr[o].isDesignShape&&(e=i.canvasToProductObjArr[o]),i.canvasToProductObjArr[o].barTypeSign&&(t=i.canvasToProductObjArr[o],t.visible=!1);e||(e=i.canvasToProductObjArr[0]);var s=e.getLeft(),n=e.getTop(),r=e.getWidth(),l=e.getHeight();s||(s=0),n||(n=0),r||(r=i.canvasWidth),l||(l=i.canvasHeight);var d=this.canvas.toDataURL({format:"png",left:s*this.canvasScaleNum,top:n*this.canvasScaleNum,width:r*this.canvasScaleNum,height:l*this.canvasScaleNum});a.isDisplay&&(a.visible=!0),t&&(t.visible=!0),this.base64Str=d,i.canvas.renderAll()}}],[{key:"getInstance",value:function(e){return this._instance||(this._instance=new t(e)),this._instance}}]),t}()},eec9:function(e,t,i){},f0f0:function(e,t,i){},f131:function(e,t,i){"use strict";var a=i("5d33"),o=i.n(a);o.a},f27b:function(e,t,i){},f309:function(e,t,i){},f3e0:function(e,t,i){"use strict";i("6c7b"),i("c5f6"),i("28a5");var a=function(e){if(document.all){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async=!1,t.loadXML(e),t}return(new DOMParser).parseFromString(e,"text/xml")},o=function(e){return window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)},s=function(e){var t;if(window.ActiveXObject)t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.load(e);else if(navigator.userAgent.indexOf("Firefox")>0)t=document.implementation.createDocument("","",null),t.load(e);else{var i=new window.XMLHttpRequest;i.open("GET",e,!1),i.send(null),4==i.readyState&&(t=i.responseXML.documentElement)}return t},n=function(e,t){var i=e.getElementsByTagName(t)[0].getAttribute("transform"),a="";if(-1!=i.indexOf("translate")){var o=i.split(")");for(var s in a="translate(0 0)",o)Number(s)>0&&""!=o[s]&&(a=a+o[s]+")");e.getElementsByTagName(t)[0].setAttribute("transform",a)}},r=function(e){var t,i,a,o=e.getElementsByTagName("g")[0].transform.animVal.getItem("translate").matrix.e,s=e.getElementsByTagName("g")[0].transform.animVal.getItem("translate").matrix.f,n=e.getElementsByTagName("g")[0].childNodes;for(var r in n)if("#text"!=n[r].nodeName){if(void 0==n[r].transform)continue;if(0==n[r].transform.animVal.length)continue;if(void 0==n[r].transform.animVal.getItem("translate"))continue;var l=n[r].transform.animVal.getItem("translate").matrix;if(void 0!=l&&null!=l){t=l.e,i=l.f,a={parentX:o,parentY:s,childX:t,childY:i};break}}return a},l=function(e){var t=e.getElementsByTagName("g")[0].getAttribute("transform"),i="";if(-1!=t.indexOf("translate")){var a=t.split(")");for(var o in i="translate(0 0)",a)Number(o)>0&&""!=a[o]&&(i=i+a[o]+")");e.getElementsByTagName("g")[0].setAttribute("transform",i)}if(-1!=t.indexOf("scale")){t=e.getElementsByTagName("g")[0].getAttribute("transform");var s=t.split(")"),n="scale(1 1)";for(var r in s)-1!=t.indexOf("rotate")?2!=Number(r)&&""!=s[r]&&(n=s[r]+")"+n):1!=Number(r)&&""!=s[r]&&(n=s[r]+")"+n);e.getElementsByTagName("g")[0].setAttribute("transform",n)}var l=[],d=e.getElementsByTagName("g")[0].children;for(o=0;o<d.length;o++){var c=[];if("none"==d.item(o).style.stroke&&"none"==d.item(o).style.fill);else if("g"==d.item(o).nodeName){if("#text"==d.item(o).firstChild.nodeName){if(d.item(o).transform.animVal.length<=0)continue;var h=d.item(o).transform.animVal[0].matrix.e,g=d.item(o).transform.animVal[0].matrix.f;if(d.item(o).transform.animVal.length>1){var m=d.item(o).transform.animVal[1].matrix.a,p=d.item(o).transform.animVal[1].matrix.d;h/=m,g/=p}c=[h,g]}}else d.item(o).setAttribute("transform","translate(0 0)");l.push(c)}return l};t["a"]={createXml:a,xmlToString:o,loadXML:s,resetSVGXmlTransForm:n,parseGXY:l,getParentXYandChildrenXY:r}},f46a:function(e,t,i){e.exports=i.p+"static/img/loading-book.c28ecbf3.gif"},f5b3:function(t,i,a){"use strict";a.d(i,"a",function(){return D});a("c5f6"),a("a481"),a("7f7f"),a("28a5");var o,s,n,r,l,d,c,h,g,m,p=a("d225"),u=a("b0b4"),f=a("308d"),y=a("6bb5"),_=a("4e2b"),v=a("1db1"),w=a("103a"),b=a("cba4"),I=a("0a92"),S=a("a244"),x=a("66a2"),k=a("324d"),O=a("4cbb"),L=a("5841"),T="maskBg",C="maskFact",P="clip_",j="dMaskShape_",A=a("3523"),N="pixWarn_",E=a("35f8"),J="beyondWarn_",D=function(t){function i(e,t,a,o){var s;return Object(p["a"])(this,i),s=Object(f["a"])(this,Object(y["a"])(i).call(this,t)),s.parent=e,s.objJson=t,s.i=a.parentIndex,s.m=a.childIndex,s.selfindex=a.svgindex,s.id=a.id,s.isEdit=a.isEdit,s.isUpdate=a.isUpdate,s.page=a.page,s.click=!1,s.vm=o,s.isPhotoChange=a.isPhotoChange,s.pageImgJson=a.pageImgJson,g=800,m=800,s}return Object(_["a"])(i,t),Object(u["a"])(i,[{key:"initMask",value:function(){-1!=this.id.indexOf("edit")&&this.initMaskBg_editPage(this.parent,this.objJson);var e=this.initMaskFact(this.parent,this.objJson);this.objJson.cutArea||this.initMaskSource(this.parent,this.objJson,e),this.objJson.media.isSimple||this.initMaskBg(this.parent,this.objJson)}},{key:"initClipMask",value:function(e){var t,i=this,a="";if(a=i.selfindex?P+i.i+"_"+i.m+"_"+i.selfindex:P+i.i+"_"+i.m,SVG("#"+a)){t=i.parent.rect();var o=e.width()/decorateImg.attr("bigFactWidth");t.x(e.x()+i.objJson.cutArea.x*o),t.y(e.y()+i.objJson.cutArea.y*o),t.width(i.objJson.cutArea.width*o),t.height(i.objJson.cutArea.height*o),t.attribute({id:a,isClip:!0,relativeBigX:i.objJson.cutArea.x,relativeBigY:i.objJson.cutArea.y,relativeBigW:i.objJson.cutArea.width,relativeBigH:i.objJson.cutArea.height}),e.clipWith(t)}}},{key:"initMaskFact",value:function(e,t){var i,a=this;if(i=a.isEdit?"edit_"+T+"_"+a.i+"_"+a.m:T+"_"+a.i+"_"+a.m,void 0!=this.selfindex&&(i=i+"_"+a.selfindex),SVG("#"+i)){var o=SVG("#"+i);return o}var s="";if(void 0!=this.selfindex&&-1==t.media.factMaskSource.indexOf(Object(w["d"])(t.media.factMaskSource))&&(t.media.factMaskSource=Object(w["d"])(t.media.factMaskSource)+Object(w["a"])(t.media.factMaskSource,t,this.vm.pageKey)),s=t.media.factMaskSource,-1!=t.media.factMaskSource.indexOf(L["a"].thumbnailUrl)&&-1==t.media.factMaskSource.indexOf("?token=")){var n=localStorage.getItem(a.vm.pageKey.thumbnailToken);s=t.media.factMaskSource+"?token="+n}var r,l,d,c;o=e.image(s,function(e){if(a.pageImgJson.imgArr.length>0){var t=e.target.src;if(-1!=t.indexOf(L["a"].thumbnailUrl)){var i=t.split(L["a"].thumbnailUrl),o=i[1].split("?token=");t=L["a"].thumbnailUrl+o[0]}var s=a.pageImgJson.imgArr.indexOf(t);-1!=s&&a.pageImgJson.imgArr.splice(s,1),a.pageImgJson.imgArr.length<=0&&(a.vm.isShowLoading=!1,console.log("页面加载完"),a.vm.everyTimeRender&&a.vm.everyTimeRender())}});if(o.on("error",function(e){if(console.log("遮罩背景下载失败"),a.pageImgJson.imgArr.length>0){var t=s;if(-1!=t.indexOf(L["a"].thumbnailUrl)){var i=t.split(L["a"].thumbnailUrl),o=i[1].split("?token=");t=L["a"].thumbnailUrl+o[0]}var n=a.pageImgJson.imgArr.indexOf(t);-1!=n&&a.pageImgJson.imgArr.splice(n,1),a.pageImgJson.imgArr.length<=0&&(a.vm.isShowLoading=!1,console.log("页面加载完"),a.vm.everyTimeRender&&a.vm.everyTimeRender())}}),d=a.objJson.printLocation.x+a.objJson.printLocation.width/2,c=a.objJson.printLocation.y+a.objJson.printLocation.height/2,a.isEdit&&(d=a.objJson.printLocation.width/2,c=a.objJson.printLocation.height/2),0==a.objJson.location.rotation){r=a.objJson.location.x,l=a.objJson.location.y;var h=a.vm.$store.getters.detailJson;if(void 0!=a.selfindex&&0!=h.pageList[a.i].content.itemList[a.m].location.rotation){h=a.vm.$store.getters.detailJson;u=0-a.objJson.location.rotation-h.pageList[a.i].content.itemList[a.m].location.rotation;var g=Object(S["b"])(a.objJson.location.x,a.objJson.location.y,u,d,c);r=g.x,l=g.y}}else{var m=a.objJson.location.x,p=a.objJson.location.y,u=0-a.objJson.location.rotation;if(void 0!=a.selfindex){h=a.vm.$store.getters.detailJson;u=0-a.objJson.location.rotation-h.pageList[a.i].content.itemList[a.m].location.rotation}g=Object(S["b"])(m,p,u,d,c);r=g.x,l=g.y}return o.attr({id:i,x:r,y:l,width:t.location.width,height:t.location.height,preserveAspectRatio:"none","background-color":"red"}),t.location.width,t.location.height,a.isEdit&&o.attr({x:0,y:0}),o.filterWith(function(e){e.colorMatrix("matrix",[100,0,0,0,0,100,0,0,0,0,100,0,0,0,0,0,0,0,100,0])}),o}},{key:"initMaskSource",value:function(t,i,a){var o,s,n,r,l,d=this,c=i.media.maskSource;if(void 0!=this.selfindex&&-1==i.media.maskSource.indexOf(Object(w["d"])(i.media.maskSource))&&(i.media.maskSource=Object(w["d"])(i.media.maskSource)+Object(w["a"])(i.media.maskSource,i,this.vm.pageKey)),c=i.media.maskSource,-1!=i.media.maskSource.indexOf(L["a"].thumbnailUrl)&&-1==i.media.maskSource.indexOf("?token=")){var h=localStorage.getItem(d.vm.pageKey.thumbnailToken);if(c=i.media.maskSource+"?token="+h,-1!=c.indexOf("commonUpload/"))if(-1!=c.indexOf("fsferry/")){var g=c.split("fsferry/commonUpload/");c=g[0]+g[1]}else{g=c.split("commonUpload/");c=g[0]+g[1]}}else try{if(-1!=i.media.maskSource.indexOf(L["a"].thumbnailUrl)&&-1!=i.media.maskSource.indexOf("?token=")&&-1!=i.media.maskSource.indexOf("commonUpload/"))if(-1!=c.indexOf("fsferry/")){g=c.split("fsferry/commonUpload/");c=g[0]+g[1]}else{g=c.split("commonUpload/");c=g[0]+g[1]}if(-1==i.media.maskSource.indexOf("img/nophoto.jpg")&&window._jylog){var m=localStorage.getItem(d.vm.pageKey.orderInfo);window._jylog.push(["渲染路径记录","设计页面","警告",i.media.maskSource,JSON.parse(m).orderNo])}}catch(e){console.log(e)}if(SVG("#"+d.id)){var p=JSON.parse(localStorage.getItem(d.vm.pageKey.detailJson));if(-1!=d.id.indexOf("edit")){if(d.isPhotoChange){d.vm.isBeyond=!1,d.objJson.isBeyond=!1,p.pageList[d.i].content.itemList[d.m].isBeyond=!1;var u=JSON.stringify(p);localStorage.setItem(d.vm.pageKey.detailJson,u)}}else 0==d.objJson.isBeyond&&SVG("#"+J+d.i+"_"+d.m)&&(SVG("#"+J+d.i+"_"+d.m).remove(),SVG("#rect"+J+d.i+"_"+d.m).remove());d.isPhotoChange?(a.parent().remove(),SVG("#"+d.id).remove(),i.media.isSimple||(d.isEdit?SVG("#edit"+C+"_"+d.i+"_"+d.m).remove():SVG("#"+C+"_"+d.i+"_"+d.m).remove()),o=d.loadSource(t,c,o,i,d,a,d.isPhotoChange)):o=SVG("#"+d.id)}else o=d.loadSource(t,c,o,i,d,a,d.isPhotoChange);o.on("error",function(e){console.log("照片下载失败")});try{SVG("#"+d.id)||o.maskWith(a)}catch(e){try{if(window._jylog){m=localStorage.getItem(d.vm.pageKey.orderInfo);window._jylog.push(["弹窗提示","设计页面","警告","相框遮罩效果失效！请刷新或联系客服",JSON.parse(m).orderNo])}}catch(e){console.log(e)}d.vm.$layer.alert("相框遮罩效果失效！请刷新或联系客服");try{if(window._czc){p=JSON.parse(localStorage.getItem(d.vm.pageKey.detailJson)),m=localStorage.getItem(d.vm.pageKey.orderInfo);null!=m&&void 0!=m&&window._czc.push(["_trackEvent","剪影","设计页面","照片遮罩失效"+JSON.parse(m).orderNo+","+JSON.parse(m).productNo+","+p.templateInfo.name+","+o.id()])}}catch(e){console.log(e)}}if(d.isEdit,r=d.objJson.printLocation.x+d.objJson.printLocation.width/2,l=d.objJson.printLocation.y+d.objJson.printLocation.height/2,d.isEdit&&(r=d.objJson.printLocation.width/2,l=d.objJson.printLocation.height/2),0==d.objJson.location.rotation){s=d.objJson.location.x,n=d.objJson.location.y;p=d.vm.$store.getters.detailJson;if(void 0!=d.selfindex&&0!=p.pageList[this.i].content.itemList[this.m].location.rotation){var f=0-d.objJson.location.rotation-p.pageList[this.i].content.itemList[this.m].location.rotation,y=Object(S["b"])(d.objJson.location.x,d.objJson.location.y,f,r,l);s=y.x,n=y.y;var _="rotate(0,"+r+","+l+")";o.attr({transform:_})}}else{var v=d.objJson.location.x,b=d.objJson.location.y;f=0-d.objJson.location.rotation;if(void 0!=d.selfindex){p=d.vm.$store.getters.detailJson;f=0-d.objJson.location.rotation-p.pageList[this.i].content.itemList[this.m].location.rotation}y=Object(S["b"])(v,b,f,r,l);s=y.x,n=y.y;_="rotate(0,"+r+","+l+")";o.attr({transform:_})}var I,x=r,k=l;I=i.location.rotation%90==0?i.location.rotation:0;p=d.vm.$store.getters.detailJson;var O=d.objJson.location.rotation;void 0!=this.selfindex&&(O=d.objJson.location.rotation+p.pageList[this.i].content.itemList[this.m].location.rotation);_="rotate("+O+","+x+","+k+")";if(d.isEdit&&(_="rotate("+I+","+x+","+k+")"),0!=o.width()){var T=100,P=100;0==i.media.zoom?(T=i.media.imgWidth,P=i.media.imgHeight):(T=i.media.imgWidth*(1+i.media.zoom/10),P=i.media.imgHeight*(1+i.media.zoom/10)),o.attr({width:T,height:P})}o.attr({x:s+i.media.imgX,y:n+i.media.imgY});var j="",A="";if(d.vm.isAlbum){var N=[{animatedClass:" wow fadeInUp animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInUp;"},{animatedClass:" wow fadeInLeftBig animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInLeftBig;"},{animatedClass:" wow fadeInDown animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: fadeInDown;"},{animatedClass:" wow bounceInDown animated",animatedStyle:" visibility: visible; animation-delay: 0.1s;animation-name: bounceInDown;"}],E=0,D=N.length-1,B=D-E,K=Math.random(),M=(E+B*K).toFixed(0);j=N[M].animatedClass,A=N[M].animatedStyle;var $=SVG("#group"+d.i+"_"+d.m);$.attr({class:j,"data-wow-delay":"0.2s",style:A})}if(o.attr({class:"bgimg myimg",id:d.id,ty:i.media.mediaType,transform:_}),d.isEdit&&o.attr({x:i.media.imgX,y:i.media.imgY}),0!=o.width()){p=JSON.parse(localStorage.getItem(d.vm.pageKey.detailJson));d.initPixWarnImg(d,o,p)}d.isEdit&&this.editImg(o,a)}},{key:"initPixWarnImg",value:function(e,t,i){if(!e.vm.isAlbum){var a,o="#"+N+e.i+"_"+e.m;e.isEdit&&(o="#edit"+N+e.i+"_"+e.m),(e.objJson.location.maskFactHeight<m||e.objJson.location.maskFactWidth<g)&&-1==e.objJson.media.maskSource.indexOf("img/nophoto.jpg")?SVG(o)?(a=SVG(o),a.remove(),a=e.loadWarnPix(i),e.vm.isLowPixel=!0):(a=e.loadWarnPix(i),e.vm.isLowPixel=!0):q(t,e,i)}}},{key:"initMaskBg",value:function(e,t){var i,a=this;i=a.isEdit?"edit"+C+"_"+a.i+"_"+a.m:C+"_"+a.i+"_"+a.m,a.selfindex&&(i=i+"_"+a.selfindex);var o,s,n,r,l,d=t.media.bgSource;if(void 0!=a.selfindex&&(d=Object(w["d"])(t.media.bgSource)+Object(w["a"])(t.media.bgSource,t,this.vm.pageKey)),-1!=d.indexOf(L["a"].thumbnailUrl)&&-1==d.indexOf("?token=")){var c=localStorage.getItem(a.vm.pageKey.thumbnailToken);d=d+"?token="+c}if(o=SVG("#"+i)?SVG("#"+i):e.image(d,function(e){if(a.pageImgJson.imgArr.length>0){var t=e.target.src;if(-1!=t.indexOf(L["a"].thumbnailUrl)){var i=t.split(L["a"].thumbnailUrl),o=i[1].split("?token=");t=L["a"].thumbnailUrl+o[0]}var s=a.pageImgJson.imgArr.indexOf(t);-1!=s&&a.pageImgJson.imgArr.splice(s,1),0==a.i&&console.log("第一页:"+a.pageImgJson.imgArr.length),a.pageImgJson.imgArr.length<=0&&(a.vm.isShowLoading=!1,console.log("页面加载完"),a.vm.everyTimeRender&&a.vm.everyTimeRender())}}),o.on("error",function(e){if(console.log("遮罩框子下载失败"),a.pageImgJson.imgArr.length>0){var t=d;if(-1!=t.indexOf(L["a"].thumbnailUrl)){var i=t.split(L["a"].thumbnailUrl),o=i[1].split("?token=");t=L["a"].thumbnailUrl+o[0]}var s=a.pageImgJson.imgArr.indexOf(t);-1!=s&&a.pageImgJson.imgArr.splice(s,1),0==a.i&&console.log("第一页:"+a.pageImgJson.imgArr.length),a.pageImgJson.imgArr.length<=0&&(a.vm.isShowLoading=!1,console.log("页面加载完"),a.vm.everyTimeRender&&a.vm.everyTimeRender())}}),r=a.objJson.printLocation.x+a.objJson.printLocation.width/2,l=a.objJson.printLocation.y+a.objJson.printLocation.height/2,a.isEdit&&(r=a.objJson.printLocation.width/2,l=a.objJson.printLocation.height/2),0==a.objJson.location.rotation){s=a.objJson.location.x,n=a.objJson.location.y;var h=a.vm.$store.getters.detailJson;if(void 0!=a.selfindex&&0!=h.pageList[a.i].content.itemList[a.m].location.rotation){f=0-a.objJson.location.rotation-h.pageList[a.i].content.itemList[a.m].location.rotation;var g=Object(S["b"])(a.objJson.location.x,a.objJson.location.y,f,r,l);s=g.x,n=g.y}var m="rotate(0,"+r+","+l+")";o.attr({transform:m})}else{var p=a.objJson.location.x,u=a.objJson.location.y,f=0-a.objJson.location.rotation;if(void 0!=a.selfindex){h=a.vm.$store.getters.detailJson;f=0-a.objJson.location.rotation-h.pageList[a.i].content.itemList[a.m].location.rotation}g=Object(S["b"])(p,u,f,r,l);s=g.x,n=g.y;m="rotate(0,"+r+","+l+")";o.attr({transform:m})}var y,_=r,v=l;y=t.location.rotation%90==0?t.location.rotation:0;h=a.vm.$store.getters.detailJson;var b=a.objJson.location.rotation;void 0!=a.selfindex&&(b=a.objJson.location.rotation+h.pageList[a.i].content.itemList[a.m].location.rotation);m="rotate("+b+","+_+","+v+")";a.isEdit&&(m="rotate("+y+","+_+","+v+")"),o.attr({id:i,x:s,y:n,width:t.location.width,height:t.location.height,transform:m,style:"pointer-events: none"}),a.isEdit&&o.attr({x:0,y:0})}},{key:"initMaskBg_editPage",value:function(e,t){var i,a=this;i="edit"+T+"_"+a.i+"_"+a.m,this.selfindex&&(i=i+"_"+this.selfindex);var o,s,n,r,l,d=t.media.factMaskSource;if(-1!=t.media.factMaskSource.indexOf(L["a"].thumbnailUrl)&&-1==t.media.factMaskSource.indexOf("?token=")){var c=localStorage.getItem(a.vm.pageKey.thumbnailToken);d=t.media.factMaskSource+"?token="+c}if(o=SVG("#"+i)?SVG("#"+i):e.image(d,function(e){}),o.on("error",function(e){console.log("背景底图下载失败")}),r=a.objJson.printLocation.x+a.objJson.printLocation.width/2,l=a.objJson.printLocation.y+a.objJson.printLocation.height/2,a.isEdit&&(r=a.objJson.printLocation.width/2,l=a.objJson.printLocation.height/2),0==a.objJson.location.rotation)s=a.objJson.location.x,n=a.objJson.location.y;else{var h=a.objJson.location.x,g=a.objJson.location.y,m=0-a.objJson.location.rotation,p=Object(S["b"])(h,g,m,r,l);s=p.x,n=p.y;var u="rotate(0,"+r+","+l+")";o.attr({transform:u})}var f,y=r,_=l;f=t.location.rotation%90==0?t.location.rotation:0;u="rotate("+t.location.rotation+","+y+","+_+")";a.isEdit&&(u="rotate("+f+","+y+","+_+")"),o.attr({id:i,x:s,y:n,width:t.location.width,height:t.location.height,transform:u,style:"pointer-events: none"}),a.isEdit&&o.attr({x:0,y:0})}},{key:"editImg",value:function(e,t){var i=this,a=document.getElementById("drawing2"),o=document.getElementById(e.id());i.click=!0,o.addEventListener("touchstart",function(t){B(t,e)}),o.addEventListener("touchmove",function(a){K(a,i,e),F(e,t)},{passive:!1}),o.addEventListener("touchend",function(a){try{if(window._jylog){var o=localStorage.getItem(i.vm.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","图片移动",i.i+","+i.m,JSON.parse(o).orderNo])}}catch(a){console.log(a)}M(a,i,e),R(e,t),F(e,t);var s=JSON.parse(localStorage.getItem(i.vm.pageKey.detailJson));0==i.selfindex||i.selfindex?(s.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.imgX=e.x(),s.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.imgY=e.y()):(s.pageList[i.i].content.itemList[i.m].media.imgX=e.x(),s.pageList[i.i].content.itemList[i.m].media.imgY=e.y());var n,r=JSON.stringify(s);localStorage.setItem(i.vm.pageKey.detailJson,r),n=0==i.selfindex||i.selfindex?s.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.zoom:s.pageList[i.i].content.itemList[i.m].media.zoom,i.updateFaceArea(e,s,n)});var s=document.getElementById(e.id()),n=Object(b["a"])(s,a);n.gesturestart=function(t){$(t,e)},n.gesturemove=function(a){U(a,i,e,t)},n.gestureend=function(a){try{if(window._jylog){var o=localStorage.getItem(i.vm.pageKey.orderInfo);window._jylog.push(["按钮点击","设计","图片缩放","",JSON.parse(o).orderNo])}}catch(a){console.log(a)}R(e,t);var s,n=JSON.parse(localStorage.getItem(i.vm.pageKey.detailJson));0==i.selfindex||i.selfindex?(n.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.imgX=e.x(),n.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.imgY=e.y(),s=(e.width()/n.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.imgWidth).toFixed(4)):(n.pageList[i.i].content.itemList[i.m].media.imgX=e.x(),n.pageList[i.i].content.itemList[i.m].media.imgY=e.y(),s=(e.width()/n.pageList[i.i].content.itemList[i.m].media.imgWidth).toFixed(4)),q(e,i,n);var r=(10*(s-1)).toFixed(2);0==i.selfindex||i.selfindex?n.pageList[i.i].content.itemList[i.m].childrenElement[i.selfindex].media.zoom=r:n.pageList[i.i].content.itemList[i.m].media.zoom=r;var l=JSON.stringify(n);localStorage.setItem(i.vm.pageKey.detailJson,l),i.updateFaceArea(e,n,r)}}},{key:"faceTest",value:function(t,i){var a=this,o={};t.split("/image/");if(o.url=t,o.width=Math.round(i.media.imgWidth),o.height=Math.round(i.media.imgHeight),o.x=i.media.imgX,o.y=i.media.imgY,o.zoom=i.media.zoom,o.pageIndex=a.i,o.itemIndex=a.m,a.isPhotoChange&&(a.vm.faceTestArr.push(o),1==a.vm.faceTestArr.length)){try{if(window._jylog){var s=localStorage.getItem(a.vm.pageKey.orderInfo);window._jylog.push(["渲染路径记录处理前","设计页面faceTest人脸识别","警告",o.url,JSON.parse(s).orderNo])}}catch(e){console.log(e)}if(-1!=window.location.href.indexOf("https")&&-1!=o.url.indexOf("http")){var n=o.url.split("http");o.url="https"+n[1]}if(-1!=window.location.href.indexOf("http")&&-1!=o.url.indexOf("https")&&-1==o.url.indexOf(L["a"].thumbnailUrl)){n=o.url.split("https");o.url="http"+n[1],-1!=window.location.href.indexOf("http://ws.jndx.net/jianying")&&(n=o.url.split("jianying"),o.url="http://ws.jndx.net/jianying"+n[1])}try{if(window._jylog){s=localStorage.getItem(a.vm.pageKey.orderInfo);window._jylog.push(["渲染路径记录处理后","设计页面faceTest人脸识别","警告",o.url,JSON.parse(s).orderNo])}}catch(e){console.log(e)}a.vm.faceTestUrl=o.url,a.vm.$set(a.vm.currentPhotoJson,"url",o.url),a.vm.$set(a.vm.currentPhotoJson,"width",o.width),a.vm.$set(a.vm.currentPhotoJson,"height",o.height),a.vm.photoCanvas=document.getElementById("photoCanvas").getContext("2d"),a.vm.$nextTick(function(){a.vm.photoDom=document.getElementById("imgDom"),a.vm.faceTest(a.vm.photoCanvas,a.vm.photoDom,o)})}}},{key:"updateFaceArea",value:function(e,t,i){var a=this;if(t.pageList[a.i].content.itemList[a.m].photoFacePosition){for(var o=t.pageList[a.i].content.itemList[a.m].photoFacePosition,s=!1,n=0;n<o.length;n++){var r={};r.x=e.x()+t.pageList[a.i].content.itemList[a.m].photoFacePosition[n].x*(1+i/10),r.y=e.y()+t.pageList[a.i].content.itemList[a.m].photoFacePosition[n].y*(1+i/10),r.width=t.pageList[a.i].content.itemList[a.m].photoFacePosition[n].width*(1+i/10),r.height=r.width,console.log("zoomNum:"+i);var l=r.x,d=r.y,c=l+r.width,h=d+r.height,g=0,m=0,p=g+t.pageList[a.i].content.itemList[a.m].printLocation.width,u=m+t.pageList[a.i].content.itemList[a.m].printLocation.height,f=SVG("#facerect_"+a.i+"_"+a.m+"_"+n);if(!f){var y=SVG("#edit_group");f=y.rect(),f.attr({id:"facerect_"+a.i+"_"+a.m+"_"+n,"stroke-width":3,stroke:"#FF4C88",fill:"none","pointer-events":"none",style:"pointer-events: none;display:none"})}f.attr({x:r.x,y:r.y,width:r.width,height:r.height}),l>=g&&d>=m&&c<=p&&h<=u||(s=!0,a.vm.isBeyond=!0)}a.vm.notTestFace||(s?(t.pageList[a.i].isBeyond=!0,t.pageList[a.i].content.itemList[a.m].isBeyond=!0,t.pageList[a.i].content.itemList[a.m].hasWarn=!0):(a.vm.isBeyond=!1,t.pageList[a.i].isBeyond=!1,t.pageList[a.i].content.itemList[a.m].isBeyond=!1)),a.vm.$store.dispatch("updatePages",t);var _=JSON.stringify(t);localStorage.setItem(a.vm.pageKey.detailJson,_)}}},{key:"loadSource",value:function(t,i,a,o,s,n,r){if(this.isEdit&&SVG("#edit_group"))for(var l=SVG("#edit_group").children(),d=0;d<l.length;d++)-1!=l[d].id().indexOf("facerect_")&&l[d].remove();s=this;try{var c=performance.now()}catch(e){}return a=t.image(i,function(e){try{var t=performance.now(),l=(t-c)/1e3;if(l>3&&window._jylog){var d=localStorage.getItem(s.vm.pageKey.orderInfo);window._jylog.push(["相框照片加载","渲染","加载时长",s.i+"_"+s.m+":"+l,JSON.parse(d).orderNo])}}catch(e){}var h,g;if(this.attr({bigFactWidth:this.width(),bigFactHeight:this.height()}),r){W(this,n),F(this,n);var m=JSON.parse(localStorage.getItem(s.vm.pageKey.detailJson));0==s.selfindex||s.selfindex?(m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgX=a.x()-n.x(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgY=a.y()-n.y(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgWidth=a.width(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgHeight=a.height(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.zoom=0,m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.originalImgWidth&&(m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.originalImgWidth=""),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.originalImgHeight&&(m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.originalImgHeight="")):(m.pageList[s.i].content.itemList[s.m].media.imgX=a.x()-n.x(),m.pageList[s.i].content.itemList[s.m].media.imgY=a.y()-n.y(),m.pageList[s.i].content.itemList[s.m].media.imgWidth=a.width(),m.pageList[s.i].content.itemList[s.m].media.imgHeight=a.height(),m.pageList[s.i].content.itemList[s.m].media.zoom=0,m.pageList[s.i].content.itemList[s.m].media.originalImgWidth&&(m.pageList[s.i].content.itemList[s.m].media.originalImgWidth=""),m.pageList[s.i].content.itemList[s.m].media.originalImgHeight&&(m.pageList[s.i].content.itemList[s.m].media.originalImgHeight=""));var p=JSON.stringify(m);localStorage.setItem(s.vm.pageKey.detailJson,p),s.vm.$store.dispatch("updatePages",m),o=0==s.selfindex||s.selfindex?m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex]:m.pageList[s.i].content.itemList[s.m]}0==o.media.zoom?(h=o.media.imgWidth,g=o.media.imgHeight):(h=o.media.imgWidth*(1+o.media.zoom/10),g=o.media.imgHeight*(1+o.media.zoom/10));var u=this.width()/this.height(),f=h/g;if(Math.abs(u-f)>.05){console.log("差值",Math.abs(u-f));var y=n.width(),_=n.height(),v=y/_;u>=v?h=g*u:g=h/u}this.attr({width:h,height:g});m=JSON.parse(localStorage.getItem(s.vm.pageKey.detailJson));if(s.initPixWarnImg(s,a,m),s.objJson.isBeyond)if(-1!=s.id.indexOf("edit"))s.vm.isBeyond=!0;else if("album"!=s.vm.$route.name)s.loadWarnBeyond(m);if(Math.abs(u-f)>.05){W(this,n),F(this,n);m=JSON.parse(localStorage.getItem(s.vm.pageKey.detailJson));0==s.selfindex||s.selfindex?(m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgX=a.x()-n.x(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgY=a.y()-n.y(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgWidth=a.width(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.imgHeight=a.height(),m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex].media.zoom=0):(m.pageList[s.i].content.itemList[s.m].media.imgX=a.x()-n.x(),m.pageList[s.i].content.itemList[s.m].media.imgY=a.y()-n.y(),m.pageList[s.i].content.itemList[s.m].media.imgWidth=a.width(),m.pageList[s.i].content.itemList[s.m].media.imgHeight=a.height(),m.pageList[s.i].content.itemList[s.m].media.zoom=0);p=JSON.stringify(m);void 0!=this.selfindex||(localStorage.setItem(s.vm.pageKey.detailJson,p),s.vm.$store.dispatch("updatePages",m));try{if(window._czc){d=localStorage.getItem(s.vm.pageKey.orderInfo);null!=d&&void 0!=d&&window._czc.push(["_trackEvent","剪影","照片编辑页面","照片比例异常"+JSON.parse(d).orderNo+","+JSON.parse(d).productNo+","+m.templateInfo.name+","+this.id()])}}catch(e){console.log(e)}}if(s.pageImgJson.imgArr.length>=0){var b=e.target.src;if(-1!=e.target.src.indexOf("img/nophoto.jpg")&&(b="img/nophoto.jpg"),-1!=b.indexOf(L["a"].thumbnailUrl)){var I=b.split(L["a"].thumbnailUrl),S=I[1].split("?token=");b=-1!=o.media.maskSource.indexOf("fsferry/")?L["a"].thumbnailUrl+"fsferry/commonUpload/"+S[0]:L["a"].thumbnailUrl+"commonUpload/"+S[0]}var x=s.pageImgJson.imgArr.indexOf(b);if(-1!=x&&s.pageImgJson.imgArr.splice(x,1),s.pageImgJson.imgArr.length<=0){try{if(s.vm.firstLoadPageStartTime&&-1!=window.location.href.indexOf("design")&&s.i<1){var k=performance.now(),T=(k-s.vm.firstLoadPageStartTime)/1e3;if(console.log("loadCostTime:"+T),window._jylog){d=localStorage.getItem(s.vm.pageKey.orderInfo);window._jylog.push(["页面loading","设计页面","设计页面loading时长",T,JSON.parse(d).orderNo])}s.vm.firstLoadPageStartTime=null}}catch(e){console.log(e)}s.vm.isShowLoading=!1,console.log("页面加载完"),s.vm.everyTimeRender&&s.vm.everyTimeRender()}}if(r&&(-1!=s.id.indexOf("edit")&&s.isPhotoChange&&-1==o.media.maskSource.indexOf("img.alicdn.com")&&(s.vm.faceTestArr=[],s.vm.loadingShow_faceTest=!0,setTimeout(function(){s.faceTest(i,o)},10)),-1==s.id.indexOf("edit")&&""!=o.media.maskSource&&-1==o.media.maskSource.indexOf("nophoto"))){m=JSON.parse(localStorage.getItem(s.vm.pageKey.detailJson));var C=m.pageList[s.i];if(o=0==s.selfindex||s.selfindex?m.pageList[s.i].content.itemList[s.m].childrenElement[s.selfindex]:m.pageList[s.i].content.itemList[s.m],o.photoFacePosition)for(var P=o.photoFacePosition,j=o.media.zoom,A=0;A<P.length;A++){var N=P[A].x,E=P[A].y;J=D=P[A].width*(1+j/10),s.hitFaceArea(N,E,J,D,o,C,m)}else if(o.characterArea&&o.characterArea.areaX){N=o.characterArea.areaX*o.media.imgWidth,E=o.characterArea.areaY*o.media.imgHeight;var J=o.characterArea.areaW*o.media.imgWidth,D=o.characterArea.areaH*o.media.imgHeight;s.hitFaceArea(N,E,J,D,o,C,m)}else{var B=Object(w["d"])(o.media.maskSource),K=Object(w["f"])(o.media.maskSource,o).replace(B,""),M=[{src:K,factWidth:o.location.maskFactWidth,factHeight:o.location.maskFactHeight}];Object(O["S"])(M).then(function(e){if(e.result){var t=o.media.imgWidth,i=o.media.imgHeight,a=e.data[0],n=a.split(","),r=n[1]*t,l=n[3]*t,d=n[2]*i,c=n[4]*i,h={};h.areaX=n[1],h.areaY=n[2],h.areaW=n[3],h.areaH=n[4],o.characterArea=h,s.hitFaceArea(r,d,l,c,o,C,m)}}).catch(function(e){console.log(e)})}}}),a.on("error",function(e){if(console.log("照片下载失败"),s.pageImgJson.imgArr.length>0){var t=i;if(-1!=i.indexOf("img/nophoto.jpg")&&(t="img/nophoto.jpg"),-1!=t.indexOf(L["a"].thumbnailUrl)){var a=t.split(L["a"].thumbnailUrl),n=a[1].split("?token=");t=-1!=o.media.maskSource.indexOf("fsferry/")?L["a"].thumbnailUrl+"fsferry/commonUpload/"+n[0]:L["a"].thumbnailUrl+"commonUpload/"+n[0]}var r=s.pageImgJson.imgArr.indexOf(t);-1!=r&&s.pageImgJson.imgArr.splice(r,1),s.pageImgJson.imgArr.length<=0&&(s.vm.isShowLoading=!1,console.log("页面加载完"),s.vm.everyTimeRender&&s.vm.everyTimeRender())}}),Object(k["b"])(a,o),a}},{key:"hitFaceArea",value:function(e,t,i,a,o,s,n){var r=this;if(!r.vm.notTestFace){var l=o.printLocation.x+o.media.imgX+e,d=o.printLocation.y+o.media.imgY+t,c=l+i,h=d+a,g=o.printLocation.x,m=o.printLocation.y,p=g+o.printLocation.width,u=m+o.printLocation.height;if(l>=g&&d>=m&&Math.floor(c)<=p&&Math.floor(h)<=u){n.pageList[r.i].content.itemList[r.m].isBeyond=!1,o.isBeyond=!1;var f=s.content.itemList,y=!0;for(var _ in f)f[_].isBeyond&&(y=!1);y&&(s.isBeyond=!1,n.pageList[r.i].isBeyond=!1);var v=JSON.stringify(n);r.vm.$store.dispatch("updatePages",n),localStorage.setItem(r.vm.pageKey.detailJson,v)}else{s.isBeyond=!0,n.pageList[r.i].isBeyond=!0,n.pageList[r.i].hasWarn=!0,-1!=r.m&&(n.pageList[r.i].content.itemList[r.m].isBeyond=!0,o.isBeyond=!0);v=JSON.stringify(n);r.vm.$store.dispatch("updatePages",n),localStorage.setItem(r.vm.pageKey.detailJson,v),!0,r.loadWarnBeyond(n)}}}},{key:"loadWarnBeyond",value:function(e){var t=575,i=80,a=30,o=i,s=a;if(SVG("#"+this.id)){var n,r=SVG("#"+this.id).attr("transform");n=this.parent.image(E,function(){});var l,d,c,h,g=this.parent.rect(),m=this;if(c=m.objJson.printLocation.x+m.objJson.printLocation.width/2,h=m.objJson.printLocation.y+m.objJson.printLocation.height/2,0==m.objJson.location.rotation)l=m.objJson.location.x,d=m.objJson.location.y;else{var p=m.objJson.location.x,u=m.objJson.location.y,f=0-m.objJson.location.rotation,y=Object(S["b"])(p,u,f,c,h);l=y.x,d=y.y;var _="rotate(0,"+c+","+h+")";g.attr({transform:_}),n.attr({transform:_})}g.attr({id:"rect"+J+this.i+"_"+this.m,x:l,y:d,width:this.objJson.location.width,height:this.objJson.location.height,"stroke-width":2,stroke:"#FF4C88",fill:"none","pointer-events":"none",style:"pointer-events: none"}),0!=m.objJson.location.rotation&&g.attr({transform:r});this.objJson.location.x,this.objJson.location.y;if(this.isEdit);else{var v=e.pageList[this.i].diyDisplayWidth/t;o=i*v,s=a*v,n.attr({id:J+this.i+"_"+this.m})}return n.attr({class:"show-warn",width:o,height:s,x:l,y:d,style:"pointer-events: none"}),0!=m.objJson.location.rotation&&n.attr({transform:r}),n}}},{key:"loadWarnPix",value:function(e){var t=575,i=40,a=258,o=31,s=i,n=10,r=this.parent.image(A,function(){}),l=this.objJson.location.x,d=this.objJson.location.y;if(this.isEdit){var c=e.pageList[this.i].content.itemList[this.m].location.width/a,h="edit"+N+this.i+"_"+this.m;(this.selfindex||0==this.selfindex)&&(c=e.pageList[this.i].content.itemList[this.m].childrenElement[this.selfindex].location.width/a,h="edit"+N+this.i+"_"+this.m+"_"+this.selfindex),s=o*c,n*c,l=0,d=0,r.attr({id:h})}else{c=e.pageList[this.i].diyDisplayWidth/t;s=i*c,n*c;h=N+this.i+"_"+this.m;(this.selfindex||0==this.selfindex)&&(h=N+this.i+"_"+this.m+"_"+this.selfindex),r.attr({id:h})}return r.attr({class:"show-warn",width:s,height:s,x:l+this.objJson.location.width/2-s/2,y:d+this.objJson.location.height/2-s/2,style:"pointer-events: none"}),r}},{key:"initMaskShape",value:function(){var e,t=this;if(SVG("#"+j+t.i+"_"+t.m))return SVG("#"+j+t.i+"_"+t.m);e=t.parent.rect();var i=t.vm.$store.getters.detailJson,a=i.pageList[t.i].content.itemList[0].location.x,o=i.pageList[t.i].content.itemList[0].location.y,s=i.pageList[t.i].content.itemList[0].location.width,n=i.pageList[t.i].content.itemList[0].location.height;if("photo"==i.diyType){var r=i.pageList[t.i].diyWorkAreaWidth/i.pageList[t.i].workAreaWidth,l=i.pageList[t.i].content.itemList[0].location.x,d=i.pageList[t.i].content.itemList[0].location.y,c=l+x["a"].productBleedSpace*r,h=d+x["a"].productBleedSpace*r,g=x["a"].productBleedSpace*r;if(2==i.templateInfo.coverper&&i.coverInfo.hascover&&0==t.i&&i.pageList[0].iscover){g=x["a"].yignkeProductBleedSpace*r,c=l+x["a"].yignkeProductBleedSpace*r,h=d+x["a"].yignkeProductBleedSpace*r;var m=localStorage.getItem(t.vm.pageKey.rk);4==m&&(g=x["a"].rkBleedSpace*r,c=l+x["a"].rkBleedSpace*r,h=d+x["a"].rkBleedSpace*r)}a=c,o=h,s=i.pageList[t.i].content.itemList[0].location.width-2*g,n=i.pageList[t.i].content.itemList[0].location.height-2*g}return e.attr({id:j+t.i+"_"+t.m,x:a,y:o,width:s,height:n}),e}}]),i}(v["a"]),B=function(e,t){e.preventDefault(),o=e.targetTouches[0].pageX,s=e.targetTouches[0].pageY,l=t.x(),d=t.y()},K=function(e,t,i){var a=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson));n=e.targetTouches[0].pageX,r=e.targetTouches[0].pageY;var c=document.getElementById("svg_"+t.i).clientWidth,h=document.getElementById("svg_"+t.i).clientHeight,g=a.pageList[t.i].diyDisplayWidth,m=a.pageList[t.i].diyDisplayHeight,p=Math.round((n-o)*g/c),u=Math.round((r-s)*m/h),f=Object(I["a"])(i,p,u);if(p=f.xspace,u=f.yspace,(i.x()!=l+p||i.y()!=d+u)&&(i.attr({x:Math.round(l+p),y:Math.round(d+u)}),t.objJson.isBeyond)){var y=JSON.stringify(a);localStorage.setItem(t.vm.pageKey.detailJson,y)}},M=function(e,t,i){e.changedTouches[0].pageX,e.changedTouches[0].pageY;var a=JSON.parse(localStorage.getItem(t.vm.pageKey.detailJson)),c=document.getElementById("svg_"+t.i).clientWidth,h=document.getElementById("svg_"+t.i).clientHeight,g=a.pageList[t.i].diyDisplayWidth,m=a.pageList[t.i].diyDisplayHeight,p=Math.round((n-o)*g/c),u=Math.round((r-s)*m/h),f=Object(I["a"])(i,p,u);p=f.xspace,u=f.yspace;var y=Math.round(l+p),_=Math.round(d+u);i.attr({x:y,y:_})},$=function(e,t){c=t.width(),h=t.height(),l=t.x(),d=t.y()},U=function(e,t,i,a){t.click&&(e.preventDefault(),-1!=e.target.id.indexOf(i.id())&&(i.attr({width:c*e.scale,height:h*e.scale}),(c*e.scale<a.width()||h*e.scale<a.height())&&i.attr({x:a.width()/2-(a.width()/2-l)*e.scale,y:a.height()/2-(a.height()/2-d)*e.scale})))},W=function(e,t){var i=e.width(),a=e.height(),o=i/a,s=t.width(),n=t.height(),r=s/n;o>=r?(a=n,i=o*a,e.attr({height:a,width:i})):(i=s,a=i/o,e.attr({width:i,height:a}))},F=function(e,t){var i=e.x(),a=e.y(),o=t.x()-(e.width()-t.width()),s=t.y()-(e.height()-t.height()),n=t.x(),r=t.y();i>n&&(i=n,e.attr({x:i})),a>r&&(a=r,e.attr({y:a})),i<o&&(i=o,e.attr({x:i})),a<s&&(a=s,e.attr({y:a}))},R=function(e,t){e.width()<=e.height()?e.width()<t.width()?W(e,t):e.height()<t.height()&&W(e,t):e.height()<t.height()?W(e,t):e.width()<t.width()&&W(e,t)},q=function(e,t,i){if(!(t.objJson.location.maskFactHeight<m||t.objJson.location.maskFactWidth<g)||-1!=t.objJson.media.maskSource.indexOf("img/nophoto.jpg")){for(var a=25.4,o=300,s=2.5,n=i.pageList[t.i].workAreaWidth/a*o,r=i.pageList[t.i].workAreaHeight/a*o,l=(i.pageList[t.i].diyDisplayWidth,0),d=0,c=i.pageList[t.i].content.itemList,h=0;h<c.length;h++)if(c[h].isDesignShape&&1==c[h].isDesignShape){l=c[h].location.width,d=c[h].location.height;break}var p=Number(n)/l,u=Number(r)/d,f=i.pageList[t.i].content.itemList[t.m].location.maskFactWidth/p,y=i.pageList[t.i].content.itemList[t.m].location.maskFactHeight/u,_=e.width(),v=e.height();if(console.log(_/f+":"+s),_/f>s||v/y>s){var w;t.vm.isLowPixel=!0,console.log("图片放大后模糊！");var b="#"+N+t.i+"_"+t.m;t.isEdit&&(b="#edit"+N+t.i+"_"+t.m),SVG(b)?(w=SVG(b),w.remove(),w=t.loadWarnPix(i)):w=t.loadWarnPix(i)}else{t.vm.isLowPixel=!1;b="#"+N+t.i+"_"+t.m;t.isEdit&&(b="#edit"+N+t.i+"_"+t.m),SVG(b)&&SVG(b).remove()}}}},f5cd:function(e,t,i){},f7b6:function(e,t,i){},f84b:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjc5NUE3NDEwRDZDMjExRUFCRjZGRTc3MUExQTNEMzA0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjc5NUE3NDExRDZDMjExRUFCRjZGRTc3MUExQTNEMzA0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Nzk1QTc0MEVENkMyMTFFQUJGNkZFNzcxQTFBM0QzMDQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Nzk1QTc0MEZENkMyMTFFQUJGNkZFNzcxQTFBM0QzMDQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7Q19bLAAAFLklEQVR42tRZe0xbZRQ/9/a2BUpXytsRnoMNMyawYRbZGOJAiGaOaNx8TIfGJftH/APignsEpmZzifiHi1MXDYku2aJMcS6Zc5ljKLowHgoDBsgzTKDQAqXQ3r78zu1GYoT73T6o7vzTr+33nfPruec753dOGfBAbv5+W66Qc0VyObdbznFxrIzVylhGzTAsh987nQ6b3eE0OuwOg9VmG7Zabed4q+1SVvo6q7u2GHc2t3X0PRgQoDimVMjTtCHqBLUqUMayrOgZh8MBRtOC3TBtHLTw1g6zma/ISEvu8inA1o7e+MAA5WmNWpUVGR6ipYESAzsxOW2YMZpuLpgt+zLTUobAW+nsGaocHh2/Y7PZnb4S1IU6UbfHwEicBXX1Dl2emTWZnSskqBttoC13wWm6+4abLRbeudKCNtAW2pTsOTxAbp7TX4K27oKkexJd7g/PLeVJtE29EN7EnM1mc3rjebRNMFQtmWYwlYRpV/0auzryAamxOjNrhCtX6+FGUyv0/tkPRuOc8LlKFQRJCfGQmbEBCvMfhajICMnxP3Jn4q8pw+wj91LQIkASA5eTE2IKZDJ6jrPwPJw5Wwtff3MBeF68ODAMA4UFebDvlT2gWaWm6rbbHdA3OPpjanLc44sAsUJERWh/iY4M1dIUjE/o4GDlcRgcGhbecxwHG4mnNm1Mh4iwMODkHExN6qH9Vhf81tQM8/MLwr5QbQgcPXIAUtcmU0GOTegN4zrDVlJxOpm73vs2JTFmJ61CTOgmobTsIExO6YX3TxTlQ8mLuyB0md+1sGCG83UX4UvibavVCkqFAt5/r4oKEitO78BoHfFiMYOFn8Red0JsdJLYITRQWnZIiDWOk0FFeSnk5mRLiquevn6oOPyOELMhIRr47KNq0GhWiZ4ZHBnrJ7GYyiIrIYU/nmbkq/MXBHAoB8pelwwOZW1yEpx49wgoFHKYnp6Bkx9/Tj2DmBAbi5QJWYnYZoyjc7V1wjo/bxvkbdvidulck5QAr778grC+1tAIteTRP1+yH+q+v7TkfsSE2FiBz1Fir6HxBphM88KNLHnpOY/re/GOIuGykJQHpz6tAZ1uClrb2pfci5hc2AjZpCluam4VXlPXpUB0VITHAPHGb83e/I/P8rfnLrufpLxQFpkwTXH/gIu2ZTy03mv6lpmetriOjAiH7M1Zy+5lWSaYvUfTxcRgmHYpDA/3GmB4WOji+qknC0EsvBAbB36W2NgYUAer0DrJo9vpYYENDvXKk8A2zpkIXZ/0GmCwSgVnak4J66DAQNG9iI3F7oumNCnRlSbb/rjlEy8iMBo4V0VxzrHYGtI2Prwp00UobvfC2LjOb+FAiIOexb4Va5+Y5JDUgBQK81fNF2f9Ag4xITYWm2rsW0UfSVAg7H5mp7C+8tN1uFr/s9sGBwaHCQs6BteuN0raj5gQG4sdP2mqqf3ps0/vgJQ1Lj5xovok1Dc0SgaHZKG8opIQ2xb47uIPks4gJsTG4jiCdPzttMcsl8vh6OE3hTxG+lp4+/gHUP3hJ6DXLx/CFotFILZvlB8SmAzSrb17dkl6vIgJsfmcsCqVCpgifLGzu2exhqMgzap8qxzS1qdKJaxbcETiF8qfn5cD+1/bS+WAy1J+XzdNAQFKSIyPE7xa8FguxKyO9rhp8nnbyfO8T9vO/33j/q+AM82biwdGxlrxpvpL0BbaRNvuDI9a/Dg8apE8PLovxm9+HGBW3fcjYE+H6Buwb3VziD6E5WtFhuj/5d8QfwswAEx2UxI9gS7QAAAAAElFTkSuQmCC"},fa47:function(e,t,i){"use strict";var a=i("e578"),o=i.n(a);o.a},fa68:function(e,t,i){e.exports=i.p+"static/img/loading-book.931c0368.svg"},fd6f:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVFNDQ2NkUwRDZDMjExRUE4RkRFRTBERDBDMjMzRkU3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjVFNDQ2NkUxRDZDMjExRUE4RkRFRTBERDBDMjMzRkU3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NUU0NDY2REVENkMyMTFFQThGREVFMEREMEMyMzNGRTciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NUU0NDY2REZENkMyMTFFQThGREVFMEREMEMyMzNGRTciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7xwGBQAAADYElEQVR42tSZ30sUURTHz141c+vVoCgqKAOzECEiNvIHYSlC9Pu557BCI/fJbQtCKSvyb/BFapfAfPAh1rAgAomwoB9EkQS5b8EqpWnf45zV2XV2du7MuKsHDndY7tz7mXN/fO89GyAXttDWU4GiHt4Ar4PvhW+BB6XKNHwK/hk+Dk/ARwND4RndvgKaYIdQtMPPwDdp9pWCx+D9AH3jKyDAalD0wZvJHxuBdwJ0whMgwEpRROFd8BLy1/7Be+ERgM5pAwKuEkUcHqLVtTGeMoBMOgYE3HYUz2XyF8J4MTUBcjIvoETuZQHhzJCh7EgqizkXLwIcSZ8xYbAGlAURouLZUWFYOcSylbxdhdXqZnXXprcgcwT7bOGuthI9ukRUtdV91ydriZ50El1rtatVIizLQywKkXsTDiDQ9dVEu6Fmty8S7dumD3f8ANHlE0QbSo127K1ZmJYi2G4vJQuI3rBRBsuJbl3Qg2zAx11pMZ5/Q44fPHPy1iJTQIQ/6UhbuaOONiOi03+IugeJPv50/k4K74QHiL4lnWp3pZJTiTPhT3wguj+UGcmaHc4/KDLoFI6EqV7Jkcm5MeQ9QM7NG5BRQB7cubLekSr9aFt8opLznJ69AGRP3IDkSR85lwl5eA/RjVNe4djqlGvVeP3FGpLhwqeJStH03zkvcIvqwoskZToJ61s2kFLLz9HHRO++e9m0p5UnOKtI+gfHFlS+iNPMLNH8vEnh0WxFmS9NK7nguDeedzz/OHocRY4eR5GHnYffmy0O8ZRvcDzUPLT+QU4pOSjqG0td99lMOJ6PPO+yIY9Vuz7EKrm36sOxipSXZcKljSFZNXgPZMjrbYaq6Nu4kku1PhyrCEve3aeZcGmb+GHsgQzJG3aHK8gEA46KMOvDsS6/+pS7Pm/Q7iGZaVRJOiKWt/ou3KVuns+EY13OZ1aQjfudAMaYLb0P9uetzg1v3qgHlwuyvcUo7a1/6cAquZIR2+pffxHN4rrwcFgPzgzZNWC0k3hvfKhNaiSdv1k/lyb5oZeKb73mpFK2FkckV1IsGxOGdZr6kKHmCk2uJdBb8ihpdZohC8hJSYGMFWhYQ1aZrZyApkg2wu/IylqN1cptN+bKDdomMLPm5dpMAVuArs0kugVowf6G+C/AAGNPbPXNRvmJAAAAAElFTkSuQmCC"},fda8:function(e,t,i){"use strict";var a=i("1631"),o=i.n(a);o.a},fdad:function(e,t,i){},fdc3:function(e,t,i){},ff08:function(e,t,i){"use strict";i.d(t,"a",function(){return h});var a=i("d225"),o=i("b0b4"),s=i("d80f"),n=i("a09a"),r=i("89d6"),l=i("f5b3"),d=i("b2a9"),c="selfGroup_",h=function(){function e(t,i,o,s,n){Object(a["a"])(this,e),this.parent=t,this.objJson=i,this.paragramJson=o,this.pageImgJson=o.pageImgJson,this.i=o.parentIndex,this.m=o.itemIndex,this.b=o.childIndex,this.id=o.id,this.vm=s,this.index=0,this.currentChildIndex=n}return Object(o["a"])(e,[{key:"allchange",value:function(){this.index=0;for(var e=0;e<this.objJson.childrenElement.length;e++)(!this.currentChildIndex&&0!=this.currentChildIndex||e==this.currentChildIndex)&&(this.paragramJson.childIndex=e,this.initGroup(this.objJson.childrenElement[e]))}},{key:"initGroup",value:function(e){var t=this,i=c+t.i+"_"+t.m;if(!SVG("#"+i)){if(e.media.mediaType==s["a"].IMAGE){var a=new r["a"](t.parent,e,t.pageImgJson,t.i,t.m,!1,t.vm,null,null,t.paragramJson.childIndex);a.initDecorateImg()}if(e.media.mediaType==s["a"].ADVANCED_IMAGE_MASK){var o={pageImgJson:t.pageImgJson,parentIndex:t.i,childIndex:t.m,svgindex:t.paragramJson.childIndex,id:"bgimg_photo_"+t.i+"_"+t.m+"_"+t.paragramJson.childIndex,isEdit:!1},h=new l["a"](t.parent,e,o,t.vm);h.initMask()}if(e.media.mediaType==s["a"].TEXT){o={pageImgJson:t.pageImgJson,pageIndex:t.i,itemIndex:t.m,selfindex:t.paragramJson.childIndex,isEdit:!1,vm:t.vm};var g=new n["a"](t.parent,e,o);g.initCustomText()}if(e.media.mediaType==s["a"].SVG){o={i:t.i,m:t.m,c:t.paragramJson.childIndex,index:this.index};var m=new d["a"](t.parent,e,o,t.vm);m.initSvgImg(),this.index++}}}}]),e}()},ff8b:function(e,t,i){"use strict";var a=i("c686"),o=i.n(a);o.a}});